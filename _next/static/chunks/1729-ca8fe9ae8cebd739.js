try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="f3310334-413b-4eb5-835c-fb22527c8cb2",e._sentryDebugIdIdentifier="sentry-dbid-f3310334-413b-4eb5-835c-fb22527c8cb2")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1729],{31729:function(e,n,t){var s=t(11010),i=t(97582),r=t(85893),a=t(67294),d=t(42130),c=t(39360),l=t(86501),o=t(27245),u=t(41664),m=t.n(u),x=t(11163),f=t(20442),h=t(93950),g=t(93566),b=t(7080),v=t(73591),y=t(93778),j=t(26858),N=t(42083),I=t(44576),w=t(72107),B=t(26952);n.Z=function(e){var n,t=e.actionId,u=e.actionInfo,p=e.onStakedAmountChange,C=e.showJoinButton,A=(0,d.m)().address;(0,c.x)();var k=((0,a.useContext)(y.M)||{}).token,_=(0,x.useRouter)(),D=(0,f.Bk)(),E=D.currentRound,P=D.error,z=(0,g.$A)((null==k?void 0:k.address)||"",E,t),L=z.isSubmitted,H=z.error,R=z.isPending,F=(0,b.Dn)((null==k?void 0:k.address)||"",E,t),S=F.isActionIdVoted,Z=F.error,J=F.isPending,M=(0,f.X9)((null==k?void 0:k.address)||"",t,A||""),T=M.joinedAmountByActionIdByAccount,K=M.isPending,Q=M.error,V=(0,f.PL)((null==k?void 0:k.address)||"",t),X=V.joinedAmountByActionId,$=V.isPending,q=V.error,G=T&&T>0&&X&&X>0,O=G?Number(T)/Number(X)*100:0,U=(0,j.rl)(O),W=G&&u?(0,B.cH)(T||BigInt(0),X||BigInt(0),Number(u.body.maxRandomAccounts||0)):0,Y=(0,j.rl)(W),ee=G&&u?(0,B.CI)(T||BigInt(0),X||BigInt(0),Number(u.body.maxRandomAccounts||0)):BigInt(0),en=(0,h.Cv)((null==k?void 0:k.address)||"",t,A||""),et=en.verificationKeys,es=en.verificationInfos,ei=en.isPending,er=en.error,ea=(0,f.Qc)(),ed=ea.withdraw,ec=ea.isPending,el=ea.isConfirming,eo=ea.isConfirmed,eu=ea.writeError,em=(n=(0,s._)(function(){return(0,i.Jh)(this,function(e){switch(e.label){case 0:if(void 0!=T&&T<=BigInt(2))return l.Am.error("你还没有参与，无需取回"),[2];return[4,ed((null==k?void 0:k.address)||"",t)];case 1:return e.sent(),[2]}})}),function(){return n.apply(this,arguments)});(0,a.useEffect)(function(){eo&&(l.Am.success("取回成功"),_.push("/my"))},[eo,_]),(0,a.useEffect)(function(){K||null==p||p(T||BigInt(0))},[T,K]);var ex=(0,v.S)().handleContractError;return((0,a.useEffect)(function(){Q&&ex(Q,"join"),q&&ex(q,"join"),er&&ex(er,"join"),P&&ex(P,"join"),eu&&ex(eu,"join"),H&&ex(H,"submit"),Z&&ex(Z,"vote")},[Q,q,er,P,eu,H,Z]),K||$||R||J)?"":(0,r.jsxs)("div",{className:"flex flex-col items-center px-0 pt-1",children:[G&&(0,r.jsxs)("div",{className:"stats w-full grid grid-cols-2 divide-x-0 gap-4",children:[(0,r.jsxs)("div",{className:"stat place-items-center min-h-[120px] flex flex-col justify-center",children:[(0,r.jsx)("div",{className:"stat-title",children:"我的参与"}),(0,r.jsx)("div",{className:"stat-value text-2xl text-secondary",children:K?(0,r.jsx)(N.Z,{}):(0,j.LH)(T||BigInt(0),0)}),(0,r.jsxs)("div",{className:"stat-desc text-sm mt-2 whitespace-normal break-words text-center",children:[null==k?void 0:k.symbol,"数量"]})]}),(0,r.jsxs)("div",{className:"stat place-items-center min-h-[120px] flex flex-col justify-center p-0",children:[(0,r.jsx)("div",{className:"stat-title",children:"被抽中验证概率"}),(0,r.jsx)("div",{className:"stat-value text-2xl text-secondary",children:Y}),(0,r.jsxs)("div",{className:"stat-desc text-sm mt-2 whitespace-normal break-words text-center",children:["我的占比：",U]})]})]}),W<100&&ee>BigInt(0)&&(0,r.jsxs)("div",{className:"text-sm mb-2 text-gray-500 whitespace-normal break-words text-center",children:["（要100%概率被抽中，至少还需"," ",(0,r.jsxs)("span",{className:"text-secondary",children:[" ",(0,j.LH)(ee,4,"ceil")]})," 代币）"]}),(void 0===C||C)&&(0,r.jsx)(r.Fragment,{children:G?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex justify-center space-x-2 mt-2 w-full",children:[void 0!=T&&T<=BigInt(2)?(0,r.jsx)(o.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",disabled:!0,children:"取回"}):(0,r.jsx)(o.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",onClick:em,disabled:ec||el||eo,children:ec?"提交中":el?"确认中":eo?"已取回":"取回代币"}),(0,r.jsx)(o.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",asChild:!0,children:(0,r.jsx)(m(),{href:"/my/rewardsofaction?id=".concat(t,"&symbol=").concat(null==k?void 0:k.symbol),children:"查看激励"})}),S?(0,r.jsx)(o.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",asChild:!0,children:(0,r.jsx)(m(),{href:"/acting/join?id=".concat(t,"&symbol=").concat(null==k?void 0:k.symbol),children:"增加参与代币"})}):(0,r.jsx)(o.z,{variant:"outline",className:"w-1/3",disabled:!0,children:"增加参与代币"})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-700 bg-gray-50 border border-gray-200 rounded px-2 py-3 mt-3 mb-3 w-full",children:[(0,r.jsx)("div",{className:"font-medium text-gray-600 mb-3",children:"\uD83D\uDCA1 小贴士："}),(0,r.jsx)("div",{className:"ml-4 text-gray-600 mb-2",children:"1. 要100%被抽中的代币数 = 总参与代币数 / 最大激励地址数。 所以，有其他人增加参与代币，就需要更多代币才能达到100%概率被抽中。"}),(0,r.jsx)("div",{className:"ml-4 text-gray-600",children:"2. 当前验证的是上一轮的行动结果，所以取回代币，不会影响正在进行的验证，也不会影响上一轮行动的激励。"})]}),(0,r.jsx)("div",{className:"flex flex-col items-start my-4 w-full",children:(0,r.jsxs)("div",{className:"text-sm text-greyscale-600 w-full",children:[ei&&"加载中...",void 0!=T&&T>BigInt(2)&&et&&et.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{className:"text-base font-medium text-gray-700 mb-3",children:"我提供的验证信息："}),(0,r.jsx)("div",{className:"w-full bg-gray-50 rounded-lg p-4 border border-gray-100",children:(0,r.jsx)("div",{className:"w-full text-left",children:et.map(function(e,n){return(0,r.jsxs)("div",{className:"mb-2",children:[(0,r.jsx)("div",{className:"text-sm font-bold text-greyscale-600",children:e}),(0,r.jsx)("div",{className:"text-base",children:(0,r.jsx)(w.L,{text:es[n]})})]},n)})})})]})]})})]}):L&&(0,r.jsx)(o.z,{variant:"outline",className:"w-1/2 text-secondary border-secondary",asChild:!0,children:(0,r.jsx)(m(),{href:"/acting/join?id=".concat(t,"&symbol=").concat(null==k?void 0:k.symbol),children:"参与行动"})})}),(0,r.jsx)(I.Z,{isLoading:ec||el,text:ec?"提交交易...":"确认交易..."})]})}},26952:function(e,n,t){function s(e,n){return n<=0||e<=BigInt(0)||1===n?BigInt(0):e/(BigInt(n)-BigInt(1))}function i(e,n,t){if(t<=0||n<=BigInt(0)||1===t)return BigInt(0);var s=n-e*BigInt(t);if(s<=BigInt(0))return BigInt(0);var i=s/BigInt(t-1);return i>BigInt(0)?i:BigInt(0)}function r(e,n,t){return n<=BigInt(0)||t<=0||e<=BigInt(0)?0:Math.min(Number(e)/Number(n)*100*t,100)}t.d(n,{CI:function(){return i},cH:function(){return r},h3:function(){return s}})}}]);