try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="2629b900-5847-4467-bb06-2990cc16a0c0",e._sentryDebugIdIdentifier="sentry-dbid-2629b900-5847-4467-bb06-2990cc16a0c0")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3483],{31729:function(e,n,r){var t=r(11010),i=r(97582),s=r(85893),a=r(67294),o=r(42130),c=r(39360),u=r(86501),d=r(27245),l=r(41664),f=r.n(l),m=r(11163),h=r(20442),g=r(93950),v=r(93566),x=r(7080),b=r(73591),p=r(93778),y=r(91529),j=r(42083),w=r(44576),N=r(72107);n.Z=function(e){var n,r=e.actionId,l=e.actionInfo,k=e.onStakedAmountChange,I=e.showJoinButton,C=(0,o.m)().address;(0,c.x)();var B=((0,a.useContext)(p.M)||{}).token,P=(0,m.useRouter)(),E=(0,h.Bk)(),A=E.currentRound,_=E.error,L=(0,v.$A)((null==B?void 0:B.address)||"",A,r),$=L.isSubmitted,z=L.error,M=L.isPending,R=(0,x.Dn)((null==B?void 0:B.address)||"",A,r),T=R.isActionIdVoted,D=R.error,S=R.isPending,F=(0,h.X9)((null==B?void 0:B.address)||"",r,C||""),H=F.joinedAmountByActionIdByAccount,K=F.isPending,V=F.error,Z=(0,h.PL)((null==B?void 0:B.address)||"",r),q=Z.joinedAmountByActionId,J=Z.isPending,W=Z.error,X=H&&H>0&&q&&q>0,Q=X?Number(H)/Number(q)*100:0,U=(0,y.rl)(Q),G=X?(0,y.rl)(Math.min(Q*Number(null==l?void 0:l.body.maxRandomAccounts),100)):"0%",O=(0,g.Cv)((null==B?void 0:B.address)||"",r,C||""),Y=O.verificationKeys,ee=O.verificationInfos,en=O.isPending,er=O.error,et=(0,h.Qc)(),ei=et.withdraw,es=et.isPending,ea=et.isConfirming,eo=et.isConfirmed,ec=et.writeError,eu=(n=(0,t._)(function(){return(0,i.Jh)(this,function(e){switch(e.label){case 0:if(void 0!=H&&H<=BigInt(2))return u.Am.error("你还没有参与，无需取回"),[2];return[4,ei((null==B?void 0:B.address)||"",r)];case 1:return e.sent(),[2]}})}),function(){return n.apply(this,arguments)});(0,a.useEffect)(function(){eo&&(u.Am.success("取回成功"),P.push("/my"))},[eo,P]),(0,a.useEffect)(function(){K||null==k||k(H||BigInt(0))},[H,K]);var ed=(0,b.S)().handleContractError;return((0,a.useEffect)(function(){V&&ed(V,"join"),W&&ed(W,"join"),er&&ed(er,"join"),_&&ed(_,"join"),ec&&ed(ec,"join"),z&&ed(z,"submit"),D&&ed(D,"vote")},[V,W,er,_,ec,z,D]),K||J||M||S)?"":(0,s.jsxs)("div",{className:"flex flex-col items-center px-4 pt-1",children:[X&&(0,s.jsxs)("div",{className:"stats w-full grid grid-cols-2 divide-x-0",children:[(0,s.jsxs)("div",{className:"stat place-items-center",children:[(0,s.jsx)("div",{className:"stat-title",children:"我的参与"}),(0,s.jsx)("div",{className:"stat-value text-2xl text-secondary",children:J?(0,s.jsx)(j.Z,{}):(0,y.LH)(H||BigInt(0),0)}),(0,s.jsx)("div",{className:"stat-desc text-sm mt-2",children:"参与本行动的代币"})]}),(0,s.jsxs)("div",{className:"stat place-items-center",children:[(0,s.jsx)("div",{className:"stat-title",children:"我的占比"}),(0,s.jsx)("div",{className:"stat-value text-2xl text-secondary",children:U}),(0,s.jsxs)("div",{className:"stat-desc text-sm mt-2",children:["被抽中验证概率 ",G]})]})]}),(void 0===I||I)&&(0,s.jsx)(s.Fragment,{children:X?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex justify-center space-x-2 mt-2 w-full",children:[void 0!=H&&H<=BigInt(2)?(0,s.jsx)(d.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",disabled:!0,children:"取回"}):(0,s.jsx)(d.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",onClick:eu,disabled:es||ea||eo,children:es?"提交中":ea?"确认中":eo?"已取回":"取回代币"}),(0,s.jsx)(d.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",asChild:!0,children:(0,s.jsx)(f(),{href:"/my/rewardsofaction?id=".concat(r,"&symbol=").concat(null==B?void 0:B.symbol),children:"查看激励"})}),T?(0,s.jsx)(d.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",asChild:!0,children:(0,s.jsx)(f(),{href:"/acting/join?id=".concat(r,"&symbol=").concat(null==B?void 0:B.symbol),children:"增加参与代币"})}):(0,s.jsx)(d.z,{variant:"outline",className:"w-1/3",disabled:!0,children:"增加参与代币"})]}),(0,s.jsx)("div",{className:"flex flex-col items-center my-4",children:(0,s.jsxs)("div",{className:"text-sm text-greyscale-600",children:[en&&"加载中...",void 0!=H&&H>BigInt(2)&&Y&&Y.length>0&&(0,s.jsx)("div",{children:Y.map(function(e,n){return(0,s.jsxs)("div",{children:[e,": ",(0,s.jsx)(N.L,{text:ee[n]})]},n)})})]})})]}):$&&(0,s.jsx)(d.z,{variant:"outline",className:"w-1/2 text-secondary border-secondary",asChild:!0,children:(0,s.jsx)(f(),{href:"/acting/join?id=".concat(r,"&symbol=").concat(null==B?void 0:B.symbol),children:"参与行动"})})}),(0,s.jsx)(w.Z,{isLoading:es||ea,text:es?"提交交易...":"确认交易..."})]})}},42083:function(e,n,r){var t=r(85893),i=r(23432);n.Z=function(){return(0,t.jsx)(i.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},93566:function(e,n,r){r.d(n,{$A:function(){return h},Bk:function(){return m},Xo:function(){return x},dI:function(){return f},qd:function(){return v},sK:function(){return g}});var t=r(11010),i=r(97582),s=r(67294),a=r(71104),o=r(7724),c=r(37742),u=r(84689),d=r(37474),l="0xeBB295af1D4ee9ed92e55EFF4ca5Eb8D4AB81aCE",f=function(e,n){var r=(0,a.u)({address:l,abi:o.d,functionName:"actionInfo",args:[e,n||BigInt(0)],query:{enabled:!!e&&void 0!==n}});return{actionInfo:r.data,isPending:r.isPending,error:r.error}},m=function(){var e=(0,a.u)({address:l,abi:o.d,functionName:"currentRound",args:[]}),n=e.data,r=e.isPending,t=e.error;return{currentRound:(0,c.Zu)(n),isPending:r,error:t}},h=function(e,n,r){var t=(0,a.u)({address:l,abi:o.d,functionName:"isSubmitted",args:[e,n,r]});return{isSubmitted:t.data,isPending:t.isPending,error:t.error}},g=function(e,n,r){var t=(0,a.u)({address:l,abi:o.d,functionName:"submitInfo",args:[e,n,r],query:{enabled:!!e&&!!n}});return{submitInfo:t.data,isPending:t.isPending,error:t.error}};function v(){var e,n=(0,d.e9)(o.d,l,"submit"),r=n.execute,a=n.isPending,c=n.isConfirming,f=n.isConfirmed,m=n.error,h=n.hash,g=n.isTukeMode,v=(e=(0,t._)(function(e,n){return(0,i.Jh)(this,function(t){switch(t.label){case 0:return[4,r([e,n])];case 1:return[2,t.sent()]}})}),function(n,r){return e.apply(this,arguments)});return(0,s.useEffect)(function(){m&&((0,u.Vh)(m),(0,u.H)(m))},[h,m,f]),{submit:v,isPending:a,isConfirming:c,writeError:m,isConfirmed:f,hash:h,isTukeMode:g}}function x(){var e,n=(0,d.e9)(o.d,l,"submitNewAction"),r=n.execute,a=n.isPending,c=n.isConfirming,f=n.isConfirmed,m=n.error,h=n.hash,g=n.isTukeMode,v=(e=(0,t._)(function(e,n){return(0,i.Jh)(this,function(t){switch(t.label){case 0:return[4,r([e,n])];case 1:return[2,t.sent()]}})}),function(n,r){return e.apply(this,arguments)});return(0,s.useEffect)(function(){m&&((0,u.Vh)(m),(0,u.H)(m))},[h,m,f]),{submitNewAction:v,isPending:a,isConfirming:c,writeError:m,isConfirmed:f,hash:h,isTukeMode:g}}},45655:function(e,n,r){r.d(n,{Hg:function(){return c},KL:function(){return a},lt:function(){return o},rJ:function(){return u}});var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};function i(e){return e?e.replace(/[&<>"'/]/g,function(e){return t[e]||e}):""}function s(e){if(!e)return"";var n=e.replace(/<[^>]*>/g,"");return i(n=(n=(n=n.replace(/javascript:/gi,"")).replace(/on\w+\s*=/gi,"")).replace(/data:[^;]*;base64,/gi,""))}function a(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"";var r=/(https?:\/\/[^\s]+)/g;if(0===(e.match(r)||[]).length){var t=i(e);return n?t.replace(/\n/g,"<br>"):t}var s=e;return s=(s=(s=(s=s.replace(/<script[^>]*>.*?<\/script>/gi,"")).replace(/<[^>]*on\w+\s*=\s*[^>]*>/gi,"")).replace(/javascript:/gi,"")).split(r).map(function(e,n){return n%2==0?function(e){if(!e)return"";var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"};return e.replace(/[&<>"']/g,function(e){return n[e]||e})}(e):o(e)?e:i(e)}).join(""),n&&(s=s.replace(/\n/g,"<br>")),s}function o(e){if(!e)return!1;try{var n=new URL(e);if(!["https:","http:"].includes(n.protocol))return!1;var r=n.hostname.toLowerCase();if(["malicious-site.com","evil.com","phishing-site.com","bit.ly","tinyurl.com","t.co"].some(function(e){return r.includes(e)}))return!1;if(["weibo.com","twitter.com","x.com","facebook.com","instagram.com","linkedin.com","youtube.com","tiktok.com","douyin.com","github.com","gitlab.com","stackoverflow.com","medium.com","wikipedia.org","reddit.com","discord.com","telegram.org","etherscan.io","bscscan.com","coinmarketcap.com","coingecko.com"].some(function(e){return r===e||r.endsWith("."+e)}))return!0;if(/[\u0000-\u001f\u007f-\u009f]/.test(r)||["phishing","malware","virus","hack"].some(function(e){return r.includes(e)})||!/^[a-zA-Z0-9.-]+$/.test(r))return!1;return!0}catch(e){return!1}}function c(e){var n=[],r=e;if(!e||""===e.trim())return{isValid:!1,errors:["验证规则不能为空"],sanitizedRule:""};e.length>1e4&&n.push("验证规则不能超过10000字"),/<(?:script|iframe|object|embed|form|input|meta|link|style)[^>]*>/gi.test(e)&&(n.push("验证规则不能包含危险的HTML标签"),r=s(e)),RegExp("(?<!https?:\\/\\/[^\\s]*)(javascript:|onclick\\s*=|onerror\\s*=|onload\\s*=|<script)","gi").test(e)&&(n.push("验证规则不能包含可执行脚本代码"),r=s(e));var t=e.match(/(https?:\/\/[^\s]+)/g)||[];if(t.length>0){var i=t.filter(function(e){return!o(e)});i.length>0&&n.push("包含不安全的链接: ".concat(i.join(", ")))}return{isValid:0===n.length,errors:n,sanitizedRule:r}}function u(e){var n=[];if(!e||""===e.trim())return{isValid:!1,errors:["验证名称不能为空"],sanitizedKey:""};var r=s(e);return r!==e&&n.push("验证名称包含不安全的内容"),{isValid:0===n.length,errors:n,sanitizedKey:r}}},72107:function(e,n,r){r.d(n,{L:function(){return o}});var t=r(85893);r(67294);var i=r(40330),s=r(45655),a=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return e;var r=/(https?:\/\/[^\s]+)/g;if(!r.test(e)){var a=(0,s.KL)(e,n);return(0,t.jsx)("span",{dangerouslySetInnerHTML:{__html:a}})}var o=e.split(r),c=e.match(r)||[];return(0,t.jsx)(t.Fragment,{children:o.map(function(e,r){if(r%2==0){var a=(0,s.KL)(e,n);return(0,t.jsx)("span",{dangerouslySetInnerHTML:{__html:a}},r)}var o=c[(r-1)/2];return(0,s.lt)(o)?(0,t.jsx)("a",{href:o,onClick:function(e){e.preventDefault(),(0,s.lt)(o)?i.N.handleExternalLink(o):alert("此链接已被识别为不安全链接，无法打开")},className:"text-blue-500 underline hover:text-blue-700 break-words break-all whitespace-normal",target:"_blank",rel:"noopener noreferrer",title:"外部链接: ".concat(o),children:o},r):(0,t.jsx)("span",{className:"text-red-500",children:"[不安全的链接已被屏蔽]"},r)})})},o=function(e){var n=e.text,r=e.preserveLineBreaks;return(0,t.jsx)(t.Fragment,{children:a(n,void 0!==r&&r)})}},21803:function(e,n,r){r.d(n,{v:function(){return t}});function t(e,n){let[r,t="0"]=e.split("."),i=r.startsWith("-");if(i&&(r=r.slice(1)),t=t.replace(/(0+)$/,""),0===n)1===Math.round(Number(`.${t}`))&&(r=`${BigInt(r)+1n}`),t="";else if(t.length>n){let[e,i,s]=[t.slice(0,n-1),t.slice(n-1,n),t.slice(n)],a=Math.round(Number(`${i}.${s}`));(t=a>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${a}`).length>n&&(t=t.slice(1),r=`${BigInt(r)+1n}`),t=t.slice(0,n)}else t=t.padEnd(n,"0");return BigInt(`${i?"-":""}${r}${t}`)}}}]);