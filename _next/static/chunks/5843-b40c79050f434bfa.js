try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},s=(new e.Error).stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="0abd03c7-f78c-4f1f-bb61-4e450eb3a4b4",e._sentryDebugIdIdentifier="sentry-dbid-0abd03c7-f78c-4f1f-bb61-4e450eb3a4b4")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5843],{34680:function(e,s,n){n.d(s,{Ol:function(){return o},SZ:function(){return u},Zb:function(){return l},aY:function(){return m},eW:function(){return f},ll:function(){return d}});var t=n(72253),r=n(47702),a=n(85893),c=n(67294),i=n(40108),l=c.forwardRef(function(e,s){var n=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,t._)({ref:s,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",n)},c))});l.displayName="Card";var o=c.forwardRef(function(e,s){var n=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,t._)({ref:s,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",n)},c))});o.displayName="CardHeader";var d=c.forwardRef(function(e,s){var n=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,t._)({ref:s,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",n)},c))});d.displayName="CardTitle";var u=c.forwardRef(function(e,s){var n=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,t._)({ref:s,className:(0,i.cn)("text-sm text-muted-foreground",n)},c))});u.displayName="CardDescription";var m=c.forwardRef(function(e,s){var n=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,t._)({ref:s,className:(0,i.cn)("p-6 pt-0",n)},c))});m.displayName="CardContent";var f=c.forwardRef(function(e,s){var n=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,t._)({ref:s,className:(0,i.cn)("flex items-center p-6 pt-0",n)},c))});f.displayName="CardFooter"},64777:function(e,s,n){var t=n(85893);s.Z=function(e){var s=e.title;return(0,t.jsx)("div",{className:"flex justify-between items-center",children:(0,t.jsx)("h1",{className:"text-lg font-bold",children:s})})}},42083:function(e,s,n){var t=n(85893),r=n(23432);s.Z=function(){return(0,t.jsx)(r.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},65843:function(e,s,n){n.r(s),n.d(s,{default:function(){return A}});var t=n(91309),r=n(85893),a=n(67294),c=n(11163),i=n(7080),l=n(73591),o=n(93778),d=n(83494),u=n(42083),m=n(42130),f=n(86501),x=n(27245),h=n(34680),v=n(41664),N=n.n(v),g=n(93950),b=n(26858),j=n(64777),y=function(e){var s=e.currentRound,n=e.onNext,c=(0,m.m)().address,i=((0,a.useContext)(o.M)||{}).token,d=(0,t._)((0,a.useState)(new Set),2),v=d[0],y=d[1],p=(0,g.YK)((null==i?void 0:i.address)||"",s,c),w=p.votingActions,_=p.isPending,S=p.error,k=(0,l.S)().handleContractError;(0,a.useEffect)(function(){S&&k(S,"vote")},[S,k]);var C=function(e){y(function(s){var n=new Set(s);return n.has(e)?n.delete(e):n.add(e),n})},B=w.reduce(function(e,s){return e+s.votesNum},BigInt(0));return _||!i?(0,r.jsx)("div",{className:"p-4 flex justify-center items-center",children:(0,r.jsx)(u.Z,{})}):(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)(j.Z,{title:"投票中的行动"}),i&&(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)(x.z,{variant:"outline",size:"sm",className:"text-secondary border-secondary",asChild:!0,children:(0,r.jsx)(N(),{href:"/action/new/?symbol=".concat(null==i?void 0:i.symbol),children:"推举新行动"})}),(0,r.jsx)(x.z,{variant:"outline",size:"sm",className:"text-secondary border-secondary",asChild:!0,children:(0,r.jsx)(N(),{href:"/submit/actions?symbol=".concat(null==i?void 0:i.symbol),children:"推举历史行动"})})]})]}),(0,r.jsx)("div",{className:"space-y-4",children:w.length>0?(0,r.jsxs)(r.Fragment,{children:[w.sort(function(e,s){return Number(s.votesNum-e.votesNum)}).map(function(e){var s=e.action;return(0,r.jsxs)(h.Zb,{className:"shadow-none flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",className:"checkbox accent-secondary ml-2",checked:v.has(BigInt(s.head.id)),onChange:function(){return C(BigInt(s.head.id))}}),(0,r.jsxs)(N(),{href:"/vote/single?id=".concat(s.head.id,"&symbol=").concat(null==i?void 0:i.symbol),className:"w-full",children:[(0,r.jsxs)(h.Ol,{className:"px-3 pt-2 pb-1 flex-row justify-start items-baseline",children:[(0,r.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No."}),(0,r.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(s.head.id)}),(0,r.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(s.body.title)})]}),(0,r.jsx)(h.aY,{className:"px-3 pt-1 pb-2",children:(0,r.jsxs)("div",{className:"flex justify-between mt-1 text-sm",children:[(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"text-greyscale-400 mr-1",children:"投票数"}),(0,r.jsx)("span",{className:"text-secondary",children:(0,b.LH)(e.votesNum)})]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"text-greyscale-400 mr-1",children:"占比"}),(0,r.jsx)("span",{className:"text-secondary",children:B===BigInt(0)?"-":(0,b.rl)(100*Number(e.votesNum)/Number(B))})]})]})})]},s.head.id)]},s.head.id)}),(0,r.jsx)("div",{className:"flex justify-center mt-4",children:(0,r.jsx)(x.z,{variant:"outline",className:"w-1/2 text-secondary border-secondary",onClick:function(){var e=Array.from(v);if(0===e.length){f.Am.error("请选择行动");return}n(e)},children:"给选中的行动投票"})}),(0,r.jsx)("div",{className:"mt-2 text-sm text-greyscale-500 text-center",children:"提示: 每轮最大可投票数，等于您的治理票数"})]}):(0,r.jsxs)("div",{className:"text-center mt-8",children:[(0,r.jsx)("div",{className:"text-base text-greyscale-500 mb-4",children:"还没有推举行动，请先推举！"}),(0,r.jsx)(x.z,{asChild:!0,children:(0,r.jsx)(N(),{href:"/submit/actions?symbol=".concat(null==i?void 0:i.symbol),children:"去推举行动"})})]})})]})},p=n(11010),w=n(75766),_=n(72253),S=n(14932),k=n(97582),C=n(92180),B=n(44576),E=function(e){var s=e.validGovVotes,n=e.votesNumByAccount,t=e.isPendingValidGovVotes,a=e.isPendingVotesNumByAccount,c=e.tokenSymbol;return(0,r.jsx)("div",{className:"stats w-full",children:(0,r.jsxs)("div",{className:"stat place-items-center",children:[(0,r.jsx)("div",{className:"stat-title text-sm",children:"我的剩余票数"}),(0,r.jsx)("div",{className:"stat-value text-secondary mt-2",children:t||a?(0,r.jsx)(u.Z,{}):(0,b.LH)(s-n||BigInt(0))}),(0,r.jsxs)("div",{className:"stat-desc text-sm mt-2",children:["如需更多票数，请先"," ",(0,r.jsx)(N(),{href:"/stake/stakelp/?symbol=".concat(c),className:"text-secondary",children:"获取治理票"})]})]})})},I=function(e){var s,n=e.selectedIds,c=e.currentRound,d=e.onBack,h=e.onSuccess,v=((0,a.useContext)(o.M)||{}).token,b=(0,m.m)().address,j=(0,t._)((0,a.useState)({}),2),y=j[0],I=j[1];(0,a.useEffect)(function(){if(n.length>0&&0===Object.keys(y).length){if(1===n.length)I((0,w._)({},n[0].toString(),100));else{var e={},s=Math.floor(100/n.length);n.forEach(function(t,r){r===n.length-1?e[t.toString()]=100-s*(n.length-1):e[t.toString()]=s}),I(e)}}},[n,y]);var A=function(e,s){if(1===n.length){I((0,w._)({},e,s));return}var t=(0,S._)((0,_._)({},y),(0,w._)({},e,s)),r=n.slice(0,-1).map(function(e){return e.toString()}).reduce(function(e,s){return e+(t[s]||0)},0);if(r>100){f.Am.error("投票百分比之和不能超过100%");return}t[n[n.length-1].toString()]=100-r,I(t)},Z=(0,C.Ty)(null==v?void 0:v.address,b),P=Z.validGovVotes,R=Z.isPending,V=Z.error,T=(0,i.VI)(null==v?void 0:v.address,c,b),z=T.votesNumByAccount,D=T.isPending,F=T.error,G=(0,g.fT)(null==v?void 0:v.address,n),L=G.actionInfos,M=G.isPending,H=G.error,O=(0,i.rv)(),Y=O.vote,J=O.isPending,K=O.isConfirming,W=O.isConfirmed,q=O.writeError,Q=function(){if(P-z<BigInt(2))return f.Am.error("剩余票数不足，不能投票"),!1;var e=Object.values(y).reduce(function(e,s){return e+s},0);return!(n.length>1)||100===e||(f.Am.error("百分比之和必须为100"),!1)},U=(s=(0,p._)(function(){var e,s;return(0,k.Jh)(this,function(t){switch(t.label){case 0:if(!Q())return[2];e=n,s=n.map(function(e){return BigInt(y[e.toString()]||0)*(P-z)/BigInt(100)}),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,Y(null==v?void 0:v.address,e,s)];case 2:return t.sent(),[3,4];case 3:return console.error("投票提交失败:",t.sent()),f.Am.error("提交失败，请重试"),[3,4];case 4:return[2]}})}),function(){return s.apply(this,arguments)}),X=(0,l.S)().handleContractError;return((0,a.useEffect)(function(){q&&X(q,"vote"),F&&X(F,"vote"),H&&X(H,"submit"),V&&X(V,"stake")},[q,H,V,F]),(0,a.useEffect)(function(){W&&!q&&(f.Am.success("提交成功",{duration:2e3}),setTimeout(function(){h()},2e3))},[W,q,h]),(0,a.useEffect)(function(){document.activeElement instanceof HTMLElement&&document.activeElement.blur()},[]),!v||M)?(0,r.jsx)("div",{className:"p-4 flex justify-center items-center",children:(0,r.jsx)(u.Z,{})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(E,{validGovVotes:P,votesNumByAccount:z,isPendingValidGovVotes:R,isPendingVotesNumByAccount:D,tokenSymbol:null==v?void 0:v.symbol}),(0,r.jsxs)("div",{className:"px-0",children:[(0,r.jsx)("div",{className:"space-y-4",children:null==L?void 0:L.map(function(e,s){var t=s===L.length-1,a=n.slice(0,-1).map(function(e){return e.toString()}).reduce(function(e,s){return e+(y[s]||0)},0),c=1===n.length?y[e.head.id.toString()]||100:t?100-a:y[e.head.id.toString()]||0;return(0,r.jsxs)("div",{className:"p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,r.jsx)(N(),{href:"/vote/single?id=".concat(e.head.id,"&symbol=").concat(null==v?void 0:v.symbol),className:"flex-grow",children:(0,r.jsxs)("div",{className:"font-semibold mb-2",children:[(0,r.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No.".concat(e.head.id)}),(0,r.jsx)("span",{className:"text-greyscale-900",children:"".concat(e.body.title)})]})}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"number",min:"1",max:"100",value:c||"",onChange:function(s){return A(e.head.id.toString(),Number(s.target.value))},className:"p-2 border rounded w-16",disabled:n.length>1&&t,placeholder:""}),"%"]})]},e.head.id)})}),(0,r.jsxs)("div",{className:"flex justify-center gap-4 mt-4",children:[(0,r.jsx)(x.z,{variant:"outline",className:"w-1/4",onClick:d,disabled:J||K||W,children:"返回"}),(0,r.jsx)(x.z,{className:"w-1/2 focus:outline-none focus:ring-0",onFocus:function(e){return e.currentTarget.blur()},onClick:U,disabled:J||K||W,children:J?"提交中...":K?"确认中...":W?"已提交":"提交投票"})]})]}),(0,r.jsx)("div",{className:"flex flex-col w-full p-4 mt-4",children:(0,r.jsxs)("div",{className:"bg-gray-100 text-greyscale-500 rounded-lg p-4 mb-8 text-sm",children:[(0,r.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-1",children:"注意："}),(0,r.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"1、每轮最大可投票数，等于您的治理票数；"}),(0,r.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"2、APP帮您自动计算并提交100%票数；"}),(0,r.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"3、投票时需持有完整数量的质押资产凭证：SL 类(流动性质押)、ST 类(代币质押)。"})]})}),(0,r.jsx)(B.Z,{isLoading:J||K,text:J?"提交交易...":"确认交易..."})]})},A=function(){var e=((0,a.useContext)(o.M)||{}).token,s=(0,t._)((0,a.useState)(1),2),n=s[0],m=s[1],f=(0,t._)((0,a.useState)([]),2),x=f[0],h=f[1],v=(0,i.Bk)(),N=v.currentRound,g=v.isPending,b=v.error,j=(0,c.useRouter)(),p=(0,l.S)().handleContractError;return(0,a.useEffect)(function(){b&&p(b,"vote")},[b]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.Z,{title:1===n?"投票首页":"投票",showBackButton:1===n}),(0,r.jsx)("main",{className:"flex-grow",children:g?(0,r.jsx)(u.Z,{}):1===n?(0,r.jsx)(y,{currentRound:N,onNext:function(e){h(e),m(2)}}):(0,r.jsx)(I,{selectedIds:x,currentRound:N,onBack:function(){m(1)},onSuccess:function(){m(1),h([]),j.push("/vote/actions/?symbol=".concat(null==e?void 0:e.symbol))}})})]})}}}]);