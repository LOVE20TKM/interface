try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},s=(new e.Error).stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="1b4d32dc-2660-48de-a1fd-e146124d5281",e._sentryDebugIdIdentifier="sentry-dbid-1b4d32dc-2660-48de-a1fd-e146124d5281")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5843],{34680:function(e,s,t){t.d(s,{Ol:function(){return o},SZ:function(){return u},Zb:function(){return l},aY:function(){return m},eW:function(){return f},ll:function(){return d}});var n=t(72253),r=t(47702),a=t(85893),c=t(67294),i=t(40108),l=c.forwardRef(function(e,s){var t=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:s,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t)},c))});l.displayName="Card";var o=c.forwardRef(function(e,s){var t=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:s,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",t)},c))});o.displayName="CardHeader";var d=c.forwardRef(function(e,s){var t=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:s,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",t)},c))});d.displayName="CardTitle";var u=c.forwardRef(function(e,s){var t=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:s,className:(0,i.cn)("text-sm text-muted-foreground",t)},c))});u.displayName="CardDescription";var m=c.forwardRef(function(e,s){var t=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:s,className:(0,i.cn)("p-6 pt-0",t)},c))});m.displayName="CardContent";var f=c.forwardRef(function(e,s){var t=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:s,className:(0,i.cn)("flex items-center p-6 pt-0",t)},c))});f.displayName="CardFooter"},64777:function(e,s,t){var n=t(85893);s.Z=function(e){var s=e.title;return(0,n.jsx)("div",{className:"flex justify-between items-center",children:(0,n.jsx)("h1",{className:"text-lg font-bold",children:s})})}},65843:function(e,s,t){t.r(s),t.d(s,{default:function(){return V}});var n=t(91309),r=t(85893),a=t(67294),c=t(11163),i=t(72260),l=t(73591),o=t(93778),d=t(83494),u=t(42083),m=t(42130),f=t(86501),x=t(27245),h=t(34680),v=t(41664),N=t.n(v),g=t(90278),j=t(91529),b=t(64777),y=function(e){var s=e.currentRound,t=e.onNext,c=(0,m.m)().address,i=((0,a.useContext)(o.M)||{}).token,d=(0,n._)((0,a.useState)(new Set),2),v=d[0],y=d[1],p=(0,g.YK)((null==i?void 0:i.address)||"",s,c),w=p.votingActions,_=p.isPending,S=p.error,k=(0,g._H)((null==i?void 0:i.address)||""),C=k.govData,B=k.isPending,I=(0,l.S)().handleContractError;(0,a.useEffect)(function(){S&&I(S,"vote")},[S,I]);var E=function(e){y(function(s){var t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},V=w.reduce(function(e,s){return e+s.votesNum},BigInt(0)),A=Number("30")/10;return _||B||!i?(0,r.jsx)("div",{className:"p-4 flex justify-center items-center",children:(0,r.jsx)(u.Z,{})}):(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)(b.Z,{title:"投票中的行动"}),i&&(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)(x.z,{variant:"outline",size:"sm",className:"text-secondary border-secondary",asChild:!0,children:(0,r.jsx)(N(),{href:"/extension/factories/",children:"发起新行动"})}),(0,r.jsx)(x.z,{variant:"outline",size:"sm",className:"text-secondary border-secondary",asChild:!0,children:(0,r.jsx)(N(),{href:"/submit/actions?symbol=".concat(null==i?void 0:i.symbol),children:"推举历史行动"})})]})]}),(0,r.jsx)("div",{className:"space-y-4",children:w.length>0?(0,r.jsxs)(r.Fragment,{children:[w.sort(function(e,s){return Number(s.votesNum-e.votesNum)}).map(function(e){var s=e.action,t=(null==C?void 0:C.govVotes)&&C.govVotes!==BigInt(0)?100*Number(e.votesNum)/Number(C.govVotes):0,n=t<A;return(0,r.jsxs)(h.Zb,{className:"shadow-none flex items-center ".concat(n?"border-red-500 border-2":""),children:[(0,r.jsx)("input",{type:"checkbox",className:"checkbox accent-secondary ml-2",checked:v.has(BigInt(s.head.id)),onChange:function(){return E(BigInt(s.head.id))}}),(0,r.jsxs)(N(),{href:"/vote/single?id=".concat(s.head.id,"&symbol=").concat(null==i?void 0:i.symbol),className:"w-full",children:[(0,r.jsxs)(h.Ol,{className:"px-1 pt-2 pb-1 flex-row justify-start items-baseline",children:[(0,r.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No."}),(0,r.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(s.head.id)}),(0,r.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(s.body.title)})]}),(0,r.jsxs)(h.aY,{className:"px-1 pt-1 pb-2",children:[(0,r.jsx)("div",{className:"flex justify-between mt-1 text-sm",children:(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"text-greyscale-400 mr-1",children:"投票数"}),(0,r.jsx)("span",{className:"text-secondary",children:(0,j.LH)(e.votesNum)})]})}),(0,r.jsxs)("div",{className:"flex justify-between gap-0 mt-1 text-sm",children:[(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"text-greyscale-400 mr-1",children:"占已投票"}),(0,r.jsx)("span",{className:"text-secondary",children:V===BigInt(0)?"-":(0,j.rl)(100*Number(e.votesNum)/Number(V))})]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"".concat(n?"text-red-500":"text-secondary"," mr-1"),children:"占总治理票"}),(0,r.jsx)("span",{className:n?"text-red-500":"text-secondary",children:(null==C?void 0:C.govVotes)&&C.govVotes!==BigInt(0)?(0,j.rl)(t):"-"})]})]})]})]},s.head.id)]},s.head.id)}),(0,r.jsx)("div",{className:"flex justify-center mt-4",children:(0,r.jsx)(x.z,{variant:"outline",className:"w-1/2 text-secondary border-secondary",onClick:function(){var e=Array.from(v);if(0===e.length){f.Am.error("请选择行动");return}t(e)},children:"给选中的行动投票"})}),(0,r.jsx)("div",{className:"mt-2 text-sm text-greyscale-500 text-center",children:"提示: 每轮最大可投票数，等于您的治理票数"})]}):(0,r.jsxs)("div",{className:"text-center mt-8",children:[(0,r.jsx)("div",{className:"text-base text-greyscale-500 mb-4",children:"还没有推举行动，请先推举！"}),(0,r.jsx)(x.z,{asChild:!0,children:(0,r.jsx)(N(),{href:"/submit/actions?symbol=".concat(null==i?void 0:i.symbol),children:"去推举行动"})})]})})]})},p=t(11010),w=t(75766),_=t(72253),S=t(14932),k=t(97582),C=t(933),B=t(44576),I=function(e){var s=e.validGovVotes,t=e.votesNumByAccount,n=e.isPendingValidGovVotes,a=e.isPendingVotesNumByAccount,c=e.tokenSymbol;return(0,r.jsx)("div",{className:"stats w-full",children:(0,r.jsxs)("div",{className:"stat place-items-center",children:[(0,r.jsx)("div",{className:"stat-title text-sm",children:"我的剩余票数"}),(0,r.jsx)("div",{className:"stat-value text-secondary mt-2",children:n||a?(0,r.jsx)(u.Z,{}):(0,j.LH)(s-t||BigInt(0))}),(0,r.jsxs)("div",{className:"stat-desc text-sm mt-2",children:["如需更多票数，请先"," ",(0,r.jsx)(N(),{href:"/stake/stakelp/?symbol=".concat(c),className:"text-secondary",children:"获取治理票"})]})]})})},E=function(e){var s,t=e.selectedIds,c=e.currentRound,d=e.onBack,h=e.onSuccess,v=((0,a.useContext)(o.M)||{}).token,j=(0,m.m)().address,b=(0,n._)((0,a.useState)({}),2),y=b[0],E=b[1];(0,a.useEffect)(function(){if(t.length>0&&0===Object.keys(y).length){if(1===t.length)E((0,w._)({},t[0].toString(),100));else{var e={},s=Math.floor(100/t.length);t.forEach(function(n,r){r===t.length-1?e[n.toString()]=100-s*(t.length-1):e[n.toString()]=s}),E(e)}}},[t,y]);var V=function(e,s){if(1===t.length){E((0,w._)({},e,s));return}var n=(0,S._)((0,_._)({},y),(0,w._)({},e,s)),r=t.slice(0,-1).map(function(e){return e.toString()}).reduce(function(e,s){return e+(n[s]||0)},0);if(r>100){f.Am.error("投票百分比之和不能超过100%");return}n[t[t.length-1].toString()]=100-r,E(n)},A=(0,C.Ty)(null==v?void 0:v.address,j),R=A.validGovVotes,P=A.isPending,Z=A.error,T=(0,i.VI)(null==v?void 0:v.address,c,j),z=T.votesNumByAccount,D=T.isPending,F=T.error,G=(0,g.fT)(null==v?void 0:v.address,t),H=G.actionInfos,L=G.isPending,M=G.error,O=(0,i.rv)(),Y=O.vote,J=O.isPending,K=O.isConfirming,W=O.isConfirmed,q=O.writeError,Q=function(){if(R-z<BigInt(2))return f.Am.error("剩余票数不足，不能投票"),!1;var e=Object.values(y).reduce(function(e,s){return e+s},0);return!(t.length>1)||100===e||(f.Am.error("百分比之和必须为100"),!1)},U=(s=(0,p._)(function(){var e,s;return(0,k.Jh)(this,function(n){switch(n.label){case 0:if(!Q())return[2];e=t,s=t.map(function(e){return BigInt(y[e.toString()]||0)*(R-z)/BigInt(100)}),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,Y(null==v?void 0:v.address,e,s)];case 2:return n.sent(),[3,4];case 3:return console.error("投票提交失败:",n.sent()),f.Am.error("提交失败，请重试"),[3,4];case 4:return[2]}})}),function(){return s.apply(this,arguments)}),X=(0,l.S)().handleContractError;return((0,a.useEffect)(function(){q&&X(q,"vote"),F&&X(F,"vote"),M&&X(M,"submit"),Z&&X(Z,"stake")},[q,M,Z,F]),(0,a.useEffect)(function(){W&&!q&&(f.Am.success("提交成功",{duration:2e3}),setTimeout(function(){h()},2e3))},[W,q,h]),(0,a.useEffect)(function(){document.activeElement instanceof HTMLElement&&document.activeElement.blur()},[]),!v||L)?(0,r.jsx)("div",{className:"p-4 flex justify-center items-center",children:(0,r.jsx)(u.Z,{})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(I,{validGovVotes:R,votesNumByAccount:z,isPendingValidGovVotes:P,isPendingVotesNumByAccount:D,tokenSymbol:null==v?void 0:v.symbol}),(0,r.jsxs)("div",{className:"px-0",children:[(0,r.jsx)("div",{className:"space-y-4",children:null==H?void 0:H.map(function(e,s){var n=s===H.length-1,a=t.slice(0,-1).map(function(e){return e.toString()}).reduce(function(e,s){return e+(y[s]||0)},0),c=1===t.length?y[e.head.id.toString()]||100:n?100-a:y[e.head.id.toString()]||0;return(0,r.jsxs)("div",{className:"p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,r.jsx)(N(),{href:"/vote/single?id=".concat(e.head.id,"&symbol=").concat(null==v?void 0:v.symbol),className:"flex-grow",children:(0,r.jsxs)("div",{className:"font-semibold mb-2",children:[(0,r.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No.".concat(e.head.id)}),(0,r.jsx)("span",{className:"text-greyscale-900",children:"".concat(e.body.title)})]})}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"number",min:"1",max:"100",value:c||"",onChange:function(s){return V(e.head.id.toString(),Number(s.target.value))},className:"p-2 border rounded w-16",disabled:t.length>1&&n,placeholder:""}),"%"]})]},e.head.id)})}),(0,r.jsxs)("div",{className:"flex justify-center gap-4 mt-4",children:[(0,r.jsx)(x.z,{variant:"outline",className:"w-1/4",onClick:d,disabled:J||K||W,children:"返回"}),(0,r.jsx)(x.z,{className:"w-1/2 focus:outline-none focus:ring-0",onFocus:function(e){return e.currentTarget.blur()},onClick:U,disabled:J||K||W,children:J?"提交中...":K?"确认中...":W?"已提交":"提交投票"})]})]}),(0,r.jsx)("div",{className:"flex flex-col w-full p-4 mt-4",children:(0,r.jsxs)("div",{className:"bg-gray-100 text-greyscale-500 rounded-lg p-4 mb-8 text-sm",children:[(0,r.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-1",children:"注意："}),(0,r.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"1、每轮最大可投票数，等于您的治理票数；"}),(0,r.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"2、前端会帮您自动计算并提交100%票数；"}),(0,r.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"3、投票时需持有完整数量的质押资产凭证：SL 类(流动性质押)、ST 类(代币质押)。"})]})}),(0,r.jsx)(B.Z,{isLoading:J||K,text:J?"提交交易...":"确认交易..."})]})},V=function(){var e=((0,a.useContext)(o.M)||{}).token,s=(0,n._)((0,a.useState)(1),2),t=s[0],m=s[1],f=(0,n._)((0,a.useState)([]),2),x=f[0],h=f[1],v=(0,i.Bk)(),N=v.currentRound,g=v.isPending,j=v.error,b=(0,c.useRouter)(),p=(0,l.S)().handleContractError;return(0,a.useEffect)(function(){j&&p(j,"vote")},[j]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.Z,{title:1===t?"投票首页":"投票",showBackButton:1===t}),(0,r.jsx)("main",{className:"flex-grow",children:g?(0,r.jsx)(u.Z,{}):1===t?(0,r.jsx)(y,{currentRound:N,onNext:function(e){h(e),m(2)}}):(0,r.jsx)(E,{selectedIds:x,currentRound:N,onBack:function(){m(1)},onSuccess:function(){m(1),h([]),b.push("/vote/actions/?symbol=".concat(null==e?void 0:e.symbol))}})})]})}}}]);