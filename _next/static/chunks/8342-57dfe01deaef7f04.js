try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="fd324d7e-7e5c-4ed2-8819-239bc2aa0ed1",e._sentryDebugIdIdentifier="sentry-dbid-fd324d7e-7e5c-4ed2-8819-239bc2aa0ed1")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8342],{21338:function(e,n,t){var r=t(91309),s=t(85893),o=t(67294),a=t(88504),i=t(93778),u=t(74089),c=t(42083);n.Z=function(e){var n=e.currentRound,t=e.roundType,d=e.showCountdown,l=(0,a.O)().data,f=(0,o.useContext)(i.M),g=f?f.token:void 0,h=!l||!g||void 0===g.voteOriginBlocks,m=(0,r._)((0,o.useState)(BigInt(0)),2),p=m[0],I=m[1],v=Number("30126")||0,x=Number("2868")||0,y=g?Number(g.voteOriginBlocks):0,b=v-(Number(l)-y)%v,M=b>0?Math.ceil(b*x/1e3):0,B=(0,r._)((0,o.useState)(M),2),N=B[0],A=B[1];(0,o.useEffect)(function(){if(l){var e=v-(Number(l)-y)%v;A(e>0?Math.ceil(e*x/1e3):0)}},[l,v,x,y]),(0,o.useEffect)(function(){n>BigInt(0)&&I(n)},[n]);var E=null!=p?p.toString():"0";return p<=BigInt(0)?(0,s.jsx)(s.Fragment,{}):h||null==p||p<BigInt(0)?((null==p||p<BigInt(0))&&(console.log("currentTokenRound",p),console.log("currentRound",n)),(0,s.jsx)(c.Z,{})):(0,s.jsx)("div",{className:"flex items-center mb-3",children:(0,s.jsxs)("span",{className:"text-sm text-greyscale-400",children:["(第",(0,s.jsx)("span",{className:"text-greyscale-400",children:E}),"轮","vote"===t?"投票":"verify"===t?"验证":"行动","阶段，",(0,s.jsx)("span",{className:"text-greyscale-400",children:"剩余"}),(0,s.jsx)("span",{className:"text-greyscale-400",children:Math.ceil(1e3*N/x)}),(0,s.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),void 0===d||d?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(u.Z,{initialTimeLeft:M,onTick:A})}):(0,s.jsx)("span",{className:"text-greyscale-400",children:N<60?"".concat(N,"秒"):N<=300?"".concat(Math.floor(N/60),"分钟").concat(N%60,"秒"):N<3600?"".concat(Math.floor(N/60),"分钟"):"".concat(Math.floor(N/3600),"小时").concat(Math.floor(N%3600/60),"分钟")}),(0,s.jsx)("span",{className:"text-greyscale-400",children:")"})]})})}},34188:function(e,n,t){t.d(n,{i:function(){return m}});var r=t(4586),s=t(67294),o=t(67516),a=t(93778),i=t(50095),u=t(8945),c=t(35611),d=t(8926),l=t(8300),f=t(37742),g="0x6c720b8a9c4803E7D78849E10fe535d862ACbfD1",h="0xd94e4Fc2108B78Aa57438BFe5E85192687f74322";function m(e){var n=e.account,t=e.round,m=((0,s.useContext)(a.M)||{}).token,p=null==m?void 0:m.address,I=(0,l.hS)(n,!!n),v=I.balance,x=I.isPending,y=I.error,b=v||BigInt(0),M=(0,s.useMemo)(function(){if(!n||b===BigInt(0))return[];for(var e=[],t=0;t<Number(b);t++)e.push({address:"0xA0a5BB442214988D0c6e707d825640C026fB1d04",abi:i.s,functionName:"tokenOfOwnerByIndex",args:[n,BigInt(t)]});return e},[n,b]),B=(0,o.N)({contracts:M,query:{enabled:!!n&&b>BigInt(0)}}),N=B.data,A=B.isPending,E=B.error,w=(0,s.useMemo)(function(){if(!N)return[];var e=[];return N.forEach(function(n){(null==n?void 0:n.status)==="success"&&n.result&&e.push((0,f.Zu)(n.result))}),e},[N]),k=(0,s.useMemo)(function(){return p&&0!==w.length?w.map(function(e){return{address:h,abi:c.w,functionName:"gActionIdsByTokenAddressByGroupId",args:[p,e]}}):[]},[p,w]),_=(0,o.N)({contracts:k,query:{enabled:!!p&&w.length>0}}),j=_.data,T=_.isPending,D=_.error,C=(0,s.useMemo)(function(){var e=new Map,n=new Set;return j?(w.forEach(function(t,r){var s=j[r];if((null==s?void 0:s.status)==="success"&&s.result){var o=s.result.map(function(e){return(0,f.Zu)(e)});e.set(t,o),o.forEach(function(e){return n.add(e)})}}),{groupIdToActionIdsMap:e,allUniqueActionIds:Array.from(n)}):{groupIdToActionIdsMap:e,allUniqueActionIds:[]}},[w,j]),q=C.groupIdToActionIdsMap,P=C.allUniqueActionIds,Z=(0,d.W)({token:m,actionIds:P,enabled:!!m&&P.length>0}),O=Z.extensions,R=Z.isPending,S=Z.error,F=(0,s.useMemo)(function(){var e=new Map;return O.forEach(function(n){n.isExtension&&n.extensionAddress&&e.set(n.actionId,n.extensionAddress)}),e},[O]),G=(0,s.useMemo)(function(){var e=[];return q.forEach(function(n,t){n.forEach(function(n){var r=F.get(n);r&&e.push({actionId:n,extensionAddress:r,groupId:t})})}),e},[q,F]),U=(0,s.useMemo)(function(){if(void 0===t||0===G.length)return[];var e=G.map(function(e){var n=e.extensionAddress,r=e.groupId;return{address:g,abi:u.l,functionName:"isVerified",args:[n,t,r]}}),n=G.map(function(e){var n=e.extensionAddress,r=e.groupId;return{address:h,abi:c.w,functionName:"accountsByGroupIdCount",args:[n,t,r]}}),s=G.map(function(e){var n=e.extensionAddress,r=e.groupId;return{address:g,abi:u.l,functionName:"capacityDecayRateByGroupId",args:[n,t,r]}});return(0,r._)(e).concat((0,r._)(n),(0,r._)(s))},[t,G]),V=(0,o.N)({contracts:U,query:{enabled:void 0!==t&&G.length>0}}),L=V.data,W=V.isPending,z=V.error,H=(0,s.useMemo)(function(){if(L&&0!==G.length)return L.slice(0,G.length)},[L,G.length]),J=(0,s.useMemo)(function(){if(L&&0!==G.length)return L.slice(G.length,2*G.length)},[L,G.length]),K=(0,s.useMemo)(function(){if(L&&0!==G.length)return L.slice(2*G.length,3*G.length)},[L,G.length]);return{groups:(0,s.useMemo)(function(){if(!H||!J||!K||0===G.length)return[];var e=[];return H.forEach(function(n,t){if((null==n?void 0:n.status)==="success"){var r=G[t],s=r.actionId,o=r.extensionAddress,a=r.groupId,i=n.result,u=J[t],c=(null==u?void 0:u.status)==="success"?u.result:BigInt(0),d=K[t],l=(null==d?void 0:d.status)==="success"?(0,f.Zu)(d.result):void 0,g=!i&&c>BigInt(0);e.push({groupId:a,extensionAddress:o,actionId:s,isVerified:i,needToVerify:g,capacityDecayRate:l})}}),e},[G,H,J,K]),isPending:(0,s.useMemo)(function(){return!p||!n||void 0===t||!!x||b!==BigInt(0)&&(!!A||0!==w.length&&(!!T||0!==P.length&&(!!R||0!==G.length&&W)))},[p,n,t,x,b,A,w.length,T,P.length,R,G.length,W]),error:y||E||D||S||z||null}}}}]);