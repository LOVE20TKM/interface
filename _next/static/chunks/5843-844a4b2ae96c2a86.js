try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="4c982ede-2791-469d-8572-3958ec7442bc",e._sentryDebugIdIdentifier="sentry-dbid-4c982ede-2791-469d-8572-3958ec7442bc")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5843],{34680:function(e,t,s){s.d(t,{Ol:function(){return o},SZ:function(){return u},Zb:function(){return i},aY:function(){return m},eW:function(){return x},ll:function(){return d}});var n=s(72253),r=s(47702),a=s(85893),c=s(67294),l=s(40108),i=c.forwardRef(function(e,t){var s=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s)},c))});i.displayName="Card";var o=c.forwardRef(function(e,t){var s=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s)},c))});o.displayName="CardHeader";var d=c.forwardRef(function(e,t){var s=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s)},c))});d.displayName="CardTitle";var u=c.forwardRef(function(e,t){var s=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s)},c))});u.displayName="CardDescription";var m=c.forwardRef(function(e,t){var s=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:t,className:(0,l.cn)("p-6 pt-0",s)},c))});m.displayName="CardContent";var x=c.forwardRef(function(e,t){var s=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",s)},c))});x.displayName="CardFooter"},24920:function(e,t,s){s.d(t,{Z:function(){return n}});var n=(0,s(31134).Z)("UserPen",[["path",{d:"M11.5 15H7a4 4 0 0 0-4 4v2",key:"15lzij"}],["path",{d:"M21.378 16.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"1817ys"}],["circle",{cx:"10",cy:"7",r:"4",key:"e45bow"}]])},27460:function(e,t,s){var n=s(91309),r=s(85893),a=s(67294),c=s(74855),l=s(78865),i=s(18289),o=s(86501),d=s(26858);t.Z=function(e){var t=e.address,s=e.word,u=e.showCopyButton,m=e.showCopyLast4Button,x=e.showAddress,f=void 0===x||x,h=e.colorClassName,v=void 0===h?"":h,g=e.colorClassName2,y=void 0===g?"":g,N=(0,n._)((0,a.useState)(!1),2),p=N[0],j=N[1],b=(0,n._)((0,a.useState)(!1),2),w=b[0],C=b[1];(0,a.useEffect)(function(){j(!1),C(!1)},[t]);var k=function(e){e.preventDefault(),e.stopPropagation()};return(0,r.jsxs)("span",{className:"inline-flex items-center space-x-1",children:[s&&(0,r.jsx)("span",{className:"text-xs",children:s}),f&&!y&&(0,r.jsx)("span",{className:"font-mono text-xs ".concat(null!=v?v:"text-greyscale-500"),children:(0,d.Vu)(t)}),f&&y&&(0,r.jsxs)("span",{className:"text-[0px]",children:[(0,r.jsx)("span",{className:"font-mono text-xs ".concat(null!=v?v:"text-greyscale-500"),children:"".concat(t.substring(0,6),"...")}),(0,r.jsx)("span",{className:"font-mono text-xs ".concat(y),children:"".concat(t.substring(t.length-4))})]}),(void 0===u||u)&&(0,r.jsx)(c.CopyToClipboard,{text:t,onCopy:function(e,t){t?(j(!0),setTimeout(function(){return j(!1)},2e3)):o.ZP.error("复制失败")},children:(0,r.jsx)("button",{className:"flex items-center justify-center p-1 rounded focus:outline-none active:bg-gray-200 md:hover:bg-gray-200",onClick:k,"aria-label":"复制地址",style:{WebkitTapHighlightColor:"transparent",WebkitAppearance:"none",appearance:"none",background:"transparent",backgroundColor:"transparent",border:"none",outline:"none"},children:p?(0,r.jsx)(l.Z,{className:"h-4 w-4 ".concat(null!=v?v:"text-greyscale-500")}):(0,r.jsx)(i.Z,{className:"h-4 w-4 ".concat(null!=v?v:"text-greyscale-500")})})}),void 0!==m&&m&&(0,r.jsx)(c.CopyToClipboard,{text:t.substring(t.length-4),onCopy:function(e,t){t?(C(!0),o.ZP.success("已复制后4位"),setTimeout(function(){return C(!1)},2e3)):o.ZP.error("复制失败")},children:(0,r.jsx)("button",{className:"text-xs px-2 py-1 rounded border border-gray-300 focus:outline-none active:bg-gray-200 md:hover:bg-gray-100 transition-colors",onClick:k,"aria-label":"复制地址后4位",style:{WebkitTapHighlightColor:"transparent"},children:w?(0,r.jsx)("span",{className:"".concat(null!=v?v:"text-greyscale-500"),children:"已复制"}):(0,r.jsx)("span",{className:"".concat(null!=v?v:"text-greyscale-500"),children:"后4位"})})})]})}},64777:function(e,t,s){var n=s(85893);t.Z=function(e){var t=e.title;return(0,n.jsx)("div",{className:"flex justify-between items-center",children:(0,n.jsx)("h1",{className:"text-lg font-bold",children:t})})}},42083:function(e,t,s){var n=s(85893),r=s(23432);t.Z=function(){return(0,n.jsx)(r.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},65843:function(e,t,s){s.r(t),s.d(t,{default:function(){return A}});var n=s(91309),r=s(85893),a=s(67294),c=s(11163),l=s(7080),i=s(73591),o=s(93778),d=s(83494),u=s(42083),m=s(42130),x=s(86501),f=s(24920),h=s(27245),v=s(34680),g=s(41664),y=s.n(g),N=s(93950),p=s(26858),j=s(27460),b=s(64777),w=function(e){var t=e.currentRound,s=e.onNext,c=(0,m.m)().address,l=((0,a.useContext)(o.M)||{}).token,d=(0,n._)((0,a.useState)(new Set),2),g=d[0],w=d[1],C=(0,N.YK)((null==l?void 0:l.address)||"",t,c),k=C.votingActions,_=C.isPending,S=C.error,Z=(0,i.S)().handleContractError;(0,a.useEffect)(function(){S&&Z(S,"vote")},[S,Z]);var B=function(e){w(function(t){var s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},E=k.reduce(function(e,t){return e+t.votesNum},BigInt(0));return _||!l?(0,r.jsx)("div",{className:"p-4 flex justify-center items-center",children:(0,r.jsx)(u.Z,{})}):(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)(b.Z,{title:"投票中的行动"}),l&&(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)(h.z,{variant:"outline",size:"sm",className:"text-secondary border-secondary",asChild:!0,children:(0,r.jsx)(y(),{href:"/action/new/?symbol=".concat(null==l?void 0:l.symbol),children:"推举新行动"})}),(0,r.jsx)(h.z,{variant:"outline",size:"sm",className:"text-secondary border-secondary",asChild:!0,children:(0,r.jsx)(y(),{href:"/vote/actions4submit?symbol=".concat(null==l?void 0:l.symbol),children:"推举历史行动"})})]})]}),(0,r.jsx)("div",{className:"space-y-4",children:k.length>0?(0,r.jsxs)(r.Fragment,{children:[k.sort(function(e,t){return Number(t.votesNum-e.votesNum)}).map(function(e){var t=e.action;return(0,r.jsxs)(v.Zb,{className:"shadow-none flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",className:"checkbox accent-secondary ml-2",checked:g.has(BigInt(t.head.id)),onChange:function(){return B(BigInt(t.head.id))}}),(0,r.jsxs)(y(),{href:"/action/detail?id=".concat(t.head.id,"&type=vote&symbol=").concat(null==l?void 0:l.symbol),className:"w-full",children:[(0,r.jsxs)(v.Ol,{className:"px-3 pt-2 pb-1 flex-row justify-start items-baseline",children:[(0,r.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No."}),(0,r.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(t.head.id)}),(0,r.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(t.body.title)})]}),(0,r.jsx)(v.aY,{className:"px-3 pt-1 pb-2",children:(0,r.jsxs)("div",{className:"flex justify-between mt-1 text-sm",children:[(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)(f.Z,{className:"text-greyscale-400 mr-1 h-3 w-3"}),(0,r.jsx)("span",{className:"text-greyscale-400",children:(0,r.jsx)(j.Z,{address:t.head.author,showCopyButton:!1})})]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"text-greyscale-400 mr-1",children:"投票数"}),(0,r.jsx)("span",{className:"text-secondary",children:(0,p.LH)(e.votesNum)})]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"text-greyscale-400 mr-1",children:"占比"}),(0,r.jsx)("span",{className:"text-secondary",children:E===BigInt(0)?"-":(0,p.rl)(100*Number(e.votesNum)/Number(E))})]})]})})]},t.head.id)]},t.head.id)}),(0,r.jsx)("div",{className:"flex justify-center mt-4",children:(0,r.jsx)(h.z,{variant:"outline",className:"w-1/2 text-secondary border-secondary",onClick:function(){var e=Array.from(g);if(0===e.length){x.Am.error("请选择行动");return}s(e)},children:"给选中的行动投票"})}),(0,r.jsx)("div",{className:"mt-2 text-sm text-greyscale-500 text-center",children:"提示: 每轮最大可投票数，等于您的治理票数"})]}):(0,r.jsxs)("div",{className:"text-center mt-8",children:[(0,r.jsx)("div",{className:"text-base text-greyscale-500 mb-4",children:"还没有推举行动，请先推举！"}),(0,r.jsx)(h.z,{asChild:!0,children:(0,r.jsx)(y(),{href:"/vote/actions4submit?symbol=".concat(null==l?void 0:l.symbol),children:"去推举行动"})})]})})]})},C=s(11010),k=s(75766),_=s(72253),S=s(14932),Z=s(97582),B=s(92180),E=s(44576),I=function(e){var t=e.validGovVotes,s=e.votesNumByAccount,n=e.isPendingValidGovVotes,a=e.isPendingVotesNumByAccount,c=e.tokenSymbol;return(0,r.jsx)("div",{className:"stats w-full",children:(0,r.jsxs)("div",{className:"stat place-items-center",children:[(0,r.jsx)("div",{className:"stat-title text-sm",children:"我的剩余票数"}),(0,r.jsx)("div",{className:"stat-value text-secondary mt-2",children:n||a?(0,r.jsx)(u.Z,{}):(0,p.LH)(t-s||BigInt(0))}),(0,r.jsxs)("div",{className:"stat-desc text-sm mt-2",children:["如需更多票数，请先"," ",(0,r.jsx)(y(),{href:"/gov/stakelp/?symbol=".concat(c),className:"text-secondary",children:"获取治理票"})]})]})})},P=function(e){var t,s=e.selectedIds,c=e.currentRound,d=e.onBack,f=e.onSuccess,v=((0,a.useContext)(o.M)||{}).token,g=(0,m.m)().address,p=(0,n._)((0,a.useState)({}),2),j=p[0],b=p[1];(0,a.useEffect)(function(){if(s.length>0&&0===Object.keys(j).length){if(1===s.length)b((0,k._)({},s[0].toString(),100));else{var e={},t=Math.floor(100/s.length);s.forEach(function(n,r){r===s.length-1?e[n.toString()]=100-t*(s.length-1):e[n.toString()]=t}),b(e)}}},[s,j]);var w=function(e,t){if(1===s.length){b((0,k._)({},e,t));return}var n=(0,S._)((0,_._)({},j),(0,k._)({},e,t)),r=s.slice(0,-1).map(function(e){return e.toString()}).reduce(function(e,t){return e+(n[t]||0)},0);if(r>100){x.Am.error("投票百分比之和不能超过100%");return}n[s[s.length-1].toString()]=100-r,b(n)},P=(0,B.Ty)(null==v?void 0:v.address,g),A=P.validGovVotes,T=P.isPending,R=P.error,V=(0,l.VI)(null==v?void 0:v.address,c,g),z=V.votesNumByAccount,H=V.isPending,M=V.error,D=(0,N.fT)(null==v?void 0:v.address,s),L=D.actionInfos,F=D.isPending,G=D.error,O=(0,l.rv)(),W=O.vote,Y=O.isPending,J=O.isConfirming,K=O.isConfirmed,U=O.writeError,q=function(){if(A-z<BigInt(2))return x.Am.error("剩余票数不足，不能投票"),!1;var e=Object.values(j).reduce(function(e,t){return e+t},0);return!(s.length>1)||100===e||(x.Am.error("百分比之和必须为100"),!1)},Q=(t=(0,C._)(function(){var e,t;return(0,Z.Jh)(this,function(n){switch(n.label){case 0:if(!q())return[2];e=s,t=s.map(function(e){return BigInt(j[e.toString()]||0)*(A-z)/BigInt(100)}),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,W(null==v?void 0:v.address,e,t)];case 2:return n.sent(),[3,4];case 3:return n.sent(),x.Am.error("提交失败，请重试"),[3,4];case 4:return[2]}})}),function(){return t.apply(this,arguments)}),X=(0,i.S)().handleContractError;return((0,a.useEffect)(function(){U&&X(U,"vote"),M&&X(M,"vote"),G&&X(G,"submit"),R&&X(R,"stake")},[U,G,R,M]),(0,a.useEffect)(function(){K&&!U&&(x.Am.success("提交成功",{duration:2e3}),setTimeout(function(){f()},2e3))},[K,U,f]),(0,a.useEffect)(function(){document.activeElement instanceof HTMLElement&&document.activeElement.blur()},[]),!v||F)?(0,r.jsx)("div",{className:"p-4 flex justify-center items-center",children:(0,r.jsx)(u.Z,{})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(I,{validGovVotes:A,votesNumByAccount:z,isPendingValidGovVotes:T,isPendingVotesNumByAccount:H,tokenSymbol:null==v?void 0:v.symbol}),(0,r.jsxs)("div",{className:"px-0",children:[(0,r.jsx)("div",{className:"space-y-4",children:null==L?void 0:L.map(function(e,t){var n=t===L.length-1,a=s.slice(0,-1).map(function(e){return e.toString()}).reduce(function(e,t){return e+(j[t]||0)},0),c=1===s.length?j[e.head.id.toString()]||100:n?100-a:j[e.head.id.toString()]||0;return(0,r.jsxs)("div",{className:"p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,r.jsx)(y(),{href:"/action/detail?id=".concat(e.head.id,"&type=vote&symbol=").concat(null==v?void 0:v.symbol),className:"flex-grow",children:(0,r.jsxs)("div",{className:"font-semibold mb-2",children:[(0,r.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No.".concat(e.head.id)}),(0,r.jsx)("span",{className:"text-greyscale-900",children:"".concat(e.body.title)})]})}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"number",min:"1",max:"100",value:c||"",onChange:function(t){return w(e.head.id.toString(),Number(t.target.value))},className:"p-2 border rounded w-16",disabled:s.length>1&&n,placeholder:""}),"%"]})]},e.head.id)})}),(0,r.jsxs)("div",{className:"flex justify-center gap-4 mt-4",children:[(0,r.jsx)(h.z,{variant:"outline",className:"w-1/4",onClick:d,disabled:Y||J||K,children:"返回"}),(0,r.jsx)(h.z,{className:"w-1/2 focus:outline-none focus:ring-0",onFocus:function(e){return e.currentTarget.blur()},onClick:Q,disabled:Y||J||K,children:Y?"提交中...":J?"确认中...":K?"已提交":"提交投票"})]})]}),(0,r.jsx)("div",{className:"flex flex-col w-full p-4 mt-4",children:(0,r.jsxs)("div",{className:"bg-gray-100 text-greyscale-500 rounded-lg p-4 mb-8 text-sm",children:[(0,r.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-1",children:"注意："}),(0,r.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"1、每轮最大可投票数，等于您的治理票数；"}),(0,r.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"2、APP帮您自动计算并提交100%票数；"}),(0,r.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"3、投票时需持有完整数量的质押资产凭证：SL 类(流动性质押)、ST 类(代币质押)。"})]})}),(0,r.jsx)(E.Z,{isLoading:Y||J,text:Y?"提交交易...":"确认交易..."})]})},A=function(){var e=((0,a.useContext)(o.M)||{}).token,t=(0,n._)((0,a.useState)(1),2),s=t[0],m=t[1],x=(0,n._)((0,a.useState)([]),2),f=x[0],h=x[1],v=(0,l.Bk)(),g=v.currentRound,y=v.isPending,N=v.error,p=(0,c.useRouter)(),j=(0,i.S)().handleContractError;return(0,a.useEffect)(function(){N&&j(N,"vote")},[N]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.Z,{title:1===s?"投票首页":"投票",showBackButton:1===s}),(0,r.jsx)("main",{className:"flex-grow",children:y?(0,r.jsx)(u.Z,{}):1===s?(0,r.jsx)(w,{currentRound:g,onNext:function(e){h(e),m(2)}}):(0,r.jsx)(P,{selectedIds:f,currentRound:g,onBack:function(){m(1)},onSuccess:function(){m(1),h([]),p.push("/vote/actions/?symbol=".concat(null==e?void 0:e.symbol))}})})]})}}}]);