"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7082],{76929:function(e,t,n){n.d(t,{l0:function(){return m},NI:function(){return v},pf:function(){return g},Wi:function(){return f},xJ:function(){return p},lX:function(){return h},zG:function(){return N}});var r=n(85893),i=n(67294),s=n(4222),a=n(87536),l=n(40108),o=n(41850);let c=(0,n(12003).j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),u=i.forwardRef((e,t)=>{let{className:n,...i}=e;return(0,r.jsx)(o.f,{ref:t,className:(0,l.cn)(c(),n),...i})});u.displayName=o.f.displayName;let m=a.RV,d=i.createContext({}),f=e=>{let{...t}=e;return(0,r.jsx)(d.Provider,{value:{name:t.name},children:(0,r.jsx)(a.Qr,{...t})})},x=()=>{let e=i.useContext(d),t=i.useContext(b),{getFieldState:n,formState:r}=(0,a.Gc)(),s=n(e.name,r);if(!e)throw Error("useFormField should be used within <FormField>");let{id:l}=t;return{id:l,name:e.name,formItemId:"".concat(l,"-form-item"),formDescriptionId:"".concat(l,"-form-item-description"),formMessageId:"".concat(l,"-form-item-message"),...s}},b=i.createContext({}),p=i.forwardRef((e,t)=>{let{className:n,...s}=e,a=i.useId();return(0,r.jsx)(b.Provider,{value:{id:a},children:(0,r.jsx)("div",{ref:t,className:(0,l.cn)("space-y-2",n),...s})})});p.displayName="FormItem";let h=i.forwardRef((e,t)=>{let{className:n,...i}=e,{error:s,formItemId:a}=x();return(0,r.jsx)(u,{ref:t,className:(0,l.cn)(s&&"text-destructive",n),htmlFor:a,...i})});h.displayName="FormLabel";let v=i.forwardRef((e,t)=>{let{...n}=e,{error:i,formItemId:a,formDescriptionId:l,formMessageId:o}=x();return(0,r.jsx)(s.g7,{ref:t,id:a,"aria-describedby":i?"".concat(l," ").concat(o):"".concat(l),"aria-invalid":!!i,...n})});v.displayName="FormControl";let g=i.forwardRef((e,t)=>{let{className:n,...i}=e,{formDescriptionId:s}=x();return(0,r.jsx)("p",{ref:t,id:s,className:(0,l.cn)("text-sm text-muted-foreground",n),...i})});g.displayName="FormDescription";let N=i.forwardRef((e,t)=>{let{className:n,children:i,...s}=e,{error:a,formMessageId:o}=x(),c=a?String(null==a?void 0:a.message):i;return c?(0,r.jsx)("p",{ref:t,id:o,className:(0,l.cn)("text-sm font-medium text-destructive",n),...s,children:c}):null});N.displayName="FormMessage"},44576:function(e,t,n){var r=n(85893);n(67294);var i=n(23432);t.Z=e=>{let{isLoading:t,text:n="Loading"}=e;return t?(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(i.Z,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,r.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:n})]})}):null}},27082:function(e,t,n){n.r(t);var r=n(85893),i=n(67294),s=n(11163),a=n(1604),l=n(56312),o=n(87536),c=n(41664),u=n.n(c),m=n(92321),d=n(86501),f=n(27245),x=n(21774),b=n(76929),p=n(48105),h=n(91529),v=n(67068),g=n(70019),N=n(19638),y=n(95049),j=n(64777),F=n(42083),k=n(44576),w=n(23432);let S=e=>a.z.object({contributeAmount:a.z.string().nonempty({message:"请输入申购数量"}).refine(e=>Number(e)>0,{message:"申购数量不能为 0"}).refine(t=>{var n;return(null!==(n=(0,h.vz)(t))&&void 0!==n?n:0n)<=e},{message:"申购数量不能超过余额 (".concat((0,h.bM)(e),")")})});t.default=e=>{let{token:t,launchInfo:n}=e,{address:a,chain:c}=(0,m.m)(),I=(0,s.useRouter)(),{balance:E,isPending:A,error:z}=(0,N.hS)(null==t?void 0:t.parentTokenAddress,a),{contributed:C,isPending:T,error:$}=(0,g.ap)(null==t?void 0:t.address,a),B=(0,o.cI)({resolver:(0,l.F)(S(E||0n)),defaultValues:{contributeAmount:""}}),{approve:R,isWriting:D,isConfirming:M,isConfirmed:P,writeError:U}=(0,N.yA)(null==t?void 0:t.parentTokenAddress),[L,Z]=(0,i.useState)(!1),{allowance:V,isPending:G,error:W}=(0,N.yG)(null==t?void 0:t.parentTokenAddress,a,"0x897Eb0BC5c2a68FBF3EF1ef27e6E35a3A5c869b0");(0,i.useEffect)(()=>{P&&(Z(!0),d.Am.success("授权".concat(null==t?void 0:t.parentTokenSymbol,"成功")))},[P,null==t?void 0:t.parentTokenSymbol]);let _=B.watch("contributeAmount");(0,i.useEffect)(()=>{var e;let t=null!==(e=(0,h.vz)(_))&&void 0!==e?e:0n;t>0n&&V&&V>0n&&V>=t?Z(!0):Z(!1)},[_,V]);let H=async e=>{if((0,p.S)(c))try{var t;let n=null!==(t=(0,h.vz)(e.contributeAmount))&&void 0!==t?t:0n;await R("0x897Eb0BC5c2a68FBF3EF1ef27e6E35a3A5c869b0",n)}catch(e){console.error(e)}},{contribute:J,isPending:K,isConfirming:X,isConfirmed:O,writeError:Q}=(0,g.OY)(),Y=async e=>{if((0,p.S)(c)){if(!L){d.Am.error("请先授权");return}try{var n;let r=null!==(n=(0,h.vz)(e.contributeAmount))&&void 0!==n?n:0n;await J(null==t?void 0:t.address,r,a)}catch(e){console.error(e)}}};(0,i.useEffect)(()=>{O&&(d.Am.success("申购成功"),setTimeout(()=>{I.push("/launch?symbol=".concat(null==t?void 0:t.symbol))},2e3))},[O,I,null==t?void 0:t.symbol]);let{setError:q}=(0,y.V)();(0,i.useEffect)(()=>{void 0!==E&&E<=0n&&q({name:"余额不足",message:"请先获取 ".concat(null==t?void 0:t.parentTokenSymbol,"，再来申购")})},[E,t]);let{handleContractError:ee}=(0,v.S)();(0,i.useEffect)(()=>{Q&&ee(Q,"launch"),$&&ee($,"launch"),U&&ee(U,"token"),z&&ee(z,"token"),W&&ee(W,"token")},[U,Q,z,$,W,ee]);let et=D||M,en=(0,i.useRef)(null);return((0,i.useEffect)(()=>{!G&&en.current&&en.current.blur()},[G]),!t||A||T)?(0,r.jsx)(F.Z,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)(j.Z,{title:"参与申购"}),(0,r.jsx)("div",{className:"stats w-full",children:(0,r.jsxs)("div",{className:"stat place-items-center",children:[(0,r.jsx)("div",{className:"stat-title text-sm mr-6",children:"我已申购质押"}),(0,r.jsxs)("div",{className:"stat-value text-secondary",children:[(0,h.LH)(C||0n),(0,r.jsx)("span",{className:"text-greyscale-500 font-normal text-sm ml-2",children:t.parentTokenSymbol})]})]})}),(0,r.jsx)(b.l0,{...B,children:(0,r.jsxs)("form",{onSubmit:e=>e.preventDefault(),className:"space-y-4",children:[(0,r.jsx)(b.Wi,{control:B.control,name:"contributeAmount",render:e=>{let{field:n}=e;return(0,r.jsxs)(b.xJ,{children:[(0,r.jsx)(b.lX,{children:"申购数量："}),(0,r.jsx)(b.NI,{children:(0,r.jsx)(x.I,{type:"number",placeholder:"请填写".concat(t.parentTokenSymbol,"数量"),disabled:et||0n>=(E||0n),className:"!ring-secondary-foreground",...n})}),(0,r.jsx)(b.zG,{})]})}}),(0,r.jsxs)("div",{className:"flex items-center text-sm mb-4",children:[(0,r.jsxs)("span",{className:"text-greyscale-400",children:[(0,h.LH)(E||0n)," ",t.parentTokenSymbol]}),(0,r.jsx)(f.z,{variant:"link",size:"sm",onClick:()=>{B.setValue("contributeAmount",(0,h.bM)(E||0n))},disabled:et||0n>=(E||0n),className:"text-secondary",children:"全部"}),"TestTKM20"===t.parentTokenSymbol&&(0,r.jsx)(u(),{href:"/dex/deposit?symbol=".concat(t.symbol),children:(0,r.jsxs)(f.z,{variant:"link",size:"sm",className:"text-secondary",children:["获取",t.parentTokenSymbol]})})]}),(0,r.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,r.jsx)(f.z,{ref:en,className:"w-1/2",onClick:B.handleSubmit(H),disabled:G||D||M||L,children:G?(0,r.jsx)(w.Z,{className:"animate-spin"}):D?"1.提交中...":M?"1.确认中...":L?"1.".concat(t.parentTokenSymbol,"已授权"):"1.授权".concat(t.parentTokenSymbol)}),(0,r.jsx)(f.z,{className:"w-1/2 text-white py-2 rounded-lg",onClick:B.handleSubmit(Y),disabled:!L||K||X||O,children:K?"2.申购中...":X?"2.确认中...":O?"2.申购成功":"2.申购"})]})]})})]}),(0,r.jsx)(k.Z,{isLoading:D||M||K||X,text:D||K?"提交交易...":"确认交易..."})]})}},91529:function(e,t,n){n.d(t,{LH:function(){return a},Vu:function(){return s},bM:function(){return o},cK:function(){return u},eb:function(){return m},kP:function(){return c},vz:function(){return l}});var r=n(21803),i=n(15229);let s=e=>e?"".concat(e.substring(0,6),"...").concat(e.substring(e.length-4)):"",a=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t=Number(o(e));if(e<10n)return"0";if(t>=1e5)return new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(t);if(t>=1e3)return new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(t);if(t>=1)return new Intl.NumberFormat("en-US",{maximumFractionDigits:4}).format(t);{if(t>=.001)return new Intl.NumberFormat("en-US",{maximumFractionDigits:4}).format(t);if(0===t)return"0";let e=t.toFixed(14),n=e.split(".");if(n.length<2)return e;let r=n[1],i=0;for(let e of r)if("0"===e)i++;else break;let s=r.slice(i,i+4);return"0.0{".concat(i,"}").concat(s)}},l=e=>{let t=parseInt("18",10);try{let n=e.replace(/,/g,"");return(0,r.v)(n,t)}catch(e){return console.error("parseUnits error:",e),0n}},o=e=>{let t=parseInt("18",10);return(0,i.b)(e,t)},c=e=>e.includes(".")?parseFloat(e.replace(/,/g,"")).toString():e,u=(e,t)=>e&&t?e-BigInt(t.initialStakeRound)+1n:0n,m=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=Number(e);if(r>=1)return new Intl.NumberFormat("en-US",{maximumFractionDigits:t}).format(r);if(r>=.001)return new Intl.NumberFormat("en-US",{maximumFractionDigits:n+1}).format(r);{if(0===r)return"0";let e=r.toFixed(n+10),t=e.split(".");if(t.length<2)return e;let i=t[1],s=0;for(let e of i)if("0"===e)s++;else break;let a=i.slice(s);return"0.{".concat(s,"}").concat(a)}}},48105:function(e,t,n){n.d(t,{S:function(){return i}});var r=n(86501);let i=e=>!!e||(r.Am.error("请先将钱包链接 ".concat("thinkium801")),!1)},21803:function(e,t,n){n.d(t,{v:function(){return r}});function r(e,t){let[n,r="0"]=e.split("."),i=n.startsWith("-");if(i&&(n=n.slice(1)),r=r.replace(/(0+)$/,""),0===t)1===Math.round(Number(`.${r}`))&&(n=`${BigInt(n)+1n}`),r="";else if(r.length>t){let[e,i,s]=[r.slice(0,t-1),r.slice(t-1,t),r.slice(t)],a=Math.round(Number(`${i}.${s}`));(r=a>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${a}`).length>t&&(r=r.slice(1),n=`${BigInt(n)+1n}`),r=r.slice(0,t)}else r=r.padEnd(t,"0");return BigInt(`${i?"-":""}${n}${r}`)}}}]);