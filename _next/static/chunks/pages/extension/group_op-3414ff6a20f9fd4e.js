try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="9b0fac1c-7c61-460a-a15e-a884f08f5ea2",e._sentryDebugIdIdentifier="sentry-dbid-9b0fac1c-7c61-460a-a15e-a884f08f5ea2")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1203],{48014:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/extension/group_op",function(){return r(97929)}])},74193:function(e,n,r){"use strict";r.d(n,{NI:function(){return y},Wi:function(){return p},l0:function(){return f},lX:function(){return N},pf:function(){return b},xJ:function(){return j},zG:function(){return A}});var t=r(34788),s=r(12796),i=r(72253),a=r(14932),o=r(47702),c=r(85893),l=r(67294),d=r(88426),u=r(87536),m=r(40108),x=r(94193),f=u.RV,h=l.createContext({}),p=function(e){var n=(0,t._)({},(0,s._)(e));return(0,c.jsx)(h.Provider,{value:{name:n.name},children:(0,c.jsx)(u.Qr,(0,i._)({},n))})},g=function(){var e=l.useContext(h),n=l.useContext(v),r=(0,u.Gc)(),t=r.getFieldState,s=r.formState,a=t(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");var o=n.id;return(0,i._)({id:o,name:e.name,formItemId:"".concat(o,"-form-item"),formDescriptionId:"".concat(o,"-form-item-description"),formMessageId:"".concat(o,"-form-item-message")},a)},v=l.createContext({}),j=l.forwardRef(function(e,n){var r=e.className,t=(0,o._)(e,["className"]),s=l.useId();return(0,c.jsx)(v.Provider,{value:{id:s},children:(0,c.jsx)("div",(0,i._)({ref:n,className:(0,m.cn)("space-y-2",r)},t))})});j.displayName="FormItem";var N=l.forwardRef(function(e,n){var r=e.className,t=(0,o._)(e,["className"]),s=g(),a=s.error,l=s.formItemId;return(0,c.jsx)(x._,(0,i._)({ref:n,className:(0,m.cn)(a&&"text-destructive",r),htmlFor:l},t))});N.displayName="FormLabel";var y=l.forwardRef(function(e,n){var r=(0,t._)({},(0,s._)(e)),a=g(),o=a.error,l=a.formItemId,u=a.formDescriptionId,m=a.formMessageId;return(0,c.jsx)(d.g7,(0,i._)({ref:n,id:l,"aria-describedby":o?"".concat(u," ").concat(m):"".concat(u),"aria-invalid":!!o},r))});y.displayName="FormControl";var b=l.forwardRef(function(e,n){var r=e.className,t=(0,o._)(e,["className"]),s=g().formDescriptionId;return(0,c.jsx)("p",(0,i._)({ref:n,id:s,className:(0,m.cn)("text-sm text-muted-foreground",r)},t))});b.displayName="FormDescription";var A=l.forwardRef(function(e,n){var r=e.className,t=e.children,s=(0,o._)(e,["className","children"]),l=g(),d=l.error,u=l.formMessageId,x=d?String(null==d?void 0:d.message):t;return x?(0,c.jsx)("p",(0,a._)((0,i._)({ref:n,id:u,className:(0,m.cn)("text-sm font-medium text-destructive",r)},s),{children:x})):null});A.displayName="FormMessage"},94193:function(e,n,r){"use strict";r.d(n,{_:function(){return u}});var t=r(72253),s=r(47702),i=r(85893),a=r(67294),o=r(49102),c=r(12003),l=r(40108),d=(0,c.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),u=a.forwardRef(function(e,n){var r=e.className,a=(0,s._)(e,["className"]);return(0,i.jsx)(o.f,(0,t._)({ref:n,className:(0,l.cn)(d(),r)},a))});u.displayName=o.f.displayName},88659:function(e,n,r){"use strict";r.d(n,{Bw:function(){return v},Ph:function(){return x},Ql:function(){return j},i4:function(){return h},ki:function(){return f}});var t=r(72253),s=r(14932),i=r(47702),a=r(85893),o=r(67294),c=r(76405),l=r(42171),d=r(15432),u=r(78865),m=r(40108),x=c.fC;c.ZA;var f=c.B4,h=o.forwardRef(function(e,n){var r=e.className,o=e.children,d=(0,i._)(e,["className","children"]);return(0,a.jsxs)(c.xz,(0,s._)((0,t._)({ref:n,className:(0,m.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r)},d),{children:[o,(0,a.jsx)(c.JO,{asChild:!0,children:(0,a.jsx)(l.Z,{className:"h-4 w-4 opacity-50"})})]}))});h.displayName=c.xz.displayName;var p=o.forwardRef(function(e,n){var r=e.className,o=(0,i._)(e,["className"]);return(0,a.jsx)(c.u_,(0,s._)((0,t._)({ref:n,className:(0,m.cn)("flex cursor-default items-center justify-center py-1",r)},o),{children:(0,a.jsx)(d.Z,{className:"h-4 w-4"})}))});p.displayName=c.u_.displayName;var g=o.forwardRef(function(e,n){var r=e.className,o=(0,i._)(e,["className"]);return(0,a.jsx)(c.$G,(0,s._)((0,t._)({ref:n,className:(0,m.cn)("flex cursor-default items-center justify-center py-1",r)},o),{children:(0,a.jsx)(l.Z,{className:"h-4 w-4"})}))});g.displayName=c.$G.displayName;var v=o.forwardRef(function(e,n){var r=e.className,o=e.children,l=e.position,d=void 0===l?"popper":l,u=(0,i._)(e,["className","children","position"]);return(0,a.jsx)(c.h_,{children:(0,a.jsxs)(c.VY,(0,s._)((0,t._)({ref:n,className:(0,m.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===d&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:d},u),{children:[(0,a.jsx)(p,{}),(0,a.jsx)(c.l_,{className:(0,m.cn)("p-1","popper"===d&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:o}),(0,a.jsx)(g,{})]}))})});v.displayName=c.VY.displayName,o.forwardRef(function(e,n){var r=e.className,s=(0,i._)(e,["className"]);return(0,a.jsx)(c.__,(0,t._)({ref:n,className:(0,m.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",r)},s))}).displayName=c.__.displayName;var j=o.forwardRef(function(e,n){var r=e.className,o=e.children,l=(0,i._)(e,["className","children"]);return(0,a.jsxs)(c.ck,(0,s._)((0,t._)({ref:n,className:(0,m.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r)},l),{children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(c.wU,{children:(0,a.jsx)(u.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(c.eT,{children:o})]}))});j.displayName=c.ck.displayName,o.forwardRef(function(e,n){var r=e.className,s=(0,i._)(e,["className"]);return(0,a.jsx)(c.Z0,(0,t._)({ref:n,className:(0,m.cn)("-mx-1 my-1 h-px bg-muted",r)},s))}).displayName=c.Z0.displayName},76453:function(e,n,r){"use strict";r.d(n,{g:function(){return c}});var t=r(72253),s=r(47702),i=r(85893),a=r(67294),o=r(40108),c=a.forwardRef(function(e,n){var r=e.className,a=(0,s._)(e,["className"]);return(0,i.jsx)("textarea",(0,t._)({className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:n},a))});c.displayName="Textarea"},64777:function(e,n,r){"use strict";var t=r(85893);n.Z=function(e){var n=e.title;return(0,t.jsx)("div",{className:"flex justify-between items-center",children:(0,t.jsx)("h1",{className:"text-lg font-bold",children:n})})}},42083:function(e,n,r){"use strict";var t=r(85893),s=r(23432);n.Z=function(){return(0,t.jsx)(s.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},85794:function(e,n,r){"use strict";r.d(n,{A5:function(){return f},DA:function(){return g},hS:function(){return m},l3:function(){return p},yA:function(){return h},yG:function(){return u},z4:function(){return x}});var t=r(11010),s=r(97582),i=r(67294),a=r(71104),o=r(37541),c=r(37742),l=r(37474),d=r(84689),u=function(e,n,r){var t=!(arguments.length>3)||void 0===arguments[3]||arguments[3],s=(0,a.u)({address:e,abi:o.O,functionName:"allowance",args:[n,r],query:{enabled:!!e&&!!n&&!!r&&t}}),i=s.data,l=s.isPending,d=s.error,u=s.refetch;return{allowance:void 0!==i?(0,c.Zu)(i):void 0,isPending:l,error:d,refetch:u}},m=function(e,n){var r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],t=(0,a.u)({address:e,abi:o.O,functionName:"balanceOf",args:[n],query:{enabled:!!e&&!!n&&r}}),s=t.data,i=t.isPending,l=t.error,d=t.refetch;return{balance:void 0!==s?(0,c.Zu)(s):void 0,isPending:i,error:l,refetch:d}},x=function(e){var n=(0,a.u)({address:e,abi:o.O,functionName:"symbol",args:[],query:{enabled:!!e}});return{symbol:n.data,isPending:n.isPending,error:n.error}},f=function(e){var n=(0,a.u)({address:e,abi:o.O,functionName:"totalSupply",args:[],query:{enabled:!!e}}),r=n.data,t=n.isPending,s=n.error;return{totalSupply:void 0!==r?(0,c.Zu)(r):void 0,isPending:t,error:s}};function h(e){var n,r=(0,l.e9)(o.O,e,"approve"),a=r.execute,c=r.isPending,u=r.isConfirming,m=r.isConfirmed,x=r.error,f=r.hash,h=r.isTukeMode,p=(n=(0,t._)(function(n,r){return(0,s.Jh)(this,function(t){switch(t.label){case 0:return console.log("提交approve交易:",{token:e,spender:n,value:r,isTukeMode:h}),[4,a([n,r])];case 1:return[2,t.sent()]}})}),function(e,r){return n.apply(this,arguments)});return(0,i.useEffect)(function(){f&&console.log("approve tx hash:",f),x&&(console.log("提交approve交易错误:"),(0,d.Vh)(x),(0,d.H)(x))},[f,x]),{approve:p,isPending:c,isConfirming:u,writeError:x,isConfirmed:m,hash:f,isTukeMode:h}}function p(e){var n,r=(0,l.e9)(o.O,e,"burnForParentToken"),a=r.execute,c=r.isPending,u=r.isConfirming,m=r.isConfirmed,x=r.error,f=r.hash,h=r.isTukeMode,p=(n=(0,t._)(function(n){return(0,s.Jh)(this,function(r){switch(r.label){case 0:return console.log("提交burnForParentToken交易:",{token:e,amount:n,isTukeMode:h}),[4,a([n])];case 1:return[2,r.sent()]}})}),function(e){return n.apply(this,arguments)});return(0,i.useEffect)(function(){f&&console.log("burnForParentToken tx hash:",f),x&&(console.log("提交burnForParentToken交易错误:"),(0,d.Vh)(x),(0,d.H)(x))},[f,x]),{burnForParentToken:p,isPending:c,isConfirming:u,writeError:x,isConfirmed:m,hash:f,isTukeMode:h}}function g(e){var n,r=(0,l.e9)(o.O,e,"transfer"),a=r.execute,c=r.isPending,u=r.isConfirming,m=r.isConfirmed,x=r.error,f=r.hash,h=r.isTukeMode,p=(n=(0,t._)(function(n,r){return(0,s.Jh)(this,function(t){switch(t.label){case 0:return console.log("提交transfer交易:",{token:e,to:n,amount:r,isTukeMode:h}),[4,a([n,r])];case 1:return[2,t.sent()]}})}),function(e,r){return n.apply(this,arguments)});return(0,i.useEffect)(function(){f&&console.log("transfer tx hash:",f),x&&(console.log("提交transfer交易错误:"),(0,d.Vh)(x),(0,d.H)(x))},[f,x]),{transfer:p,isPending:c,isConfirming:u,writeError:x,isConfirmed:m,hash:f,isTukeMode:h}}},15206:function(e,n,r){"use strict";r.d(n,{k:function(){return c}});var t=r(67516),s=r(50095),i=r(8300),a=r(37742),o="0xA0a5BB442214988D0c6e707d825640C026fB1d04";function c(e){for(var n=!!e,r=(0,i.hS)(e||"0x0000000000000000000000000000000000000000",n),c=r.balance,l=r.isPending,d=r.error,u=n&&void 0!==c?Number(c):0,m=[],x=0;x<u;x++)m.push({address:o,abi:s.s,functionName:"tokenOfOwnerByIndex",args:[e,BigInt(x)]});var f=(0,t.N)({contracts:m,query:{enabled:n&&u>0}}),h=f.data,p=f.isPending,g=f.error,v=null==h?void 0:h.map(function(e){return e.result?(0,a.Zu)(e.result):void 0}).filter(Boolean),j=(null==v?void 0:v.map(function(e){return{address:o,abi:s.s,functionName:"groupNameOf",args:[e]}}))||[],N=(0,t.N)({contracts:j,query:{enabled:n&&v&&v.length>0}}),y=N.data,b=N.isPending,A=N.error,I=n&&v?v.map(function(e,n){var r;return{tokenId:e,groupName:(null==y?void 0:null===(r=y[n])||void 0===r?void 0:r.result)||""}}):[],_=!!n&&(l||u>0&&(p||b)),w=n?d||g||A:void 0;return{myGroups:I,balance:n&&void 0!==c?c:BigInt(0),isPending:_,error:w}}},97929:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return el}});var t=r(72253),s=r(14932),i=r(85893),a=r(67294),o=r(11163),c=r(93778),l=r(93566),d=r(92112),u=r(8300),m=r(27966),x=r(42083),f=r(83494),h=r(11010),p=r(91309),g=r(97582),v=r(41664),j=r.n(v),N=r(56312),y=r(86501),b=r(87536),A=r(42130),I=r(45901),_=r(79711),w=r(27245),k=r(74193),C=r(21774),B=r(88659),P=r(76453),J=r(85794),M=r(15206),E=r(38442),L=r(21879),Z=r(87974),F=r(933),S=r(91529),z=r(64777),R=r(44576),T=function(e){var n=e.activationMinGovRatio,r=(e.maxJoinAmountRatio,e.joinMaxAmount,e.groupActivationStakeAmount),t=n?(0,S.rl)(100*Number(n)/1e18):"0%";return(0,i.jsxs)("div",{className:"text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded px-3 py-2",children:[(0,i.jsx)("div",{className:"flex items-center gap-2 text-sm font-bold text-blue-800",children:"\uD83D\uDCA1小贴士"}),(0,i.jsxs)("div",{className:"flex flex-col space-y-2 text-gray-700 ",children:[(0,i.jsx)("div",{className:"text-sm text-blue-700 pt-3",children:"激活要求："}),(0,i.jsxs)("div",{children:["激活链群需质押代币数量：",(0,i.jsx)("b",{children:(0,S.LH)(r||BigInt(0),4,"ceil")})]}),(0,i.jsxs)("div",{children:["激活链群最小治理票比例：",(0,i.jsx)("b",{children:t})]}),(0,i.jsx)("div",{className:"text-sm text-blue-700 pt-3",children:"参与代币："}),(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"行动最大参与代币量"})," = 已铸造代币总量 \xd7 最大参与代币占比 \xd7 该行动投票率"]})]})]})},D=function(e){var n=e.tokenSymbol,r=void 0===n?"":n,t=e.isTokenApproved,s=e.isPendingApprove,a=e.isConfirmingApprove,o=e.onApprove,c=e.isPendingAction,l=e.isConfirmingAction,d=e.isConfirmedAction,u=e.onAction,m=e.actionLabel,x=e.actionLabelPending,f=e.actionLabelConfirming,h=e.actionLabelConfirmed,p=e.disableApprove,g=e.disableAction;return(0,i.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,i.jsx)(w.z,{className:"w-1/2",disabled:s||a||t||void 0!==p&&p,type:"button",onClick:o,children:t?"1.".concat(r,"已授权"):"1.授权".concat(r)}),(0,i.jsx)(w.z,{className:"w-1/2",disabled:!t||c||l||d||void 0!==g&&g,type:"button",onClick:u,children:c?x||"2.提交中...":l?f||"2.确认中...":d?h||"2.已完成":"2.".concat(m)})]})},G="0x0000000000000000000000000000000000000000",V=function(e){var n=e.actionId,r=(e.actionInfo,e.extensionAddress),l=e.groupId,d=(0,o.useRouter)(),u=((0,a.useContext)(c.M)||{}).token,f=(0,A.m)().address,v=(0,M.k)(f),V=v.myGroups,H=v.isPending,O=v.error,X=(0,p._)((0,a.useState)(l),2),W=X[0],q=X[1],Q=(0,p._)((0,a.useState)(!1),2),K=Q[0],U=Q[1],$=l||W,Y=(0,Z.gO)(r,f||G),ee=Y.activeGroupIds,en=Y.isPending,er=Y.error,et=(0,a.useMemo)(function(){return V&&ee?V.filter(function(e){return!ee.some(function(n){return n===e.tokenId})}):V},[V,ee]);(0,a.useEffect)(function(){l||!et||1!==et.length||W||q(et[0].tokenId)},[l,et,W]);var es=(0,L.DM)({actionId:n,extensionAddress:r}),ei=es.params,ea=es.isPending,eo=es.error,ec=(0,E.r)({tokenAddress:null==ei?void 0:ei.joinTokenAddress,tokenSymbol:null==ei?void 0:ei.joinTokenSymbol,enabled:!!(null==ei?void 0:ei.joinTokenAddress)}),el=ec.formattedSymbol,ed=ec.isPending,eu=(null==ei?void 0:ei.groupActivationStakeAmount)||BigInt(0),em=(0,F.Ty)((null==ei?void 0:ei.tokenAddress)||G,f||G,!!(null==ei?void 0:ei.tokenAddress)&&!!f).validGovVotes,ex=(0,F.kc)((null==ei?void 0:ei.tokenAddress)||G).govVotesNum,ef=(0,a.useMemo)(function(){return em&&ex&&ex!==BigInt(0)?em*BigInt(1e18)/ex:BigInt(0)},[em,ex]),eh=(null==ei?void 0:ei.activationMinGovRatio)||BigInt(0),ep=ef<eh,eg=(0,J.hS)((null==ei?void 0:ei.tokenAddress)||G,f||G,!!(null==ei?void 0:ei.tokenAddress)&&!!f),ev=eg.balance,ej=eg.isPending,eN=eg.error,ey=(0,a.useMemo)(function(){return I.Ry({maxCapacity:I.Z_().refine(function(e){if(!e||"0"===e)return!0;var n=parseFloat(e);return!isNaN(n)&&n>=0},{message:"请输入有效的容量上限"}),description:I.Z_().max(2e3,{message:"描述不能超过2000字"}),minJoinAmount:I.Z_().refine(function(e){if(!e||""===e.trim()||"0"===e)return!1;var n=parseFloat(e);return!isNaN(n)&&n>0},{message:"最小参与代币数不能为空且必须大于0"}).superRefine(function(e,n){if(!e||"0"===e){n.addIssue({code:_.NL.custom,message:"最小参与代币数不能为0"});return}var r=(0,S.vz)(e);r>BigInt(0)&&(null==ei?void 0:ei.joinMaxAmount)&&r>ei.joinMaxAmount&&n.addIssue({code:_.NL.custom,message:"不能大于全局最大参与量 ".concat((0,S.LH)(ei.joinMaxAmount,2)," ").concat((null==u?void 0:u.symbol)||"")})}),maxJoinAmount:I.Z_().refine(function(e){if(!e||"0"===e)return!0;var n=parseFloat(e);return!isNaN(n)&&n>=0},{message:"请输入有效的代币数"}).superRefine(function(e,n){if(e&&"0"!==e){var r=(0,S.vz)(e);r>BigInt(0)&&(null==ei?void 0:ei.joinMaxAmount)&&r>ei.joinMaxAmount&&n.addIssue({code:_.NL.custom,message:"不能大于全局最大参与量 ".concat((0,S.LH)(ei.joinMaxAmount,2)," ").concat((null==u?void 0:u.symbol)||"")})}}),maxAccounts:I.Z_().refine(function(e){if(!e||"0"===e)return!0;var n=parseInt(e,10);return!isNaN(n)&&n>=0&&Number.isInteger(n)},{message:"请输入有效的非负整数"})}).refine(function(e){var n=(0,S.vz)(e.minJoinAmount||"0"),r=(0,S.vz)(e.maxJoinAmount||"0");return!(n>BigInt(0)&&r>BigInt(0)&&r<n)},{message:"最大参与量不能小于最小参与量",path:["maxJoinAmount"]})},[ei,u]),eb=(0,b.cI)({resolver:(0,N.F)(ey),defaultValues:{maxCapacity:"",description:"",minJoinAmount:"",maxJoinAmount:"",maxAccounts:""},mode:"onChange"}),eA=(0,J.yG)((null==ei?void 0:ei.tokenAddress)||G,f||G,"0xf2084E73bF047aF26d72CEFde25e22536a1f37C8",!!(null==ei?void 0:ei.tokenAddress)&&!!f),eI=eA.allowance,e_=(eA.isPending,eA.error),ew=eA.refetch,ek=void 0!==eI&&eI>=eu,eC=(0,J.yA)((null==ei?void 0:ei.tokenAddress)||G),eB=eC.approve,eP=eC.isPending,eJ=eC.isConfirming,eM=eC.isConfirmed,eE=eC.writeError;function eL(){return(eL=(0,h._)(function(e){return(0,g.Jh)(this,function(e){switch(e.label){case 0:if(!eu||eu===BigInt(0))return y.Am.error("激活需质押代币数量未设置"),[2];if(void 0!==ev&&ev<eu)return y.Am.error("余额不足，需要 ".concat((0,S.LH)(eu)," ").concat(null==u?void 0:u.symbol)),[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,eB("0xf2084E73bF047aF26d72CEFde25e22536a1f37C8",eu)];case 2:return e.sent(),[3,4];case 3:return console.error("Approve failed",e.sent()),[3,4];case 4:return[2]}})})).apply(this,arguments)}(0,a.useEffect)(function(){eM&&(y.Am.success("授权成功"),ew())},[eM,ew]);var eZ=(0,Z.EU)(),eF=eZ.activateGroup,eS=eZ.isPending,ez=eZ.isConfirming,eR=eZ.isConfirmed,eT=eZ.writeError;function eD(){return(eD=(0,h._)(function(e){var n,t,s,i;return(0,g.Jh)(this,function(a){switch(a.label){case 0:if(!ei)return y.Am.error("扩展协议参数未加载完成"),[2];if(!$)return y.Am.error("请选择要激活的链群"),[2];if(!ek)return y.Am.error("请先授权质押代币"),[2];if(ep)return y.Am.error("治理票占比不足，无法激活链群"),[2];if(n=e.maxCapacity?(0,S.vz)(e.maxCapacity):BigInt(0),!e.minJoinAmount||"0"===e.minJoinAmount)return y.Am.error("最小参与代币数不能为0"),[2];if((t=(0,S.vz)(e.minJoinAmount))<=BigInt(0))return y.Am.error("最小参与代币数必须大于0"),[2];s=e.maxJoinAmount?(0,S.vz)(e.maxJoinAmount):BigInt(0),i=e.maxAccounts&&"0"!==e.maxAccounts?BigInt(parseInt(e.maxAccounts,10)):BigInt(0),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,eF(r,$,e.description,n,t,s,i)];case 2:return a.sent(),[3,4];case 3:return console.error("Activate group failed",a.sent()),[3,4];case 4:return[2]}})})).apply(this,arguments)}(0,a.useEffect)(function(){eR&&(y.Am.success("链群激活成功"),U(!0),setTimeout(function(){d.push("/action/info/?id=".concat(n.toString(),"&symbol=").concat(null==u?void 0:u.symbol,"&tab=public"))},1500))},[eR,d,n,null==u?void 0:u.symbol]);var eG=(0,m.b)().handleError;return((0,a.useEffect)(function(){eo&&eG(eo),eN&&eG(eN),e_&&eG(e_),eE&&eG(eE),eT&&eG(eT),O&&eG(O),er&&eG(er)},[eo,eN,e_,eE,eT,O,er,eG]),ea||ej||ed||!l&&(H||en))?(0,i.jsxs)("div",{className:"flex flex-col items-center py-8",children:[(0,i.jsx)(x.Z,{}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:"加载参数中..."})]}):eS||K||l||et&&0!==et.length?ei?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("div",{children:(0,i.jsx)(z.Z,{title:"激活链群"})}),ep&&(0,i.jsxs)("div",{className:"text-sm text-red-700 bg-red-50 border border-red-200 rounded px-3 py-2",children:[(0,i.jsx)("div",{className:"font-medium",children:"⚠️ 治理票占比不足"}),(0,i.jsxs)("div",{className:"mt-1",children:["你的治理票占比"," ",(0,i.jsx)("span",{className:"font-semibold",children:(0,S.rl)(100*Number(ef)/1e18)})," ","低于最小限制 ",(0,i.jsx)("span",{className:"font-semibold",children:(0,S.rl)(100*Number(eh)/1e18)}),"，无法激活链群。"]}),(0,i.jsx)("div",{className:"text-xs text-red-600 mt-1",children:"您可以增加治理票数，再尝试激活链群。"})]}),!l&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:"选择链群NFT"}),(0,i.jsxs)(B.Ph,{value:(null==W?void 0:W.toString())||"",onValueChange:function(e){return q(BigInt(e))},children:[(0,i.jsx)(B.i4,{className:"!ring-secondary-foreground",children:(0,i.jsx)(B.ki,{placeholder:"请选择要激活的链群"})}),(0,i.jsx)(B.Bw,{children:null==et?void 0:et.map(function(e){return(0,i.jsx)(B.Ql,{value:e.tokenId.toString(),children:e.groupName||"链群 #".concat(e.tokenId.toString())},e.tokenId.toString())})})]}),!W&&(0,i.jsx)("p",{className:"text-xs text-red-500",children:"请选择一个链群"})]}),(0,i.jsx)(k.l0,(0,s._)((0,t._)({},eb),{children:(0,i.jsxs)("form",{onSubmit:function(e){return e.preventDefault()},className:"space-y-4",children:[(0,i.jsx)(k.Wi,{control:eb.control,name:"maxCapacity",render:function(e){var n=e.field;return(0,i.jsxs)(k.xJ,{children:[(0,i.jsxs)(k.lX,{children:["链群容量上限 ",(0,i.jsx)("span",{className:"text-gray-500 text-xs font-normal",children:el})]}),(0,i.jsx)(k.NI,{children:(0,i.jsx)(C.I,(0,t._)({placeholder:"0 为不限制",className:"!ring-secondary-foreground flex-1"},n))}),(0,i.jsx)(k.zG,{})]})}}),(0,i.jsx)(k.Wi,{control:eb.control,name:"description",render:function(e){var n=e.field;return(0,i.jsxs)(k.xJ,{children:[(0,i.jsx)(k.lX,{children:"链群描述"}),(0,i.jsx)(k.NI,{children:(0,i.jsx)(P.g,(0,t._)({placeholder:"例如：一些注意事项，以及如何联系到链群服务者，如何加入所在链群的行动者群（例如：QQ 群、微信验证群）等",className:"!ring-secondary-foreground min-h-[100px]"},n))}),(0,i.jsx)(k.zG,{})]})}}),(0,i.jsx)(k.Wi,{control:eb.control,name:"minJoinAmount",render:function(e){var n=e.field;return(0,i.jsxs)(k.xJ,{children:[(0,i.jsxs)(k.lX,{children:["单地址最小参与代币数"," ",(0,i.jsx)("span",{className:"text-gray-500 text-xs font-normal",children:el})]}),(0,i.jsx)(k.NI,{children:(0,i.jsx)(C.I,(0,t._)({placeholder:"请填写数量，必须大于0",className:"!ring-secondary-foreground"},n))}),(0,i.jsx)(k.pf,{className:"text-xs",children:"最小参与代币数必须大于0"}),(0,i.jsx)(k.zG,{})]})}}),(0,i.jsx)(k.Wi,{control:eb.control,name:"maxJoinAmount",render:function(e){var n=e.field;return(0,i.jsxs)(k.xJ,{children:[(0,i.jsxs)(k.lX,{children:["单地址最大参与代币数"," ",(0,i.jsx)("span",{className:"text-gray-500 text-xs font-normal",children:el})]}),(0,i.jsx)(k.NI,{children:(0,i.jsx)(C.I,(0,t._)({placeholder:"0 为不做限制",className:"!ring-secondary-foreground"},n))}),(null==ei?void 0:ei.joinMaxAmount)&&ei.joinMaxAmount>BigInt(0)&&(0,i.jsxs)(k.pf,{className:"text-xs",children:["扩展行动当前最大参与量：",(0,S.LH)(ei.joinMaxAmount)]}),(0,i.jsx)(k.zG,{})]})}}),(0,i.jsx)(k.Wi,{control:eb.control,name:"maxAccounts",render:function(e){var n=e.field;return(0,i.jsxs)(k.xJ,{children:[(0,i.jsx)(k.lX,{children:"行动者最大地址数"}),(0,i.jsx)(k.NI,{children:(0,i.jsx)(C.I,(0,t._)({placeholder:"0 为不做限制",className:"!ring-secondary-foreground"},n))}),(0,i.jsx)(k.zG,{})]})}}),(0,i.jsxs)("div",{className:"p-4 border rounded-lg ".concat(void 0!==ev&&ev<eu?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"),children:[(0,i.jsx)("div",{className:"text-sm mb-1 ".concat(void 0!==ev&&ev<eu?"text-red-800":"text-gray-800"),children:"激活链群需质押代币："}),(0,i.jsx)("div",{className:"text-lg font-semibold ".concat(void 0!==ev&&ev<eu?"text-red-900":"text-blue-900"),children:(0,i.jsxs)("span",{className:"flex items-center gap-1",children:[(0,S.LH)(eu,4,"ceil")," ",(0,i.jsx)("span",{className:"text-sm text-gray-600",children:null==ei?void 0:ei.stakeTokenSymbol})]})}),(0,i.jsxs)("div",{className:"text-xs mt-1 ".concat(void 0!==ev&&ev<eu?"text-red-600":"text-gray-600"),children:["当前余额：",(0,S.LH)(ev||BigInt(0))]}),void 0!==ev&&ev<eu&&(0,i.jsx)("div",{className:"text-xs text-red-700 font-medium mt-2",children:"⚠️ 余额不足，无法激活链群"})]}),(0,i.jsx)(D,{tokenSymbol:null==u?void 0:u.symbol,isTokenApproved:ek,isPendingApprove:eP,isConfirmingApprove:eJ,onApprove:function(){return eb.handleSubmit(function(e){return function(e){return eL.apply(this,arguments)}(e)})()},isPendingAction:eS,isConfirmingAction:ez,isConfirmedAction:eR,onAction:function(){return eb.handleSubmit(function(e){return function(e){return eD.apply(this,arguments)}(e)})()},actionLabel:"激活链群",actionLabelPending:"2.提交中...",actionLabelConfirming:"2.确认中...",actionLabelConfirmed:"2.已激活",disableApprove:ep,disableAction:!$||void 0!==ev&&ev<eu||ep})]})})),(0,i.jsx)(T,{activationMinGovRatio:null==ei?void 0:ei.activationMinGovRatio,maxJoinAmountRatio:null==ei?void 0:ei.maxJoinAmountRatio,joinMaxAmount:null==ei?void 0:ei.joinMaxAmount,groupActivationStakeAmount:null==ei?void 0:ei.groupActivationStakeAmount})]}),(0,i.jsx)(R.Z,{isLoading:eP||eJ||eS||ez,text:eP?"授权中...":eJ?"确认授权...":eS?"激活中...":"确认激活..."})]}):(0,i.jsx)("div",{className:"text-center py-12",children:(0,i.jsx)("p",{className:"text-red-500",children:"未找到扩展参数"})}):(0,i.jsxs)("div",{className:"text-center py-12",children:[(0,i.jsx)("p",{className:"mb-4 text-gray-500",children:V&&V.length>0?"您的所有链群已激活，没有未激活链群":"没有未激活的 链群NFT"}),(0,i.jsx)("p",{className:"mb-4",children:(0,i.jsx)(j(),{href:"/group/groupids/",children:(0,i.jsx)(w.z,{variant:"outline",className:"w-1/2 text-secondary border-secondary",children:"去铸造链群NFT >>"})})})]})},H=r(72260),O=r(48886),X=function(e){e.actionId,e.actionInfo;var n=e.extensionAddress,r=e.groupId,t=(0,o.useRouter)(),s=((0,a.useContext)(c.M)||{}).token,l=(0,Z.iF)(n,r),d=l.activatedRound,u=l.isPending,f=l.error,p=(0,H.Bk)(),v=p.currentRound,j=p.isPending,N=p.error,b=(0,a.useMemo)(function(){return v?v+BigInt(1):void 0},[v]),A=(0,L.Av)({extensionAddress:n,groupId:r,round:b}),I=A.groupDetail,_=A.isPending,k=A.error,C=v>BigInt(0)?v-BigInt(1):BigInt(0),B=(0,O.oi)(n,C,r),P=B.count,J=B.isPending,M=B.error,E=(0,Z.M3)(),F=E.deactivateGroup,T=E.isPending,D=E.isConfirming,G=E.isConfirmed,V=E.writeError;function X(){return(X=(0,h._)(function(){return(0,g.Jh)(this,function(e){switch(e.label){case 0:if(!I)return y.Am.error("未找到链群信息"),[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,F(n,r)];case 2:return e.sent(),[3,4];case 3:return console.error("Deactivate group failed",e.sent()),[3,4];case 4:return[2]}})})).apply(this,arguments)}(0,a.useEffect)(function(){G&&(y.Am.success("链群关闭成功"),setTimeout(function(){t.back()},1500))},[G,t]);var W=(0,m.b)().handleError;if((0,a.useEffect)(function(){k&&W(k),f&&W(f),M&&W(M),N&&W(N),V&&W(V)},[k,f,M,N,V,W]),_||u||J||j)return(0,i.jsxs)("div",{className:"flex flex-col items-center py-8",children:[(0,i.jsx)(x.Z,{}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:"加载链群信息..."})]});if(!I||void 0===d)return(0,i.jsx)("div",{className:"text-center py-12",children:(0,i.jsx)("p",{className:"text-red-500",children:"未找到链群信息"})});var q=d===v,Q=I.isActive&&!q;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(z.Z,{title:"关闭链群"}),(0,i.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["关闭链群 ",(0,i.jsx)("span",{className:"text-gray-500 text-xs",children:"#"}),(0,i.jsx)("span",{className:"text-secondary text-base font-semibold",children:r.toString()}),(0,i.jsx)("span",{className:"font-semibold text-gray-800 text-sm ml-1",children:I.groupName})," 并取回质押代币"]})]}),(0,i.jsx)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("span",{className:"text-sm text-gray-600",children:"链群状态:"}),(0,i.jsx)("span",{className:"ftext-sm ".concat(I.isActive?"text-green-600":"text-gray-500"),children:I.isActive?"活跃中":"已关闭"})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("span",{className:"text-sm text-gray-600",children:"当前容量:"}),(0,i.jsxs)("span",{className:"text-sm",children:[(0,S.LH)(I.totalJoinedAmount,2)," /"," ",I.maxCapacity>BigInt(0)?(0,S.LH)(I.maxCapacity,2):"不限"," ",null==s?void 0:s.symbol]})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("span",{className:"text-sm text-gray-600",children:"参与地址数:"}),(0,i.jsx)("span",{className:"text-sm",children:(null==P?void 0:P.toString())||"0"})]})]})}),(0,i.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,i.jsx)(w.z,{variant:"outline",onClick:function(){return t.back()},disabled:T||D,children:"取消"}),(0,i.jsx)(w.z,{variant:"destructive",disabled:!Q||T||D||G,onClick:function(){return X.apply(this,arguments)},children:T?"提交中...":D?"确认中...":G?"已关闭":q?"请等待下一轮次再关闭":"确认关闭"})]}),q&&I.isActive&&(0,i.jsx)("div",{className:"text-center text-sm text-amber-600 bg-amber-50 border border-amber-200 rounded px-3 py-2",children:"⚠️ 在激活链群的同一轮次内无法关闭，请等待下一轮次再操作。"}),!I.isActive&&(0,i.jsx)("div",{className:"text-center text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded px-3 py-2",children:"链群已关闭"}),(0,i.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,i.jsx)("div",{className:"flex items-start gap-3",children:(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("div",{className:"font-medium text-red-800 mb-1",children:"⚠️ 重要提示"}),(0,i.jsxs)("div",{className:"text-sm text-red-700 space-y-1",children:[(0,i.jsx)("div",{children:"• 链群关闭后将无法再验证，也不再有激励"}),(0,i.jsx)("div",{children:"• 链群关闭后，新的参与者无法再加入"}),(0,i.jsx)("div",{children:"• 链群关闭后可以取回全部质押代币"}),(0,i.jsx)("div",{children:"• 在激活后的下一个轮次，才能关闭链群"})]})]})})})]}),(0,i.jsx)(R.Z,{isLoading:T||D,text:T?"关闭中...":"确认关闭..."})]})},W=r(20442),q=r(8595),Q=r(47714),K=function(e){var n=e.actionId,r=(e.actionInfo,e.extensionAddress),l=e.groupId,d=(0,o.useRouter)(),u=((0,a.useContext)(c.M)||{}).token,f=(0,W.Bk)().currentRound,p=(0,Q.A)({extensionAddress:r,groupId:l,round:f}),v=p.groupDetail,j=p.isPending,A=p.error,B=(0,q.D)({actionId:n,extensionAddress:r}),J=B.params,M=B.isPending,L=B.error,F=(0,E.r)({tokenAddress:null==J?void 0:J.joinTokenAddress,tokenSymbol:null==J?void 0:J.joinTokenSymbol,enabled:!!(null==J?void 0:J.joinTokenAddress)}),D=F.formattedSymbol,G=F.isPending,V=(0,a.useMemo)(function(){return I.Ry({maxCapacity:I.Z_().refine(function(e){if(!e||"0"===e)return!0;var n=parseFloat(e);return!isNaN(n)&&n>=0},{message:"请输入有效的容量上限"}),description:I.Z_().max(500,{message:"描述不能超过500字"}),minJoinAmount:I.Z_().refine(function(e){if(!e||""===e.trim()||"0"===e)return!1;var n=parseFloat(e);return!isNaN(n)&&n>0},{message:"最小参与代币数不能为空且必须大于0"}).superRefine(function(e,n){if(!e||"0"===e){n.addIssue({code:_.NL.custom,message:"最小参与代币数不能为0"});return}var r=(0,S.vz)(e);r>BigInt(0)&&(null==J?void 0:J.joinMaxAmount)&&r>J.joinMaxAmount&&n.addIssue({code:_.NL.custom,message:"不能大于全局最大参与量 ".concat((0,S.LH)(J.joinMaxAmount,2)," ").concat((null==u?void 0:u.symbol)||"")})}),maxJoinAmount:I.Z_().refine(function(e){if(!e||"0"===e)return!0;var n=parseFloat(e);return!isNaN(n)&&n>=0},{message:"请输入有效的代币数"}).superRefine(function(e,n){if(e&&"0"!==e){var r=(0,S.vz)(e);r>BigInt(0)&&(null==J?void 0:J.joinMaxAmount)&&r>J.joinMaxAmount&&n.addIssue({code:_.NL.custom,message:"不能大于全局最大参与量 ".concat((0,S.LH)(J.joinMaxAmount,2)," ").concat((null==u?void 0:u.symbol)||"")})}}),maxAccounts:I.Z_().refine(function(e){if(!e||"0"===e)return!0;var n=parseInt(e,10);return!isNaN(n)&&n>=0&&Number.isInteger(n)},{message:"请输入有效的非负整数"})}).refine(function(e){var n=(0,S.vz)(e.minJoinAmount||"0"),r=(0,S.vz)(e.maxJoinAmount||"0");return!(n>BigInt(0)&&r>BigInt(0)&&r<n)},{message:"最大参与量不能小于最小参与量",path:["maxJoinAmount"]})},[J,u]),H=(0,b.cI)({resolver:(0,N.F)(V),defaultValues:{maxCapacity:"",description:"",minJoinAmount:"",maxJoinAmount:"",maxAccounts:""},mode:"onChange"});(0,a.useEffect)(function(){if(v){var e=v.minJoinAmount>BigInt(0)?(0,S.LH)(v.minJoinAmount,(null==u?void 0:u.decimals)||18):"";H.reset({maxCapacity:v.maxCapacity>BigInt(0)?(0,S.LH)(v.maxCapacity,(null==u?void 0:u.decimals)||18):"",description:v.description||"",minJoinAmount:e,maxJoinAmount:v.maxJoinAmount>BigInt(0)?(0,S.LH)(v.maxJoinAmount,(null==u?void 0:u.decimals)||18):"",maxAccounts:v.maxAccounts>BigInt(0)?v.maxAccounts.toString():""})}},[v,H,null==u?void 0:u.decimals]);var O=(0,Z.Jh)(),X=O.updateGroupInfo,K=O.isPending,U=O.isConfirming,$=O.isConfirmed,Y=O.writeError;function ee(){return(ee=(0,h._)(function(e){var n,t,s,i;return(0,g.Jh)(this,function(a){switch(a.label){case 0:if(!J)return y.Am.error("扩展协议参数未加载完成"),[2];if(n=e.maxCapacity?(0,S.vz)(e.maxCapacity):BigInt(0),!e.minJoinAmount||"0"===e.minJoinAmount)return y.Am.error("最小参与代币数不能为0"),[2];if((t=(0,S.vz)(e.minJoinAmount))<=BigInt(0))return y.Am.error("最小参与代币数必须大于0"),[2];s=e.maxJoinAmount?(0,S.vz)(e.maxJoinAmount):BigInt(0),i=e.maxAccounts&&"0"!==e.maxAccounts?BigInt(parseInt(e.maxAccounts,10)):BigInt(0),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,X(r,l,e.description,n,t,s,i)];case 2:return a.sent(),[3,4];case 3:return console.error("Update group failed",a.sent()),[3,4];case 4:return[2]}})})).apply(this,arguments)}(0,a.useEffect)(function(){$&&(y.Am.success("链群信息更新成功"),setTimeout(function(){d.back()},1500))},[$,d]);var en=(0,m.b)().handleError;return((0,a.useEffect)(function(){A&&en(A),L&&en(L),Y&&en(Y)},[A,L,Y,en]),j||M||G)?(0,i.jsxs)("div",{className:"flex flex-col items-center py-8",children:[(0,i.jsx)(x.Z,{}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:"加载参数中..."})]}):v&&J?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsx)("div",{children:(0,i.jsx)(z.Z,{title:"更新链群信息"})}),(0,i.jsx)(k.l0,(0,s._)((0,t._)({},H),{children:(0,i.jsxs)("form",{onSubmit:function(e){return e.preventDefault()},className:"space-y-4",children:[(0,i.jsx)(k.Wi,{control:H.control,name:"maxCapacity",render:function(e){var n=e.field;return(0,i.jsxs)(k.xJ,{children:[(0,i.jsxs)(k.lX,{children:["链群容量上限 ",(0,i.jsx)("span",{className:"text-gray-500 text-xs font-normal",children:D})]}),(0,i.jsx)(k.NI,{children:(0,i.jsx)(C.I,(0,t._)({placeholder:"0 为不限制",className:"!ring-secondary-foreground"},n))}),(0,i.jsx)(k.zG,{})]})}}),(0,i.jsx)(k.Wi,{control:H.control,name:"description",render:function(e){var n=e.field;return(0,i.jsxs)(k.xJ,{children:[(0,i.jsx)(k.lX,{children:"链群描述"}),(0,i.jsx)(k.NI,{children:(0,i.jsx)(P.g,(0,t._)({placeholder:"介绍您的链群...",className:"!ring-secondary-foreground min-h-[100px]"},n))}),(0,i.jsx)(k.zG,{})]})}}),(0,i.jsx)(k.Wi,{control:H.control,name:"minJoinAmount",render:function(e){var n=e.field;return(0,i.jsxs)(k.xJ,{children:[(0,i.jsxs)(k.lX,{children:["单地址最小参与代币数"," ",(0,i.jsx)("span",{className:"text-gray-500 text-xs font-normal",children:D})]}),(0,i.jsx)(k.NI,{children:(0,i.jsx)(C.I,(0,t._)({placeholder:"请填写数量，必须大于0",className:"!ring-secondary-foreground"},n))}),(0,i.jsx)(k.pf,{className:"text-xs",children:"最小参与代币数必须大于0"}),(0,i.jsx)(k.zG,{})]})}}),(0,i.jsx)(k.Wi,{control:H.control,name:"maxJoinAmount",render:function(e){var n=e.field;return(0,i.jsxs)(k.xJ,{children:[(0,i.jsxs)(k.lX,{children:["单地址最大参与代币数"," ",(0,i.jsx)("span",{className:"text-gray-500 text-xs font-normal",children:D})]}),(0,i.jsx)(k.NI,{children:(0,i.jsx)(C.I,(0,t._)({placeholder:"可填0, 表示与扩展行动默认值保持一致",className:"!ring-secondary-foreground"},n))}),(null==J?void 0:J.joinMaxAmount)&&J.joinMaxAmount>BigInt(0)&&(0,i.jsxs)(k.pf,{className:"text-xs",children:["扩展行动当前最大参与量：",(0,S.LH)(J.joinMaxAmount)]}),(0,i.jsx)(k.zG,{})]})}}),(0,i.jsx)(k.Wi,{control:H.control,name:"maxAccounts",render:function(e){var n=e.field;return(0,i.jsxs)(k.xJ,{children:[(0,i.jsx)(k.lX,{children:"行动者最大地址数"}),(0,i.jsx)(k.NI,{children:(0,i.jsx)(C.I,(0,t._)({placeholder:"0 为不做限制",className:"!ring-secondary-foreground"},n))}),(0,i.jsx)(k.zG,{})]})}}),(0,i.jsx)("div",{className:"flex justify-center space-x-4 pt-4",children:(0,i.jsx)(w.z,{disabled:K||U||$,className:"w-full max-w-xs",type:"button",onClick:function(){H.handleSubmit(function(e){return function(e){return ee.apply(this,arguments)}(e)})()},children:K?"提交中...":U?"确认中...":$?"已更新":"确认更新"})})]})})),(0,i.jsx)(T,{activationMinGovRatio:null==J?void 0:J.activationMinGovRatio,maxJoinAmountRatio:null==J?void 0:J.maxJoinAmountRatio,joinMaxAmount:null==J?void 0:J.joinMaxAmount,groupActivationStakeAmount:null==J?void 0:J.groupActivationStakeAmount})]}),(0,i.jsx)(R.Z,{isLoading:K||U,text:K?"更新中...":"确认更新..."})]}):(0,i.jsx)("div",{className:"text-center py-12",children:(0,i.jsx)("p",{className:"text-red-500",children:"未找到扩展参数"})})},U=r(60480),$=r(10221),Y=r(27460),ee=function(e){var n=e.actionId,r=(e.actionInfo,e.extensionAddress),l=e.groupId,d=(0,o.useRouter)(),u=((0,a.useContext)(c.M)||{}).token,f=(0,Z.iF)(r,l),p=f.isPending,v=f.error,j=(0,$.Nq)(r,l),A=j.delegatedVerifier,_=j.isPending,B=j.error,P=I.Ry({delegatedVerifier:I.Z_().refine(function(e){return!e||""===e.trim()||(0,U.U)(e)},{message:"请输入有效的以太坊地址"})}),J=(0,b.cI)({resolver:(0,N.F)(P),defaultValues:{delegatedVerifier:""},mode:"onChange"});(0,a.useEffect)(function(){A&&"0x0000000000000000000000000000000000000000"!==A&&J.reset({delegatedVerifier:A})},[A,J]);var M=(0,$.$b)(),E=M.setGroupDelegate,L=M.isPending,F=M.isConfirming,S=M.isConfirmed,T=M.writeError;function D(){return(D=(0,h._)(function(e){var n,t;return(0,g.Jh)(this,function(s){switch(s.label){case 0:t=(null===(n=e.delegatedVerifier)||void 0===n?void 0:n.trim())||"0x0000000000000000000000000000000000000000",s.label=1;case 1:return s.trys.push([1,3,,4]),[4,E(r,l,t)];case 2:return s.sent(),[3,4];case 3:return console.error("Set delegate failed",s.sent()),[3,4];case 4:return[2]}})})).apply(this,arguments)}function G(){return(G=(0,h._)(function(){return(0,g.Jh)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,E(r,l,"0x0000000000000000000000000000000000000000")];case 1:return e.sent(),[3,3];case 2:return console.error("Cancel delegate failed",e.sent()),[3,3];case 3:return[2]}})})).apply(this,arguments)}(0,a.useEffect)(function(){if(S){var e,r=(null===(e=J.getValues("delegatedVerifier"))||void 0===e?void 0:e.trim())?"打分代理设置成功":"打分代理已取消";y.Am.success(r),setTimeout(function(){d.push("/extension/group/?groupId=".concat(l,"&actionId=").concat(n,"&symbol=").concat(null==u?void 0:u.symbol))},1500)}},[S,d,J]);var V=(0,m.b)().handleError;if((0,a.useEffect)(function(){v&&V(v),B&&V(B),T&&V(T)},[v,B,T,V]),p||_)return(0,i.jsxs)("div",{className:"flex flex-col items-center py-8",children:[(0,i.jsx)(x.Z,{}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:"加载参数中..."})]});if(void 0===A)return(0,i.jsx)("div",{className:"text-center py-12",children:(0,i.jsx)("p",{className:"text-red-500",children:"未找到扩展参数"})});var H="0x0000000000000000000000000000000000000000"!==A;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsx)("div",{children:(0,i.jsx)(z.Z,{title:"设置打分代理"})}),H&&(0,i.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,i.jsx)("div",{className:"text-sm text-blue-800 mb-2",children:"当前打分代理:"}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(Y.Z,{address:A,showCopyButton:!0}),(0,i.jsx)("button",{type:"button",onClick:function(){return G.apply(this,arguments)},disabled:L||F||S,className:"text-sm text-blue-600 hover:text-blue-800 underline disabled:text-gray-400 disabled:no-underline disabled:cursor-not-allowed",children:"取消代理"})]})]}),(0,i.jsx)(k.l0,(0,s._)((0,t._)({},J),{children:(0,i.jsxs)("form",{onSubmit:function(e){return e.preventDefault()},className:"space-y-4",children:[(0,i.jsx)(k.Wi,{control:J.control,name:"delegatedVerifier",render:function(e){var n=e.field;return(0,i.jsxs)(k.xJ,{children:[(0,i.jsx)(k.lX,{children:"代理地址"}),(0,i.jsx)(k.NI,{children:(0,i.jsx)(C.I,(0,t._)({placeholder:"输入代理打分地址",className:"!ring-secondary-foreground"},n))}),(0,i.jsx)(k.pf,{className:"text-xs"}),(0,i.jsx)(k.zG,{})]})}}),(0,i.jsx)("div",{className:"flex justify-center gap-3 pt-4",children:(0,i.jsx)(w.z,{disabled:L||F||S,className:"w-full max-w-xs",type:"button",onClick:function(){J.handleSubmit(function(e){return function(e){return D.apply(this,arguments)}(e)})()},children:L?"提交中...":F?"确认中...":S?"已设置":"确认设置"})})]})})),(0,i.jsxs)("div",{className:"text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded px-3 py-2",children:[(0,i.jsx)("div",{className:"font-medium text-gray-700 mb-1",children:"\uD83D\uDCA1 打分代理说明"}),(0,i.jsxs)("div",{className:"space-y-1 text-gray-600",children:[(0,i.jsx)("div",{children:"• 打分代理可以代替您对链群进行验证打分"}),(0,i.jsx)("div",{children:"• 代理人不需要是链群所有者"}),(0,i.jsx)("div",{children:"• 可以随时更换或取消代理"})]})]})]}),(0,i.jsx)(R.Z,{isLoading:L||F,text:L?"设置中...":"确认设置..."})]})},en=r(4586),er=r(59271),et=r(79128),es=r(72107),ei=r(67516),ea=r(67959),eo=function(e){var n=e.tokenAddress,r=e.actionId,t=e.accounts,s=e.verificationKeys,i=e.enabled,o=void 0===i||i,c=(0,a.useMemo)(function(){if(!o||0===t.length||0===s.length||!n)return[];var e=[];return t.forEach(function(t){s.forEach(function(s){e.push({address:"0x37Ddf561323b823144BaE33264f9C5461714846e",abi:ea.z,functionName:"verificationInfo",args:[n,r,t,s]})})}),e},[n,r,t,s,o]),l=(0,ei.N)({contracts:c,query:{enabled:o&&c.length>0}}),d=l.data,u=l.isLoading,m=l.error,x=l.isSuccess,f=(0,a.useMemo)(function(){if(!o||0===t.length||0===s.length)return{infos:[],isLoading:!1,hasError:!1,allLoaded:!0};var e=t.map(function(e,n){var r=[],t=!1,i=null;return s.forEach(function(e,a){var o=n*s.length+a,c=null==d?void 0:d[o];(null==c?void 0:c.status)==="success"?r.push(c.result||""):(r.push(""),(null==c?void 0:c.status)==="failure"&&(t=!0,i=c.error))}),{account:e,infos:r,isPending:u,error:t?i:null}}),n=!!m||e.some(function(e){return null!==e.error});return{infos:e,isLoading:u,hasError:n,allLoaded:x}},[d,t,s,o,u,m,x]);return{verificationInfos:f.infos,isLoading:f.isLoading,isPending:f.isLoading,hasError:f.hasError,allLoaded:f.allLoaded,error:m||null,getInfosByAccount:function(e){var n=f.infos.find(function(n){return n.account.toLowerCase()===e.toLowerCase()});return(null==n?void 0:n.infos)||[]},getInfosMap:function(){var e={};return f.infos.forEach(function(n){e[n.account]=n.infos}),e},hasValidData:o&&t.length>0&&s.length>0&&!!n}},ec=function(e){var n,r=e.actionId,t=e.actionInfo,s=e.extensionAddress,l=e.groupId,d=e.groupName,u=(0,o.useRouter)(),f=((0,a.useContext)(c.M)||{}).token,v=(0,A.m)().address,j=(0,er.Bk)(),N=j.currentRound,b=j.isPending,I=j.error,_=(0,$.Y8)(s,v||"0x",l),k=_.canVerify,C=_.isPending,B=_.error,P=(0,et.o)({extensionAddress:s,groupId:l,round:N||BigInt(0)}),J=P.accounts,M=P.isPending,E=P.error,L=(0,$.Jf)(s,N||BigInt(0),l),Z=L.verifiedAccountCount,F=L.isPending,S=L.error,T=eo({tokenAddress:null==f?void 0:f.address,actionId:r,accounts:J||[],verificationKeys:(null==t?void 0:t.body.verificationKeys)||[],enabled:!!(null==f?void 0:f.address)&&!!t&&((null==J?void 0:J.length)||0)>0}),D=T.verificationInfos,G=T.isPending,V=T.error,H=(0,p._)((0,a.useState)([]),2),O=H[0],X=H[1];(0,a.useEffect)(function(){J&&J.length>0&&X(J.map(function(e){return{account:e,score:"100"}}))},[J]);var W=(0,$.jQ)(),q=W.submitOriginScores,Q=W.isPending,K=W.isConfirming,U=W.isConfirmed,ee=W.writeError,ei=(n=(0,h._)(function(){var e,n,r,t,s,i,a,o,c,l,d,u,m;return(0,g.Jh)(this,function(x){switch(x.label){case 0:return x.trys.push([0,2,,3]),[4,navigator.clipboard.readText()];case 1:if(e=x.sent().trim().split("\n").filter(function(e){return e.trim().length>0}),n=(0,en._)(O),r=0,(t=e.every(function(e){return 1===e.trim().split(/[\t,\s]+/).length}))&&e.length===n.length)for(s=0;s<e.length&&s<n.length;s++)!isNaN(parseFloat(i=e[s].trim()))&&(n[s].score=i,r++);else{a=!0,o=!1,c=void 0;try{for(l=function(){var e=u.value.trim().split(/[\t,\s]+/);if(e.length>=2){var t=e[0].toLowerCase(),s=e[1],i=n.findIndex(function(e){return e.account.toLowerCase()===t});-1!==i&&!isNaN(parseFloat(s))&&(n[i].score=s,r++)}},d=e[Symbol.iterator]();!(a=(u=d.next()).done);a=!0)l()}catch(e){o=!0,c=e}finally{try{a||null==d.return||d.return()}finally{if(o)throw c}}}return r>0?(X(n),y.Am.success("成功导入 ".concat(r," 个地址的分数"))):t?y.Am.error("分数行数（".concat(e.length,"）与地址数量（").concat(n.length,"）不匹配")):y.Am.error("未找到匹配的地址，请确保格式为：分数（每行一个）"),[3,3];case 2:return m=x.sent(),y.Am.error("粘贴失败，请检查剪贴板内容"),console.error("Paste error:",m),[3,3];case 3:return[2]}})}),function(){return n.apply(this,arguments)});function ea(){return(ea=(0,h._)(function(){var e;return(0,g.Jh)(this,function(n){switch(n.label){case 0:if(!k)return y.Am.error("您没有打分权限"),[2];if(void 0!==Z&&J&&Z>=BigInt(J.length))return y.Am.error("本轮打分已经完成，无需重复提交"),[2];if(O.some(function(e){var n=parseFloat(e.score||"0");return isNaN(n)||n<0||n>100}))return y.Am.error("请确保所有分数都在 0~100 之间"),[2];n.label=1;case 1:return n.trys.push([1,3,,4]),e=O.map(function(e){var n=parseInt(e.score);return BigInt(isNaN(n)||n<0?0:n)}),[4,q(s,l,BigInt(0),e)];case 2:return n.sent(),[3,4];case 3:return console.error("Verify group failed",n.sent()),[3,4];case 4:return[2]}})})).apply(this,arguments)}(0,a.useEffect)(function(){U&&(y.Am.success("打分提交成功"),setTimeout(function(){u.push("/extension/my_verifying_groups?symbol=".concat(null==f?void 0:f.symbol))},1500))},[U,u]);var ec=(0,m.b)().handleError;if((0,a.useEffect)(function(){I&&ec(I),B&&ec(B),E&&ec(E),S&&ec(S),ee&&ec(ee),V&&ec(V)},[I,B,E,S,ee,V,ec]),b||C||M||F||G)return(0,i.jsxs)("div",{className:"flex flex-col items-center py-8",children:[(0,i.jsx)(x.Z,{}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:"加载验证信息..."})]});if(!k)return(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)(z.Z,{title:"链群验证"}),(0,i.jsxs)("div",{className:"text-center py-12",children:[(0,i.jsx)("p",{className:"text-red-500 mb-4",children:"您没有打分权限"}),(0,i.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:"只有链群服务者和打分代理才能打分"})]})]});if(!J||0===J.length)return(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)(z.Z,{title:"链群验证"}),(0,i.jsx)("div",{className:"text-center py-12",children:(0,i.jsx)("p",{className:"text-gray-500 mb-4",children:"暂无待打分的行动者"})})]});var el=function(e,n){var r=(0,en._)(O);if(""===n){r[e].score=n,X(r);return}if(!/^\d+$/.test(n)){y.Am.error("请输入整数");return}var t=parseInt(n,10);t>=0&&t<=100?(r[e].score=n,X(r)):t>100?(r[e].score="100",X(r),y.Am.error("分数不能超过 100")):t<0&&(r[e].score="0",X(r),y.Am.error("分数不能小于 0"))};return void 0!==Z&&J&&Z>=BigInt(J.length)?(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(z.Z,{title:"链群验证"}),(0,i.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["为链群 #",l.toString()," 中的行动者打分"]})]}),(0,i.jsx)("div",{className:"text-center py-6",children:(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"打分已完成"}),(0,i.jsxs)("p",{className:"text-sm text-gray-600",children:["本轮已为 ",null==J?void 0:J.length," 个行动者提交打分"]})]})})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(z.Z,{title:"链群验证"}),(0,i.jsxs)("div",{className:"text-gray-500 mb-2 text-sm",children:[(0,i.jsx)("span",{children:"链群："}),(0,i.jsx)("span",{className:"text-gray-500 text-xs",children:"#"}),(0,i.jsx)("span",{className:"text-secondary text-base font-semibold ",children:l.toString()})," ",(0,i.jsx)("span",{className:"font-semibold",children:d})]})]}),(0,i.jsx)("div",{className:"w-full max-w-2xl",children:(0,i.jsxs)("table",{className:"w-full border-collapse",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("th",{className:"pb-3 text-left text-sm text-greyscale-500",children:"行动者地址"}),(0,i.jsx)("th",{className:"pb-3 text-left whitespace-nowrap w-16 text-sm text-greyscale-500",children:"打分"})]})}),(0,i.jsx)("tbody",{children:O.map(function(e,n){var r=D.find(function(n){return n.account.toLowerCase()===e.account.toLowerCase()});return(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("td",{className:"py-1",children:(0,i.jsxs)("div",{className:"text-left",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-xs font-bold text-gray-500 min-w-[4px]",children:n+1}),(0,i.jsx)("div",{className:"font-mono",children:(0,i.jsx)(Y.Z,{address:e.account,showCopyButton:!0,showCopyLast4Button:!0})})]}),t&&r&&(0,i.jsx)("div",{className:"text-sm text-greyscale-800 ml-3",children:t.body.verificationKeys.map(function(e,n){return(0,i.jsxs)("div",{className:"mb-2",children:[(0,i.jsxs)("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:[e,":"]}),(0,i.jsx)("div",{children:(0,i.jsx)(es.L,{text:r.infos[n]||""})})]},n)})})]})}),(0,i.jsx)("td",{className:"py-1 w-18 px-1",children:(0,i.jsx)("div",{className:"flex items-center text-left",children:(0,i.jsx)("input",{type:"number",min:"0",max:"100",step:"1",pattern:"\\d*",inputMode:"numeric",value:e.score,placeholder:"0",onChange:function(e){return el(n,e.target.value)},className:"w-16 px-1 py-1 border rounded text-xs focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})})})]},e.account)})})]})}),(0,i.jsxs)("div",{className:"flex justify-center space-x-4 pt-4",children:[(0,i.jsx)(w.z,{className:"w-1/2",variant:"outline",onClick:ei,children:"从剪贴板粘贴分数"}),(0,i.jsx)(w.z,{className:"w-1/2",disabled:Q||K||U,onClick:function(){return ea.apply(this,arguments)},children:Q?"提交中...":K?"确认中...":U?"已提交":"提交验证"})]}),(0,i.jsxs)("div",{className:"text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded px-3 py-2",children:[(0,i.jsx)("div",{className:"font-medium text-gray-700 mb-1",children:"\uD83D\uDCA1 小贴士"}),(0,i.jsxs)("div",{className:"space-y-1 text-gray-600",children:[(0,i.jsx)("div",{children:"• 验证打分范围为：0~100 之间"}),(0,i.jsx)("div",{children:"• 可以从剪贴板粘贴分数（格式：每行一个分数）"})]})]})]}),(0,i.jsx)(R.Z,{isLoading:Q||K,text:Q?"提交打分...":"确认打分..."})]})},el=function(){var e=(0,o.useRouter)(),n=e.query,r=n.op,h=n.groupId,p=((0,a.useContext)(c.M)||{}).token,g=e.query.actionId?BigInt(e.query.actionId):void 0,v=h?BigInt(h):void 0,j="activate"===r,N=(0,l.dI)(null==p?void 0:p.address,g||BigInt(0)),y=N.actionInfo,b=N.isPending,A=N.error,I=(0,d.kz)({tokenAddress:null==p?void 0:p.address,actionInfo:y}),_=I.contractInfo,w=I.isPending,k=I.error,C=null==_?void 0:_.extension,B=(0,u.nS)("verify"===r&&v?v:BigInt(0)),P=B.groupName,J=B.isPending,M=B.error,E=(0,m.b)().handleError;(0,a.useEffect)(function(){A&&E(A),k&&E(k),"verify"===r&&M&&E(M)},[A,k,M,E,r]);var L=function(){switch(r){case"activate":return"激活链群";case"deactivate":return"停用链群";case"update":return"更新链群";case"set_delegated":return"设置委托";case"verify":return"验证链群";default:return"链群操作"}};return b||w||"verify"===r&&J?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f.Z,{title:L(),showBackButton:!0}),(0,i.jsx)("main",{className:"flex-grow",children:(0,i.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,i.jsx)("div",{className:"flex flex-col items-center py-12",children:(0,i.jsx)(x.Z,{})})})})]}):C&&r?j||v?y?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f.Z,{title:L(),showBackButton:!0}),(0,i.jsx)("main",{className:"flex-grow p-4",children:(0,i.jsx)("div",{className:"pt-0 pb-3 max-w-3xl mx-auto",children:function(){var e={actionId:g,actionInfo:y,extensionAddress:C};switch(r){case"activate":return(0,i.jsx)(V,(0,t._)({},e));case"deactivate":return(0,i.jsx)(X,(0,s._)((0,t._)({},e),{groupId:v}));case"update":return(0,i.jsx)(K,(0,s._)((0,t._)({},e),{groupId:v}));case"set_delegated":return(0,i.jsx)(ee,(0,s._)((0,t._)({},e),{groupId:v}));case"verify":return(0,i.jsx)(ec,(0,s._)((0,t._)({},e),{groupId:v,groupName:P||""}));default:return(0,i.jsx)("div",{className:"text-center py-12",children:(0,i.jsxs)("p",{className:"text-red-500",children:["未知的操作类型: ",r]})})}}()})})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f.Z,{title:L(),showBackButton:!0}),(0,i.jsx)("main",{className:"flex-grow",children:(0,i.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,i.jsx)("div",{className:"text-center py-12",children:(0,i.jsx)("p",{className:"text-red-500",children:"未找到行动信息"})})})})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f.Z,{title:L(),showBackButton:!0}),(0,i.jsx)("main",{className:"flex-grow",children:(0,i.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,i.jsxs)("div",{className:"text-center py-12",children:[(0,i.jsx)("p",{className:"text-red-500",children:"缺少必要参数"}),(0,i.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"需要: groupId"})]})})})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f.Z,{title:"链群操作",showBackButton:!0}),(0,i.jsx)("main",{className:"flex-grow",children:(0,i.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,i.jsxs)("div",{className:"text-center py-12",children:[(0,i.jsx)("p",{className:"text-red-500",children:"缺少必要参数"}),(0,i.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"需要: actionId (行动ID), op (操作类型)"})]})})})]})}}},function(e){e.O(0,[8501,4463,721,5771,3494,8300,2112,5611,7966,8945,6097,8886,5293,7974,7568,1879,2888,9774,179],function(){return e(e.s=48014)}),_N_E=e.O()}]);