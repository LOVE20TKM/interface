try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="6f72d46f-8a43-4d30-8105-8aa62a9fbb72",e._sentryDebugIdIdentifier="sentry-dbid-6f72d46f-8a43-4d30-8105-8aa62a9fbb72")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7857],{76109:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/extension/deploy",function(){return t(60717)}])},34680:function(e,n,t){"use strict";t.d(n,{Ol:function(){return l},SZ:function(){return u},Zb:function(){return d},aY:function(){return p},eW:function(){return m},ll:function(){return c}});var s=t(72253),r=t(47702),a=t(85893),i=t(67294),o=t(40108),d=i.forwardRef(function(e,n){var t=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,s._)({ref:n,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t)},i))});d.displayName="Card";var l=i.forwardRef(function(e,n){var t=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,s._)({ref:n,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",t)},i))});l.displayName="CardHeader";var c=i.forwardRef(function(e,n){var t=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,s._)({ref:n,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",t)},i))});c.displayName="CardTitle";var u=i.forwardRef(function(e,n){var t=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,s._)({ref:n,className:(0,o.cn)("text-sm text-muted-foreground",t)},i))});u.displayName="CardDescription";var p=i.forwardRef(function(e,n){var t=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,s._)({ref:n,className:(0,o.cn)("p-6 pt-0",t)},i))});p.displayName="CardContent";var m=i.forwardRef(function(e,n){var t=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,s._)({ref:n,className:(0,o.cn)("flex items-center p-6 pt-0",t)},i))});m.displayName="CardFooter"},74193:function(e,n,t){"use strict";t.d(n,{NI:function(){return j},Wi:function(){return y},l0:function(){return x},lX:function(){return b},pf:function(){return N},xJ:function(){return v},zG:function(){return w}});var s=t(34788),r=t(12796),a=t(72253),i=t(14932),o=t(47702),d=t(85893),l=t(67294),c=t(88426),u=t(87536),p=t(40108),m=t(94193),x=u.RV,f=l.createContext({}),y=function(e){var n=(0,s._)({},(0,r._)(e));return(0,d.jsx)(f.Provider,{value:{name:n.name},children:(0,d.jsx)(u.Qr,(0,a._)({},n))})},h=function(){var e=l.useContext(f),n=l.useContext(g),t=(0,u.Gc)(),s=t.getFieldState,r=t.formState,i=s(e.name,r);if(!e)throw Error("useFormField should be used within <FormField>");var o=n.id;return(0,a._)({id:o,name:e.name,formItemId:"".concat(o,"-form-item"),formDescriptionId:"".concat(o,"-form-item-description"),formMessageId:"".concat(o,"-form-item-message")},i)},g=l.createContext({}),v=l.forwardRef(function(e,n){var t=e.className,s=(0,o._)(e,["className"]),r=l.useId();return(0,d.jsx)(g.Provider,{value:{id:r},children:(0,d.jsx)("div",(0,a._)({ref:n,className:(0,p.cn)("space-y-2",t)},s))})});v.displayName="FormItem";var b=l.forwardRef(function(e,n){var t=e.className,s=(0,o._)(e,["className"]),r=h(),i=r.error,l=r.formItemId;return(0,d.jsx)(m._,(0,a._)({ref:n,className:(0,p.cn)(i&&"text-destructive",t),htmlFor:l},s))});b.displayName="FormLabel";var j=l.forwardRef(function(e,n){var t=(0,s._)({},(0,r._)(e)),i=h(),o=i.error,l=i.formItemId,u=i.formDescriptionId,p=i.formMessageId;return(0,d.jsx)(c.g7,(0,a._)({ref:n,id:l,"aria-describedby":o?"".concat(u," ").concat(p):"".concat(u),"aria-invalid":!!o},t))});j.displayName="FormControl";var N=l.forwardRef(function(e,n){var t=e.className,s=(0,o._)(e,["className"]),r=h().formDescriptionId;return(0,d.jsx)("p",(0,a._)({ref:n,id:r,className:(0,p.cn)("text-sm text-muted-foreground",t)},s))});N.displayName="FormDescription";var w=l.forwardRef(function(e,n){var t=e.className,s=e.children,r=(0,o._)(e,["className","children"]),l=h(),c=l.error,u=l.formMessageId,m=c?String(null==c?void 0:c.message):s;return m?(0,d.jsx)("p",(0,i._)((0,a._)({ref:n,id:u,className:(0,p.cn)("text-sm font-medium text-destructive",t)},r),{children:m})):null});w.displayName="FormMessage"},94193:function(e,n,t){"use strict";t.d(n,{_:function(){return u}});var s=t(72253),r=t(47702),a=t(85893),i=t(67294),o=t(49102),d=t(12003),l=t(40108),c=(0,d.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),u=i.forwardRef(function(e,n){var t=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)(o.f,(0,s._)({ref:n,className:(0,l.cn)(c(),t)},i))});u.displayName=o.f.displayName},27460:function(e,n,t){"use strict";var s=t(91309),r=t(85893),a=t(67294),i=t(74855),o=t(78865),d=t(18289),l=t(86501),c=t(91529);n.Z=function(e){var n=e.address,t=e.word,u=e.showCopyButton,p=e.showCopyLast4Button,m=e.showAddress,x=void 0===m||m,f=e.colorClassName,y=void 0===f?"":f,h=e.colorClassName2,g=void 0===h?"":h,v=(0,s._)((0,a.useState)(!1),2),b=v[0],j=v[1],N=(0,s._)((0,a.useState)(!1),2),w=N[0],T=N[1];(0,a.useEffect)(function(){j(!1),T(!1)},[n]);var _=function(e){e.preventDefault(),e.stopPropagation()};return(0,r.jsxs)("span",{className:"inline-flex items-center space-x-1",children:[t&&(0,r.jsx)("span",{className:"text-xs",children:t}),x&&!g&&(0,r.jsx)("span",{className:"font-mono text-xs ".concat(null!=y?y:"text-greyscale-500"),children:(0,c.Vu)(n)}),x&&g&&(0,r.jsxs)("span",{className:"text-[0px]",children:[(0,r.jsx)("span",{className:"font-mono text-xs ".concat(null!=y?y:"text-greyscale-500"),children:"".concat(n.substring(0,6),"...")}),(0,r.jsx)("span",{className:"font-mono text-xs ".concat(g),children:"".concat(n.substring(n.length-4))})]}),(void 0===u||u)&&(0,r.jsx)(i.CopyToClipboard,{text:n,onCopy:function(e,n){n?(j(!0),setTimeout(function(){return j(!1)},2e3)):l.ZP.error("复制失败")},children:(0,r.jsx)("button",{className:"flex items-center justify-center p-1 rounded focus:outline-none active:bg-gray-200 md:hover:bg-gray-200",onClick:_,"aria-label":"复制地址",style:{WebkitTapHighlightColor:"transparent",WebkitAppearance:"none",appearance:"none",background:"transparent",backgroundColor:"transparent",border:"none",outline:"none"},children:b?(0,r.jsx)(o.Z,{className:"h-4 w-4 ".concat(null!=y?y:"text-greyscale-500")}):(0,r.jsx)(d.Z,{className:"h-4 w-4 ".concat(null!=y?y:"text-greyscale-500")})})}),void 0!==p&&p&&(0,r.jsx)(i.CopyToClipboard,{text:n.substring(n.length-4),onCopy:function(e,n){n?(T(!0),l.ZP.success("已复制后4位"),setTimeout(function(){return T(!1)},2e3)):l.ZP.error("复制失败")},children:(0,r.jsx)("button",{className:"text-xs px-2 py-1 rounded border border-gray-300 focus:outline-none active:bg-gray-200 md:hover:bg-gray-100 transition-colors",onClick:_,"aria-label":"复制地址后4位",style:{WebkitTapHighlightColor:"transparent"},children:w?(0,r.jsx)("span",{className:"".concat(null!=y?y:"text-greyscale-500"),children:"已复制"}):(0,r.jsx)("span",{className:"".concat(null!=y?y:"text-greyscale-500"),children:"后4位"})})})]})}},42083:function(e,n,t){"use strict";var s=t(85893),r=t(23432);n.Z=function(){return(0,s.jsx)(r.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},60624:function(e,n,t){"use strict";t.d(n,{C:function(){return p}});var s=t(91309),r=t(67294),a=t(67516),i=t(42130),o=t(93778),d=t(66889),l=t(32848),c=t(37742),u=Number("3")/1e3,p=function(){var e=((0,r.useContext)(o.M)||{}).token,n=(0,i.m)().address,t=(0,r.useMemo)(function(){return(null==e?void 0:e.address)&&n?[{address:"0xb0d291C3B036860c8D5E2C681bFa391F787b26Cb",abi:d.B,functionName:"validGovVotes",args:[e.address,n]},{address:"0xa42CAcd51b0F27c863b0De3e7961590e00E3fc4a",abi:l.C,functionName:"govData",args:[e.address]}]:[]},[null==e?void 0:e.address,n]),p=(0,a.N)({contracts:t,query:{enabled:!!(null==e?void 0:e.address)&&!!n&&t.length>0}}),m=p.data,x=p.isPending,f=p.error;return(0,r.useMemo)(function(){if(!m||!(null==e?void 0:e.address)||!n)return{hasEnoughVotes:!1,percentage:0,validGovVotes:void 0,govData:void 0,SUBMIT_MIN_PERCENTAGE:u,isPending:x,error:f};var t=(0,s._)(m,2),r=t[0],a=t[1],i=(null==r?void 0:r.result)?(0,c.Zu)(r.result):void 0,o=null==a?void 0:a.result,d=i&&(null==o?void 0:o.govVotes)&&o.govVotes!==BigInt(0)?Number(i)/Number(o.govVotes):0;return{hasEnoughVotes:d>=u,percentage:d,validGovVotes:i,govData:o,SUBMIT_MIN_PERCENTAGE:u,isPending:x,error:f}},[m,null==e?void 0:e.address,n,x,f])}},85794:function(e,n,t){"use strict";t.d(n,{A5:function(){return x},DA:function(){return h},hS:function(){return p},l3:function(){return y},yA:function(){return f},yG:function(){return u},z4:function(){return m}});var s=t(11010),r=t(97582),a=t(67294),i=t(71104),o=t(37541),d=t(37742),l=t(37474),c=t(84689),u=function(e,n,t){var s=!(arguments.length>3)||void 0===arguments[3]||arguments[3],r=(0,i.u)({address:e,abi:o.O,functionName:"allowance",args:[n,t],query:{enabled:!!e&&!!n&&!!t&&s}}),a=r.data,l=r.isPending,c=r.error,u=r.refetch;return{allowance:void 0!==a?(0,d.Zu)(a):void 0,isPending:l,error:c,refetch:u}},p=function(e,n){var t=!(arguments.length>2)||void 0===arguments[2]||arguments[2],s=(0,i.u)({address:e,abi:o.O,functionName:"balanceOf",args:[n],query:{enabled:!!e&&!!n&&t}}),r=s.data,a=s.isPending,l=s.error,c=s.refetch;return{balance:void 0!==r?(0,d.Zu)(r):void 0,isPending:a,error:l,refetch:c}},m=function(e){var n=(0,i.u)({address:e,abi:o.O,functionName:"symbol",args:[],query:{enabled:!!e}});return{symbol:n.data,isPending:n.isPending,error:n.error}},x=function(e){var n=(0,i.u)({address:e,abi:o.O,functionName:"totalSupply",args:[],query:{enabled:!!e}}),t=n.data,s=n.isPending,r=n.error;return{totalSupply:void 0!==t?(0,d.Zu)(t):void 0,isPending:s,error:r}};function f(e){var n,t=(0,l.e9)(o.O,e,"approve"),i=t.execute,d=t.isPending,u=t.isConfirming,p=t.isConfirmed,m=t.error,x=t.hash,f=t.isTukeMode,y=(n=(0,s._)(function(n,t){return(0,r.Jh)(this,function(s){switch(s.label){case 0:return console.log("提交approve交易:",{token:e,spender:n,value:t,isTukeMode:f}),[4,i([n,t])];case 1:return[2,s.sent()]}})}),function(e,t){return n.apply(this,arguments)});return(0,a.useEffect)(function(){x&&console.log("approve tx hash:",x),m&&(console.log("提交approve交易错误:"),(0,c.Vh)(m),(0,c.H)(m))},[x,m]),{approve:y,isPending:d,isConfirming:u,writeError:m,isConfirmed:p,hash:x,isTukeMode:f}}function y(e){var n,t=(0,l.e9)(o.O,e,"burnForParentToken"),i=t.execute,d=t.isPending,u=t.isConfirming,p=t.isConfirmed,m=t.error,x=t.hash,f=t.isTukeMode,y=(n=(0,s._)(function(n){return(0,r.Jh)(this,function(t){switch(t.label){case 0:return console.log("提交burnForParentToken交易:",{token:e,amount:n,isTukeMode:f}),[4,i([n])];case 1:return[2,t.sent()]}})}),function(e){return n.apply(this,arguments)});return(0,a.useEffect)(function(){x&&console.log("burnForParentToken tx hash:",x),m&&(console.log("提交burnForParentToken交易错误:"),(0,c.Vh)(m),(0,c.H)(m))},[x,m]),{burnForParentToken:y,isPending:d,isConfirming:u,writeError:m,isConfirmed:p,hash:x,isTukeMode:f}}function h(e){var n,t=(0,l.e9)(o.O,e,"transfer"),i=t.execute,d=t.isPending,u=t.isConfirming,p=t.isConfirmed,m=t.error,x=t.hash,f=t.isTukeMode,y=(n=(0,s._)(function(n,t){return(0,r.Jh)(this,function(s){switch(s.label){case 0:return console.log("提交transfer交易:",{token:e,to:n,amount:t,isTukeMode:f}),[4,i([n,t])];case 1:return[2,s.sent()]}})}),function(e,t){return n.apply(this,arguments)});return(0,a.useEffect)(function(){x&&console.log("transfer tx hash:",x),m&&(console.log("提交transfer交易错误:"),(0,c.Vh)(m),(0,c.H)(m))},[x,m]),{transfer:y,isPending:d,isConfirming:u,writeError:m,isConfirmed:p,hash:x,isTukeMode:f}}},60717:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Y}});var s=t(85893),r=t(11163),a=t(83494),i=t(67294),o=t(27245),d=t(92261),l=t(11010),c=t(72253),u=t(14932),p=t(91309),m=t(97582),x=t(41664),f=t.n(x),y=t(56312),h=t(87536),g=t(86501),v=t(60480),b=t(59691),j=t(84192),N=t(21803);function w(e,n="wei"){return(0,N.v)(e,j.ez[n])}var T=t(42130),_=t(35243),C=t(45901),E=t(93778),A=t(95049),k=t(34680),M=t(74193),P=t(21774),I=t(37474),R=t(84689),S=[{type:"constructor",inputs:[{name:"_center",type:"address",internalType:"address"}],stateMutability:"nonpayable"},{type:"function",name:"CENTER_ADDRESS",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"createExtension",inputs:[{name:"tokenAddress",type:"address",internalType:"address"},{name:"joinLpTokenAddress",type:"address",internalType:"address"},{name:"govRatioMultiplier",type:"uint256",internalType:"uint256"},{name:"minGovRatio",type:"uint256",internalType:"uint256"}],outputs:[{name:"extension",type:"address",internalType:"address"}],stateMutability:"nonpayable"},{type:"function",name:"exists",inputs:[{name:"extension",type:"address",internalType:"address"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"extensionCreator",inputs:[{name:"extension",type:"address",internalType:"address"}],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"extensions",inputs:[],outputs:[{name:"",type:"address[]",internalType:"address[]"}],stateMutability:"view"},{type:"function",name:"extensionsAtIndex",inputs:[{name:"index",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"extensionsCount",inputs:[],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"event",name:"CreateExtension",inputs:[{name:"extension",type:"address",indexed:!0,internalType:"address"},{name:"tokenAddress",type:"address",indexed:!0,internalType:"address"}],anonymous:!1},{type:"error",name:"InvalidJoinTokenAddress",inputs:[]},{type:"error",name:"InvalidJoinTokenFactory",inputs:[]},{type:"error",name:"InvalidJoinTokenPair",inputs:[]}],D=t(85794),Z=t(60624),F=t(91529),G=t(27460),J=t(44576),V=C.Ry({joinTokenAddress:C.Z_().min(1,{message:"请输入LP Token地址"}).refine(function(e){return(0,v.U)(e)},{message:"LP Token地址格式无效"}),govRatioMultiplier:C.Z_().min(1,{message:"请输入治理比率乘数"}).refine(function(e){var n=parseFloat(e);return!isNaN(n)&&n>=0&&Number.isInteger(n)},{message:"治理比率乘数必须是非负整数"}),minGovRatio:C.Z_().min(1,{message:"请输入最小治理票占比"}).refine(function(e){var n=parseFloat(e);return!isNaN(n)&&n>=0&&n<=100},{message:"最小治理票占比必须在 0% ~ 100% 之间"})});function O(e){var n,t,r,a,d,x,v,j,C,O,z,B,U,L,W=e.factoryAddress,X=(0,i.useContext)(E.M),H=(null==X?void 0:null===(U=X.token)||void 0===U?void 0:U.address)||"",q=(null==X?void 0:null===(L=X.token)||void 0===L?void 0:L.symbol)||"",Y=(0,T.m)().address,Q=(0,A.V)().setError,$=(0,D.hS)(H,Y,!!Y).balance,K=(0,Z.C)(),ee=K.hasEnoughVotes,en=K.percentage,et=K.validGovVotes,es=K.govData,er=K.SUBMIT_MIN_PERCENTAGE,ea=(0,h.cI)({resolver:(0,y.F)(V),defaultValues:{joinTokenAddress:"",govRatioMultiplier:"",minGovRatio:""},mode:"onChange"}),ei=(t=(n=(0,I.e9)(S,W||"0x4d53728aF3DB35ec5DF0f717d5FfeC19749d7f11","createExtension")).execute,r=n.isPending,a=n.isConfirming,d=n.isConfirmed,x=n.error,v=n.hash,j=n.isTukeMode,C=(0,l._)(function(e,n,s,r){return(0,m.Jh)(this,function(a){switch(a.label){case 0:return console.log("提交 createExtension 交易:",{tokenAddress:e,joinTokenAddress:n,govRatioMultiplier:s,minGovRatio:r,isTukeMode:j}),[4,t([e,n,s,r])];case 1:return[2,a.sent()]}})}),O=function(e,n,t,s){return C.apply(this,arguments)},(0,i.useEffect)(function(){v&&console.log("createExtension tx hash:",v),x&&(console.log("提交 createExtension 交易错误:"),(0,R.Vh)(x),(0,R.H)(x))},[v,x]),{createExtension:O,isPending:r,isConfirming:a,writeError:x,isConfirmed:d,hash:v,isTukeMode:j}),eo=ei.createExtension,ed=ei.isPending,el=ei.isConfirming,ec=ei.isConfirmed,eu=ei.writeError,ep=ei.hash,em=(0,D.yA)(H),ex=em.approve,ef=em.isPending,ey=em.isConfirming,eh=em.isConfirmed,eg=em.writeError,ev=em.hash,eb=(0,p._)((0,i.useState)("idle"),2),ej=eb[0],eN=eb[1],ew=(0,_.A)({hash:ep}).data;(0,_.A)({hash:ev}).data;var eT=(0,p._)((0,i.useState)(null),2),e_=eT[0],eC=eT[1];(0,i.useEffect)(function(){if(ew&&ew.logs)try{var e=(0,b.h)({abi:S,eventName:"CreateExtension",logs:ew.logs});if(e.length>0&&e[0].args.extension){var n=e[0].args.extension;eC(n),console.log("扩展合约已部署，地址:",n),g.ZP.success("扩展部署成功！")}}catch(e){console.error("解析扩展地址失败:",e)}},[ew]),(0,i.useEffect)(function(){eh&&"approving"===ej&&(eN("approved"),g.ZP.success("授权成功！"))},[eh,ej]),(0,i.useEffect)(function(){ec&&e_&&eN("deployed")},[ec,e_]),(0,i.useEffect)(function(){eg&&(g.ZP.error("授权失败: ".concat(eg.message)),eN("idle"))},[eg]),(0,i.useEffect)(function(){void 0!==$&&$<w("1")&&Q({name:"代币余额不足",message:"部署扩展合约，需要1个".concat(q,"，请先充值")})},[$,q,Q]),(0,i.useEffect)(function(){!ee&&void 0!==et&&es&&Q({name:"治理票不足",message:"有效治理票，须达到总治理票的".concat((0,F.rl)(100*er,1),"，才能部署扩展合约（您当前有效治理票占比").concat((0,F.rl)(100*en,3),"）")})},[ee,et,es,er,en,Q]);var eE=(z=(0,l._)(function(){var e;return(0,m.Jh)(this,function(n){switch(n.label){case 0:if(!H)return g.ZP.error("未选择代币"),[2];return[4,ea.trigger()];case 1:if(!n.sent())return g.ZP.error("请先完整填写表单"),[2];n.label=2;case 2:return n.trys.push([2,4,,5]),eN("approving"),[4,ex(W,w("1"))];case 3:return n.sent(),[3,5];case 4:return console.error("授权失败:",e=n.sent()),g.ZP.error((null==e?void 0:e.message)||"授权失败"),eN("idle"),[3,5];case 5:return[2]}})}),function(){return z.apply(this,arguments)}),eA=(B=(0,l._)(function(e){var n,t;return(0,m.Jh)(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),eN("deploying"),n=(0,N.v)(e.minGovRatio,18)*BigInt(1)/BigInt(100),[4,eo(H,e.joinTokenAddress,BigInt(e.govRatioMultiplier),n)];case 1:return s.sent(),[3,3];case 2:return console.error("部署扩展失败:",t=s.sent()),g.ZP.error((null==t?void 0:t.message)||"部署扩展失败"),eN("approved"),[3,3];case 3:return[2]}})}),function(e){return B.apply(this,arguments)});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(k.Zb,{className:"border-0 shadow-none",children:[(0,s.jsxs)(k.Ol,{className:"px-4 md:px-6 pb-4 md:pb-6 pt-4 md:pt-6",children:[(0,s.jsx)(k.ll,{className:"text-xl md:text-2xl",children:"部署LP行动扩展合约"}),(0,s.jsx)(k.SZ,{className:"text-sm"})]}),(0,s.jsx)(k.aY,{className:"px-4 md:px-6 pb-4 md:pb-6",children:(0,s.jsx)(M.l0,(0,u._)((0,c._)({},ea),{children:(0,s.jsxs)("form",{onSubmit:function(e){return e.preventDefault()},className:"space-y-4 md:space-y-6",children:[(0,s.jsx)(M.Wi,{control:ea.control,name:"joinTokenAddress",render:function(e){var n=e.field;return(0,s.jsxs)(M.xJ,{children:[(0,s.jsx)(M.lX,{children:"1. LP代币合约地址"}),(0,s.jsx)(M.NI,{children:(0,s.jsx)(P.I,(0,u._)((0,c._)({type:"text",placeholder:"0x...",disabled:"idle"!==ej},n),{onChange:function(e){var t=e.target.value.replace(/\s+/g,"");n.onChange(t)}}))}),(0,s.jsx)(M.pf,{className:"text-sm text-greyscale-500",children:"包含当前行动所在代币的 LP 代币（Uniswap V2 Pair）合约地址"}),(0,s.jsx)(M.zG,{})]})}}),(0,s.jsx)(M.Wi,{control:ea.control,name:"govRatioMultiplier",render:function(e){var n=e.field;return(0,s.jsxs)(M.xJ,{children:[(0,s.jsx)(M.lX,{children:"2. 治理比率乘数"}),(0,s.jsx)(M.NI,{children:(0,s.jsx)(P.I,(0,c._)({type:"number",placeholder:"比如 2",disabled:"idle"!==ej,min:"0",step:"1",className:"max-w-40 md:max-w-xs"},n))}),(0,s.jsx)(M.pf,{className:"text-sm text-greyscale-500",children:"LP占比超过 (治理票占比 \xd7 治理比率乘数) 的部分，不再有铸币激励"}),(0,s.jsx)(M.zG,{})]})}}),(0,s.jsx)(M.Wi,{control:ea.control,name:"minGovRatio",render:function(e){var n=e.field;return(0,s.jsxs)(M.xJ,{children:[(0,s.jsx)(M.lX,{children:"3. 加入行动所需最小治理票占比"}),(0,s.jsx)(M.NI,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2 max-w-40 md:max-w-xs",children:[(0,s.jsx)(P.I,(0,c._)({type:"number",placeholder:"例如 0.1",disabled:"idle"!==ej,min:"0",max:"100",step:"0.001",className:"flex-1"},n)),(0,s.jsx)("span",{className:"text-greyscale-500 text-base whitespace-nowrap",children:"%"})]})}),(0,s.jsx)(M.pf,{className:"text-sm text-greyscale-500",children:"用户治理票占比低于此值时，无法加入行动"}),(0,s.jsx)(M.zG,{})]})}}),eu&&(0,s.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-red-600",children:["错误: ",eu.message]})}),e_&&(0,s.jsxs)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-2xl",children:"\uD83C\uDF89"}),(0,s.jsx)("p",{className:"text-base font-semibold text-green-700",children:"扩展部署完成！"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("p",{className:"text-sm text-greyscale-600",children:"扩展合约地址:"}),(0,s.jsx)(G.Z,{address:e_,showAddress:!0})]}),(0,s.jsxs)("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded space-y-3",children:[(0,s.jsx)("p",{className:"text-sm text-blue-700",children:"✨ 扩展已部署！现在可以使用此扩展地址创建行动。"}),(0,s.jsx)(o.z,{className:"w-full",asChild:!0,children:(0,s.jsx)(f(),{href:"/action/new/?symbol=".concat(q,"&extension=").concat(e_),rel:"noopener noreferrer",children:"立即创建行动"})})]})]}),!e_&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex space-x-4 w-full",children:[(0,s.jsx)(o.z,{type:"button",onClick:eE,className:"w-1/2",disabled:ef||ey||"approved"===ej||"deploying"===ej||"deployed"===ej||!ee||void 0!==$&&$<w("1"),children:ef?"1.提交中...":ey?"1.确认中...":"approved"===ej||"deploying"===ej||"deployed"===ej?"1.代币已授权":"1.代币授权"}),(0,s.jsx)(o.z,{type:"button",onClick:function(){return ea.handleSubmit(eA)()},className:"w-1/2",disabled:"approved"!==ej&&"deploying"!==ej||ed||el,children:ed?"2.部署中...":el?"2.确认中...":"2.部署扩展"})]}),(0,s.jsxs)("div",{className:"mt-6 text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded px-3 py-2",children:[(0,s.jsx)("div",{className:"font-medium text-gray-700 mb-1",children:"\uD83D\uDCA1 小贴士"}),(0,s.jsxs)("div",{className:"space-y-1 text-gray-600",children:[(0,s.jsx)("div",{children:"• 每个新的扩展行动，都需部署1个专属扩展合约"}),(0,s.jsxs)("div",{children:["• 部署时会将 1个 ",q," 转给扩展合约，用于扩展合约初始化"]})]})]})]})]})}))})]}),(0,s.jsx)(J.Z,{isLoading:ef||ey||ed||el,text:ef?"提交授权交易...":ey?"确认授权交易...":ed?"提交部署交易...":"确认部署交易..."})]})}var z=[{type:"constructor",inputs:[{name:"center_",type:"address",internalType:"address"},{name:"groupManagerAddress_",type:"address",internalType:"address"},{name:"groupJoinAddress_",type:"address",internalType:"address"},{name:"groupVerifyAddress_",type:"address",internalType:"address"},{name:"groupAddress_",type:"address",internalType:"address"}],stateMutability:"nonpayable"},{type:"function",name:"CENTER_ADDRESS",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"GROUP_ADDRESS",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"GROUP_JOIN_ADDRESS",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"GROUP_MANAGER_ADDRESS",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"GROUP_VERIFY_ADDRESS",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"createExtension",inputs:[{name:"tokenAddress_",type:"address",internalType:"address"},{name:"activationMinGovRatio_",type:"uint256",internalType:"uint256"},{name:"activationStakeAmount_",type:"uint256",internalType:"uint256"},{name:"joinTokenAddress_",type:"address",internalType:"address"},{name:"maxJoinAmountRatio_",type:"uint256",internalType:"uint256"}],outputs:[{name:"extension",type:"address",internalType:"address"}],stateMutability:"nonpayable"},{type:"function",name:"exists",inputs:[{name:"extension",type:"address",internalType:"address"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"extensionCreator",inputs:[{name:"extension",type:"address",internalType:"address"}],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"extensions",inputs:[],outputs:[{name:"",type:"address[]",internalType:"address[]"}],stateMutability:"view"},{type:"function",name:"extensionsAtIndex",inputs:[{name:"index",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"extensionsCount",inputs:[],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"event",name:"CreateExtension",inputs:[{name:"extension",type:"address",indexed:!0,internalType:"address"},{name:"tokenAddress",type:"address",indexed:!0,internalType:"address"}],anonymous:!1},{type:"error",name:"InvalidActivationMinGovRatio",inputs:[]},{type:"error",name:"InvalidActivationStakeAmount",inputs:[]},{type:"error",name:"InvalidJoinTokenAddress",inputs:[]},{type:"error",name:"InvalidMaxJoinAmountRatio",inputs:[]}],B=C.Ry({joinTokenAddress:C.Z_().min(1,{message:"请输入加入代币地址"}).refine(function(e){return(0,v.U)(e)},{message:"加入代币地址格式无效"}),activationStakeAmount:C.Z_().min(1,{message:"请输入激活需质押代币数量"}).refine(function(e){var n=parseFloat(e);return!isNaN(n)&&n>0},{message:"激活需质押代币数量必须大于0"}),maxJoinAmountRatio:C.Z_().min(1,{message:"请输入最大参与代币占比"}).refine(function(e){var n=parseFloat(e);return!isNaN(n)&&n>=.001&&n<=100},{message:"最大参与代币占比必须在 0.001% ~ 100% 之间"}),activationMinGovRatio:C.Z_().min(1,{message:"请输入激活链群最小治理票比例"}).refine(function(e){var n=parseFloat(e);return!isNaN(n)&&n>=0&&n<=100},{message:"激活链群最小治理票比例必须在 0% ~ 100% 之间"})});function U(e){var n,t,r,a,d,x,v,j,C,S,V,O,U,L,W=e.factoryAddress,X=(0,i.useContext)(E.M),H=(null==X?void 0:null===(U=X.token)||void 0===U?void 0:U.address)||"",q=(null==X?void 0:null===(L=X.token)||void 0===L?void 0:L.symbol)||"",Y=(0,T.m)().address,Q=(0,A.V)().setError,$=(0,D.hS)(H,Y,!!Y).balance,K=(0,Z.C)(),ee=K.hasEnoughVotes,en=K.percentage,et=K.validGovVotes,es=K.govData,er=K.SUBMIT_MIN_PERCENTAGE,ea=(0,h.cI)({resolver:(0,y.F)(B),defaultValues:{joinTokenAddress:H||"",activationStakeAmount:"",maxJoinAmountRatio:"0.1",activationMinGovRatio:"0.1"},mode:"onChange"}),ei=(t=(n=(0,I.e9)(z,W,"createExtension")).execute,r=n.isPending,a=n.isConfirming,d=n.isConfirmed,x=n.error,v=n.hash,j=n.isTukeMode,C=(0,l._)(function(e,n,s,r,a){return(0,m.Jh)(this,function(i){switch(i.label){case 0:return console.log("提交 createExtension 交易:",{contractAddress:W,tokenAddress:e,activationMinGovRatio:n,activationStakeAmount:s,joinTokenAddress:r,maxJoinAmountRatio:a,isTukeMode:j}),[4,t([e,n,s,r,a])];case 1:return[2,i.sent()]}})}),S=function(e,n,t,s,r){return C.apply(this,arguments)},(0,i.useEffect)(function(){v&&console.log("createExtension tx hash:",v),x&&(console.log("提交 createExtension 交易错误:"),(0,R.Vh)(x),(0,R.H)(x))},[v,x]),{createExtension:S,isPending:r,isConfirming:a,writeError:x,isConfirmed:d,hash:v,isTukeMode:j}),eo=ei.createExtension,ed=ei.isPending,el=ei.isConfirming,ec=ei.isConfirmed,eu=ei.writeError,ep=ei.hash,em=(0,D.yA)(H),ex=em.approve,ef=em.isPending,ey=em.isConfirming,eh=em.isConfirmed,eg=em.writeError,ev=em.hash;(0,i.useEffect)(function(){H&&ea.setValue("joinTokenAddress",H)},[H,ea]);var eb=(0,p._)((0,i.useState)("idle"),2),ej=eb[0],eN=eb[1],ew=(0,_.A)({hash:ep}).data;(0,_.A)({hash:ev});var eT=(0,p._)((0,i.useState)(null),2),e_=eT[0],eC=eT[1];(0,i.useEffect)(function(){if(ew&&ew.logs)try{var e=(0,b.h)({abi:z,eventName:"CreateExtension",logs:ew.logs});if(e.length>0&&e[0].args.extension){var n=e[0].args.extension;eC(n),console.log("扩展合约已部署，地址:",n),g.ZP.success("扩展部署成功！")}}catch(e){console.error("解析扩展地址失败:",e)}},[ew]),(0,i.useEffect)(function(){eh&&"approving"===ej&&(eN("approved"),g.ZP.success("授权成功！"))},[eh,ej]),(0,i.useEffect)(function(){ec&&e_&&eN("deployed")},[ec,e_]),(0,i.useEffect)(function(){eg&&(g.ZP.error("授权失败: ".concat(eg.message)),eN("idle"))},[eg]),(0,i.useEffect)(function(){void 0!==$&&$<w("1")&&Q({name:"代币余额不足",message:"部署扩展合约，需要1个".concat(q,"，请先充值")})},[$,q,Q]),(0,i.useEffect)(function(){!ee&&void 0!==et&&es&&Q({name:"治理票不足",message:"有效治理票，须达到总治理票的".concat((0,F.rl)(100*er,1),"，才能部署扩展合约（您当前有效治理票占比").concat((0,F.rl)(100*en,3),"）")})},[ee,et,es,er,en,Q]);var eE=(V=(0,l._)(function(){var e;return(0,m.Jh)(this,function(n){switch(n.label){case 0:if(!H)return g.ZP.error("未选择代币"),[2];return[4,ea.trigger()];case 1:if(!n.sent())return g.ZP.error("请先完整填写表单"),[2];n.label=2;case 2:return n.trys.push([2,4,,5]),eN("approving"),[4,ex(W,w("1"))];case 3:return n.sent(),[3,5];case 4:return console.error("授权失败:",e=n.sent()),g.ZP.error((null==e?void 0:e.message)||"授权失败"),eN("idle"),[3,5];case 5:return[2]}})}),function(){return V.apply(this,arguments)}),eA=(O=(0,l._)(function(e){var n,t,s;return(0,m.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),eN("deploying"),n=w(e.activationStakeAmount),t=(0,N.v)(e.maxJoinAmountRatio,18)*BigInt(1)/BigInt(100),[4,eo(H,(0,N.v)(e.activationMinGovRatio,18)*BigInt(1)/BigInt(100),n,e.joinTokenAddress,t)];case 1:return r.sent(),[3,3];case 2:return console.error("部署扩展失败:",s=r.sent()),g.ZP.error((null==s?void 0:s.message)||"部署扩展失败"),eN("approved"),[3,3];case 3:return[2]}})}),function(e){return O.apply(this,arguments)});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(k.Zb,{className:"border-0 shadow-none",children:[(0,s.jsxs)(k.Ol,{className:"px-4 md:px-6 pb-4 md:pb-6 pt-4 md:pt-6",children:[(0,s.jsx)(k.ll,{className:"text-xl md:text-2xl",children:"部署链群行动扩展合约"}),(0,s.jsx)(k.SZ,{className:"text-sm"})]}),(0,s.jsx)(k.aY,{className:"px-4 md:px-6 pb-4 md:pb-6",children:(0,s.jsx)(M.l0,(0,u._)((0,c._)({},ea),{children:(0,s.jsxs)("form",{onSubmit:function(e){return e.preventDefault()},className:"space-y-4 md:space-y-6",children:[(0,s.jsx)(M.Wi,{control:ea.control,name:"joinTokenAddress",render:function(e){var n=e.field;return(0,s.jsxs)(M.xJ,{children:[(0,s.jsx)(M.lX,{children:"1. 参与行动所需代币的合约地址"}),(0,s.jsx)(M.NI,{children:(0,s.jsx)(P.I,(0,u._)((0,c._)({type:"text",placeholder:"0x...",disabled:"idle"!==ej},n),{onChange:function(e){var t=e.target.value.replace(/\s+/g,"");n.onChange(t)}}))}),(0,s.jsx)(M.pf,{className:"text-sm text-greyscale-500",children:"可以是普通代币地址或 LP 代币地址"}),(0,s.jsx)(M.zG,{})]})}}),(0,s.jsx)(M.Wi,{control:ea.control,name:"activationStakeAmount",render:function(e){var n=e.field;return(0,s.jsxs)(M.xJ,{children:[(0,s.jsx)(M.lX,{children:"2. 激活链群需质押代币数"}),(0,s.jsx)(M.NI,{children:(0,s.jsx)(P.I,(0,c._)({type:"number",placeholder:"比如 1000",disabled:"idle"!==ej,min:"0",step:"0.000001",className:"max-w-40 md:max-w-xs"},n))}),(0,s.jsx)(M.zG,{})]})}}),(0,s.jsx)(M.Wi,{control:ea.control,name:"maxJoinAmountRatio",render:function(e){var n=e.field;return(0,s.jsxs)(M.xJ,{children:[(0,s.jsx)(M.lX,{children:"3. 最大参与代币占比"}),(0,s.jsx)(M.NI,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2 max-w-40 md:max-w-xs",children:[(0,s.jsx)(P.I,(0,c._)({type:"number",placeholder:"例如 0.1",disabled:"idle"!==ej,min:"0.001",max:"100",step:"0.001",className:"flex-1"},n)),(0,s.jsx)("span",{className:"text-greyscale-500 text-base whitespace-nowrap",children:"%"})]})}),(0,s.jsx)(M.pf,{className:"text-sm text-greyscale-500",children:"单个行动者最大参与代币数 = 已铸造代币总量 \xd7 最大参与代币占比 \xd7 该行动投票率"}),(0,s.jsx)(M.zG,{})]})}}),(0,s.jsx)(M.Wi,{control:ea.control,name:"activationMinGovRatio",render:function(e){var n=e.field;return(0,s.jsxs)(M.xJ,{children:[(0,s.jsx)(M.lX,{children:"4. 激活链群最小治理票比例"}),(0,s.jsx)(M.NI,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2 max-w-40 md:max-w-xs",children:[(0,s.jsx)(P.I,(0,c._)({type:"number",placeholder:"例如 0.001",disabled:"idle"!==ej,min:"0",max:"100",step:"0.001",className:"flex-1"},n)),(0,s.jsx)("span",{className:"text-greyscale-500 text-base whitespace-nowrap",children:"%"})]})}),(0,s.jsx)(M.pf,{className:"text-sm text-greyscale-500",children:"服务者激活链群时，其治理票占比需不低于此值"}),(0,s.jsx)(M.zG,{})]})}}),eu&&(0,s.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-red-600",children:["错误: ",eu.message]})}),e_&&(0,s.jsxs)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-2xl",children:"\uD83C\uDF89"}),(0,s.jsx)("p",{className:"text-base font-semibold text-green-700",children:"扩展部署完成！"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("p",{className:"text-sm text-greyscale-600",children:"扩展合约地址:"}),(0,s.jsx)(G.Z,{address:e_,showAddress:!0})]}),(0,s.jsxs)("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded space-y-3",children:[(0,s.jsx)("p",{className:"text-sm text-blue-700",children:"✨ 扩展已部署！现在可以使用此扩展地址创建行动。"}),(0,s.jsx)(o.z,{className:"w-full",asChild:!0,children:(0,s.jsx)(f(),{href:"/action/new/?symbol=".concat(q,"&extension=").concat(e_),rel:"noopener noreferrer",children:"立即创建行动"})})]})]}),!e_&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex space-x-4 w-full",children:[(0,s.jsx)(o.z,{type:"button",onClick:eE,className:"w-1/2",disabled:ef||ey||"approved"===ej||"deploying"===ej||"deployed"===ej||!ee||void 0!==$&&$<w("1"),children:ef?"1.提交中...":ey?"1.确认中...":"approved"===ej||"deploying"===ej||"deployed"===ej?"1.代币已授权":"1.代币授权"}),(0,s.jsx)(o.z,{type:"button",onClick:function(){return ea.handleSubmit(eA)()},className:"w-1/2",disabled:"approved"!==ej&&"deploying"!==ej||ed||el,children:ed?"2.部署中...":el?"2.确认中...":"2.部署扩展"})]}),(0,s.jsxs)("div",{className:"mt-6 text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded px-3 py-2",children:[(0,s.jsx)("div",{className:"font-medium text-gray-700 mb-1",children:"\uD83D\uDCA1 小贴士"}),(0,s.jsxs)("div",{className:"space-y-1 text-gray-600",children:[(0,s.jsx)("div",{children:"• 每个新的扩展行动，都需部署1个专属扩展合约"}),(0,s.jsxs)("div",{children:["• 部署时会将 1个 ",q," 转给扩展合约，用于扩展合约初始化"]})]})]})]})]})}))})]}),(0,s.jsx)(J.Z,{isLoading:ef||ey||ed||el,text:ef?"提交授权交易...":ey?"确认授权交易...":ed?"提交部署交易...":"确认部署交易..."})]})}var L=[{type:"constructor",inputs:[{name:"groupActionFactory_",type:"address",internalType:"address"},{name:"groupRecipients_",type:"address",internalType:"address"}],stateMutability:"nonpayable"},{type:"function",name:"CENTER_ADDRESS",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"GROUP_ACTION_FACTORY_ADDRESS",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"GROUP_RECIPIENTS_ADDRESS",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"createExtension",inputs:[{name:"tokenAddress_",type:"address",internalType:"address"},{name:"groupActionTokenAddress_",type:"address",internalType:"address"},{name:"govRatioMultiplier_",type:"uint256",internalType:"uint256"}],outputs:[{name:"extension",type:"address",internalType:"address"}],stateMutability:"nonpayable"},{type:"function",name:"exists",inputs:[{name:"extension",type:"address",internalType:"address"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"extensionCreator",inputs:[{name:"extension",type:"address",internalType:"address"}],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"extensions",inputs:[],outputs:[{name:"",type:"address[]",internalType:"address[]"}],stateMutability:"view"},{type:"function",name:"extensionsAtIndex",inputs:[{name:"index",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"extensionsCount",inputs:[],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"event",name:"CreateExtension",inputs:[{name:"extension",type:"address",indexed:!0,internalType:"address"},{name:"tokenAddress",type:"address",indexed:!0,internalType:"address"}],anonymous:!1},{type:"error",name:"InvalidGroupActionTokenAddress",inputs:[]}],W=C.Ry({groupActionTokenAddress:C.Z_().min(1,{message:"请输入链群行动所在代币地址"}).refine(function(e){return(0,v.U)(e)},{message:"链群行动所在代币地址格式无效"}),govRatioMultiplier:C.Z_().min(1,{message:"请输入治理票占比倍数"}).refine(function(e){var n=parseFloat(e);return!isNaN(n)&&n>=0&&Number.isInteger(n)},{message:"治理票占比倍数必须是非负整数"})});function X(e){var n,t,r,a,d,x,v,j,N,C,S,V,O,z,B=e.factoryAddress,U=(0,i.useContext)(E.M),X=(null==U?void 0:null===(O=U.token)||void 0===O?void 0:O.address)||"",H=(null==U?void 0:null===(z=U.token)||void 0===z?void 0:z.symbol)||"",q=(0,T.m)().address,Y=(0,A.V)().setError,Q=(0,D.hS)(X,q,!!q).balance,$=(0,Z.C)(),K=$.hasEnoughVotes,ee=$.percentage,en=$.validGovVotes,et=$.govData,es=$.SUBMIT_MIN_PERCENTAGE,er=(0,h.cI)({resolver:(0,y.F)(W),defaultValues:{groupActionTokenAddress:X||"",govRatioMultiplier:""},mode:"onChange"}),ea=(t=(n=(0,I.e9)(L,B,"createExtension")).execute,r=n.isPending,a=n.isConfirming,d=n.isConfirmed,x=n.error,v=n.hash,j=n.isTukeMode,N=(0,l._)(function(e,n,s){return(0,m.Jh)(this,function(r){switch(r.label){case 0:return console.log("提交 createExtension 交易:",{contractAddress:B,tokenAddress:e,groupActionTokenAddress:n,govRatioMultiplier:s,isTukeMode:j}),[4,t([e,n,s])];case 1:return[2,r.sent()]}})}),C=function(e,n,t){return N.apply(this,arguments)},(0,i.useEffect)(function(){v&&console.log("createExtension tx hash:",v),x&&(console.log("提交 createExtension 交易错误:"),(0,R.Vh)(x),(0,R.H)(x))},[v,x]),{createExtension:C,isPending:r,isConfirming:a,writeError:x,isConfirmed:d,hash:v,isTukeMode:j}),ei=ea.createExtension,eo=ea.isPending,ed=ea.isConfirming,el=ea.isConfirmed,ec=ea.writeError,eu=ea.hash,ep=(0,D.yA)(X),em=ep.approve,ex=ep.isPending,ef=ep.isConfirming,ey=ep.isConfirmed,eh=ep.writeError;ep.hash;var eg=(0,p._)((0,i.useState)("idle"),2),ev=eg[0],eb=eg[1];(0,i.useEffect)(function(){X&&er.setValue("groupActionTokenAddress",X)},[X,er]);var ej=(0,_.A)({hash:eu}).data,eN=(0,p._)((0,i.useState)(null),2),ew=eN[0],eT=eN[1];(0,i.useEffect)(function(){if(ej&&ej.logs)try{var e=(0,b.h)({abi:L,eventName:"CreateExtension",logs:ej.logs});if(e.length>0&&e[0].args.extension){var n=e[0].args.extension;eT(n),console.log("扩展合约已部署，地址:",n),g.ZP.success("扩展部署成功！")}}catch(e){console.error("解析扩展地址失败:",e)}},[ej]),(0,i.useEffect)(function(){ey&&"approving"===ev&&(eb("approved"),g.ZP.success("授权成功！"))},[ey,ev]),(0,i.useEffect)(function(){el&&ew&&eb("deployed")},[el,ew]),(0,i.useEffect)(function(){eh&&(g.ZP.error("授权失败: ".concat(eh.message)),eb("idle"))},[eh]),(0,i.useEffect)(function(){void 0!==Q&&Q<w("1")&&Y({name:"代币余额不足",message:"部署扩展合约，需要1个".concat(H,"，请先充值")})},[Q,H,Y]),(0,i.useEffect)(function(){!K&&void 0!==en&&et&&Y({name:"治理票不足",message:"有效治理票，须达到总治理票的".concat((0,F.rl)(100*es,1),"，才能部署扩展合约（您当前有效治理票占比").concat((0,F.rl)(100*ee,3),"）")})},[K,en,et,es,ee,Y]);var e_=(S=(0,l._)(function(){var e;return(0,m.Jh)(this,function(n){switch(n.label){case 0:if(!X)return g.ZP.error("未选择代币"),[2];return[4,er.trigger()];case 1:if(!n.sent())return g.ZP.error("请先完整填写表单"),[2];n.label=2;case 2:return n.trys.push([2,4,,5]),eb("approving"),[4,em(B,w("1"))];case 3:return n.sent(),[3,5];case 4:return console.error("授权失败:",e=n.sent()),g.ZP.error((null==e?void 0:e.message)||"授权失败"),eb("idle"),[3,5];case 5:return[2]}})}),function(){return S.apply(this,arguments)}),eC=(V=(0,l._)(function(e){var n;return(0,m.Jh)(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),eb("deploying"),[4,ei(X,e.groupActionTokenAddress,BigInt(e.govRatioMultiplier))];case 1:return t.sent(),[3,3];case 2:return console.error("部署扩展失败:",n=t.sent()),g.ZP.error((null==n?void 0:n.message)||"部署扩展失败"),eb("approved"),[3,3];case 3:return[2]}})}),function(e){return V.apply(this,arguments)});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(k.Zb,{className:"border-0 shadow-none",children:[(0,s.jsxs)(k.Ol,{className:"px-4 md:px-6 pb-4 md:pb-6 pt-4 md:pt-6",children:[(0,s.jsx)(k.ll,{className:"text-xl md:text-2xl",children:"部署链群服务行动扩展合约"}),(0,s.jsx)(k.SZ,{className:"text-sm"})]}),(0,s.jsx)(k.aY,{className:"px-4 md:px-6 pb-4 md:pb-6",children:(0,s.jsx)(M.l0,(0,u._)((0,c._)({},er),{children:(0,s.jsxs)("form",{onSubmit:function(e){return e.preventDefault()},className:"space-y-4 md:space-y-6",children:[(0,s.jsx)(M.Wi,{control:er.control,name:"groupActionTokenAddress",render:function(e){var n=e.field;return(0,s.jsxs)(M.xJ,{children:[(0,s.jsx)(M.lX,{children:"1. 链群行动所在代币合约地址"}),(0,s.jsx)(M.NI,{children:(0,s.jsx)(P.I,(0,u._)((0,c._)({type:"text",placeholder:"0x...",disabled:"idle"!==ev},n),{onChange:function(e){var t=e.target.value.replace(/\s+/g,"");n.onChange(t)}}))}),(0,s.jsx)(M.pf,{className:"text-sm text-greyscale-500",children:"仅限链群服务所在代币地址或其子币地址"}),(0,s.jsx)(M.zG,{})]})}}),(0,s.jsx)(M.Wi,{control:er.control,name:"govRatioMultiplier",render:function(e){var n=e.field;return(0,s.jsxs)(M.xJ,{children:[(0,s.jsx)(M.lX,{children:"2. 治理票占比倍数"}),(0,s.jsx)(M.NI,{children:(0,s.jsx)(P.I,(0,c._)({type:"number",placeholder:"比如 2",disabled:"idle"!==ev,min:"0",step:"1",className:"max-w-40 md:max-w-xs"},n))}),(0,s.jsx)(M.pf,{className:"text-sm text-greyscale-500",children:"服务者所属链群，参与代币总量占比，超过 (治理票占比 \xd7 治理票占比倍数) 的部分，不再有铸币激励"}),(0,s.jsx)(M.zG,{})]})}}),ec&&(0,s.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-red-600",children:["错误: ",ec.message]})}),ew&&(0,s.jsxs)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-2xl",children:"\uD83C\uDF89"}),(0,s.jsx)("p",{className:"text-base font-semibold text-green-700",children:"扩展部署完成！"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("p",{className:"text-sm text-greyscale-600",children:"扩展合约地址:"}),(0,s.jsx)(G.Z,{address:ew,showAddress:!0})]}),(0,s.jsxs)("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded space-y-3",children:[(0,s.jsx)("p",{className:"text-sm text-blue-700",children:"✨ 扩展已部署！现在可以使用此扩展地址创建行动。"}),(0,s.jsx)(o.z,{className:"w-full",asChild:!0,children:(0,s.jsx)(f(),{href:"/action/new/?symbol=".concat(H,"&extension=").concat(ew),rel:"noopener noreferrer",children:"立即创建行动"})})]})]}),!ew&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex space-x-4 w-full",children:[(0,s.jsx)(o.z,{type:"button",onClick:e_,className:"w-1/2",disabled:ex||ef||"approved"===ev||"deploying"===ev||"deployed"===ev||!K||void 0!==Q&&Q<w("1"),children:ex?"1.提交中...":ef?"1.确认中...":"approved"===ev||"deploying"===ev||"deployed"===ev?"1.代币已授权":"1.代币授权"}),(0,s.jsx)(o.z,{type:"button",onClick:function(){return er.handleSubmit(eC)()},className:"w-1/2",disabled:"approved"!==ev&&"deploying"!==ev||eo||ed,children:eo?"2.部署中...":ed?"2.确认中...":"2.部署扩展"})]}),(0,s.jsxs)("div",{className:"mt-6 text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded px-3 py-2",children:[(0,s.jsx)("div",{className:"font-medium text-gray-700 mb-1",children:"\uD83D\uDCA1 小贴士"}),(0,s.jsxs)("div",{className:"space-y-1 text-gray-600",children:[(0,s.jsx)("div",{children:"• 每个新的扩展行动，都需部署1个专属扩展合约"}),(0,s.jsxs)("div",{children:["• 部署时会将 1个 ",H," 转给扩展合约，用于扩展合约初始化"]})]})]})]})]})}))})]}),(0,s.jsx)(J.Z,{isLoading:ex||ef||eo||ed,text:ex?"提交授权交易...":ef?"确认授权交易...":eo?"提交部署交易...":"确认部署交易..."})]})}var H=t(42083),q=function(e){var n=e.factoryAddress,t=(0,r.useRouter)();if(!n)return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,s.jsx)(H.Z,{}),(0,s.jsx)("p",{className:"text-greyscale-500 mt-4",children:"加载中..."})]});var a=(0,d.qD)(n);if(!a)return(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("p",{className:"text-greyscale-500 mb-4",children:"该扩展类型暂不支持"}),(0,s.jsxs)("p",{className:"text-sm text-greyscale-400 mb-6",children:["工厂地址: ",n]}),(0,s.jsx)(o.z,{variant:"outline",onClick:function(){return t.back()},children:"返回"})]});switch(a.type){case d.nw.LP:return(0,s.jsx)(O,{factoryAddress:n});case d.nw.GROUP_ACTION:return(0,s.jsx)(U,{factoryAddress:n});case d.nw.GROUP_SERVICE:return(0,s.jsx)(X,{factoryAddress:n});default:return(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("p",{className:"text-greyscale-500 mb-4",children:"该扩展类型暂不支持"}),(0,s.jsxs)("p",{className:"text-sm text-greyscale-400 mb-6",children:["工厂地址: ",n]}),(0,s.jsx)(o.z,{variant:"outline",onClick:function(){return t.back()},children:"返回"})]})}};function Y(){var e=(0,r.useRouter)().query.factory;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.Z,{title:"部署扩展行动",showBackButton:!0}),(0,s.jsx)("main",{className:"flex-grow container mx-auto px-2 py-6 max-w-2xl",children:(0,s.jsx)(q,{factoryAddress:e||""})})]})}},15950:function(e,n,t){"use strict";t.d(n,{F:function(){return c}});var s=t(57412),r=t(39135),a=t(96005),i=t(66238),o=t(32927),d=t(80522);let l="/docs/contract/decodeEventLog";function c(e){let{abi:n,data:t,strict:c,topics:u}=e,p=c??!0,[m,...x]=u;if(!m)throw new s.FM({docsPath:l});let f=n.find(e=>"event"===e.type&&m===(0,a.n)((0,d.t)(e)));if(!(f&&"name"in f)||"event"!==f.type)throw new s.lC(m,{docsPath:l});let{name:y,inputs:h}=f,g=h?.some(e=>!("name"in e&&e.name)),v=g?[]:{},b=h.filter(e=>"indexed"in e&&e.indexed);for(let e=0;e<b.length;e++){let n=b[e],t=x[e];if(!t)throw new s.Gy({abiItem:f,param:n});v[n.name||e]=function({param:e,value:n}){return"string"===e.type||"bytes"===e.type||"tuple"===e.type||e.type.match(/^(.*)\[(\d+)?\]$/)?n:((0,o.r)([e],n)||[])[0]}({param:n,value:t})}let j=h.filter(e=>!("indexed"in e&&e.indexed));if(j.length>0){if(t&&"0x"!==t)try{let e=(0,o.r)(j,t);if(e){if(g)v=[...v,...e];else for(let n=0;n<j.length;n++)v[j[n].name]=e[n]}}catch(e){if(p){if(e instanceof s.xB||e instanceof i.lQ)throw new s.SM({abiItem:f,data:t,params:j,size:(0,r.d)(t)});throw e}}else if(p)throw new s.SM({abiItem:f,data:"0x",params:j,size:0})}return{eventName:y,args:Object.values(v).length>0?v:void 0}}},59691:function(e,n,t){"use strict";t.d(n,{h:function(){return a}});var s=t(57412),r=t(15950);function a({abi:e,eventName:n,logs:t,strict:a=!0}){return t.map(t=>{try{let s=(0,r.F)({...t,abi:e,strict:a});if(n&&!n.includes(s.eventName))return null;return{...s,...t}}catch(r){let e,n;if(r instanceof s.lC)return null;if(r instanceof s.SM||r instanceof s.Gy){if(a)return null;e=r.abiItem.name,n=r.abiItem.inputs?.some(e=>!("name"in e&&e.name))}return{...t,args:n?[]:{},eventName:e}}}).filter(Boolean)}}},function(e){e.O(0,[8501,4463,721,3494,2888,9774,179],function(){return e(e.s=76109)}),_N_E=e.O()}]);