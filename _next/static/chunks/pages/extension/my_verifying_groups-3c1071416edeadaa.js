try{!function(){var n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},e=(new n.Error).stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="170e39f1-00d3-4c9c-86c3-12fea98bac54",n._sentryDebugIdIdentifier="sentry-dbid-170e39f1-00d3-4c9c-86c3-12fea98bac54")}()}catch(n){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9110],{1830:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/extension/my_verifying_groups",function(){return t(876)}])},74089:function(n,e,t){"use strict";var r=t(91309),o=t(85893),s=t(67294);e.Z=function(n){var e=n.initialTimeLeft,t=n.onTick,a=n.forceShowSeconds,i=n.fontClass,c=void 0===i?"":i,u=(0,r._)((0,s.useState)(Date.now()+1e3*e),2),d=u[0],l=u[1],f=(0,r._)((0,s.useState)(e),2),g=f[0],p=f[1];(0,s.useEffect)(function(){l(Date.now()+1e3*e)},[e]),(0,s.useEffect)(function(){var n=setInterval(function(){var e=Math.max(0,Math.floor((d-Date.now())/1e3));p(e),t&&t(e),e<=0&&(clearInterval(n),window.location.reload())},1e3);return function(){return clearInterval(n)}},[d,t]);var h=Math.floor(g/86400),x=Math.floor(g%86400/3600);return(0,o.jsxs)("span",{className:"inline-flex space-x-1 text-greyscale-400",children:[h>0&&(0,o.jsxs)("span",{children:[(0,o.jsx)("span",{className:"countdown font-mono ".concat(c),children:(0,o.jsx)("span",{style:{"--value":h}})}),(0,o.jsx)("span",{className:c,children:"天"})]}),(x>0||h>0)&&(0,o.jsxs)("span",{children:[(0,o.jsx)("span",{className:"countdown font-mono ".concat(c),children:(0,o.jsx)("span",{style:{"--value":x}})}),(0,o.jsx)("span",{className:c,children:"时"})]}),(0,o.jsxs)("span",{children:[(0,o.jsx)("span",{className:"countdown font-mono ".concat(c),children:(0,o.jsx)("span",{style:{"--value":Math.floor(g%3600/60)}})}),(0,o.jsx)("span",{className:c,children:"分"})]}),(h<=0||void 0!==a&&a)&&(0,o.jsxs)("span",{children:[(0,o.jsx)("span",{className:"countdown font-mono ".concat(c),children:(0,o.jsx)("span",{style:{"--value":g%60}})}),(0,o.jsx)("span",{className:c,children:"秒"})]})]})}},64777:function(n,e,t){"use strict";var r=t(85893);e.Z=function(n){var e=n.title;return(0,r.jsx)("div",{className:"flex justify-between items-center",children:(0,r.jsx)("h1",{className:"text-lg font-bold",children:e})})}},42083:function(n,e,t){"use strict";var r=t(85893),o=t(23432);e.Z=function(){return(0,r.jsx)(o.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},88308:function(n,e,t){"use strict";t.d(e,{h:function(){return i}});var r=t(67294),o=t(67516),s=t(50095);function a(n){return"".concat("group_name_").concat(n.toString())}var i=function(n){var e=n.groupIds,t=n.enabled,i=void 0===t||t,c=!!e&&e.length>0,u=(0,r.useMemo)(function(){if(!i||!c)return{cachedData:new Map,uncachedGroupIds:[]};var n=new Map,t=[];return e.forEach(function(e){var r=function(n){try{var e=a(n),t=localStorage.getItem(e);if(null===t)return null;var r=JSON.parse(t);return null===r.data?void 0:r.data}catch(n){return console.error("读取群名称缓存失败:",n),null}}(e);null!==r?n.set(e,r):t.push(e)}),{cachedData:n,uncachedGroupIds:t}},[e,i,c]),d=u.cachedData,l=u.uncachedGroupIds,f=(0,r.useMemo)(function(){return i&&c&&0!==l.length?l.map(function(n){return{address:"0xA0a5BB442214988D0c6e707d825640C026fB1d04",abi:s.s,functionName:"groupNameOf",args:[n]}}):[]},[l,i,c]),g=(0,o.N)({contracts:f,query:{enabled:i&&c&&f.length>0}}),p=g.data,h=g.isPending,x=g.error;(0,r.useEffect)(function(){p&&0!==l.length&&p.forEach(function(n,e){(null==n?void 0:n.status)==="success"&&function(n,e){try{var t=a(n);localStorage.setItem(t,JSON.stringify({data:void 0===e?null:e}))}catch(n){console.error("保存群名称缓存失败:",n)}}(l[e],n.result)})},[p,l]);var m=(0,r.useMemo)(function(){var n=new Map;return p&&l.length>0&&p.forEach(function(e,t){var r=l[t];(null==e?void 0:e.status)==="success"&&n.set(r,e.result)}),n},[p,l]);return{groupNameMap:(0,r.useMemo)(function(){var n=new Map;return i&&c&&e.forEach(function(e){d.has(e)?n.set(e,d.get(e)):m.has(e)&&n.set(e,m.get(e))}),n},[e,d,m,i,c]),isPending:(0,r.useMemo)(function(){return!!i&&!!c&&l.length>0&&h},[i,c,l.length,h]),error:x||null}}},87333:function(n,e,t){"use strict";t.d(e,{Q:function(){return c}});var r=t(67294),o=t(67516),s=t(65293),a=t(87974),i=t(8926);function c(n){var e=n.tokenAddress,t=n.account,c=(0,a.Od)(e),u=c.actionIds,d=c.isPending,l=c.error,f=(0,i.W)({token:{address:e},actionIds:u||[],enabled:!!e&&!!u&&u.length>0}),g=f.extensions,p=f.isPending,h=f.error,x=(0,r.useMemo)(function(){var n=new Map;return g.forEach(function(e){e.isExtension&&e.extensionAddress&&n.set(e.actionId,e.extensionAddress)}),n},[g]),m=(0,r.useMemo)(function(){if(!t||!u||0===u.length||0===x.size)return{groupIdsContracts:[],contractIndexToActionIdMap:new Map};var n=[],e=new Map;return u.forEach(function(r){var o=x.get(r);if(o){var a=n.length;n.push({address:"0xf2084E73bF047aF26d72CEFde25e22536a1f37C8",abi:s.i,functionName:"activeGroupIdsByOwner",args:[o,t]}),e.set(a,r)}}),{groupIdsContracts:n,contractIndexToActionIdMap:e}},[t,u,x]),v=m.groupIdsContracts,I=m.contractIndexToActionIdMap,y=(0,o.N)({contracts:v,query:{enabled:!!t&&!!u&&u.length>0&&x.size>0&&!p}}),b=y.data,N=y.isPending,j=y.error;return{actionIdsWithGroupIds:(0,r.useMemo)(function(){if(!b||0===v.length)return[];var n=[];return b.forEach(function(e,t){if((null==e?void 0:e.status)==="success"&&e.result){var r=I.get(t);if(void 0!==r){var o=e.result;o.length>0&&n.push({actionId:r,groupIds:o})}}}),n},[b,v,I]),isPending:(0,r.useMemo)(function(){return!e||!t||!!d||!!u&&0!==u.length&&(!!p||0!==x.size&&N)},[e,t,d,u,p,x.size,N]),error:l||h||j}}},20714:function(n,e,t){"use strict";t.d(e,{A:function(){return l}});var r=t(67294),o=t(67516),s=t(35611),a=t(87333),i=t(58149),c=t(88308),u=t(8926),d=t(37742);function l(n){var e=n.groupActionTokenAddress,t=n.account,l=n.round,f=(0,a.Q)({tokenAddress:e,account:t}),g=f.actionIdsWithGroupIds,p=f.isPending,h=f.error,x=(0,r.useMemo)(function(){return g.map(function(n){return n.actionId})},[g]),m=(0,u.W)({token:{address:e},actionIds:x,enabled:!!e&&x.length>0}),v=m.extensions,I=m.isPending,y=m.error,b=(0,r.useMemo)(function(){var n=new Map;return v.forEach(function(e){e.isExtension&&e.extensionAddress&&n.set(e.actionId,e.extensionAddress)}),n},[v]),N=(0,i.I)({tokenAddress:e,actionIds:x,enabled:!!e&&x.length>0&&!I}),j=N.actionInfos,M=N.isPending,w=N.error,E=(0,r.useMemo)(function(){var n=new Set;return g.forEach(function(e){e.groupIds.forEach(function(e){n.add(e.toString())})}),Array.from(n).map(function(n){return BigInt(n)})},[g]),_=(0,c.h)({groupIds:E.length>0?E:void 0,enabled:E.length>0&&!p}),A=_.groupNameMap,k=_.isPending,B=_.error,T=(0,r.useMemo)(function(){var n=[];return g.forEach(function(e){var t=b.get(e.actionId);t&&e.groupIds.forEach(function(r){n.push({actionId:e.actionId,extensionAddress:t,groupId:r,index:n.length})})}),n},[g,b]),S=(0,r.useMemo)(function(){return 0!==T.length&&l?T.map(function(n){var e=n.extensionAddress,t=n.groupId;return{address:"0xd94e4Fc2108B78Aa57438BFe5E85192687f74322",abi:s.w,functionName:"totalJoinedAmountByGroupId",args:[e,l,t]}}):[]},[T,l]),P=(0,o.N)({contracts:S,query:{enabled:!!l&&S.length>0&&!I}}),C=P.data,V=P.isPending,Z=P.error,D=(0,r.useMemo)(function(){var n=new Map;return C&&T.length>0&&T.forEach(function(e,t){var r=e.actionId,o=e.groupId,s=C[t];if((null==s?void 0:s.status)==="success"&&void 0!==s.result){var a="".concat(r,"_").concat(o);n.set(a,(0,d.Z)(s.result))}}),n},[C,T]);return{actionsWithGroups:(0,r.useMemo)(function(){if(0===x.length)return[];var n=[];return g.forEach(function(e,t){var r=e.actionId,o=j[t];if(o){var s=b.get(r);if(s){var a=e.groupIds.map(function(n){var e="".concat(r,"_").concat(n),t=D.get(e)||BigInt(0);return{groupId:n,groupName:A.get(n),totalJoinedAmount:t}});n.push({actionId:r,actionTitle:o.body.title||"行动 #".concat(r.toString()),extensionAddress:s,groups:a})}}}),n},[g,j,b,A,D]),isPending:(0,r.useMemo)(function(){return!e||!t||!l||!!p||0!==g.length&&(!!I||0!==b.size&&(!!M||!!k||V))},[e,t,l,p,g.length,I,b.size,M,k,V]),error:h||y||w||B||Z}}},876:function(n,e,t){"use strict";t.r(e);var r=t(85893),o=t(67294),s=t(42130),a=t(11163),i=t(4307),c=t(93778),u=t(72260),d=t(34188),l=t(58149),f=t(88308),g=t(20714),p=t(27966),h=t(83494),x=t(64777),m=t(42083),v=t(21338);e.default=function(){var n=(0,a.useRouter)(),e=((0,o.useContext)(c.M)||{}).token,t=(0,s.m)().address,I=(0,u.Bk)().currentRound,y=(0,o.useMemo)(function(){return!I||I<BigInt(2)?BigInt(0):I-BigInt(2)},[I]),b=(0,o.useMemo)(function(){if(y)return y+BigInt(1)},[y]),N=(0,d.i)({account:t,round:y}),j=N.groups,M=N.isPending,w=N.error,E=null==e?void 0:e.address,_=(0,g.A)({groupActionTokenAddress:E,account:t,round:b}),A=_.actionsWithGroups,k=_.isPending,B=_.error,T=(0,o.useMemo)(function(){var n=new Map;return j.forEach(function(e){var t="".concat(e.actionId,"_").concat(e.groupId);n.set(t,e)}),n},[j]),S=(0,o.useMemo)(function(){var n=new Set;return j.forEach(function(e){return n.add(e.actionId)}),A.forEach(function(e){return n.add(e.actionId)}),Array.from(n)},[j,A]),P=(0,o.useMemo)(function(){var n=new Set;return j.forEach(function(e){return n.add(e.groupId)}),A.forEach(function(e){e.groups.forEach(function(e){return n.add(e.groupId)})}),Array.from(n)},[j,A]),C=(0,l.I)({tokenAddress:null==e?void 0:e.address,actionIds:S}),V=C.actionInfos,Z=C.isPending,D=C.error,O=(0,f.h)({groupIds:P}),G=O.groupNameMap,q=O.isPending,z=O.error,F=(0,o.useMemo)(function(){if(!V)return[];var n=new Map;return j.forEach(function(e){var t=e.actionId.toString();if(!n.has(t)){var r,o=V.find(function(n){return n.head.id===e.actionId});n.set(t,{actionId:e.actionId,actionTitle:(null==o?void 0:null===(r=o.body)||void 0===r?void 0:r.title)||"行动 #".concat(e.actionId),groups:[]})}n.get(t).groups.push({groupId:e.groupId,groupName:null==G?void 0:G.get(e.groupId),extensionAddress:e.extensionAddress,isVerified:e.isVerified,needToVerify:e.needToVerify,hasVoted:!0})}),A.forEach(function(e){var t=e.actionId.toString();if(!n.has(t)){var r,o=V.find(function(n){return n.head.id===e.actionId});n.set(t,{actionId:e.actionId,actionTitle:(null==o?void 0:null===(r=o.body)||void 0===r?void 0:r.title)||e.actionTitle||"行动 #".concat(e.actionId),groups:[]})}var s=n.get(t);e.groups.forEach(function(n){var t="".concat(e.actionId,"_").concat(n.groupId);T.has(t)||s.groups.push({groupId:n.groupId,groupName:(null==G?void 0:G.get(n.groupId))||n.groupName,extensionAddress:e.extensionAddress,isVerified:!1,needToVerify:!1,hasVoted:!1})})}),Array.from(n.values()).sort(function(n,e){return n.actionId>e.actionId?-1:1})},[j,A,T,V,G]),W=(0,p.b)().handleError;(0,o.useEffect)(function(){w&&W(w),D&&W(D),z&&W(z),B&&W(B)},[w,D,z,B,W]);var J=function(t,r){(null==e?void 0:e.symbol)&&(t.isVerified||!t.hasVoted?n.push("/extension/group/?groupId=".concat(t.groupId,"&actionId=").concat(r,"&symbol=").concat(e.symbol,"&tab=scores&round=").concat(y)):n.push("/extension/group_op/?actionId=".concat(r,"&groupId=").concat(t.groupId,"&op=verify")))};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h.Z,{title:"我需验证的链群",showBackButton:!0}),(0,r.jsx)("main",{className:"flex-grow p-4",children:t?M||Z||q||k?(0,r.jsx)("div",{className:"flex justify-center items-center p-8",children:(0,r.jsx)(m.Z,{})}):0===F.length?(0,r.jsxs)("div",{className:"py-4",children:[(0,r.jsx)(x.Z,{title:"我的链群"}),(0,r.jsx)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:"没有已激活的链群"})]}):(0,r.jsxs)("div",{children:[(0,r.jsx)(x.Z,{title:"我的链群"}),(0,r.jsx)(v.Z,{currentRound:y,roundType:"verify"}),F.map(function(n){return(0,r.jsxs)("div",{className:"border rounded-lg p-3 mt-4",children:[(0,r.jsxs)("div",{className:"flex items-baseline mb-3",children:[(0,r.jsx)("span",{className:"text-greyscale-400 text-sm",children:"No."}),(0,r.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:n.actionId.toString()}),(0,r.jsx)("span",{className:"font-bold text-greyscale-800",children:n.actionTitle})]}),(0,r.jsx)("div",{className:"space-y-0",children:n.groups.map(function(e,t){return(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 cursor-pointer ".concat(t>0?"border-t":""),onClick:function(){return J(e,n.actionId)},children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-gray-500 text-xs",children:"#"}),(0,r.jsx)("span",{className:"text-secondary text-base font-semibold",children:e.groupId.toString()}),(0,r.jsx)("span",{className:"text-gray-800",children:e.groupName||"链群 #".concat(e.groupId)})]}),(0,r.jsx)("div",{className:"mt-1",children:e.hasVoted?e.isVerified?(0,r.jsx)("span",{className:"text-xs text-green-600 bg-green-50 px-2 py-1 rounded",children:"已验证"}):e.needToVerify?(0,r.jsx)("span",{className:"text-xs text-orange-600 bg-orange-50 px-2 py-1 rounded",children:"待验证"}):(0,r.jsx)("span",{className:"text-xs text-gray-600 bg-gray-50 px-2 py-1 rounded",children:"无需验证"}):(0,r.jsx)("span",{className:"text-xs text-red-600 bg-red-50 px-2 py-1 rounded",children:"未投票"})})]}),(0,r.jsx)(i.Z,{className:"w-5 h-5 text-gray-400"})]},e.groupId.toString())})})]},n.actionId.toString())})]}):(0,r.jsx)("div",{className:"text-center text-sm text-greyscale-500 p-4 mt-4",children:"请先连接钱包"})})]})}},88504:function(n,e,t){"use strict";t.d(e,{O:function(){return g}});var r=t(72253),o=t(14932),s=t(3628),a=t(97712),i=t(81946),c=t(36100),u=t(10352),d=t(39360),l=t(78942),f=t(63973);function g(){var n,e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},g=t.query,p=void 0===g?{}:g,h=t.watch,x=(0,l.Z)(t),m=(0,s.NL)(),v=(0,d.x)({config:x}),I=null!==(n=t.chainId)&&void 0!==n?n:v,y=function(n,e={}){return{gcTime:0,async queryFn({queryKey:e}){let{scopeKey:t,...r}=e[1];return await function(n,e={}){let{chainId:t,...r}=e,o=n.getClient({chainId:t});return(0,i.s)(o,a.z,"getBlockNumber")(r)}(n,r)??null},queryKey:function(n={}){return["blockNumber",(0,c.OP)(n)]}(e)}}(x,(0,o._)((0,r._)({},t),{chainId:I}));return(0,f.x)((0,o._)((0,r._)({},(0,r._)({config:t.config,chainId:t.chainId},"object"==typeof h?h:{})),{enabled:!!((null===(e=p.enabled)||void 0===e||e)&&("object"==typeof h?h.enabled:h)),onBlockNumber:function(n){m.setQueryData(y.queryKey,n)}})),(0,u.aM)((0,r._)({},p,y))}},63973:function(n,e,t){"use strict";t.d(e,{x:function(){return l}});var r=t(72253),o=t(14932),s=t(47702),a=t(65185),i=t(81946),c=t(67294),u=t(39360),d=t(78942);function l(){var n,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.enabled,l=void 0===t||t,f=e.onBlockNumber,g=(e.config,(0,s._)(e,["enabled","onBlockNumber","config"])),p=(0,d.Z)(e),h=(0,u.x)({config:p}),x=null!==(n=e.chainId)&&void 0!==n?n:h;(0,c.useEffect)(function(){if(l&&f)return function(n,e){let t,r;let{syncConnectedChain:o=n._internal.syncConnectedChain,...s}=e,c=e=>{t&&t();let r=n.getClient({chainId:e});return t=(0,i.s)(r,a.q,"watchBlockNumber")(s)},u=c(e.chainId);return o&&!e.chainId&&(r=n.subscribe(({chainId:n})=>n,async n=>c(n))),()=>{u?.(),r?.()}}(p,(0,o._)((0,r._)({},g),{chainId:x,onBlockNumber:f}))},[x,p,l,f,g.onError,g.emitMissed,g.emitOnBegin,g.poll,g.pollingInterval,g.syncConnectedChain])}}},function(n){n.O(0,[8501,4463,3494,8300,5611,7966,8945,5293,7974,8342,2888,9774,179],function(){return n(n.s=1830)}),_N_E=n.O()}]);