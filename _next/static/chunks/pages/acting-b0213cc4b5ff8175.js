(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2884],{2293:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>R});var t=a(37876),n=a(14232),r=a(8047),l=a(6960),c=a(48230),i=a.n(c),d=a(12293),o=a(83416),x=a(20451),m=a(9215),u=a(62288),h=a(20442),N=a(4066);let v=e=>{var s=e.currentRound,a=((0,n.useContext)(o.N)||{}).token,r=(0,u.CZ)((null==a?void 0:a.address)||""),l=r.rewardAvailable,c=r.isPending,i=r.error,v=(0,m.lW)((null==a?void 0:a.address)||"","0xDe5256A1cf6022ef6af832181CCE617Aee585Dc9"),j=v.balance,f=v.isPending,p=v.error,y=(0,x.g)().handleContractError;(0,n.useEffect)(()=>{p&&y(p,"join"),i&&y(i,"mint")},[p,i]);var g=a?s-BigInt(a.initialStakeRound)+1n:0n,b=(0,N.u3)(l,g);return(0,t.jsx)("div",{className:"px-4",children:(0,t.jsxs)("div",{className:"w-full border rounded-lg p-0",children:[(0,t.jsxs)("div",{className:"stats w-full grid grid-cols-2 divide-x-0",children:[(0,t.jsxs)("div",{className:"stat place-items-center pb-2",children:[(0,t.jsx)("div",{className:"stat-title text-sm pb-1",children:"参与行动代币总数"}),(0,t.jsx)("div",{className:"stat-value text-xl text-secondary",children:f?(0,t.jsx)(d.A,{}):(0,h.NJ)(j||BigInt(0))})]}),(0,t.jsxs)("div",{className:"stat place-items-center pb-2",children:[(0,t.jsx)("div",{className:"stat-title text-sm pb-1",children:"预计新增铸币"}),(0,t.jsx)("div",{className:"stat-value text-xl text-secondary",children:c||void 0===l?(0,t.jsx)(d.A,{}):(0,h.NJ)(b)})]})]}),(0,t.jsxs)("div",{className:"text-center text-xs mb-2 text-greyscale-500",children:["预估年化收益率（APY）：",(0,N.BN)(b,j)]})]})})};var j=a(66663),f=a(91754),p=a(96108),y=a(28638),g=a(52372),b=a(18651),w=a(1709),A=a(87577);let _=e=>{var s=e.currentRound,a=((0,n.useContext)(o.N)||{}).token,l=(0,r.F)().address,c=(0,g.pX)((null==a?void 0:a.address)||"",s||0n,l),m=c.joinableActionDetails,v=c.joinedActions,j=c.isPending,_=c.error,k=(0,u.CZ)((null==a?void 0:a.address)||""),C=k.rewardAvailable,R=k.isPending,E=k.error;null==m||m.sort((e,s)=>Number(e.action.head.id)-Number(s.action.head.id));var M=(null==m?void 0:m.reduce((e,s)=>e+s.votesNum,0n))||0n,B=a?s-BigInt(a.initialStakeRound)+1n:0n,S=(0,N.u3)(C,B),T=(0,x.g)().handleContractError;return(0,n.useEffect)(()=>{_&&T(_,"dataViewer"),E&&T(E,"mint")},[_,E]),(0,t.jsxs)("div",{className:"px-4 py-6",children:[(0,t.jsx)(w.A,{title:"本轮可参与的行动："}),(0,t.jsx)(b.A,{currentRound:s,roundType:"act"}),!l&&(0,t.jsx)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:"请先连接钱包"}),l&&j&&(0,t.jsx)("div",{className:"p-4 flex justify-center items-center",children:(0,t.jsx)(d.A,{})}),l&&!j&&!(null==m?void 0:m.length)&&(0,t.jsx)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:"本轮暂无行动"}),!j&&m&&m.length>0&&(0,t.jsxs)("div",{className:"mt-2 space-y-4",children:[m.map((e,s)=>{var n=null==v?void 0:v.some(s=>s.action.head.id===e.action.head.id),r=Number(M)>0?Number(m[s].votesNum||0n)/Number(M):0,l=n?"/action/".concat(e.action.head.id,"?type=join&symbol=").concat(null==a?void 0:a.symbol):"/acting/join?id=".concat(e.action.head.id,"&symbol=").concat(null==a?void 0:a.symbol);return(0,t.jsx)(y.Zp,{className:"shadow-none",children:(0,t.jsxs)(i(),{href:l,className:"relative block",children:[(0,t.jsxs)(y.aR,{className:"px-3 pt-2 pb-1 flex-row items-baseline",children:[(0,t.jsx)("span",{className:"text-greyscale-400 text-sm",children:"No."}),(0,t.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(e.action.head.id)}),(0,t.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(e.action.body.action)})]}),(0,t.jsxs)(y.Wu,{className:"px-3 pt-1 pb-2",children:[(0,t.jsx)("div",{className:"text-greyscale-500",children:e.action.body.consensus}),(0,t.jsxs)("div",{className:"flex justify-between mt-1 text-sm",children:[(0,t.jsxs)("span",{className:"flex items-center",children:[(0,t.jsx)(f.A,{className:"text-greyscale-400 mr-1 h-3 w-3 -translate-y-0.5"}),(0,t.jsx)("span",{className:"text-greyscale-400",children:(0,t.jsx)(A.A,{address:m[s].action.head.author,showCopyButton:!1,colorClassName2:"text-secondary"})})]}),100*r<Number("50")/10?(0,t.jsx)("span",{className:"flex justify-between text-error text-sm",children:"无铸币奖励"}):(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-greyscale-400 mr-1",children:"预估年化(APY)"}),(0,t.jsx)("span",{className:"text-secondary",children:R?(0,t.jsx)(d.A,{}):(0,N.BN)(BigInt(Math.floor(Number(S||0n)*r)),m[s].joinedAmount)})]}),(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-greyscale-400 mr-1",children:"投票"}),(0,t.jsx)("span",{className:"text-secondary",children:(0,h.Ee)(100*r)})]})]})]}),(0,t.jsx)(p.A,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-greyscale-400 pointer-events-none"})]})},e.action.head.id)}),(0,t.jsxs)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:[(0,t.jsx)("span",{className:"text-red-500 font-bold",children:"提醒："}),(0,t.jsxs)("span",{children:["每个行动阶段，最后","200","个区块（约",(0,h.Xo)(Number("200")*Number("255")/100),"），关闭行动参与报名"]})]})]})]})};var k=a(19593),C=a(17660);let R=()=>{var e=(0,r.F)().isConnected,s=((0,n.useContext)(o.N)||{}).token,a=e&&(null==s?void 0:s.hasEnded)===!0,c=(0,C.vC)(a),m=c.currentRound,u=c.error,h=c.isPending,N=(0,x.g)().handleContractError;return((0,n.useEffect)(()=>{u&&N(u,"join")},[u]),a&&h)?(0,t.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,t.jsx)(d.A,{})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.A,{title:"社区首页"}),(0,t.jsx)("main",{className:"flex-grow",children:e?s?s&&!s.hasEnded?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(k.A,{}),(0,t.jsxs)("div",{className:"flex flex-col items-center p-4 mt-4",children:[(0,t.jsx)("div",{className:"text-center mb-4 text-greyscale-500",children:"公平发射未结束，还不能参与社区行动"}),(0,t.jsx)(l.$,{className:"w-1/2",asChild:!0,children:(0,t.jsx)(i(),{href:"/launch?symbol=".concat(s.symbol),children:"查看公平发射"})})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(k.A,{}),(0,t.jsx)(v,{currentRound:m}),(0,t.jsx)(_,{currentRound:m})]}):(0,t.jsx)(d.A,{}):(0,t.jsx)("div",{className:"flex flex-col items-center p-4 mt-4",children:(0,t.jsx)("div",{className:"text-center mb-4 text-greyscale-500",children:"没有链接钱包，请先连接钱包"})})})]})}},18651:(e,s,a)=>{"use strict";a.d(s,{A:()=>o});var t=a(40854),n=a(37876),r=a(14232),l=a(63934),c=a(83416);let i=e=>{var s=e.initialTimeLeft,a=e.onTick,l=(0,t._)((0,r.useState)(Date.now()+1e3*s),2),c=l[0],i=l[1],d=(0,t._)((0,r.useState)(s),2),o=d[0],x=d[1];(0,r.useEffect)(()=>{i(Date.now()+1e3*s)},[s]),(0,r.useEffect)(()=>{var e=setInterval(()=>{var s=Math.max(0,Math.floor((c-Date.now())/1e3));x(s),a&&a(s),s<=0&&(clearInterval(e),window.location.reload())},1e3);return()=>clearInterval(e)},[c,a]);var m=Math.floor(o/86400),u=Math.floor(o%86400/3600),h=Math.floor(o%3600/60);return(0,n.jsxs)("div",{className:"inline-flex gap-1 text-greyscale-400",children:[m>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"countdown font-mono",children:(0,n.jsx)("span",{style:{"--value":m}})}),"天"]}),(u>0||m>0)&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"countdown font-mono",children:(0,n.jsx)("span",{style:{"--value":u}})}),"时"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"countdown font-mono",children:(0,n.jsx)("span",{style:{"--value":h}})}),"分"]}),m<=0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"countdown font-mono",children:(0,n.jsx)("span",{style:{"--value":o%60}})}),"秒"]})]})};var d=a(12293);let o=e=>{var s=e.currentRound,a=e.roundType,o=e.showCountdown,x=(0,l.y)().data,m=(0,r.useContext)(c.N),u=m?m.token:void 0,h=!x||!u||void 0===u.voteOriginBlocks,N=(0,t._)((0,r.useState)(0n),2),v=N[0],j=N[1],f=Number("33784")||0,p=Number("255")||0,y=u?Number(u.voteOriginBlocks):0,g=f-(Number(x)-y)%f,b=g>0?Math.ceil(g*p/100):0,w=(0,t._)((0,r.useState)(b),2),A=w[0],_=w[1];(0,r.useEffect)(()=>{if(x){var e=f-(Number(x)-y)%f;_(e>0?Math.ceil(e*p/100):0)}},[x,f,p,y]),(0,r.useEffect)(()=>{u&&s>0n&&j(s-BigInt(u.initialStakeRound)+1n)},[s,u]);var k=null!=v?v.toString():"0";return(null==u?void 0:u.initialStakeRound)&&!(v<=0n)?h||null==v||v<0n?((null==v||v<0n)&&(console.log("currentTokenRound",v),console.log("currentRound",s),console.log("token.initialStakeRound",null==u?void 0:u.initialStakeRound),console.log("token",u)),(0,n.jsx)(d.A,{})):(0,n.jsx)("div",{className:"flex items-center mb-3",children:(0,n.jsxs)("span",{className:"text-sm text-greyscale-400",children:["( 第",(0,n.jsx)("span",{className:"text-greyscale-400",children:k}),"轮","vote"===a?"投票":"verify"===a?"验证":"行动","阶段，",(0,n.jsx)("span",{className:"text-greyscale-400",children:"剩余"}),(0,n.jsx)("span",{className:"text-greyscale-400",children:Math.ceil(100*A/p)}),(0,n.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),void 0===o||o?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(i,{initialTimeLeft:b,onTick:_})}):(0,n.jsx)("span",{className:"text-greyscale-400",children:A<60?"".concat(A,"秒"):A<=300?"".concat(Math.floor(A/60),"分钟").concat(A%60,"秒"):A<3600?"".concat(Math.floor(A/60),"分钟"):"".concat(Math.floor(A/3600),"小时").concat(Math.floor(A%3600/60),"分钟")}),(0,n.jsx)("span",{className:"text-greyscale-400",children:" )"})]})}):(0,n.jsx)(n.Fragment,{})}},28638:(e,s,a)=>{"use strict";a.d(s,{BT:()=>x,Wu:()=>m,ZB:()=>o,Zp:()=>i,aR:()=>d,wL:()=>u});var t=a(3576),n=a(65699),r=a(37876),l=a(14232),c=a(30684),i=l.forwardRef((e,s)=>{var a=e.className,l=(0,n._)(e,["className"]);return(0,r.jsx)("div",(0,t._)({ref:s,className:(0,c.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a)},l))});i.displayName="Card";var d=l.forwardRef((e,s)=>{var a=e.className,l=(0,n._)(e,["className"]);return(0,r.jsx)("div",(0,t._)({ref:s,className:(0,c.cn)("flex flex-col space-y-1.5 p-6",a)},l))});d.displayName="CardHeader";var o=l.forwardRef((e,s)=>{var a=e.className,l=(0,n._)(e,["className"]);return(0,r.jsx)("div",(0,t._)({ref:s,className:(0,c.cn)("text-2xl font-semibold leading-none tracking-tight",a)},l))});o.displayName="CardTitle";var x=l.forwardRef((e,s)=>{var a=e.className,l=(0,n._)(e,["className"]);return(0,r.jsx)("div",(0,t._)({ref:s,className:(0,c.cn)("text-sm text-muted-foreground",a)},l))});x.displayName="CardDescription";var m=l.forwardRef((e,s)=>{var a=e.className,l=(0,n._)(e,["className"]);return(0,r.jsx)("div",(0,t._)({ref:s,className:(0,c.cn)("p-6 pt-0",a)},l))});m.displayName="CardContent";var u=l.forwardRef((e,s)=>{var a=e.className,l=(0,n._)(e,["className"]);return(0,r.jsx)("div",(0,t._)({ref:s,className:(0,c.cn)("flex items-center p-6 pt-0",a)},l))});u.displayName="CardFooter"},45839:(e,s,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/acting",function(){return a(2293)}])},91754:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});var t=(0,a(11713).A)("UserPen",[["path",{d:"M11.5 15H7a4 4 0 0 0-4 4v2",key:"15lzij"}],["path",{d:"M21.378 16.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"1817ys"}],["circle",{cx:"10",cy:"7",r:"4",key:"e45bow"}]])},96108:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});var t=(0,a(11713).A)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])}},e=>{var s=s=>e(e.s=s);e.O(0,[8230,4571,4112,4267,2569,5139,548,8656,9593,2288,636,6593,8792],()=>s(45839)),_N_E=e.O()}]);