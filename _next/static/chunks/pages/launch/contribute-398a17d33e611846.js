try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="12d802fa-61f7-4f02-9f64-6b3fcb1896c3",e._sentryDebugIdIdentifier="sentry-dbid-12d802fa-61f7-4f02-9f64-6b3fcb1896c3")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8251],{58862:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/launch/contribute",function(){return r(58314)}])},85794:function(e,n,r){"use strict";r.d(n,{A5:function(){return h},DA:function(){return g},hS:function(){return f},l3:function(){return b},yA:function(){return v},yG:function(){return d},z4:function(){return m}});var t=r(11010),s=r(97582),i=r(67294),o=r(71104),a=r(37541),c=r(37742),u=r(37474),l=r(84689),d=function(e,n,r){var t=!(arguments.length>3)||void 0===arguments[3]||arguments[3],s=(0,o.u)({address:e,abi:a.O,functionName:"allowance",args:[n,r],query:{enabled:!!e&&!!n&&!!r&&t}}),i=s.data,u=s.isPending,l=s.error,d=s.refetch;return{allowance:void 0!==i?(0,c.Z)(i):void 0,isPending:u,error:l,refetch:d}},f=function(e,n){var r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],t=(0,o.u)({address:e,abi:a.O,functionName:"balanceOf",args:[n],query:{enabled:!!e&&!!n&&r}}),s=t.data,i=t.isPending,u=t.error,l=t.refetch;return{balance:void 0!==s?(0,c.Z)(s):void 0,isPending:i,error:u,refetch:l}},m=function(e){var n=(0,o.u)({address:e,abi:a.O,functionName:"symbol",args:[],query:{enabled:!!e}});return{symbol:n.data,isPending:n.isPending,error:n.error}},h=function(e){var n=(0,o.u)({address:e,abi:a.O,functionName:"totalSupply",args:[],query:{enabled:!!e}}),r=n.data,t=n.isPending,s=n.error;return{totalSupply:void 0!==r?(0,c.Z)(r):void 0,isPending:t,error:s}};function v(e){var n,r=(0,u.e9)(a.O,e,"approve"),o=r.execute,c=r.isPending,d=r.isConfirming,f=r.isConfirmed,m=r.error,h=r.hash,v=r.isTukeMode,b=(n=(0,t._)(function(n,r){return(0,s.Jh)(this,function(t){switch(t.label){case 0:return console.log("提交approve交易:",{token:e,spender:n,value:r,isTukeMode:v}),[4,o([n,r])];case 1:return[2,t.sent()]}})}),function(e,r){return n.apply(this,arguments)});return(0,i.useEffect)(function(){h&&console.log("approve tx hash:",h),m&&(console.log("提交approve交易错误:"),(0,l.Vh)(m),(0,l.H)(m))},[h,m]),{approve:b,isPending:c,isConfirming:d,writeError:m,isConfirmed:f,hash:h,isTukeMode:v}}function b(e){var n,r=(0,u.e9)(a.O,e,"burnForParentToken"),o=r.execute,c=r.isPending,d=r.isConfirming,f=r.isConfirmed,m=r.error,h=r.hash,v=r.isTukeMode,b=(n=(0,t._)(function(n){return(0,s.Jh)(this,function(r){switch(r.label){case 0:return console.log("提交burnForParentToken交易:",{token:e,amount:n,isTukeMode:v}),[4,o([n])];case 1:return[2,r.sent()]}})}),function(e){return n.apply(this,arguments)});return(0,i.useEffect)(function(){h&&console.log("burnForParentToken tx hash:",h),m&&(console.log("提交burnForParentToken交易错误:"),(0,l.Vh)(m),(0,l.H)(m))},[h,m]),{burnForParentToken:b,isPending:c,isConfirming:d,writeError:m,isConfirmed:f,hash:h,isTukeMode:v}}function g(e){var n,r=(0,u.e9)(a.O,e,"transfer"),o=r.execute,c=r.isPending,d=r.isConfirming,f=r.isConfirmed,m=r.error,h=r.hash,v=r.isTukeMode,b=(n=(0,t._)(function(n,r){return(0,s.Jh)(this,function(t){switch(t.label){case 0:return console.log("提交transfer交易:",{token:e,to:n,amount:r,isTukeMode:v}),[4,o([n,r])];case 1:return[2,t.sent()]}})}),function(e,r){return n.apply(this,arguments)});return(0,i.useEffect)(function(){h&&console.log("transfer tx hash:",h),m&&(console.log("提交transfer交易错误:"),(0,l.Vh)(m),(0,l.H)(m))},[h,m]),{transfer:b,isPending:c,isConfirming:d,writeError:m,isConfirmed:f,hash:h,isTukeMode:v}}},58314:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return D}});var t=r(85893),s=r(67294),i=r(93778),o=r(70019),a=r(73591),c=r(83494),u=r(42083),l=r(11010),d=r(72253),f=r(14932),m=r(91309),h=r(97582),v=r(11163),b=r(45901),g=r(56312),x=r(87536),p=r(41664),y=r.n(p),k=r(42130),j=r(39360),w=r(62776),N=r(86501),T=r(27245),C=r(21774),E=r(74193),P=r(91529),_=r(12956),I=r(85794),B=r(95049),A=r(64777),S=r(44576),M=r(23432),z=function(e){var n,r,i,c=e.token;e.launchInfo;var p=(0,k.m)(),z=p.address,D=p.isConnected;(0,j.x)();var O=(0,v.useRouter)(),Z=(null==c?void 0:c.parentTokenSymbol)=="TKM20",F=Z?"TKM":(null==c?void 0:c.parentTokenSymbol)||"",V=(0,w.K)({address:z,query:{enabled:Z}}),J=V.data,q=V.isLoading,H=V.error,K=(0,I.hS)(null==c?void 0:c.parentTokenAddress,z,!Z),L=K.balance,G=K.isPending,R=K.error,X=Z?(null==J?void 0:J.value)||BigInt(0):L||BigInt(0),W=Z?q:G,Y=(0,o.ap)(null==c?void 0:c.address,z),Q=Y.contributed,U=Y.isPending,$=Y.error,ee=((0,P.vz)("0.5"),(0,x.cI)({resolver:(0,g.F)((n=void 0,b.Ry({contributeAmount:b.Z_().nonempty({message:"请输入申购数量"}).refine(function(e){return Number(e)>0},{message:"申购数量不能为 0"}).refine(function(e){var n;return(null!==(n=(0,P.vz)(e))&&void 0!==n?n:BigInt(0))<=X},{message:"申购数量不能超过余额 (".concat((0,P.bM)(X),")")}).refine(function(e){var r;return!n||(null!==(r=(0,P.vz)(e))&&void 0!==r?r:BigInt(0))<=n},{message:"测试环境限制：首个父币最多可申购 ".concat("0.5")})}))),defaultValues:{contributeAmount:""},mode:"onChange",reValidateMode:"onChange"})),en=(0,I.yA)(null==c?void 0:c.parentTokenAddress),er=en.approve,et=en.isPending,es=en.isConfirming,ei=en.isConfirmed,eo=en.writeError,ea=(0,m._)((0,s.useState)(!1),2),ec=ea[0],eu=ea[1],el=(0,I.yG)(null==c?void 0:c.parentTokenAddress,z,"0xfbb35BfeDf07E238c8Ef60aB937B4DB2CDA2D268",!Z),ed=el.allowance,ef=el.isPending,em=el.error,eh=el.refetch;(0,s.useEffect)(function(){ei&&!Z&&(eu(!0),N.Am.success("授权".concat(null==c?void 0:c.parentTokenSymbol,"成功")),eh())},[ei,null==c?void 0:c.parentTokenSymbol,Z,eh]);var ev=ee.watch("contributeAmount");(0,s.useEffect)(function(){if(Z){eu(!0);return}var e,n=null!==(e=(0,P.vz)(ev))&&void 0!==e?e:BigInt(0);n>BigInt(0)&&ed&&ed>BigInt(0)&&ed>=n?eu(!0):eu(!1)},[ev,ed,Z]);var eb=(r=(0,l._)(function(e){var n;return(0,h.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,er("0xfbb35BfeDf07E238c8Ef60aB937B4DB2CDA2D268",null!==(n=(0,P.vz)(e.contributeAmount))&&void 0!==n?n:BigInt(0))];case 1:return r.sent(),[3,3];case 2:return console.error(r.sent()),[3,3];case 3:return[2]}})}),function(e){return r.apply(this,arguments)}),eg=(0,_.E)(),ex=eg.contribute,ep=eg.isPending,ey=eg.isConfirming,ek=eg.isConfirmed,ej=eg.writeError,ew=(0,o.OY)(),eN=ew.contribute,eT=ew.isPending,eC=ew.isConfirming,eE=ew.isConfirmed,eP=ew.writeError,e_=Z?ep:eT,eI=Z?ey:eC,eB=Z?ek:eE,eA=(i=(0,l._)(function(e){var n,r;return(0,h.Jh)(this,function(t){switch(t.label){case 0:if(!Z&&!ec)return N.Am.error("请先授权"),[2];t.label=1;case 1:if(t.trys.push([1,6,,7]),r=null!==(n=(0,P.vz)(e.contributeAmount))&&void 0!==n?n:BigInt(0),!Z)return[3,3];return[4,ex(null==c?void 0:c.address,z,r)];case 2:return t.sent(),[3,5];case 3:return[4,eN(null==c?void 0:c.address,r,z)];case 4:t.sent(),t.label=5;case 5:return[3,7];case 6:return console.error(t.sent()),[3,7];case 7:return[2]}})}),function(e){return i.apply(this,arguments)});(0,s.useEffect)(function(){eB&&(N.Am.success("申购成功"),setTimeout(function(){O.push("/launch?symbol=".concat(null==c?void 0:c.symbol))},2e3))},[eB,O,null==c?void 0:c.symbol]);var eS=(0,B.V)().setError;(0,s.useEffect)(function(){D&&!W&&void 0!==X&&X<=BigInt(0)&&eS({name:"余额不足",message:"请先获取 ".concat(F,"，再来申购")})},[X,eS,D,W,F]);var eM=(0,a.S)().handleContractError;(0,s.useEffect)(function(){var e=Z?ej:eP,n=Z?H:R;e&&eM(e,"launch"),$&&eM($,"launch"),n&&eM(n,Z?"balance":"token"),!Z&&(eo&&eM(eo,"token"),em&&eM(em,"token"))},[ej,eP,$,H,R,eo,em,eM,Z]);var ez=et||es,eD=(0,s.useRef)(null);return((0,s.useEffect)(function(){!ef&&eD.current&&eD.current.blur()},[ef]),D)?!c||W||U?(0,t.jsx)(u.Z,{}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"px-4 mt-2",children:[(0,t.jsx)(A.Z,{title:"参与申购"}),(0,t.jsx)("div",{className:"stats w-full",children:(0,t.jsxs)("div",{className:"stat place-items-center",children:[(0,t.jsx)("div",{className:"stat-title text-sm mr-6",children:"我已申购质押"}),(0,t.jsxs)("div",{className:"stat-value text-secondary",children:[(0,P.LH)(Q||BigInt(0)),(0,t.jsx)("span",{className:"text-greyscale-500 font-normal text-sm ml-2",children:F})]})]})}),(0,t.jsx)(E.l0,(0,f._)((0,d._)({},ee),{children:(0,t.jsxs)("form",{onSubmit:function(e){return e.preventDefault()},className:"space-y-4",children:[(0,t.jsx)(E.Wi,{control:ee.control,name:"contributeAmount",render:function(e){var n=e.field;return(0,t.jsxs)(E.xJ,{children:[(0,t.jsx)(E.lX,{children:"申购数量："}),(0,t.jsx)(E.NI,{children:(0,t.jsx)(C.I,(0,d._)({type:"number",max:void 0,placeholder:"请填写".concat(F,"数量"),disabled:!Z&&ez||X<=BigInt(0),className:"!ring-secondary-foreground"},n))}),(0,t.jsx)(E.zG,{}),!1]})}}),(0,t.jsxs)("div",{className:"flex items-center text-sm mb-4",children:[(0,t.jsxs)("span",{className:"text-greyscale-400",children:[(0,P.LH)(X)," ",F]}),(0,t.jsx)(T.z,{variant:"link",size:"sm",onClick:function(){ee.setValue("contributeAmount",(0,P.bM)(X))},disabled:!Z&&ez||X<=BigInt(0),className:"text-secondary",children:"全部"}),!Z&&(null==c?void 0:c.parentTokenSymbol)==="TKM20"&&(0,t.jsx)(y(),{href:"/dex/deposit?symbol=".concat(c.symbol),children:(0,t.jsxs)(T.z,{variant:"link",size:"sm",className:"text-secondary",children:["获取",c.parentTokenSymbol]})})]}),(0,t.jsx)("div",{className:"flex justify-center",children:Z?(0,t.jsx)(T.z,{className:"w-full text-white py-2 rounded-lg",onClick:ee.handleSubmit(eA),disabled:e_||eI||eB||X<=BigInt(0),children:e_?"申购中...":eI?"确认中...":eB?"申购成功":"申购"}):(0,t.jsxs)("div",{className:"flex space-x-4 w-full",children:[(0,t.jsx)(T.z,{ref:eD,className:"w-1/2",onClick:ee.handleSubmit(eb),disabled:ef||et||es||ec,children:ef?(0,t.jsx)(M.Z,{className:"animate-spin"}):et?"1.提交中...":es?"1.确认中...":ec?"1.".concat(null==c?void 0:c.parentTokenSymbol,"已授权"):"1.授权".concat(null==c?void 0:c.parentTokenSymbol)}),(0,t.jsx)(T.z,{className:"w-1/2 text-white py-2 rounded-lg",onClick:ee.handleSubmit(eA),disabled:!ec||e_||eI||eB,children:e_?"2.申购中...":eI?"2.确认中...":eB?"2.申购成功":"2.申购"})]})})]})}))]}),(0,t.jsx)(S.Z,{isLoading:e_||eI||!Z&&(et||es),text:e_||!Z&&et?"提交交易...":"确认交易..."})]}):(0,t.jsx)("div",{className:"flex flex-col items-center p-4 mt-4",children:(0,t.jsx)("div",{className:"text-center mb-4 text-greyscale-500",children:"没有链接钱包，请先连接钱包"})})};function D(){var e=((0,s.useContext)(i.M)||{}).token,n=(0,o.kF)(e?e.address:"0x0000000000000000000000000000000000000000"),r=n.launchInfo,l=n.isPending,d=n.error,f=(0,a.S)().handleContractError;return(0,s.useEffect)(function(){d&&f(d,"launch")},[d]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Z,{title:"申购"}),(0,t.jsx)("main",{className:"flex-grow",children:l?(0,t.jsx)(u.Z,{}):r?(0,t.jsx)(z,{token:e,launchInfo:r}):(0,t.jsx)("div",{className:"text-red-500",children:"找不到发射信息"})})]})}}},function(e){e.O(0,[8501,4463,721,3494,3591,19,6998,2888,9774,179],function(){return e(e.s=58862)}),_N_E=e.O()}]);