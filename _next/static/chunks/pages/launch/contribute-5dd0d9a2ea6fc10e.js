(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1109],{7446:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var n=(0,r(11713).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},18449:(e,t,r)=>{"use strict";r.d(t,{X:()=>a});var n=r(76200);class s extends n.C{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function a(e,t){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new s({value:e});let[r,n="0"]=e.split("."),a=r.startsWith("-");if(a&&(r=r.slice(1)),n=n.replace(/(0+)$/,""),0===t)1===Math.round(Number(`.${n}`))&&(r=`${BigInt(r)+1n}`),n="";else if(n.length>t){let[e,s,a]=[n.slice(0,t-1),n.slice(t-1,t),n.slice(t)],i=Math.round(Number(`${s}.${a}`));(n=i>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${i}`).length>t&&(n=n.slice(1),r=`${BigInt(r)+1n}`),n=n.slice(0,t)}else n=n.padEnd(t,"0");return BigInt(`${a?"-":""}${r}${n}`)}},20442:(e,t,r)=>{"use strict";r.d(t,{$w:()=>i,Js:()=>d,LP:()=>u,NJ:()=>l,W_:()=>a,XS:()=>o,lM:()=>m,mW:()=>c});var n=r(18449),s=r(32602),a=e=>e?"".concat(e.substring(0,6),"...").concat(e.substring(e.length-4)):"",i=e=>{var t=Number(d(e));return new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(t)},l=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=Number(d(e));if(e<10n)return"0";if(t>=1e5)return new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(t);if(t>=1e3)return new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(t);if(t>=1||t>=.001)return new Intl.NumberFormat("en-US",{maximumFractionDigits:4}).format(t);if(0===t)return"0";var r=t.toFixed(14),n=r.split(".");if(n.length<2)return r;var s=n[1],a=0,i=!0,l=!1,o=void 0;try{for(var c,u=s[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var m=c.value;if("0"===m)a++;else break}}catch(e){l=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(l)throw o}}var p=s.slice(a,a+4);return"0.0{".concat(a,"}").concat(p)},o=e=>{var t=parseInt("18",10);try{var r=e.replace(/,/g,"");return(0,n.X)(r,t)}catch(e){return console.error("parseUnits error:",e),0n}},d=e=>{var t=parseInt("18",10);return(0,s.J)(e,t)},c=e=>e.includes(".")?parseFloat(e.replace(/,/g,"")).toString():e,u=(e,t)=>e&&t?e-BigInt(t.initialStakeRound)+1n:0n,m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=Number(e);if(n>=1)return new Intl.NumberFormat("en-US",{maximumFractionDigits:t}).format(n);if(n>=.001)return new Intl.NumberFormat("en-US",{maximumFractionDigits:r+1}).format(n);if(0===n)return"0";var s=n.toFixed(r+10),a=s.split(".");if(a.length<2)return s;var i=a[1],l=0,o=!0,d=!1,c=void 0;try{for(var u,m=i[Symbol.iterator]();!(o=(u=m.next()).done);o=!0){var p=u.value;if("0"===p)l++;else break}}catch(e){d=!0,c=e}finally{try{o||null==m.return||m.return()}finally{if(d)throw c}}var f=i.slice(l);return"0.0{".concat(l,"}").concat(f)}},42038:(e,t,r)=>{"use strict";r.d(t,{C:()=>s});var n=r(97685),s=e=>!!e||(n.oR.error("请先将钱包链接 ".concat("thinkium801")),!1)},46593:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>P});var n=r(37876),s=r(14232),a=r(83416),i=r(40752),l=r(20451),o=r(66663),d=r(12293),c=r(16927),u=r(3576),m=r(62701),p=r(40854),f=r(4902),y=r(89099),v=r(60513),x=r(13810),b=r(88992),h=r(48230),g=r.n(h),N=r(8047),j=r(57238),w=r(97685),_=r(6960),T=r(77932),A=r(92659),C=r(42038),k=r(20442),E=r(59493),F=r(40162),I=[{type:"constructor",inputs:[],stateMutability:"nonpayable"},{type:"function",name:"WETHAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"contributeWithETH",inputs:[{name:"tokenAddress",type:"address",internalType:"address"},{name:"to",type:"address",internalType:"address"}],outputs:[],stateMutability:"payable"},{type:"function",name:"init",inputs:[{name:"WETHAddress_",type:"address",internalType:"address"},{name:"launchAddress_",type:"address",internalType:"address"},{name:"submitAddress_",type:"address",internalType:"address"},{name:"voteAddress_",type:"address",internalType:"address"},{name:"joinAddress_",type:"address",internalType:"address"},{name:"verifyAddress_",type:"address",internalType:"address"},{name:"mintAddress_",type:"address",internalType:"address"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"initialized",inputs:[],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"joinAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"launchAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"mintAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"submitAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"verifyAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"voteAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"event",name:"ContributeWithETH",inputs:[{name:"tokenAddress",type:"address",indexed:!0,internalType:"address"},{name:"to",type:"address",indexed:!0,internalType:"address"},{name:"ethAmount",type:"uint256",indexed:!1,internalType:"uint256"},{name:"wethAmount",type:"uint256",indexed:!1,internalType:"uint256"}],anonymous:!1}],S=r(9215),M=r(25239),$=r(1709),D=r(99574),R=r(7446),W=e=>v.z.object({contributeAmount:v.z.string().nonempty({message:"请输入申购数量"}).refine(e=>Number(e)>0,{message:"申购数量不能为 0"}).refine(t=>{var r;return(null!=(r=(0,k.XS)(t))?r:0n)<=e},{message:"申购数量不能超过余额 (".concat((0,k.Js)(e),")")})});let B=e=>{var t=e.token;e.launchInfo;var r=(0,N.F)(),a=r.address,o=r.chain,v=r.isConnected,h=(0,y.useRouter)(),B=(null==t?void 0:t.parentTokenSymbol)=="TestTKM20",P=B?"TKM":(null==t?void 0:t.parentTokenSymbol)||"",z=(0,j.A)({address:a,query:{enabled:B}}),X=z.data,J=z.isLoading,L=z.error,U=(0,S.lW)(null==t?void 0:t.parentTokenAddress,a,!B),H=U.balance,O=U.isPending,V=U.error,q=B?(null==X?void 0:X.value)||0n:H||0n,K=B?J:O,G=(0,i.$r)(null==t?void 0:t.address,a),Q=G.contributed,Y=G.isPending,Z=G.error,ee=(0,b.mN)({resolver:(0,x.u)(W(q)),defaultValues:{contributeAmount:""}}),et=(0,S.zH)(null==t?void 0:t.parentTokenAddress),er=et.approve,en=et.isWriting,es=et.isConfirming,ea=et.isConfirmed,ei=et.writeError,el=(0,p._)((0,s.useState)(!1),2),eo=el[0],ed=el[1],ec=(0,S.Gp)(null==t?void 0:t.parentTokenAddress,a,"0x19C8E1E12D71E811ab5b70987579cbF2f856B388",!B),eu=ec.allowance,em=ec.isPending,ep=ec.error;(0,s.useEffect)(()=>{ea&&!B&&(ed(!0),w.oR.success("授权".concat(null==t?void 0:t.parentTokenSymbol,"成功")))},[ea,null==t?void 0:t.parentTokenSymbol,B]);var ef=ee.watch("contributeAmount");(0,s.useEffect)(()=>{if(B)return void ed(!0);var e,t=null!=(e=(0,k.XS)(ef))?e:0n;t>0n&&eu&&eu>0n&&eu>=t?ed(!0):ed(!1)},[ef,eu,B]);var ey=function(){var e=(0,c._)(function(e){var t;return(0,f.__generator)(this,function(r){switch(r.label){case 0:if(!(0,C.C)(o))return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,er("0x19C8E1E12D71E811ab5b70987579cbF2f856B388",null!=(t=(0,k.XS)(e.contributeAmount))?t:0n)];case 2:return r.sent(),[3,4];case 3:return console.error(r.sent()),[3,4];case 4:return[2]}})});return function(t){return e.apply(this,arguments)}}(),ev=function(){var e,t=(0,E.x)(),r=t.writeContract,n=t.isPending,s=t.data,a=t.error,i=(e=(0,c._)(function(e,t,n){var s;return(0,f.__generator)(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,r({address:"0x9CE12E214F7d770E4d708f9BD140C5F8468b1E02",abi:I,functionName:"contributeWithETH",args:[e,t],value:n})];case 1:return a.sent(),[3,3];case 2:throw console.error("Native Coin Contribute Failed:",s=a.sent()),s;case 3:return[2]}})}),function(t,r,n){return e.apply(this,arguments)}),l=(0,F.g)({hash:s});return{contribute:i,writeData:s,isWriting:n,writeError:a,isConfirming:l.isLoading,isConfirmed:l.isSuccess}}(),ex=ev.contribute,eb=ev.isWriting,eh=ev.isConfirming,eg=ev.isConfirmed,eN=ev.writeError,ej=(0,i.LO)(),ew=ej.contribute,e_=ej.isPending,eT=ej.isConfirming,eA=ej.isConfirmed,eC=ej.writeError,ek=B?eb:e_,eE=B?eh:eT,eF=B?eg:eA,eI=function(){var e=(0,c._)(function(e){var r,n;return(0,f.__generator)(this,function(s){switch(s.label){case 0:if(!(0,C.C)(o))return[2];if(!B&&!eo)return w.oR.error("请先授权"),[2];s.label=1;case 1:if(s.trys.push([1,6,,7]),n=null!=(r=(0,k.XS)(e.contributeAmount))?r:0n,!B)return[3,3];return[4,ex(null==t?void 0:t.address,a,n)];case 2:return s.sent(),[3,5];case 3:return[4,ew(null==t?void 0:t.address,n,a)];case 4:s.sent(),s.label=5;case 5:return[3,7];case 6:return console.error(s.sent()),[3,7];case 7:return[2]}})});return function(t){return e.apply(this,arguments)}}();(0,s.useEffect)(()=>{eF&&(w.oR.success("申购成功"),setTimeout(()=>{h.push("/launch?symbol=".concat(null==t?void 0:t.symbol))},2e3))},[eF,h,null==t?void 0:t.symbol]);var eS=(0,M.q)().setError;(0,s.useEffect)(()=>{v&&!K&&void 0!==q&&q<=0n&&eS({name:"余额不足",message:"请先获取 ".concat(P,"，再来申购")})},[q,eS,v,K,P]);var eM=(0,l.g)().handleContractError;(0,s.useEffect)(()=>{var e=B?eN:eC,t=B?L:V;e&&eM(e,"launch"),Z&&eM(Z,"launch"),t&&eM(t,B?"balance":"token"),!B&&(ei&&eM(ei,"token"),ep&&eM(ep,"token"))},[eN,eC,Z,L,V,ei,ep,eM,B]);var e$=en||es,eD=(0,s.useRef)(null);return((0,s.useEffect)(()=>{!em&&eD.current&&eD.current.blur()},[em]),v)?!t||K||Y?(0,n.jsx)(d.A,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"px-4 mt-2",children:[(0,n.jsx)($.A,{title:"参与申购"}),(0,n.jsx)("div",{className:"stats w-full",children:(0,n.jsxs)("div",{className:"stat place-items-center",children:[(0,n.jsx)("div",{className:"stat-title text-sm mr-6",children:"我已申购质押"}),(0,n.jsxs)("div",{className:"stat-value text-secondary",children:[(0,k.NJ)(Q||0n),(0,n.jsx)("span",{className:"text-greyscale-500 font-normal text-sm ml-2",children:P})]})]})}),(0,n.jsx)(A.lV,(0,m._)((0,u._)({},ee),{children:(0,n.jsxs)("form",{onSubmit:e=>e.preventDefault(),className:"space-y-4",children:[(0,n.jsx)(A.zB,{control:ee.control,name:"contributeAmount",render:e=>{var t=e.field;return(0,n.jsxs)(A.eI,{children:[(0,n.jsx)(A.lR,{children:"申购数量："}),(0,n.jsx)(A.MJ,{children:(0,n.jsx)(T.p,(0,u._)({type:"number",placeholder:"请填写".concat(P,"数量"),disabled:!B&&e$||q<=0n,className:"!ring-secondary-foreground"},t))}),(0,n.jsx)(A.C5,{})]})}}),(0,n.jsxs)("div",{className:"flex items-center text-sm mb-4",children:[(0,n.jsxs)("span",{className:"text-greyscale-400",children:[(0,k.NJ)(q)," ",P]}),(0,n.jsx)(_.$,{variant:"link",size:"sm",onClick:()=>{ee.setValue("contributeAmount",(0,k.Js)(q))},disabled:!B&&e$||q<=0n,className:"text-secondary",children:"全部"}),!B&&(null==t?void 0:t.parentTokenSymbol)==="TestTKM20"&&(0,n.jsx)(g(),{href:"/dex/deposit?symbol=".concat(t.symbol),children:(0,n.jsxs)(_.$,{variant:"link",size:"sm",className:"text-secondary",children:["获取",t.parentTokenSymbol]})})]}),(0,n.jsx)("div",{className:"flex justify-center",children:B?(0,n.jsx)(_.$,{className:"w-full text-white py-2 rounded-lg",onClick:ee.handleSubmit(eI),disabled:ek||eE||eF||q<=0n,children:ek?"申购中...":eE?"确认中...":eF?"申购成功":"申购"}):(0,n.jsxs)("div",{className:"flex space-x-4 w-full",children:[(0,n.jsx)(_.$,{ref:eD,className:"w-1/2",onClick:ee.handleSubmit(ey),disabled:em||en||es||eo,children:em?(0,n.jsx)(R.A,{className:"animate-spin"}):en?"1.提交中...":es?"1.确认中...":eo?"1.".concat(null==t?void 0:t.parentTokenSymbol,"已授权"):"1.授权".concat(null==t?void 0:t.parentTokenSymbol)}),(0,n.jsx)(_.$,{className:"w-1/2 text-white py-2 rounded-lg",onClick:ee.handleSubmit(eI),disabled:!eo||ek||eE||eF,children:ek?"2.申购中...":eE?"2.确认中...":eF?"2.申购成功":"2.申购"})]})})]})}))]}),(0,n.jsx)("div",{className:"border-t border-gray-200 mx-4 mt-2 mb-6"}),(0,n.jsx)(D.A,{isLoading:ek||eE||!B&&(en||es),text:ek||!B&&en?"提交交易...":"确认交易..."})]}):(0,n.jsx)("div",{className:"flex flex-col items-center p-4 mt-4",children:(0,n.jsx)("div",{className:"text-center mb-4 text-greyscale-500",children:"没有链接钱包，请先连接钱包"})})};function P(){var e=((0,s.useContext)(a.N)||{}).token,t=(0,i.TU)(e?e.address:"0x0000000000000000000000000000000000000000"),r=t.launchInfo,c=t.isPending,u=t.error,m=(0,l.g)().handleContractError;return(0,s.useEffect)(()=>{u&&m(u,"launch")},[u]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.A,{title:"申购"}),(0,n.jsx)("main",{className:"flex-grow",children:c?(0,n.jsx)(d.A,{}):r?(0,n.jsx)(B,{token:e,launchInfo:r}):(0,n.jsx)("div",{className:"text-red-500",children:"找不到发射信息"})})]})}},77328:(e,t,r)=>{e.exports=r(89836)},86739:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var n=(0,r(11713).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},92659:(e,t,r)=>{"use strict";r.d(t,{lV:()=>v,MJ:()=>w,Rr:()=>_,zB:()=>b,eI:()=>N,lR:()=>j,C5:()=>T});var n=r(81110),s=r(40120),a=r(3576),i=r(62701),l=r(65699),o=r(37876),d=r(14232),c=r(39358),u=r(88992),m=r(30684),p=r(49794),f=(0,r(47137).F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),y=d.forwardRef((e,t)=>{var r=e.className,n=(0,l._)(e,["className"]);return(0,o.jsx)(p.b,(0,a._)({ref:t,className:(0,m.cn)(f(),r)},n))});y.displayName=p.b.displayName;var v=u.Op,x=d.createContext({}),b=e=>{var t=(0,n._)({},(0,s._)(e));return(0,o.jsx)(x.Provider,{value:{name:t.name},children:(0,o.jsx)(u.xI,(0,a._)({},t))})},h=()=>{var e=d.useContext(x),t=d.useContext(g),r=(0,u.xW)(),n=r.getFieldState,s=r.formState,i=n(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");var l=t.id;return(0,a._)({id:l,name:e.name,formItemId:"".concat(l,"-form-item"),formDescriptionId:"".concat(l,"-form-item-description"),formMessageId:"".concat(l,"-form-item-message")},i)},g=d.createContext({}),N=d.forwardRef((e,t)=>{var r=e.className,n=(0,l._)(e,["className"]),s=d.useId();return(0,o.jsx)(g.Provider,{value:{id:s},children:(0,o.jsx)("div",(0,a._)({ref:t,className:(0,m.cn)("space-y-2",r)},n))})});N.displayName="FormItem";var j=d.forwardRef((e,t)=>{var r=e.className,n=(0,l._)(e,["className"]),s=h(),i=s.error,d=s.formItemId;return(0,o.jsx)(y,(0,a._)({ref:t,className:(0,m.cn)(i&&"text-destructive",r),htmlFor:d},n))});j.displayName="FormLabel";var w=d.forwardRef((e,t)=>{var r=(0,n._)({},(0,s._)(e)),i=h(),l=i.error,d=i.formItemId,u=i.formDescriptionId,m=i.formMessageId;return(0,o.jsx)(c.DX,(0,a._)({ref:t,id:d,"aria-describedby":l?"".concat(u," ").concat(m):"".concat(u),"aria-invalid":!!l},r))});w.displayName="FormControl";var _=d.forwardRef((e,t)=>{var r=e.className,n=(0,l._)(e,["className"]),s=h().formDescriptionId;return(0,o.jsx)("p",(0,a._)({ref:t,id:s,className:(0,m.cn)("text-sm text-muted-foreground",r)},n))});_.displayName="FormDescription";var T=d.forwardRef((e,t)=>{var r=e.className,n=e.children,s=(0,l._)(e,["className","children"]),d=h(),c=d.error,u=d.formMessageId,p=c?String(null==c?void 0:c.message):n;return p?(0,o.jsx)("p",(0,i._)((0,a._)({ref:t,id:u,className:(0,m.cn)("text-sm font-medium text-destructive",r)},s),{children:p})):null});T.displayName="FormMessage"},94004:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/launch/contribute",function(){return r(46593)}])},99574:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(37876);r(14232);var s=r(7446);let a=e=>{var t=e.isLoading,r=e.text;return t?(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(s.A,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,n.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:void 0===r?"Loading":r})]})}):null}}},e=>{var t=t=>e(e.s=t);e.O(0,[6869,2569,5139,3356,636,6593,8792],()=>t(94004)),_N_E=e.O()}]);