(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1109],{18449:(e,t,n)=>{"use strict";n.d(t,{X:()=>r});var s=n(76200);class a extends s.C{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function r(e,t){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new a({value:e});let[n,s="0"]=e.split("."),r=n.startsWith("-");if(r&&(n=n.slice(1)),s=s.replace(/(0+)$/,""),0===t)1===Math.round(Number(`.${s}`))&&(n=`${BigInt(n)+1n}`),s="";else if(s.length>t){let[e,a,r]=[s.slice(0,t-1),s.slice(t-1,t),s.slice(t)],i=Math.round(Number(`${a}.${r}`));(s=i>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${i}`).length>t&&(s=s.slice(1),n=`${BigInt(n)+1n}`),s=s.slice(0,t)}else s=s.padEnd(t,"0");return BigInt(`${r?"-":""}${n}${s}`)}},42038:(e,t,n)=>{"use strict";n.d(t,{C:()=>a});var s=n(97685),a=e=>!!e||(s.oR.error("请先将钱包链接 ".concat("thinkium70001")),!1)},46593:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>L});var s=n(37876),a=n(14232),r=n(83416),i=n(40752),d=n(20451),l=n(60154),o=n(12293),u=n(16927),c=n(3576),m=n(62701),p=n(40854),y=n(4902),f=n(89099),v=n(60513),x=n(13810),h=n(88992),b=n(48230),N=n.n(b),T=n(8047),g=n(57238),j=n(97685),w=n(6960),A=n(77932),_=n(92659),C=n(42038),k=n(20442),E=n(40162),I=n(81675),M=n(1160),S=n(99090),$=[{type:"constructor",inputs:[],stateMutability:"nonpayable"},{type:"function",name:"WETHAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"contributeWithETH",inputs:[{name:"tokenAddress",type:"address",internalType:"address"},{name:"to",type:"address",internalType:"address"}],outputs:[],stateMutability:"payable"},{type:"function",name:"init",inputs:[{name:"WETHAddress_",type:"address",internalType:"address"},{name:"launchAddress_",type:"address",internalType:"address"},{name:"stakeAddress_",type:"address",internalType:"address"},{name:"submitAddress_",type:"address",internalType:"address"},{name:"voteAddress_",type:"address",internalType:"address"},{name:"joinAddress_",type:"address",internalType:"address"},{name:"verifyAddress_",type:"address",internalType:"address"},{name:"mintAddress_",type:"address",internalType:"address"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"initialized",inputs:[],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"joinAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"launchAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"mintAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"stakeAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"stakeLiquidity",inputs:[{name:"tokenAddress",type:"address",internalType:"address"},{name:"tokenAmount",type:"uint256",internalType:"uint256"},{name:"parentTokenAmount",type:"uint256",internalType:"uint256"},{name:"tokenAmountMin",type:"uint256",internalType:"uint256"},{name:"parentTokenAmountMin",type:"uint256",internalType:"uint256"},{name:"promisedWaitingPhases",type:"uint256",internalType:"uint256"},{name:"to",type:"address",internalType:"address"}],outputs:[{name:"govVotesAdded",type:"uint256",internalType:"uint256"},{name:"slAmountAdded",type:"uint256",internalType:"uint256"}],stateMutability:"nonpayable"},{type:"function",name:"submitAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"verifyAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"voteAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"event",name:"ContributeWithETH",inputs:[{name:"tokenAddress",type:"address",indexed:!0,internalType:"address"},{name:"to",type:"address",indexed:!0,internalType:"address"},{name:"ethAmount",type:"uint256",indexed:!1,internalType:"uint256"},{name:"wethAmount",type:"uint256",indexed:!1,internalType:"uint256"}],anonymous:!1}],F="0xe37E58E2192d115E0ECe861726d4849064C1E1b4",R=n(9215),P=n(25239),H=n(1709),W=n(99574),z=n(7446),B=e=>v.z.object({contributeAmount:v.z.string().nonempty({message:"请输入申购数量"}).refine(e=>Number(e)>0,{message:"申购数量不能为 0"}).refine(t=>{var n;return(null!=(n=(0,k.XS)(t))?n:0n)<=e},{message:"申购数量不能超过余额 (".concat((0,k.Js)(e),")")})});let D=e=>{var t=e.token;e.launchInfo;var n=(0,T.F)(),r=n.address,l=n.chain,v=n.isConnected,b=(0,f.useRouter)(),D=(null==t?void 0:t.parentTokenSymbol)=="TestTKM20",L=D?"TKM":(null==t?void 0:t.parentTokenSymbol)||"",X=(0,g.A)({address:r,query:{enabled:D}}),J=X.data,q=X.isLoading,V=X.error,O=(0,R.lW)(null==t?void 0:t.parentTokenAddress,r,!D),K=O.balance,Y=O.isPending,G=O.error,U=D?(null==J?void 0:J.value)||0n:K||0n,Q=D?q:Y,Z=(0,i.$r)(null==t?void 0:t.address,r),ee=Z.contributed,et=Z.isPending,en=Z.error,es=(0,h.mN)({resolver:(0,x.u)(B(U)),defaultValues:{contributeAmount:""}}),ea=(0,R.zH)(null==t?void 0:t.parentTokenAddress),er=ea.approve,ei=ea.isPending,ed=ea.isConfirming,el=ea.isConfirmed,eo=ea.writeError,eu=(0,p._)((0,a.useState)(!1),2),ec=eu[0],em=eu[1],ep=(0,R.Gp)(null==t?void 0:t.parentTokenAddress,r,"0xC8257e61128edDCC7B5af60461945336b2cce4bA",!D),ey=ep.allowance,ef=ep.isPending,ev=ep.error;(0,a.useEffect)(()=>{el&&!D&&(em(!0),j.oR.success("授权".concat(null==t?void 0:t.parentTokenSymbol,"成功")))},[el,null==t?void 0:t.parentTokenSymbol,D]);var ex=es.watch("contributeAmount");(0,a.useEffect)(()=>{if(D)return void em(!0);var e,t=null!=(e=(0,k.XS)(ex))?e:0n;t>0n&&ey&&ey>0n&&ey>=t?em(!0):em(!1)},[ex,ey,D]);var eh=function(){var e=(0,u._)(function(e){var t;return(0,y.YH)(this,function(n){switch(n.label){case 0:if(!(0,C.C)(l))return[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,er("0xC8257e61128edDCC7B5af60461945336b2cce4bA",null!=(t=(0,k.XS)(e.contributeAmount))?t:0n)];case 2:return n.sent(),[3,4];case 3:return console.error(n.sent()),[3,4];case 4:return[2]}})});return function(t){return e.apply(this,arguments)}}(),eb=function(){var e,t=(0,p._)((0,a.useState)(!1),2),n=t[0],s=t[1],r=(0,p._)((0,a.useState)(null),2),i=r[0],d=r[1],l=(0,p._)((0,a.useState)(),2),o=l[0],c=l[1],m=(e=(0,u._)(function(e,t,n){var a;return(0,y.YH)(this,function(r){switch(r.label){case 0:s(!0),d(null),r.label=1;case 1:return r.trys.push([1,4,5,6]),[4,(0,I.v)(S.$,{address:F,abi:$,functionName:"contributeWithETH",args:[e,t],value:n})];case 2:return r.sent(),[4,(0,M.E)(S.$,{address:F,abi:$,functionName:"contributeWithETH",args:[e,t],value:n})];case 3:return c(a=r.sent()),[2,a];case 4:return d(r.sent()),[3,6];case 5:return s(!1),[7];case 6:return[2]}})}),function(t,n,s){return e.apply(this,arguments)}),f=(0,E.g)({hash:o}),v=f.isLoading,x=f.isSuccess,h=f.error;return{contribute:m,isPending:n,isConfirming:v,writeError:null!=i?i:h,isConfirmed:x}}(),eN=eb.contribute,eT=eb.isPending,eg=eb.isConfirming,ej=eb.isConfirmed,ew=eb.writeError,eA=(0,i.LO)(),e_=eA.contribute,eC=eA.isPending,ek=eA.isConfirming,eE=eA.isConfirmed,eI=eA.writeError,eM=D?eT:eC,eS=D?eg:ek,e$=D?ej:eE,eF=function(){var e=(0,u._)(function(e){var n,s;return(0,y.YH)(this,function(a){switch(a.label){case 0:if(!(0,C.C)(l))return[2];if(!D&&!ec)return j.oR.error("请先授权"),[2];a.label=1;case 1:if(a.trys.push([1,6,,7]),s=null!=(n=(0,k.XS)(e.contributeAmount))?n:0n,!D)return[3,3];return[4,eN(null==t?void 0:t.address,r,s)];case 2:return a.sent(),[3,5];case 3:return[4,e_(null==t?void 0:t.address,s,r)];case 4:a.sent(),a.label=5;case 5:return[3,7];case 6:return console.error(a.sent()),[3,7];case 7:return[2]}})});return function(t){return e.apply(this,arguments)}}();(0,a.useEffect)(()=>{e$&&(j.oR.success("申购成功"),setTimeout(()=>{b.push("/launch?symbol=".concat(null==t?void 0:t.symbol))},2e3))},[e$,b,null==t?void 0:t.symbol]);var eR=(0,P.q)().setError;(0,a.useEffect)(()=>{v&&!Q&&void 0!==U&&U<=0n&&eR({name:"余额不足",message:"请先获取 ".concat(L,"，再来申购")})},[U,eR,v,Q,L]);var eP=(0,d.g)().handleContractError;(0,a.useEffect)(()=>{var e=D?ew:eI,t=D?V:G;e&&eP(e,"launch"),en&&eP(en,"launch"),t&&eP(t,D?"balance":"token"),!D&&(eo&&eP(eo,"token"),ev&&eP(ev,"token"))},[ew,eI,en,V,G,eo,ev,eP,D]);var eH=ei||ed,eW=(0,a.useRef)(null);return((0,a.useEffect)(()=>{!ef&&eW.current&&eW.current.blur()},[ef]),v)?!t||Q||et?(0,s.jsx)(o.A,{}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"px-4 mt-2",children:[(0,s.jsx)(H.A,{title:"参与申购"}),(0,s.jsx)("div",{className:"stats w-full",children:(0,s.jsxs)("div",{className:"stat place-items-center",children:[(0,s.jsx)("div",{className:"stat-title text-sm mr-6",children:"我已申购质押"}),(0,s.jsxs)("div",{className:"stat-value text-secondary",children:[(0,k.NJ)(ee||0n),(0,s.jsx)("span",{className:"text-greyscale-500 font-normal text-sm ml-2",children:L})]})]})}),(0,s.jsx)(_.lV,(0,m._)((0,c._)({},es),{children:(0,s.jsxs)("form",{onSubmit:e=>e.preventDefault(),className:"space-y-4",children:[(0,s.jsx)(_.zB,{control:es.control,name:"contributeAmount",render:e=>{var t=e.field;return(0,s.jsxs)(_.eI,{children:[(0,s.jsx)(_.lR,{children:"申购数量："}),(0,s.jsx)(_.MJ,{children:(0,s.jsx)(A.p,(0,c._)({type:"number",placeholder:"请填写".concat(L,"数量"),disabled:!D&&eH||U<=0n,className:"!ring-secondary-foreground"},t))}),(0,s.jsx)(_.C5,{})]})}}),(0,s.jsxs)("div",{className:"flex items-center text-sm mb-4",children:[(0,s.jsxs)("span",{className:"text-greyscale-400",children:[(0,k.NJ)(U)," ",L]}),(0,s.jsx)(w.$,{variant:"link",size:"sm",onClick:()=>{es.setValue("contributeAmount",(0,k.Js)(U))},disabled:!D&&eH||U<=0n,className:"text-secondary",children:"全部"}),!D&&(null==t?void 0:t.parentTokenSymbol)==="TestTKM20"&&(0,s.jsx)(N(),{href:"/dex/deposit?symbol=".concat(t.symbol),children:(0,s.jsxs)(w.$,{variant:"link",size:"sm",className:"text-secondary",children:["获取",t.parentTokenSymbol]})})]}),(0,s.jsx)("div",{className:"flex justify-center",children:D?(0,s.jsx)(w.$,{className:"w-full text-white py-2 rounded-lg",onClick:es.handleSubmit(eF),disabled:eM||eS||e$||U<=0n,children:eM?"申购中...":eS?"确认中...":e$?"申购成功":"申购"}):(0,s.jsxs)("div",{className:"flex space-x-4 w-full",children:[(0,s.jsx)(w.$,{ref:eW,className:"w-1/2",onClick:es.handleSubmit(eh),disabled:ef||ei||ed||ec,children:ef?(0,s.jsx)(z.A,{className:"animate-spin"}):ei?"1.提交中...":ed?"1.确认中...":ec?"1.".concat(null==t?void 0:t.parentTokenSymbol,"已授权"):"1.授权".concat(null==t?void 0:t.parentTokenSymbol)}),(0,s.jsx)(w.$,{className:"w-1/2 text-white py-2 rounded-lg",onClick:es.handleSubmit(eF),disabled:!ec||eM||eS||e$,children:eM?"2.申购中...":eS?"2.确认中...":e$?"2.申购成功":"2.申购"})]})})]})}))]}),(0,s.jsx)(W.A,{isLoading:eM||eS||!D&&(ei||ed),text:eM||!D&&ei?"提交交易...":"确认交易..."})]}):(0,s.jsx)("div",{className:"flex flex-col items-center p-4 mt-4",children:(0,s.jsx)("div",{className:"text-center mb-4 text-greyscale-500",children:"没有链接钱包，请先连接钱包"})})};function L(){var e=((0,a.useContext)(r.N)||{}).token,t=(0,i.TU)(e?e.address:"0x0000000000000000000000000000000000000000"),n=t.launchInfo,u=t.isPending,c=t.error,m=(0,d.g)().handleContractError;return(0,a.useEffect)(()=>{c&&m(c,"launch")},[c]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.A,{title:"申购"}),(0,s.jsx)("main",{className:"flex-grow",children:u?(0,s.jsx)(o.A,{}):n?(0,s.jsx)(D,{token:e,launchInfo:n}):(0,s.jsx)("div",{className:"text-red-500",children:"找不到发射信息"})})]})}},69167:(e,t,n)=>{"use strict";n.d(t,{v:()=>o});var s=n(57616),a=n(94833),r=n(14237),i=n(66655),d=n(8481),l=n(57771);async function o(e,t){let{abi:n,address:o,args:u,dataSuffix:c,functionName:m,...p}=t,y=p.account?(0,s.J)(p.account):e.account,f=(0,r.p)({abi:n,args:u,functionName:m});try{let{data:s}=await (0,d.T)(e,l.T,"call")({batch:!1,data:`${f}${c?c.replace("0x",""):""}`,to:o,...p,account:y}),r=(0,a.e)({abi:n,args:u,functionName:m,data:s||"0x"}),i=n.filter(e=>"name"in e&&e.name===t.functionName);return{result:r,request:{abi:i,address:o,args:u,dataSuffix:c,functionName:m,...p,account:y}}}catch(e){throw(0,i.j)(e,{abi:n,address:o,args:u,docsPath:"/docs/contract/simulateContract",functionName:m,sender:y?.address})}}},81675:(e,t,n)=>{"use strict";n.d(t,{v:()=>i});var s=n(69167),a=n(629),r=n(90203);async function i(e,t){let n,{abi:i,chainId:d,connector:l,...o}=t;n=t.account?t.account:(await (0,r.r)(e,{chainId:d,connector:l})).account;let u=e.getClient({chainId:d}),c=(0,a.T)(u,s.v,"simulateContract"),{result:m,request:p}=await c({...o,abi:i,account:n});return{chainId:u.chain.id,result:m,request:{...p,chainId:d}}}},92659:(e,t,n)=>{"use strict";n.d(t,{lV:()=>v,MJ:()=>j,Rr:()=>w,zB:()=>h,eI:()=>T,lR:()=>g,C5:()=>A});var s=n(81110),a=n(40120),r=n(3576),i=n(62701),d=n(65699),l=n(37876),o=n(14232),u=n(39358),c=n(88992),m=n(30684),p=n(49794),y=(0,n(47137).F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),f=o.forwardRef((e,t)=>{var n=e.className,s=(0,d._)(e,["className"]);return(0,l.jsx)(p.b,(0,r._)({ref:t,className:(0,m.cn)(y(),n)},s))});f.displayName=p.b.displayName;var v=c.Op,x=o.createContext({}),h=e=>{var t=(0,s._)({},(0,a._)(e));return(0,l.jsx)(x.Provider,{value:{name:t.name},children:(0,l.jsx)(c.xI,(0,r._)({},t))})},b=()=>{var e=o.useContext(x),t=o.useContext(N),n=(0,c.xW)(),s=n.getFieldState,a=n.formState,i=s(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");var d=t.id;return(0,r._)({id:d,name:e.name,formItemId:"".concat(d,"-form-item"),formDescriptionId:"".concat(d,"-form-item-description"),formMessageId:"".concat(d,"-form-item-message")},i)},N=o.createContext({}),T=o.forwardRef((e,t)=>{var n=e.className,s=(0,d._)(e,["className"]),a=o.useId();return(0,l.jsx)(N.Provider,{value:{id:a},children:(0,l.jsx)("div",(0,r._)({ref:t,className:(0,m.cn)("space-y-2",n)},s))})});T.displayName="FormItem";var g=o.forwardRef((e,t)=>{var n=e.className,s=(0,d._)(e,["className"]),a=b(),i=a.error,o=a.formItemId;return(0,l.jsx)(f,(0,r._)({ref:t,className:(0,m.cn)(i&&"text-destructive",n),htmlFor:o},s))});g.displayName="FormLabel";var j=o.forwardRef((e,t)=>{var n=(0,s._)({},(0,a._)(e)),i=b(),d=i.error,o=i.formItemId,c=i.formDescriptionId,m=i.formMessageId;return(0,l.jsx)(u.DX,(0,r._)({ref:t,id:o,"aria-describedby":d?"".concat(c," ").concat(m):"".concat(c),"aria-invalid":!!d},n))});j.displayName="FormControl";var w=o.forwardRef((e,t)=>{var n=e.className,s=(0,d._)(e,["className"]),a=b().formDescriptionId;return(0,l.jsx)("p",(0,r._)({ref:t,id:a,className:(0,m.cn)("text-sm text-muted-foreground",n)},s))});w.displayName="FormDescription";var A=o.forwardRef((e,t)=>{var n=e.className,s=e.children,a=(0,d._)(e,["className","children"]),o=b(),u=o.error,c=o.formMessageId,p=u?String(null==u?void 0:u.message):s;return p?(0,l.jsx)("p",(0,i._)((0,r._)({ref:t,id:c,className:(0,m.cn)("text-sm font-medium text-destructive",n)},a),{children:p})):null});A.displayName="FormMessage"},94004:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/launch/contribute",function(){return n(46593)}])},99574:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var s=n(37876);n(14232);var a=n(7446);let r=e=>{var t=e.isLoading,n=e.text;return t?(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(a.A,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,s.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:void 0===n?"Loading":n})]})}):null}}},e=>{var t=t=>e(e.s=t);e.O(0,[3308,9374,8230,6869,154,3096,5139,3356,636,6593,8792],()=>t(94004)),_N_E=e.O()}]);