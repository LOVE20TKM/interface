(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5475],{7446:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});var r=(0,t(11713).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},12293:(e,s,t)=>{"use strict";t.d(s,{A:()=>n});var r=t(37876),a=t(7446);let n=()=>(0,r.jsx)(a.A,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})},18449:(e,s,t)=>{"use strict";t.d(s,{X:()=>n});var r=t(76200);class a extends r.C{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function n(e,s){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new a({value:e});let[t,r="0"]=e.split("."),n=t.startsWith("-");if(n&&(t=t.slice(1)),r=r.replace(/(0+)$/,""),0===s)1===Math.round(Number(`.${r}`))&&(t=`${BigInt(t)+1n}`),r="";else if(r.length>s){let[e,a,n]=[r.slice(0,s-1),r.slice(s-1,s),r.slice(s)],i=Math.round(Number(`${a}.${n}`));(r=i>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${i}`).length>s&&(r=r.slice(1),t=`${BigInt(t)+1n}`),r=r.slice(0,s)}else r=r.padEnd(s,"0");return BigInt(`${n?"-":""}${t}${r}`)}},31517:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>A});var r=t(16927),a=t(3576),n=t(62701),i=t(40854),l=t(4902),c=t(37876),d=t(14232),o=t(89099),u=t(8047),m=t(97685),x=t(6960),h=t(48230),v=t.n(h),g=t(64115),f=t(98684),p=t(19591),N=t(20451),y=t(42038),b=t(20442),j=t(83416),w=t(66663),_=t(12293),E=t(99574);let A=()=>{var e=((0,d.useContext)(j.N)||{}).token,s=(0,i._)((0,d.useState)({}),2),t=s[0],h=s[1],A=(0,u.F)(),$=A.address,k=A.chain,C=(0,f.vC)(),I=C.currentRound,B=(C.isPending,C.error),P=(0,o.useRouter)(),R=P.query.ids,L=(0,i._)((0,d.useState)([]),2),T=L[0],F=L[1];(0,d.useEffect)(()=>{R&&F(R.split(",").map(e=>parseInt(e,10)))},[R]),(0,d.useEffect)(()=>{if(1===T.length)h({[T[0]]:100});else{var e={},s=Math.floor(100/T.length);T.forEach((t,r)=>{r===T.length-1?e[t]=100-s*(T.length-1):e[t]=s}),h(e)}},[T]);var M=(e,s)=>{if(1!==T.length){var r=(0,n._)((0,a._)({},t),{[e]:s}),i=T.slice(0,-1).reduce((e,s)=>e+(r[s]||0),0);if(i>100)return void m.oR.error("投票百分比之和不能超过100%");r[T[T.length-1]]=100-i,h(r)}},S=(0,p.Fd)(null==e?void 0:e.address,$),O=S.validGovVotes,X=S.isPending,q=S.error,z=(0,f.Pb)(null==e?void 0:e.address,I,$),W=z.votesNumByAccount,D=z.isPending,G=z.error,H=(null==T?void 0:T.map(e=>BigInt(e)))||[],J=(0,g.ui)(null==e?void 0:e.address,H),U=J.actionInfos,V=J.isPending,K=J.error,Q=(0,f.eU)(),Y=Q.vote,Z=Q.isWriting,ee=Q.isConfirming,es=Q.isConfirmed,et=Q.writeError,er=()=>!!(0,y.C)(k)&&(O-W<2n?(m.oR.error("剩余票数不足，不能投票"),!1):100===Object.values(t).reduce((e,s)=>e+s,0)||(m.oR.error("百分比之和必须为100"),!1)),ea=function(){var s=(0,r._)(function(){var s,r;return(0,l.__generator)(this,function(a){switch(a.label){case 0:if(!er())return[2];s=T.map(e=>BigInt(e)),r=T.map(e=>BigInt(t[e]||0)*(O-W)/100n),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,Y(null==e?void 0:e.address,s,r)];case 2:return a.sent(),[3,4];case 3:return console.error("投票提交失败:",a.sent()),m.oR.error("提交失败，请重试"),[3,4];case 4:return[2]}})});return function(){return s.apply(this,arguments)}}(),en=(0,N.g)().handleContractError;return(0,d.useEffect)(()=>{B&&en(B,"vote"),et&&en(et,"vote"),G&&en(G,"vote"),K&&en(K,"submit"),q&&en(q,"stake")},[B,et,K,q,G]),(0,d.useEffect)(()=>{es&&!et&&(m.oR.success("提交成功",{duration:2e3}),setTimeout(()=>{P.push("/vote/actions/?symbol=".concat(null==e?void 0:e.symbol))},2e3))},[es,et]),(0,d.useEffect)(()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()},[]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(w.A,{title:"投票"}),(0,c.jsx)("main",{className:"flex-grow",children:!e||V?(0,c.jsx)(_.A,{}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"stats w-full",children:(0,c.jsxs)("div",{className:"stat place-items-center",children:[(0,c.jsx)("div",{className:"stat-title text-sm",children:"我的剩余票数"}),(0,c.jsx)("div",{className:"stat-value text-secondary mt-2",children:X||D?(0,c.jsx)(_.A,{}):(0,b.NJ)(O-W||BigInt(0))}),(0,c.jsxs)("div",{className:"stat-desc text-sm mt-2",children:["如需更多票数，请先"," ",(0,c.jsx)(v(),{href:"/gov/stakelp/?symbol=".concat(null==e?void 0:e.symbol),className:"text-secondary",children:"获取治理票"})]})]})}),(0,c.jsxs)("div",{className:"px-4",children:[(0,c.jsx)("div",{className:"space-y-4",children:null==U?void 0:U.map((s,r)=>{var a=r===U.length-1,n=100-T.slice(0,-1).reduce((e,s)=>e+(t[s]||0),0);return(0,c.jsxs)("div",{className:"p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,c.jsxs)(v(),{href:"/action/".concat(s.head.id,"?type=vote&symbol=").concat(e.symbol),className:"flex-grow",children:[(0,c.jsxs)("div",{className:"font-semibold mb-2",children:[(0,c.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No.".concat(s.head.id)}),(0,c.jsx)("span",{className:"text-greyscale-900",children:"".concat(s.body.action)})]}),(0,c.jsx)("p",{className:"text-greyscale-500",children:s.body.consensus})]},s.head.id),(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("input",{type:"number",min:a?n:1,max:"100",value:a?n:t[s.head.id]||"",onChange:e=>M(s.head.id,Number(e.target.value)),className:"p-2 border rounded w-16",disabled:1===T.length||a,placeholder:""}),"%"]})]},s.head.id)})}),(0,c.jsx)("div",{className:"flex justify-center mt-4",children:(0,c.jsx)(x.$,{className:"w-1/2 focus:outline-none focus:ring-0",onFocus:e=>e.currentTarget.blur(),onClick:ea,disabled:Z||ee||es,children:Z?"提交中...":ee?"确认中...":es?"已提交":"提交投票"})})]}),(0,c.jsx)("div",{className:"flex flex-col w-full p-4 mt-4",children:(0,c.jsxs)("div",{className:"bg-gray-100 text-greyscale-500 rounded-lg p-4 mb-8 text-sm",children:[(0,c.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-1",children:"注意："}),(0,c.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"1、每轮最大可投票数，等于您的治理票数；"}),(0,c.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"2、APP帮您自动计算并提交100%票数；"}),(0,c.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"3、投票时需持有完整数量的质押资产凭证：SL 类(流动性质押)、ST 类(代币质押)。"})]})}),(0,c.jsx)(E.A,{isLoading:Z||ee,text:Z?"提交交易...":"确认交易..."})]})})]})}},42038:(e,s,t)=>{"use strict";t.d(s,{C:()=>a});var r=t(97685),a=e=>!!e||(r.oR.error("请先将钱包链接 ".concat("thinkium801")),!1)},77328:(e,s,t)=>{e.exports=t(89836)},86504:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote/vote",function(){return t(31517)}])},86739:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});var r=(0,t(11713).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},99574:(e,s,t)=>{"use strict";t.d(s,{A:()=>n});var r=t(37876);t(14232);var a=t(7446);let n=e=>{var s=e.isLoading,t=e.text;return s?(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(a.A,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,r.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:void 0===t?"Loading":t})]})}):null}}},e=>{var s=s=>e(e.s=s);e.O(0,[2569,2840,9591,636,6593,8792],()=>s(86504)),_N_E=e.O()}]);