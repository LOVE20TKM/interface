try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="bb7275f3-80bc-40a7-9ee4-782f5b482b61",e._sentryDebugIdIdentifier="sentry-dbid-bb7275f3-80bc-40a7-9ee4-782f5b482b61")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2821],{47375:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote/records",function(){return n(36689)}])},36689:function(e,t,n){"use strict";n.r(t);var s=n(11010),i=n(91309),r=n(4586),o=n(97582),a=n(85893),c=n(67294),l=n(42130),d=n(11163),u=n(27245),f=n(41664),g=n.n(f),m=n(93778),x=n(90278),h=n(72260),v=n(73591),y=n(83494),b=n(64777),p=n(42083),j=n(91529),N=BigInt(20);t.default=function(){var e=(0,d.useRouter)(),t=((0,c.useContext)(m.M)||{}).token,n=(0,l.m)().address,f=(0,i._)((0,c.useState)(BigInt(0)),2),I=f[0],w=f[1],B=(0,i._)((0,c.useState)(BigInt(0)),2),_=B[0],S=B[1],E=(0,i._)((0,c.useState)(!0),2),k=E[0],C=E[1],P=(0,i._)((0,c.useState)([]),2),T=P[0],V=P[1],M=(0,i._)((0,c.useState)(0),2),A=M[0],O=M[1],Z=(0,c.useRef)(null),H=(0,c.useMemo)(function(){return e.query.account||n},[e.query.account,n]),L=(0,h.Bk)(),R=L.currentRound,D=L.isPending,q=L.error;(0,c.useEffect)(function(){if(void 0!==R&&R>BigInt(0)){var e=R-N+BigInt(1)>BigInt(0)?R-N+BigInt(1):BigInt(1);S(R),w(e)}},[R]);var F=(0,x.a6)(null==t?void 0:t.address,H,I,_),X=F.votingHistory,z=F.isPending,J=F.error;(0,c.useEffect)(function(){if((null==X?void 0:X.accountActions)&&(null==X?void 0:X.actionInfos)&&I!==BigInt(0)&&_!==BigInt(0)){var e=X.accountActions,t=X.actionInfos,n=new Map;t.forEach(function(e){n.set(e.head.id.toString(),e)});var s=new Map;e.forEach(function(e){var t=e.round.toString(),i=n.get(e.actionId.toString());if(i){var r=e.totalVoteCount>BigInt(0)?Number(e.myVoteCount*BigInt(1e4)/e.totalVoteCount)/100:0;s.has(t)||s.set(t,[]),s.get(t).push({actionInfo:i,votingAction:e,votePercentage:r})}});for(var i=[],o=_;o>=I;o--){var a=o.toString(),c=s.get(a)||[];c.sort(function(e,t){return e.actionInfo.head.id>t.actionInfo.head.id?-1:1}),i.push({round:o,actions:c,hasVoting:c.length>0})}V(function(e){var t=new Set(e.map(function(e){return e.round.toString()})),n=i.filter(function(e){return!t.has(e.round.toString())});return(0,r._)(e).concat((0,r._)(n)).sort(function(e,t){return e.round>t.round?-1:1})})}},[X,I,_]),(0,c.useEffect)(function(){C(I>BigInt(1))},[I]);var K=(0,i._)((0,c.useState)(!1),2),W=K[0],Y=K[1],G=(0,c.useCallback)((0,s._)(function(){return(0,o.Jh)(this,function(e){return z||W?console.log("正在加载中或防抖期间，跳过本次请求"):(Y(!0),I>BigInt(1)?w(I-N>=BigInt(1)?I-N:BigInt(1)):console.log("已经到达最早轮次，不再加载"),setTimeout(function(){Y(!1)},1e3)),[2]})}),[z,W,I]);(0,c.useEffect)(function(){if(Z.current){var e=Z.current,t=/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);/iPad|iPhone|iPod/.test(navigator.userAgent)&&window.MSStream;var n=null,s=null,i=function(){s&&clearTimeout(s),s=setTimeout(function(){var t=e.getBoundingClientRect(),n=window.innerHeight;t.top<=n+150&&k&&!z&&!W&&(console.log("通过滚动事件触发加载"),G())},100)};"IntersectionObserver"in window&&(n=new IntersectionObserver(function(e){e.forEach(function(e){e.isIntersecting&&k&&!z&&!W&&G()})},{root:null,rootMargin:t?"80px":"100px",threshold:[0,.1,.25,.5,.75,1]})).observe(e);var r=document.documentElement||document.body;r.addEventListener("scroll",i,{passive:!0}),r.addEventListener("touchmove",i,{passive:!0}),setTimeout(function(){e.getBoundingClientRect().bottom<=window.innerHeight+80&&k&&!z&&setTimeout(function(){return G()},500)},1e3);var o=setTimeout(function(){k&&!z&&!W&&T.length>0&&(O(function(e){return e+1}),A>=2&&(console.log("检测失败次数过多，强制触发加载"),G(),O(0)))},3e3);return function(){clearTimeout(o),n&&(n.unobserve(e),n.disconnect()),s&&clearTimeout(s),r.removeEventListener("scroll",i),r.removeEventListener("touchmove",i)}}},[G,k,z,W,A,T.length]);var Q=(0,v.S)().handleContractError;return(0,c.useEffect)(function(){q&&Q(q,"dataViewer"),J&&Q(J,"dataViewer")},[q,J,Q]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.Z,{title:"投票历史",showBackButton:!0}),(0,a.jsx)("main",{className:"flex-grow",style:{WebkitOverflowScrolling:"touch",overscrollBehaviorY:"contain",transformStyle:"preserve-3d"},children:t&&H?(0,a.jsxs)("div",{className:"flex flex-col space-y-4 p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)(b.Z,{title:"".concat(H!==n?" 投票记录（".concat(H&&!(H.length<8)?"".concat(H.slice(0,6),"...").concat(H.slice(-4)):H,"）"):"我的投票记录")})," ",R>=BigInt(1)&&(0,a.jsx)(u.z,{variant:"link",className:"text-secondary border-secondary",asChild:!0,children:(0,a.jsx)(g(),{href:"/vote/actions/?symbol=".concat(null==t?void 0:t.symbol),children:"投票中的行动 >>"})})]}),D?(0,a.jsx)(p.Z,{}):0!==T.length||z?(0,a.jsxs)(a.Fragment,{children:[T.map(function(e){return(0,a.jsxs)("div",{className:"border border-gray-100 rounded-lg py-2 px-2 shadow-sm ".concat(e.hasVoting?"bg-white":"bg-gray-50"),children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)("span",{className:"text-greyscale-500 mr-2",children:"轮次:"}),(0,a.jsx)("span",{className:"text-xl font-bold ".concat(e.hasVoting?"text-secondary":"text-gray-400"),children:(0,j.cK)(e.round,t).toString()})]}),e.hasVoting?(0,a.jsx)("div",{className:"space-y-4",children:e.actions.map(function(e){return(0,a.jsxs)("div",{className:"border-l-4 border-secondary/20 pl-4",children:[(0,a.jsxs)("div",{className:"flex items-baseline mb-2",children:[(0,a.jsx)("span",{className:"text-greyscale-500 mr-1",children:"No."}),(0,a.jsx)("span",{className:"text-secondary text-lg font-bold mr-2",children:e.actionInfo.head.id.toString()}),(0,a.jsx)("span",{className:"font-bold text-greyscale-800",children:e.actionInfo.body.title})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-6 text-sm text-greyscale-600",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"mr-1",children:"我的投票:"}),(0,a.jsx)("span",{className:"font-semibold text-secondary",children:(0,j.LH)(e.votingAction.myVoteCount)})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"mr-1",children:"占比:"}),(0,a.jsx)("span",{className:"font-semibold text-primary",children:(0,j.rl)(e.votePercentage)})]})]})]},e.actionInfo.head.id.toString())})}):(0,a.jsx)("div",{className:"text-center text-greyscale-400",children:"该轮次没有投票"})]},e.round.toString())}),(0,a.jsx)("div",{ref:Z,className:"h-24 flex justify-center items-center mt-4 mb-8 px-4",style:{minHeight:"96px",opacity:1,visibility:"visible",transform:"translateZ(0)"},children:z||W?(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,a.jsx)(p.Z,{}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"正在加载更多轮次..."})]}):k?(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-2 cursor-pointer active:scale-95 transition-transform",onClick:function(){console.log("用户点击手动加载"),G()},children:[(0,a.jsx)("span",{className:"text-sm text-gray-500 text-center",children:"下滑自动加载更多轮次"}),(0,a.jsx)("span",{className:"text-xs text-gray-400 text-center",children:"或点击此处手动加载"}),(0,a.jsx)("div",{className:"w-8 h-1 bg-gray-200 rounded opacity-50 mt-2"})]}):T.length>0?(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"已加载所有轮次"}),(0,a.jsx)("div",{className:"w-12 h-0.5 bg-gray-200 rounded opacity-30"})]}):null})]}):(0,a.jsx)("div",{className:"text-center text-greyscale-500 py-8",children:"没有投票记录"})]}):(0,a.jsx)(p.Z,{})})]})}}},function(e){e.O(0,[8501,4463,3494,3591,9419,2888,9774,179],function(){return e(e.s=47375)}),_N_E=e.O()}]);