(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7060],{73148:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote/vote",function(){return s(21171)}])},68655:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});let n=(0,s(31134).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},23432:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});let n=(0,s(31134).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},42083:function(e,t,s){"use strict";var n=s(85893),l=s(23432);t.Z=()=>(0,n.jsx)(l.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})},44576:function(e,t,s){"use strict";var n=s(85893);s(67294);var l=s(23432);t.Z=e=>{let{isLoading:t,text:s="Loading"}=e;return t?(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(l.Z,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,n.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:s})]})}):null}},48105:function(e,t,s){"use strict";s.d(t,{S:function(){return l}});var n=s(86501);let l=e=>!!e||(n.Am.error("请先将钱包链接 ".concat("thinkium801")),!1)},21171:function(e,t,s){"use strict";s.r(t);var n=s(85893),l=s(67294),r=s(11163),i=s(92321),c=s(86501),a=s(27245),d=s(41664),o=s.n(d),u=s(94782),m=s(7080),x=s(92180),h=s(10403),f=s(48105),g=s(91529),v=s(93778),p=s(37436),y=s(42083),j=s(44576);t.default=()=>{let{token:e}=(0,l.useContext)(v.M)||{},[t,s]=(0,l.useState)({}),{address:d,chain:N}=(0,i.m)(),{currentRound:b,isPending:w,error:E}=(0,m.Bk)(),k=(0,r.useRouter)(),{ids:Z}=k.query,[$,_]=(0,l.useState)([]);(0,l.useEffect)(()=>{Z&&_(Z.split(",").map(e=>parseInt(e,10)))},[Z]),(0,l.useEffect)(()=>{if(1===$.length)s({[$[0]]:100});else{let e={},t=Math.floor(100/$.length);$.forEach((s,n)=>{n===$.length-1?e[s]=100-t*($.length-1):e[s]=t}),s(e)}},[$]);let I=(e,n)=>{if(1===$.length)return;let l={...t,[e]:n},r=$.slice(0,-1).reduce((e,t)=>e+(l[t]||0),0);if(r>100){c.Am.error("投票百分比之和不能超过100%");return}l[$[$.length-1]]=100-r,s(l)},{validGovVotes:B,isPending:A,error:P}=(0,x.Ty)(null==e?void 0:e.address,d),{votesNumByAccount:S,isPending:T,error:C}=(0,m.VI)(null==e?void 0:e.address,b,d),L=(null==$?void 0:$.map(e=>BigInt(e)))||[],{actionInfos:M,isPending:z,error:F}=(0,u.fT)(null==e?void 0:e.address,L),{vote:O,isWriting:q,isConfirming:H,isConfirmed:X,writeError:R}=(0,m.rv)(),V=()=>!!(0,f.S)(N)&&(B-S<2n?(c.Am.error("剩余票数不足，不能投票"),!1):100===Object.values(t).reduce((e,t)=>e+t,0)||(c.Am.error("百分比之和必须为100"),!1)),W=async()=>{if(!V())return;let s=$.map(e=>BigInt(e)),n=$.map(e=>BigInt(t[e]||0)*(B-S)/100n);try{await O(null==e?void 0:e.address,s,n)}catch(e){console.error("投票提交失败:",e),c.Am.error("提交失败，请重试")}},{handleContractError:D}=(0,h.S)();return(0,l.useEffect)(()=>{E&&D(E,"vote"),R&&D(R,"vote"),C&&D(C,"vote"),F&&D(F,"submit"),P&&D(P,"stake")},[E,R,F,P,C]),(0,l.useEffect)(()=>{X&&!R&&(c.Am.success("提交成功",{duration:2e3}),setTimeout(()=>{k.push("/vote/actions/?symbol=".concat(null==e?void 0:e.symbol))},2e3))},[X,R]),(0,l.useEffect)(()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.Z,{title:"投票"}),(0,n.jsx)("main",{className:"flex-grow",children:!e||z?(0,n.jsx)(y.Z,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"stats w-full",children:(0,n.jsxs)("div",{className:"stat place-items-center",children:[(0,n.jsx)("div",{className:"stat-title text-sm",children:"我的剩余票数"}),(0,n.jsx)("div",{className:"stat-value text-secondary mt-2",children:A||T?(0,n.jsx)(y.Z,{}):(0,g.LH)(B-S||BigInt(0))}),(0,n.jsxs)("div",{className:"stat-desc text-sm mt-2",children:["如需更多票数，请先"," ",(0,n.jsx)(o(),{href:"/gov/stakelp/?symbol=".concat(null==e?void 0:e.symbol),className:"text-secondary",children:"获取治理票"})]})]})}),(0,n.jsxs)("div",{className:"px-4",children:[(0,n.jsx)("div",{className:"space-y-4",children:null==M?void 0:M.map((s,l)=>{let r=l===M.length-1,i=100-$.slice(0,-1).reduce((e,s)=>e+(t[s]||0),0);return(0,n.jsxs)("div",{className:"p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,n.jsxs)(o(),{href:"/action/".concat(s.head.id,"?type=vote&symbol=").concat(e.symbol),className:"flex-grow",children:[(0,n.jsxs)("div",{className:"font-semibold mb-2",children:[(0,n.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No.".concat(s.head.id)}),(0,n.jsx)("span",{className:"text-greyscale-900",children:"".concat(s.body.action)})]}),(0,n.jsx)("p",{className:"text-greyscale-500",children:s.body.consensus})]},s.head.id),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"number",min:r?i:1,max:"100",value:r?i:t[s.head.id]||"",onChange:e=>I(s.head.id,Number(e.target.value)),className:"p-2 border rounded w-16",disabled:1===$.length||r,placeholder:""}),"%"]})]},s.head.id)})}),(0,n.jsx)("div",{className:"flex justify-center mt-4",children:(0,n.jsx)(a.z,{className:"w-1/2 focus:outline-none focus:ring-0",onFocus:e=>e.currentTarget.blur(),onClick:W,disabled:q||H||X,children:q?"提交中...":H?"确认中...":X?"已提交":"提交投票"})})]}),(0,n.jsx)("div",{className:"flex flex-col w-full p-4 mt-4",children:(0,n.jsxs)("div",{className:"bg-gray-100 text-greyscale-500 rounded-lg p-4 mb-8 text-sm",children:[(0,n.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-1",children:"注意："}),(0,n.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"1、每轮最大可投票数，等于您的治理票数；"}),(0,n.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"2、APP帮您自动计算并提交100%票数；"}),(0,n.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"3、投票时需持有完整数量的质押资产凭证：SL 类(流动性质押)、ST 类(代币质押)。"})]})}),(0,n.jsx)(j.Z,{isLoading:q||H,text:q?"提交交易...":"确认交易..."})]})})]})}},9008:function(e,t,s){e.exports=s(23867)},21803:function(e,t,s){"use strict";function n(e,t){let[s,n="0"]=e.split("."),l=s.startsWith("-");if(l&&(s=s.slice(1)),n=n.replace(/(0+)$/,""),0===t)1===Math.round(Number(`.${n}`))&&(s=`${BigInt(s)+1n}`),n="";else if(n.length>t){let[e,l,r]=[n.slice(0,t-1),n.slice(t-1,t),n.slice(t)],i=Math.round(Number(`${l}.${r}`));(n=i>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${i}`).length>t&&(n=n.slice(1),s=`${BigInt(s)+1n}`),n=n.slice(0,t)}else n=n.padEnd(t,"0");return BigInt(`${l?"-":""}${s}${n}`)}s.d(t,{v:function(){return n}})}},function(e){e.O(0,[2083,4782,4323,2888,9774,179],function(){return e(e.s=73148)}),_N_E=e.O()}]);