try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="00d257ad-7500-4658-8e06-e01b1bd33c92",e._sentryDebugIdIdentifier="sentry-dbid-00d257ad-7500-4658-8e06-e01b1bd33c92")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7060],{73148:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote/vote",function(){return n(21171)}])},42083:function(e,t,n){"use strict";var s=n(85893),r=n(23432);t.Z=function(){return(0,s.jsx)(r.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},21171:function(e,t,n){"use strict";n.r(t);var s=n(11010),r=n(75766),i=n(72253),a=n(14932),c=n(91309),l=n(97582),d=n(85893),o=n(67294),u=n(11163),f=n(42130),m=n(86501),h=n(27245),x=n(41664),g=n.n(x),v=n(7080),b=n(92180),y=n(93950),p=n(73591),j=n(91529),N=n(93778),_=n(83494),w=n(42083),E=n(44576);t.default=function(){var e,t=((0,o.useContext)(N.M)||{}).token,n=(0,c._)((0,o.useState)({}),2),x=n[0],I=n[1],k=(0,f.m)().address,T=(0,v.Bk)(),P=T.currentRound,B=(T.isPending,T.error),C=(0,u.useRouter)(),S=C.query.ids,A=(0,c._)((0,o.useState)([]),2),Z=A[0],D=A[1];(0,o.useEffect)(function(){S&&D(S.split(",").map(function(e){return parseInt(e,10)}))},[S]),(0,o.useEffect)(function(){if(Z.length>0&&0===Object.keys(x).length){if(1===Z.length)I((0,r._)({},Z[0],100));else{var e={},t=Math.floor(100/Z.length);Z.forEach(function(n,s){s===Z.length-1?e[n]=100-t*(Z.length-1):e[n]=t}),I(e)}}},[Z,x]);var L=function(e,t){if(1===Z.length){I((0,r._)({},e,t));return}var n=(0,a._)((0,i._)({},x),(0,r._)({},e,t)),s=Z.slice(0,-1).reduce(function(e,t){return e+(n[t]||0)},0);if(s>100){m.Am.error("投票百分比之和不能超过100%");return}n[Z[Z.length-1]]=100-s,I(n)},O=(0,b.Ty)(null==t?void 0:t.address,k),F=O.validGovVotes,M=O.isPending,H=O.error,R=(0,v.VI)(null==t?void 0:t.address,P,k),V=R.votesNumByAccount,X=R.isPending,q=R.error,z=(null==Z?void 0:Z.map(function(e){return BigInt(e)}))||[],G=(0,y.fT)(null==t?void 0:t.address,z),J=G.actionInfos,K=G.isPending,Q=G.error,U=(0,v.rv)(),W=U.vote,Y=U.isPending,$=U.isConfirming,ee=U.isConfirmed,et=U.writeError,en=function(){if(F-V<BigInt(2))return m.Am.error("剩余票数不足，不能投票"),!1;var e=Object.values(x).reduce(function(e,t){return e+t},0);return!(Z.length>1)||100===e||(m.Am.error("百分比之和必须为100"),!1)},es=(e=(0,s._)(function(){var e,n;return(0,l.Jh)(this,function(s){switch(s.label){case 0:if(!en())return[2];e=Z.map(function(e){return BigInt(e)}),n=Z.map(function(e){return BigInt(x[e]||0)*(F-V)/BigInt(100)}),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,W(null==t?void 0:t.address,e,n)];case 2:return s.sent(),[3,4];case 3:return s.sent(),m.Am.error("提交失败，请重试"),[3,4];case 4:return[2]}})}),function(){return e.apply(this,arguments)}),er=(0,p.S)().handleContractError;return(0,o.useEffect)(function(){B&&er(B,"vote"),et&&er(et,"vote"),q&&er(q,"vote"),Q&&er(Q,"submit"),H&&er(H,"stake")},[B,et,Q,H,q]),(0,o.useEffect)(function(){ee&&!et&&(m.Am.success("提交成功",{duration:2e3}),setTimeout(function(){C.push("/vote/actions/?symbol=".concat(null==t?void 0:t.symbol))},2e3))},[ee,et]),(0,o.useEffect)(function(){document.activeElement instanceof HTMLElement&&document.activeElement.blur()},[]),(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(_.Z,{title:"投票"}),(0,d.jsx)("main",{className:"flex-grow",children:!t||K?(0,d.jsx)(w.Z,{}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"stats w-full",children:(0,d.jsxs)("div",{className:"stat place-items-center",children:[(0,d.jsx)("div",{className:"stat-title text-sm",children:"我的剩余票数"}),(0,d.jsx)("div",{className:"stat-value text-secondary mt-2",children:M||X?(0,d.jsx)(w.Z,{}):(0,j.LH)(F-V||BigInt(0))}),(0,d.jsxs)("div",{className:"stat-desc text-sm mt-2",children:["如需更多票数，请先"," ",(0,d.jsx)(g(),{href:"/gov/stakelp/?symbol=".concat(null==t?void 0:t.symbol),className:"text-secondary",children:"获取治理票"})]})]})}),(0,d.jsxs)("div",{className:"px-4",children:[(0,d.jsx)("div",{className:"space-y-4",children:null==J?void 0:J.map(function(e,n){var s=n===J.length-1,r=Z.slice(0,-1).reduce(function(e,t){return e+(x[t]||0)},0);return(0,d.jsxs)("div",{className:"p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,d.jsx)(g(),{href:"/action/detail?id=".concat(e.head.id,"&type=vote&symbol=").concat(t.symbol),className:"flex-grow",children:(0,d.jsxs)("div",{className:"font-semibold mb-2",children:[(0,d.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No.".concat(e.head.id)}),(0,d.jsx)("span",{className:"text-greyscale-900",children:"".concat(e.body.title)})]})},e.head.id),(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("input",{type:"number",min:"1",max:"100",value:1===Z.length?x[e.head.id.toString()]||100:s?100-r:x[e.head.id.toString()]||"",onChange:function(t){return L(e.head.id.toString(),Number(t.target.value))},className:"p-2 border rounded w-16",disabled:Z.length>1&&s,placeholder:""}),"%"]})]},e.head.id)})}),(0,d.jsx)("div",{className:"flex justify-center mt-4",children:(0,d.jsx)(h.z,{className:"w-1/2 focus:outline-none focus:ring-0",onFocus:function(e){return e.currentTarget.blur()},onClick:es,disabled:Y||$||ee,children:Y?"提交中...":$?"确认中...":ee?"已提交":"提交投票"})})]}),(0,d.jsx)("div",{className:"flex flex-col w-full p-4 mt-4",children:(0,d.jsxs)("div",{className:"bg-gray-100 text-greyscale-500 rounded-lg p-4 mb-8 text-sm",children:[(0,d.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-1",children:"注意："}),(0,d.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"1、每轮最大可投票数，等于您的治理票数；"}),(0,d.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"2、APP帮您自动计算并提交100%票数；"}),(0,d.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"3、投票时需持有完整数量的质押资产凭证：SL 类(流动性质押)、ST 类(代币质押)。"})]})}),(0,d.jsx)(E.Z,{isLoading:Y||$,text:Y?"提交交易...":"确认交易..."})]})})]})}}},function(e){e.O(0,[8239,3615,3494,3591,3950,2180,2888,9774,179],function(){return e(e.s=73148)}),_N_E=e.O()}]);