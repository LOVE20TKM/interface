try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="6f204603-1285-4471-88e4-e01681733ce8",e._sentryDebugIdIdentifier="sentry-dbid-6f204603-1285-4471-88e4-e01681733ce8")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5679],{48717:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote/history",function(){return n(79664)}])},64777:function(e,t,n){"use strict";var s=n(85893);t.Z=function(e){var t=e.title;return(0,s.jsx)("div",{className:"flex justify-between items-center",children:(0,s.jsx)("h1",{className:"text-lg font-bold",children:t})})}},42083:function(e,t,n){"use strict";var s=n(85893),i=n(23432);t.Z=function(){return(0,s.jsx)(i.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},79664:function(e,t,n){"use strict";n.r(t);var s=n(11010),i=n(91309),r=n(4586),o=n(97582),a=n(85893),c=n(67294),l=n(42130),d=n(11163),u=n(93778),f=n(93950),m=n(7080),x=n(73591),g=n(83494),h=n(64777),v=n(42083),p=n(91529),y=BigInt(20);t.default=function(){var e=(0,d.useRouter)(),t=((0,c.useContext)(u.M)||{}).token,n=(0,l.m)().address,j=(0,i._)((0,c.useState)(BigInt(0)),2),b=j[0],N=j[1],w=(0,i._)((0,c.useState)(BigInt(0)),2),I=w[0],_=w[1],B=(0,i._)((0,c.useState)(!0),2),S=B[0],E=B[1],C=(0,i._)((0,c.useState)([]),2),k=C[0],P=C[1],T=(0,i._)((0,c.useState)(0),2),V=T[0],Z=T[1],A=(0,c.useRef)(null),M=(0,c.useMemo)(function(){return e.query.account||n},[e.query.account,n]),H=(0,m.Bk)(),L=H.currentRound,O=H.isPending,R=H.error;(0,c.useEffect)(function(){if(void 0!==L&&L>BigInt(0)){var e=L-y+BigInt(1)>BigInt(0)?L-y+BigInt(1):BigInt(1);_(L),N(e)}},[L]);var D=(0,f.a6)(null==t?void 0:t.address,M,b,I),q=D.votingHistory,F=D.isPending,X=D.error;(0,c.useEffect)(function(){if((null==q?void 0:q.accountActions)&&(null==q?void 0:q.actionInfos)&&b!==BigInt(0)&&I!==BigInt(0)){var e=q.accountActions,t=q.actionInfos,n=new Map;t.forEach(function(e){n.set(e.head.id.toString(),e)});var s=new Map;e.forEach(function(e){var t=e.round.toString(),i=n.get(e.actionId.toString());if(i){var r=e.totalVoteCount>BigInt(0)?Number(e.myVoteCount*BigInt(1e4)/e.totalVoteCount)/100:0;s.has(t)||s.set(t,[]),s.get(t).push({actionInfo:i,votingAction:e,votePercentage:r})}});for(var i=[],o=I;o>=b;o--){var a=o.toString(),c=s.get(a)||[];c.sort(function(e,t){return e.actionInfo.head.id>t.actionInfo.head.id?-1:1}),i.push({round:o,actions:c,hasVoting:c.length>0})}P(function(e){var t=new Set(e.map(function(e){return e.round.toString()})),n=i.filter(function(e){return!t.has(e.round.toString())});return(0,r._)(e).concat((0,r._)(n)).sort(function(e,t){return e.round>t.round?-1:1})})}},[q,b,I]),(0,c.useEffect)(function(){E(b>BigInt(1))},[b]);var J=(0,i._)((0,c.useState)(!1),2),K=J[0],W=J[1],Y=(0,c.useCallback)((0,s._)(function(){return(0,o.Jh)(this,function(e){return F||K||(W(!0),b>BigInt(1)&&N(b-y>=BigInt(1)?b-y:BigInt(1)),setTimeout(function(){W(!1)},1e3)),[2]})}),[F,K,b]);(0,c.useEffect)(function(){if(A.current){var e=A.current,t=/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);/iPad|iPhone|iPod/.test(navigator.userAgent)&&window.MSStream;var n=null,s=null,i=function(){s&&clearTimeout(s),s=setTimeout(function(){var t=e.getBoundingClientRect(),n=window.innerHeight;t.top<=n+150&&S&&!F&&!K&&Y()},100)};"IntersectionObserver"in window&&(n=new IntersectionObserver(function(e){e.forEach(function(e){e.isIntersecting&&S&&!F&&!K&&Y()})},{root:null,rootMargin:t?"80px":"100px",threshold:[0,.1,.25,.5,.75,1]})).observe(e);var r=document.documentElement||document.body;r.addEventListener("scroll",i,{passive:!0}),r.addEventListener("touchmove",i,{passive:!0}),setTimeout(function(){e.getBoundingClientRect().bottom<=window.innerHeight+80&&S&&!F&&setTimeout(function(){return Y()},500)},1e3);var o=setTimeout(function(){S&&!F&&!K&&k.length>0&&(Z(function(e){return e+1}),V>=2&&(Y(),Z(0)))},3e3);return function(){clearTimeout(o),n&&(n.unobserve(e),n.disconnect()),s&&clearTimeout(s),r.removeEventListener("scroll",i),r.removeEventListener("touchmove",i)}}},[Y,S,F,K,V,k.length]);var z=(0,x.S)().handleContractError;return(0,c.useEffect)(function(){R&&z(R,"dataViewer"),X&&z(X,"dataViewer")},[R,X,z]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.Z,{title:"投票历史",showBackButton:!0}),(0,a.jsx)("main",{className:"flex-grow",style:{WebkitOverflowScrolling:"touch",overscrollBehaviorY:"contain",transformStyle:"preserve-3d"},children:t&&M?(0,a.jsxs)("div",{className:"flex flex-col space-y-2 p-4",children:[(0,a.jsx)(h.Z,{title:"".concat(M!==n?" 投票记录（".concat(M&&!(M.length<8)?"".concat(M.slice(0,6),"...").concat(M.slice(-4)):M,"）"):"我的投票记录")}),O?(0,a.jsx)(v.Z,{}):0!==k.length||F?(0,a.jsxs)(a.Fragment,{children:[k.map(function(e){return(0,a.jsxs)("div",{className:"border border-gray-100 rounded-lg py-2 px-4 shadow-sm ".concat(e.hasVoting?"bg-white":"bg-gray-50"),children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)("span",{className:"text-greyscale-500 mr-2",children:"轮次:"}),(0,a.jsx)("span",{className:"text-xl font-bold ".concat(e.hasVoting?"text-secondary":"text-gray-400"),children:(0,p.cK)(e.round,t).toString()})]}),e.hasVoting?(0,a.jsx)("div",{className:"space-y-4",children:e.actions.map(function(e){return(0,a.jsxs)("div",{className:"border-l-4 border-secondary/20 pl-4",children:[(0,a.jsxs)("div",{className:"flex items-baseline mb-2",children:[(0,a.jsx)("span",{className:"text-greyscale-500 mr-1",children:"No."}),(0,a.jsx)("span",{className:"text-secondary text-lg font-bold mr-2",children:e.actionInfo.head.id.toString()}),(0,a.jsx)("span",{className:"font-bold text-greyscale-800",children:e.actionInfo.body.title})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-6 text-sm text-greyscale-600",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"mr-1",children:"投票数:"}),(0,a.jsx)("span",{className:"font-semibold text-secondary",children:(0,p.LH)(e.votingAction.myVoteCount)})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"mr-1",children:"占比:"}),(0,a.jsx)("span",{className:"font-semibold text-primary",children:(0,p.rl)(e.votePercentage)}),(0,a.jsx)("span",{className:"ml-2",children:"(总投票:"}),(0,a.jsxs)("span",{className:"font-semibold",children:[(0,p.LH)(e.votingAction.totalVoteCount),")"]})]})]})]},e.actionInfo.head.id.toString())})}):(0,a.jsx)("div",{className:"text-center text-greyscale-400",children:"该轮次没有投票"})]},e.round.toString())}),(0,a.jsx)("div",{ref:A,className:"h-24 flex justify-center items-center mt-4 mb-8 px-4",style:{minHeight:"96px",opacity:1,visibility:"visible",transform:"translateZ(0)"},children:F||K?(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,a.jsx)(v.Z,{}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"正在加载更多轮次..."})]}):S?(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-2 cursor-pointer active:scale-95 transition-transform",onClick:function(){Y()},children:[(0,a.jsx)("span",{className:"text-sm text-gray-500 text-center",children:"下滑自动加载更多轮次"}),(0,a.jsx)("span",{className:"text-xs text-gray-400 text-center",children:"或点击此处手动加载"}),(0,a.jsx)("div",{className:"w-8 h-1 bg-gray-200 rounded opacity-50 mt-2"})]}):k.length>0?(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"已加载所有轮次"}),(0,a.jsx)("div",{className:"w-12 h-0.5 bg-gray-200 rounded opacity-30"})]}):null})]}):(0,a.jsx)("div",{className:"text-center text-greyscale-500 py-8",children:"没有投票记录"})]}):(0,a.jsx)(v.Z,{})})]})}}},function(e){e.O(0,[8239,5115,3494,3591,3950,2888,9774,179],function(){return e(e.s=48717)}),_N_E=e.O()}]);