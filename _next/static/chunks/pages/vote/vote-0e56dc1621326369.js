(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5475],{12293:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});var r=t(37876),n=t(7446);let a=()=>(0,r.jsx)(n.A,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})},18449:(e,s,t)=>{"use strict";t.d(s,{X:()=>a});var r=t(76200);class n extends r.C{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function a(e,s){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new n({value:e});let[t,r="0"]=e.split("."),a=t.startsWith("-");if(a&&(t=t.slice(1)),r=r.replace(/(0+)$/,""),0===s)1===Math.round(Number(`.${r}`))&&(t=`${BigInt(t)+1n}`),r="";else if(r.length>s){let[e,n,a]=[r.slice(0,s-1),r.slice(s-1,s),r.slice(s)],l=Math.round(Number(`${n}.${a}`));(r=l>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${l}`).length>s&&(r=r.slice(1),t=`${BigInt(t)+1n}`),r=r.slice(0,s)}else r=r.padEnd(s,"0");return BigInt(`${a?"-":""}${t}${r}`)}},31517:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>$});var r=t(16927),n=t(3576),a=t(62701),l=t(40854),i=t(4902),c=t(37876),d=t(14232),o=t(89099),u=t(8047),m=t(97685),h=t(6960),x=t(48230),v=t.n(x),f=t(98684),g=t(19591),p=t(52372),N=t(20451),b=t(42038),j=t(20442),y=t(83416),w=t(60154),E=t(12293),_=t(99574);let $=()=>{var e=((0,d.useContext)(y.N)||{}).token,s=(0,l._)((0,d.useState)({}),2),t=s[0],x=s[1],$=(0,u.F)(),I=$.address,C=$.chain,B=(0,f.vC)(),P=B.currentRound,k=(B.isPending,B.error),A=(0,o.useRouter)(),R=A.query.ids,T=(0,l._)((0,d.useState)([]),2),F=T[0],S=T[1];(0,d.useEffect)(()=>{R&&S(R.split(",").map(e=>parseInt(e,10)))},[R]),(0,d.useEffect)(()=>{if(1===F.length)x({[F[0]]:100});else{var e={},s=Math.floor(100/F.length);F.forEach((t,r)=>{r===F.length-1?e[t]=100-s*(F.length-1):e[t]=s}),x(e)}},[F]);var M=(e,s)=>{if(1!==F.length){var r=(0,a._)((0,n._)({},t),{[e]:s}),l=F.slice(0,-1).reduce((e,s)=>e+(r[s]||0),0);if(l>100)return void m.oR.error("投票百分比之和不能超过100%");r[F[F.length-1]]=100-l,x(r)}},L=(0,g.Fd)(null==e?void 0:e.address,I),O=L.validGovVotes,X=L.isPending,H=L.error,q=(0,f.Pb)(null==e?void 0:e.address,P,I),D=q.votesNumByAccount,G=q.isPending,J=q.error,U=(null==F?void 0:F.map(e=>BigInt(e)))||[],V=(0,p.ui)(null==e?void 0:e.address,U),W=V.actionInfos,Y=V.isPending,z=V.error,K=(0,f.eU)(),Q=K.vote,Z=K.isPending,ee=K.isConfirming,es=K.isConfirmed,et=K.writeError,er=()=>!!(0,b.C)(C)&&(O-D<2n?(m.oR.error("剩余票数不足，不能投票"),!1):100===Object.values(t).reduce((e,s)=>e+s,0)||(m.oR.error("百分比之和必须为100"),!1)),en=function(){var s=(0,r._)(function(){var s,r;return(0,i.YH)(this,function(n){switch(n.label){case 0:if(!er())return[2];s=F.map(e=>BigInt(e)),r=F.map(e=>BigInt(t[e]||0)*(O-D)/100n),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,Q(null==e?void 0:e.address,s,r)];case 2:return n.sent(),[3,4];case 3:return console.error("投票提交失败:",n.sent()),m.oR.error("提交失败，请重试"),[3,4];case 4:return[2]}})});return function(){return s.apply(this,arguments)}}(),ea=(0,N.g)().handleContractError;return(0,d.useEffect)(()=>{k&&ea(k,"vote"),et&&ea(et,"vote"),J&&ea(J,"vote"),z&&ea(z,"submit"),H&&ea(H,"stake")},[k,et,z,H,J]),(0,d.useEffect)(()=>{es&&!et&&(m.oR.success("提交成功",{duration:2e3}),setTimeout(()=>{A.push("/vote/actions/?symbol=".concat(null==e?void 0:e.symbol))},2e3))},[es,et]),(0,d.useEffect)(()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()},[]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(w.A,{title:"投票"}),(0,c.jsx)("main",{className:"flex-grow",children:!e||Y?(0,c.jsx)(E.A,{}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"stats w-full",children:(0,c.jsxs)("div",{className:"stat place-items-center",children:[(0,c.jsx)("div",{className:"stat-title text-sm",children:"我的剩余票数"}),(0,c.jsx)("div",{className:"stat-value text-secondary mt-2",children:X||G?(0,c.jsx)(E.A,{}):(0,j.NJ)(O-D||BigInt(0))}),(0,c.jsxs)("div",{className:"stat-desc text-sm mt-2",children:["如需更多票数，请先"," ",(0,c.jsx)(v(),{href:"/gov/stakelp/?symbol=".concat(null==e?void 0:e.symbol),className:"text-secondary",children:"获取治理票"})]})]})}),(0,c.jsxs)("div",{className:"px-4",children:[(0,c.jsx)("div",{className:"space-y-4",children:null==W?void 0:W.map((s,r)=>{var n=r===W.length-1,a=100-F.slice(0,-1).reduce((e,s)=>e+(t[s]||0),0);return(0,c.jsxs)("div",{className:"p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,c.jsx)(v(),{href:"/action/detail?id=".concat(s.head.id,"&type=vote&symbol=").concat(e.symbol),className:"flex-grow",children:(0,c.jsxs)("div",{className:"font-semibold mb-2",children:[(0,c.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No.".concat(s.head.id)}),(0,c.jsx)("span",{className:"text-greyscale-900",children:"".concat(s.body.title)})]})},s.head.id),(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("input",{type:"number",min:n?a:1,max:"100",value:n?a:t[s.head.id]||"",onChange:e=>M(s.head.id,Number(e.target.value)),className:"p-2 border rounded w-16",disabled:1===F.length||n,placeholder:""}),"%"]})]},s.head.id)})}),(0,c.jsx)("div",{className:"flex justify-center mt-4",children:(0,c.jsx)(h.$,{className:"w-1/2 focus:outline-none focus:ring-0",onFocus:e=>e.currentTarget.blur(),onClick:en,disabled:Z||ee||es,children:Z?"提交中...":ee?"确认中...":es?"已提交":"提交投票"})})]}),(0,c.jsx)("div",{className:"flex flex-col w-full p-4 mt-4",children:(0,c.jsxs)("div",{className:"bg-gray-100 text-greyscale-500 rounded-lg p-4 mb-8 text-sm",children:[(0,c.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-1",children:"注意："}),(0,c.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"1、每轮最大可投票数，等于您的治理票数；"}),(0,c.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"2、APP帮您自动计算并提交100%票数；"}),(0,c.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"3、投票时需持有完整数量的质押资产凭证：SL 类(流动性质押)、ST 类(代币质押)。"})]})}),(0,c.jsx)(_.A,{isLoading:Z||ee,text:Z?"提交交易...":"确认交易..."})]})})]})}},86504:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote/vote",function(){return t(31517)}])}},e=>{var s=s=>e(e.s=s);e.O(0,[3308,7657,8230,154,3096,9513,636,6593,8792],()=>s(86504)),_N_E=e.O()}]);