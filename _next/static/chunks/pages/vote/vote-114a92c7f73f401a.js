(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5475],{12293:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(37876),n=s(7446);let r=()=>(0,a.jsx)(n.A,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})},18449:(e,t,s)=>{"use strict";s.d(t,{X:()=>r});var a=s(76200);class n extends a.C{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function r(e,t){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new n({value:e});let[s,a="0"]=e.split("."),r=s.startsWith("-");if(r&&(s=s.slice(1)),a=a.replace(/(0+)$/,""),0===t)1===Math.round(Number(`.${a}`))&&(s=`${BigInt(s)+1n}`),a="";else if(a.length>t){let[e,n,r]=[a.slice(0,t-1),a.slice(t-1,t),a.slice(t)],c=Math.round(Number(`${n}.${r}`));(a=c>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${c}`).length>t&&(a=a.slice(1),s=`${BigInt(s)+1n}`),a=a.slice(0,t)}else a=a.padEnd(t,"0");return BigInt(`${r?"-":""}${s}${a}`)}},31517:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>_});var a=s(16927),n=s(3576),r=s(62701),c=s(40854),l=s(4902),i=s(37876),d=s(14232),o=s(89099),u=s(8047),m=s(97685),h=s(6960),x=s(48230),v=s.n(x),f=s(98684),g=s(19591),p=s(52372),b=s(20451),N=s(42038),j=s(20442),y=s(83416),w=s(60154),E=s(12293),$=s(99574);let _=()=>{var e=((0,d.useContext)(y.N)||{}).token,t=(0,c._)((0,d.useState)({}),2),s=t[0],x=t[1],_=(0,u.F)(),C=_.address,I=_.chain,P=(0,f.vC)(),B=P.currentRound,T=(P.isPending,P.error),k=(0,o.useRouter)(),A=k.query.ids,R=(0,c._)((0,d.useState)([]),2),F=R[0],S=R[1];(0,d.useEffect)(()=>{A&&S(A.split(",").map(e=>parseInt(e,10)))},[A]),(0,d.useEffect)(()=>{if(1===F.length)x({[F[0]]:100});else{var e={},t=Math.floor(100/F.length);F.forEach((s,a)=>{a===F.length-1?e[s]=100-t*(F.length-1):e[s]=t}),x(e)}},[F]);var M=(e,t)=>{if(1!==F.length){var a=(0,r._)((0,n._)({},s),{[e]:t}),c=F.slice(0,-1).reduce((e,t)=>e+(a[t]||0),0);if(c>100)return void m.oR.error("投票百分比之和不能超过100%");a[F[F.length-1]]=100-c,x(a)}},q=(0,g.Fd)(null==e?void 0:e.address,C),L=q.validGovVotes,O=q.isPending,X=q.error,H=(0,f.Pb)(null==e?void 0:e.address,B,C),J=H.votesNumByAccount,D=H.isPending,G=H.error,U=(null==F?void 0:F.map(e=>BigInt(e)))||[],V=(0,p.ui)(null==e?void 0:e.address,U),W=V.actionInfos,Y=V.isPending,z=V.error,K=(0,f.eU)(),Q=K.vote,Z=K.isPending,ee=K.isConfirming,et=K.isConfirmed,es=K.writeError,ea=()=>!!(0,N.C)(I)&&(L-J<2n?(m.oR.error("剩余票数不足，不能投票"),!1):100===Object.values(s).reduce((e,t)=>e+t,0)||(m.oR.error("百分比之和必须为100"),!1)),en=function(){var t=(0,a._)(function(){var t,a;return(0,l.YH)(this,function(n){switch(n.label){case 0:if(!ea())return[2];t=F.map(e=>BigInt(e)),a=F.map(e=>BigInt(s[e]||0)*(L-J)/100n),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,Q(null==e?void 0:e.address,t,a)];case 2:return n.sent(),[3,4];case 3:return console.error("投票提交失败:",n.sent()),m.oR.error("提交失败，请重试"),[3,4];case 4:return[2]}})});return function(){return t.apply(this,arguments)}}(),er=(0,b.g)().handleContractError;return(0,d.useEffect)(()=>{T&&er(T,"vote"),es&&er(es,"vote"),G&&er(G,"vote"),z&&er(z,"submit"),X&&er(X,"stake")},[T,es,z,X,G]),(0,d.useEffect)(()=>{et&&!es&&(m.oR.success("提交成功",{duration:2e3}),setTimeout(()=>{k.push("/vote/actions/?symbol=".concat(null==e?void 0:e.symbol))},2e3))},[et,es]),(0,d.useEffect)(()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()},[]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(w.A,{title:"投票"}),(0,i.jsx)("main",{className:"flex-grow",children:!e||Y?(0,i.jsx)(E.A,{}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"stats w-full",children:(0,i.jsxs)("div",{className:"stat place-items-center",children:[(0,i.jsx)("div",{className:"stat-title text-sm",children:"我的剩余票数"}),(0,i.jsx)("div",{className:"stat-value text-secondary mt-2",children:O||D?(0,i.jsx)(E.A,{}):(0,j.NJ)(L-J||BigInt(0))}),(0,i.jsxs)("div",{className:"stat-desc text-sm mt-2",children:["如需更多票数，请先"," ",(0,i.jsx)(v(),{href:"/gov/stakelp/?symbol=".concat(null==e?void 0:e.symbol),className:"text-secondary",children:"获取治理票"})]})]})}),(0,i.jsxs)("div",{className:"px-4",children:[(0,i.jsx)("div",{className:"space-y-4",children:null==W?void 0:W.map((t,a)=>{var n=a===W.length-1,r=100-F.slice(0,-1).reduce((e,t)=>e+(s[t]||0),0);return(0,i.jsxs)("div",{className:"p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,i.jsx)(v(),{href:"/action/detail?id=".concat(t.head.id,"&type=vote&symbol=").concat(e.symbol),className:"flex-grow",children:(0,i.jsxs)("div",{className:"font-semibold mb-2",children:[(0,i.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No.".concat(t.head.id)}),(0,i.jsx)("span",{className:"text-greyscale-900",children:"".concat(t.body.title)})]})},t.head.id),(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("input",{type:"number",min:n?r:1,max:"100",value:n?r:s[t.head.id]||"",onChange:e=>M(t.head.id,Number(e.target.value)),className:"p-2 border rounded w-16",disabled:1===F.length||n,placeholder:""}),"%"]})]},t.head.id)})}),(0,i.jsx)("div",{className:"flex justify-center mt-4",children:(0,i.jsx)(h.$,{className:"w-1/2 focus:outline-none focus:ring-0",onFocus:e=>e.currentTarget.blur(),onClick:en,disabled:Z||ee||et,children:Z?"提交中...":ee?"确认中...":et?"已提交":"提交投票"})})]}),(0,i.jsx)("div",{className:"flex flex-col w-full p-4 mt-4",children:(0,i.jsxs)("div",{className:"bg-gray-100 text-greyscale-500 rounded-lg p-4 mb-8 text-sm",children:[(0,i.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-1",children:"注意："}),(0,i.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"1、每轮最大可投票数，等于您的治理票数；"}),(0,i.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"2、APP帮您自动计算并提交100%票数；"}),(0,i.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"3、投票时需持有完整数量的质押资产凭证：SL 类(流动性质押)、ST 类(代币质押)。"})]})}),(0,i.jsx)($.A,{isLoading:Z||ee,text:Z?"提交交易...":"确认交易..."})]})})]})}},69167:(e,t,s)=>{"use strict";s.d(t,{v:()=>d});var a=s(57616),n=s(94833),r=s(14237),c=s(66655),l=s(8481),i=s(57771);async function d(e,t){let{abi:s,address:d,args:o,dataSuffix:u,functionName:m,...h}=t,x=h.account?(0,a.J)(h.account):e.account,v=(0,r.p)({abi:s,args:o,functionName:m});try{let{data:a}=await (0,l.T)(e,i.T,"call")({batch:!1,data:`${v}${u?u.replace("0x",""):""}`,to:d,...h,account:x}),r=(0,n.e)({abi:s,args:o,functionName:m,data:a||"0x"}),c=s.filter(e=>"name"in e&&e.name===t.functionName);return{result:r,request:{abi:c,address:d,args:o,dataSuffix:u,functionName:m,...h,account:x}}}catch(e){throw(0,c.j)(e,{abi:s,address:d,args:o,docsPath:"/docs/contract/simulateContract",functionName:m,sender:x?.address})}}},81675:(e,t,s)=>{"use strict";s.d(t,{v:()=>c});var a=s(69167),n=s(629),r=s(90203);async function c(e,t){let s,{abi:c,chainId:l,connector:i,...d}=t;s=t.account?t.account:(await (0,r.r)(e,{chainId:l,connector:i})).account;let o=e.getClient({chainId:l}),u=(0,n.T)(o,a.v,"simulateContract"),{result:m,request:h}=await u({...d,abi:c,account:s});return{chainId:o.chain.id,result:m,request:{...h,chainId:l}}}},86504:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote/vote",function(){return s(31517)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[3308,9374,8230,154,3096,9513,636,6593,8792],()=>t(86504)),_N_E=e.O()}]);