try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="726fcefe-f3f0-4429-9e47-2ca74917c504",e._sentryDebugIdIdentifier="sentry-dbid-726fcefe-f3f0-4429-9e47-2ca74917c504")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7690],{81130:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/verify/action",function(){return s(78552)}])},20725:function(e,t,s){"use strict";var n=s(85893),r=s(67294),a=s(93566),i=s(73591),c=s(93778),l=s(91529),o=s(72107),d=s(31084),u=s(44746),x=s(27460),m=s(42083);t.Z=function(e){var t=e.actionId,s=e.round,f=e.showSubmitter,h=(e.showVerifyHistory,e.onActionInfo),g=((0,r.useContext)(c.M)||{}).token,v=(0,a.dI)(null==g?void 0:g.address,t),b=v.actionInfo,j=v.isPending,p=v.error;(0,r.useEffect)(function(){h&&b&&h(b)},[b]);var y=(0,a.sK)(null==g?void 0:g.address,f?s:BigInt(0),t),N=y.submitInfo,w=y.isPending,I=y.error,B=(null==N?void 0:N.submitter)||"N/A",C=(0,i.S)().handleContractError;return((0,r.useEffect)(function(){p&&C(p,"submit"),I&&C(I,"submit")},[p,I]),j)?(0,n.jsx)(m.Z,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"mx-auto p-4 pb-2 ",children:[(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsxs)("span",{className:"text-sm text-greyscale-500",children:["No.",null==b?void 0:b.head.id.toString()]}),(0,n.jsx)("span",{className:"text-xl font-bold text-black",children:null==b?void 0:b.body.title})]}),(0,n.jsxs)("div",{className:"mt-0 text-xs text-greyscale-500 flex justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center",children:["创建人 ",(0,n.jsx)(x.Z,{address:null==b?void 0:b.head.author})]}),f&&(0,n.jsxs)("div",{className:"flex items-center",children:["推举人"," ",w?(0,n.jsx)(m.Z,{}):(0,n.jsx)(x.Z,{address:B})]})]})]}),(0,n.jsx)("div",{className:"mx-auto p-4 pb-2",children:(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"最小参与代币数"}),(0,n.jsx)("p",{className:"text-greyscale-500",children:(0,l.LH)((null==b?void 0:b.body.minStake)||BigInt(0))})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"最大激励地址数"}),(0,n.jsx)(u.Z,{title:"最大激励地址数说明",content:(0,n.jsxs)("p",{className:"leading-relaxed text-base",children:["每轮从所有参与行动的代币中，随机抽取",(0,n.jsx)("span",{className:"font-mono font-bold text-blue-600 mx-1 text-base",children:null==b?void 0:b.body.maxRandomAccounts.toString()}),"份代币，返回对应地址。若多份代币对应相同地址，则会合并为一个地址。"]})})]}),(0,n.jsx)("p",{className:"text-greyscale-500",children:(null==b?void 0:b.body.maxRandomAccounts.toString())||"-"})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold mb-2",children:"验证规则"}),(0,n.jsx)("div",{className:"text-greyscale-500",children:(0,n.jsx)(o.L,{text:null==b?void 0:b.body.verificationRule,preserveLineBreaks:!0})})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold mb-2",children:"报名参加行动时，行动者要提供的信息"}),(null==b?void 0:b.body.verificationKeys)&&(null==b?void 0:b.body.verificationKeys.length)>0?(0,n.jsx)("ul",{className:"list-disc pl-5",children:b.body.verificationKeys.map(function(e,t){return(0,n.jsxs)("li",{className:"text-greyscale-500",children:[(0,n.jsxs)("div",{className:"text-sm font-bold text-greyscale-900 mb-1",children:[(0,n.jsx)(d.Z,{text:e,showWarning:!0})," :"]}),(0,n.jsx)("div",{children:(0,n.jsx)(d.Z,{text:b.body.verificationInfoGuides[t],showWarning:!0,preserveLineBreaks:!0})})]},t)})}):(0,n.jsx)("span",{className:"text-greyscale-500",children:"无"})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"白名单"}),(0,n.jsx)("p",{className:"text-greyscale-500 flex flex-wrap items-center",children:(null==b?void 0:b.body.whiteListAddress)&&"0x0000000000000000000000000000000000000000"!==b.body.whiteListAddress?(0,n.jsx)("span",{className:"flex items-center mr-2",children:(0,n.jsx)(x.Z,{address:b.body.whiteListAddress})}):"无限制"})]})]})})]})}},44746:function(e,t,s){"use strict";s.d(t,{Z:function(){return x}});var n=s(72253),r=s(14932),a=s(91309),i=s(85893),c=s(67294),l=s(74598),o=s(35810),d=s(26986),u=s(79995);function x(e){var t=e.title,s=e.content,x=e.className,m=void 0===x?"":x,f=(0,a._)((0,c.useState)(!1),2),h=f[0],g=f[1],v=(0,u.Z)("(min-width: 768px)"),b=c.forwardRef(function(e,s){return(0,i.jsx)("button",(0,r._)((0,n._)({ref:s,type:"button",className:"inline-flex items-center p-1 rounded hover:bg-gray-100 transition-colors ".concat(m),"aria-label":"查看".concat(t)},e),{children:(0,i.jsx)(l.Z,{className:"h-4 w-4 text-gray-500 hover:text-gray-700"})}))});b.displayName="TriggerButton";var j=function(){return(0,i.jsx)("div",{className:"text-gray-700",children:"string"==typeof s?(0,i.jsx)("p",{className:"leading-relaxed text-sm",children:s}):s})};return(0,i.jsxs)(i.Fragment,{children:[v&&(0,i.jsxs)(o.Vq,{open:h,onOpenChange:g,children:[(0,i.jsx)(o.hg,{asChild:!0,children:(0,i.jsx)(b,{})}),(0,i.jsxs)(o.cZ,{className:"sm:max-w-[425px]",children:[(0,i.jsx)(o.$N,{className:"text-lg font-semibold",children:t}),(0,i.jsx)("div",{className:"pt-2 pb-4",children:(0,i.jsx)(j,{})})]})]}),!v&&(0,i.jsxs)(d.dy,{open:h,onOpenChange:g,children:[(0,i.jsx)(d.Qz,{asChild:!0,children:(0,i.jsx)(b,{})}),(0,i.jsxs)(d.sc,{className:"pb-safe",children:[(0,i.jsx)(d.OX,{children:(0,i.jsx)(d.iI,{className:"text-lg font-semibold",children:t})}),(0,i.jsx)("div",{className:"px-4 pb-8 mb-10",children:(0,i.jsx)(j,{})})]})]})]})}},64777:function(e,t,s){"use strict";var n=s(85893);t.Z=function(e){var t=e.title;return(0,n.jsx)("div",{className:"flex justify-between items-center",children:(0,n.jsx)("h1",{className:"text-lg font-bold",children:t})})}},21338:function(e,t,s){"use strict";var n=s(91309),r=s(85893),a=s(67294),i=s(88504),c=s(93778),l=s(74089),o=s(42083);t.Z=function(e){var t=e.currentRound,s=e.roundType,d=e.showCountdown,u=(0,i.O)().data,x=(0,a.useContext)(c.M),m=x?x.token:void 0,f=!u||!m||void 0===m.voteOriginBlocks,h=(0,n._)((0,a.useState)(BigInt(0)),2),g=h[0],v=h[1],b=Number("30126")||0,j=Number("2868")||0,p=m?Number(m.voteOriginBlocks):0,y=b-(Number(u)-p)%b,N=y>0?Math.ceil(y*j/1e3):0,w=(0,n._)((0,a.useState)(N),2),I=w[0],B=w[1];(0,a.useEffect)(function(){if(u){var e=b-(Number(u)-p)%b;B(e>0?Math.ceil(e*j/1e3):0)}},[u,b,j,p]),(0,a.useEffect)(function(){t>BigInt(0)&&v(t)},[t]);var C=null!=g?g.toString():"0";return g<=BigInt(0)?(0,r.jsx)(r.Fragment,{}):f||null==g||g<BigInt(0)?(null==g||BigInt(0),(0,r.jsx)(o.Z,{})):(0,r.jsx)("div",{className:"flex items-center mb-3",children:(0,r.jsxs)("span",{className:"text-sm text-greyscale-400",children:["(第",(0,r.jsx)("span",{className:"text-greyscale-400",children:C}),"轮","vote"===s?"投票":"verify"===s?"验证":"行动","阶段，",(0,r.jsx)("span",{className:"text-greyscale-400",children:"剩余"}),(0,r.jsx)("span",{className:"text-greyscale-400",children:Math.ceil(1e3*I/j)}),(0,r.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),void 0===d||d?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(l.Z,{initialTimeLeft:N,onTick:B})}):(0,r.jsx)("span",{className:"text-greyscale-400",children:I<60?"".concat(I,"秒"):I<=300?"".concat(Math.floor(I/60),"分钟").concat(I%60,"秒"):I<3600?"".concat(Math.floor(I/60),"分钟"):"".concat(Math.floor(I/3600),"小时").concat(Math.floor(I%3600/60),"分钟")}),(0,r.jsx)("span",{className:"text-greyscale-400",children:")"})]})})}},31084:function(e,t,s){"use strict";var n=s(85893);s(67294);var r=s(45655);t.Z=function(e){var t=e.text,s=e.className,a=e.maxLength,i=e.showWarning,c=e.preserveLineBreaks;if(!t)return null;var l=t;a&&t.length>a&&(l=t.substring(0,a)+"...");var o=(0,r.KL)(l,void 0!==c&&c),d=t!==l||/<[^>]*>/g.test(t)||/script|javascript|onclick|onerror|onload/gi.test(t);return(0,n.jsxs)("span",{className:void 0===s?"":s,children:[(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:o}}),void 0!==i&&i&&d&&(0,n.jsx)("span",{className:"text-yellow-500 text-xs ml-1",children:"⚠️ 内容已被安全过滤"})]})}},78552:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return X}});var n,r,a=s(91309),i=s(85893),c=s(11163),l=s(41664),o=s.n(l),d=s(67294),u=s(87250),x=s(73591),m=s(93778),f=s(83494),h=s(20725),g=s(64777),v=s(42130),b=s(7080),j=s(91529),p=s(42083),y=function(e){var t=e.currentRound,s=e.actionId,n=e.onRemainingVotesChange,r=((0,d.useContext)(m.M)||{}).token,a=(0,v.m)().address,c=(0,b.Ol)(null==r?void 0:r.address,t,a||"",s),l=c.votesNumByAccountByActionId,o=c.isPending,f=c.error,h=(0,u.Tl)(null==r?void 0:r.address,t,a||"",s),g=h.scoreByVerifierByActionId,y=h.isPending,N=h.error,w=o||y?BigInt(0):l-g;(0,d.useEffect)(function(){o||y||null==n||n(w)},[w,o,y]);var I=(0,x.S)().handleContractError;return((0,d.useEffect)(function(){f&&I(f,"vote"),N&&I(N,"verify")},[f,N]),w<=0)?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)("div",{className:"px-4",children:(0,i.jsxs)("div",{className:"text-center bg-greyscale-100 p-4 rounded-lg",children:[(0,i.jsxs)("span",{className:"text-greyscale-800 text-base",children:["我的剩余验证票数：",o||y?(0,i.jsx)(p.Z,{}):(0,i.jsx)("span",{className:"text-secondary",children:(0,j.LH)(w)})]}),(0,i.jsx)("div",{className:"mt-2 text-sm text-greyscale-500 text-center",children:"提示: 您的验证票，将按“打分比例”分配给行动参与者"})]})})},N=s(21338),w=s(11010),I=s(75766),B=s(72253),C=s(14932),k=s(97582),_=s(27245),E=s(86501),A=s(44746),Z=function(e){var t=e.isOpen,s=e.onClose,n=e.onConfirm,r=e.title,a=e.description,c=e.placeholder,l=(0,d.useRef)(null);return((0,d.useEffect)(function(){var e=function(e){"Escape"===e.key&&s()};return t&&(document.addEventListener("keydown",e),setTimeout(function(){var e;null===(e=l.current)||void 0===e||e.focus()},100)),function(){document.removeEventListener("keydown",e)}},[t,s]),t)?(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[10000] p-5",onClick:function(e){e.target===e.currentTarget&&s()},children:(0,i.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md text-center shadow-xl",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:void 0===r?"粘贴分数数据":r}),(0,i.jsx)("p",{className:"text-sm text-gray-600 mb-4 leading-relaxed",children:void 0===a?"请将复制的分数数据粘贴到下方文本框中（每行一个数字）":a}),(0,i.jsx)("textarea",{ref:l,placeholder:void 0===c?"请粘贴分数数据...":c,className:"w-full h-32 p-3 border border-gray-300 rounded-md font-mono text-sm resize-none mb-4 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"}),(0,i.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,i.jsx)("button",{onClick:function(){var e,t=(null===(e=l.current)||void 0===e?void 0:e.value.trim())||"";t?(n(t),s()):E.Am.error("请输入分数数据")},className:"px-4 py-2 bg-[#1e3a8a] text-white rounded-md hover:bg-gray-500/90 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors font-medium",children:"确认粘贴"}),(0,i.jsx)("button",{onClick:s,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors font-medium",children:"取消"})]})]})}):null},S=function(e){var t=e.isOpen,s=e.onClose,n=e.text,r=e.title,a=e.description,c=e.autoCloseDelay,l=void 0===c?3e4:c,o=(0,d.useRef)(null);return((0,d.useEffect)(function(){var e=function(e){"Escape"===e.key&&s()};if(t){document.addEventListener("keydown",e),setTimeout(function(){o.current&&(o.current.focus(),o.current.select(),o.current.setSelectionRange(0,o.current.value.length))},100);var n=null;return l>0&&(n=setTimeout(function(){s()},l)),function(){document.removeEventListener("keydown",e),n&&clearTimeout(n)}}},[t,s,l]),t)?(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[10000] p-5",onClick:function(e){e.target===e.currentTarget&&s()},children:(0,i.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md text-center shadow-xl",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:void 0===r?"请手动复制":r}),(0,i.jsx)("p",{className:"text-sm text-gray-600 mb-4 leading-relaxed",children:void 0===a?"自动复制功能不可用，请手动选择并复制以下内容：":a}),(0,i.jsx)("textarea",{ref:o,value:n,readOnly:!0,className:"w-full h-32 p-3 border border-gray-300 rounded-md font-mono text-sm resize-none mb-4 bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"}),(0,i.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,i.jsx)("button",{onClick:function(){o.current&&(o.current.focus(),o.current.select(),o.current.setSelectionRange(0,o.current.value.length),E.Am.success("已全选文本，请按 Ctrl+C 复制"))},className:"px-4 py-2 bg-[#1e3a8a] text-white rounded-md hover:bg-gray-500/90 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors font-medium",children:"全选文本"}),(0,i.jsx)("button",{onClick:s,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors font-medium",children:"关闭"})]}),l>0&&(0,i.jsxs)("p",{className:"text-xs text-gray-500 mt-3",children:[Math.round(l/1e3)," 秒后自动关闭"]})]})}):null},T=(n=(0,w._)(function(e){var t,s;return(0,k.Jh)(this,function(n){switch(n.label){case 0:if(!(navigator.clipboard&&navigator.clipboard.writeText))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,navigator.clipboard.writeText(e)];case 2:return n.sent(),[2,{success:!0,method:"clipboard"}];case 3:return n.sent(),[3,4];case 4:try{if((t=document.createElement("textarea")).value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",t.style.opacity="0",t.style.pointerEvents="none",t.setAttribute("readonly",""),document.body.appendChild(t),t.focus(),t.select(),t.setSelectionRange(0,t.value.length),s=document.execCommand("copy"),document.body.removeChild(t),s)return[2,{success:!0,method:"execCommand"}]}catch(e){}return[2,{success:!1,method:"manual",error:"浏览器不支持自动复制，需要手动复制"}]}})}),function(e){return n.apply(this,arguments)}),L=(r=(0,w._)(function(e,t,s){var n;return(0,k.Jh)(this,function(r){switch(r.label){case 0:return[4,T(e)];case 1:return(n=r.sent()).success?E.Am.success(t):s?s(e):E.Am.error(n.error||"复制失败，请手动复制"),[2]}})}),function(e,t,s){return r.apply(this,arguments)}),R=(0,s(31134).Z)("Clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]),P=s(18289),O=s(93950),M=s(27460),V=s(44576),K=s(72107),z=s(1938),D=function(e){var t,s,n,r,c=e.currentRound,l=e.actionId,o=e.actionInfo,f=e.remainingVotes,h=((0,d.useContext)(m.M)||{}).token,g=(0,O.X5)(null==h?void 0:h.address,c,l),v=g.verificationInfos,b=g.isPending,y=g.error,N=(0,O.pK)(null==h?void 0:h.address,c,l),T=N.verifiedAddresses,D=(N.isPending,N.error),F=(0,u.LW)(null==h?void 0:h.address,c,l,"0x0000000000000000000000000000000000000000"),W=F.scoreByActionIdByAccount,H=(F.isPending,F.error),X=(0,a._)((0,d.useState)({}),2),q=X[0],J=X[1],$=(0,a._)((0,d.useState)("0"),2),Y=$[0],G=$[1],Q=(0,a._)((0,d.useState)(!1),2),U=Q[0],ee=Q[1],et=(0,a._)((0,d.useState)(!1),2),es=et[0],en=et[1],er=(0,a._)((0,d.useState)(""),2),ea=er[0],ei=er[1];(0,d.useEffect)(function(){if(v&&v.length>0){var e={};v.forEach(function(t){e[t.account]=""}),J(e),G("")}},[v]);var ec=function(){var e=Object.values(q).map(function(e){return parseInt(e)||0}),t=parseInt(Y)||0,s=e.reduce(function(e,t){return e+t},0)+t;if(0===s)return{addressPercentages:{},abstainPercentage:0};var n={};return Object.keys(q).forEach(function(e){var t=parseInt(q[e])||0;n[e]=t/s*100}),{addressPercentages:n,abstainPercentage:t/s*100}}(),el=ec.addressPercentages,eo=ec.abstainPercentage,ed=(t={},(s=((null==T?void 0:T.reduce(function(e,t){return e+t.score},BigInt(0)))||BigInt(0))+(W||BigInt(0)))>BigInt(0)&&(null==v||v.forEach(function(e){var n=null==T?void 0:T.find(function(t){return t.account===e.account}),r=(null==n?void 0:n.score)||BigInt(0);t[e.account]=Number(r)/Number(s)*100})),{verificationPercentages:t,totalVerifiedVotes:s}),eu=ed.verificationPercentages,ex=ed.totalVerifiedVotes,em=function(e,t){(""===t||/^[0-9]+$/.test(t))&&J((0,C._)((0,B._)({},q),(0,I._)({},e,t)))},ef=function(e){(""===e||/^[0-9]+$/.test(e))&&G(e)},eh=(n=(0,w._)(function(){var e,t,s;return(0,k.Jh)(this,function(n){switch(n.label){case 0:if(n.trys.push([0,10,,11]),e="",t=!1,s=/Trust/i.test(navigator.userAgent),!(navigator.clipboard&&navigator.clipboard.readText&&!s))return[3,8];n.label=1;case 1:return n.trys.push([1,6,,7]),[4,navigator.permissions.query({name:"clipboard-read"})];case 2:if("denied"!==n.sent().state)return[3,3];return t=!0,[3,5];case 3:return[4,navigator.clipboard.readText()];case 4:e=n.sent(),n.label=5;case 5:return[3,7];case 6:return n.sent(),t=!0,[3,7];case 7:return[3,9];case 8:t=!0,n.label=9;case 9:if(t||!e)return ee(!0),[2];return eg(e),[3,11];case 10:return n.sent(),ee(!0),[3,11];case 11:return[2]}})}),function(){return n.apply(this,arguments)}),eg=function(e){var t=e.split("\n").map(function(e){return e.trim()}).filter(function(e){return""!==e}),s=[],n=!0,r=!1,a=void 0;try{for(var i,c=t[Symbol.iterator]();!(n=(i=c.next()).done);n=!0){var l=i.value;if(/^[0-9]+$/.test(l))s.push(l);else if(""!==l){E.Am.error('无效的数字格式: "'.concat(l,'"'));return}}}catch(e){r=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(r)throw a}}if(0===s.length){E.Am.error("没有找到有效的数字");return}var o=((null==v?void 0:v.length)||0)+1;if(s.length>o){E.Am.error("数字过多，最多支持 ".concat(o," 个数字"));return}var d=(0,B._)({},q),u=0;if(v)for(var x=0;x<v.length&&u<s.length;x++)d[v[x].account]=s[u],u++;var m=Y;u<s.length&&(m=s[u]),J(d),G(m),E.Am.success("成功粘贴 ".concat(s.length," 个分数"))},ev=(r=(0,w._)(function(){var e;return(0,k.Jh)(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),e=[],v&&v.forEach(function(t){var s=q[t.account]||"0";e.push(s)}),e.push(Y||"0"),[4,L(e.join("\n"),"已复制 ".concat(e.length," 个分数到剪贴板"),function(e){ei(e),en(!0)})];case 1:return t.sent(),[3,3];case 2:return t.sent(),E.Am.error("复制功能暂时不可用，请手动记录分数"),[3,3];case 3:return[2]}})}),function(){return r.apply(this,arguments)}),eb=function(e,t){if((e.ctrlKey||e.metaKey)&&"v"===e.key){e.preventDefault(),eh();return}if("Enter"===e.key||"Tab"===e.key){e.preventDefault();var s=document.querySelectorAll('input[type="number"]:not([disabled])'),n=(t+1)%s.length,r=s[n];r&&(r.focus(),r.select())}},ej=(0,u.yl)(),ep=ej.verify,ey=ej.isPending,eN=ej.isConfirming,ew=ej.isConfirmed,eI=ej.writeError;(0,d.useEffect)(function(){ew&&!eI&&(E.Am.success("提交成功",{duration:2e3}),setTimeout(function(){z.N.reloadWithOverlay()},2e3))},[ew,eI]);var eB=(0,x.S)().handleContractError;return(0,d.useEffect)(function(){eI&&eB(eI,"verify"),y&&eB(y,"dataViewer"),D&&eB(D,"dataViewer"),H&&eB(H,"verify")},[eI,y,D,H]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"w-full max-w-2xl",children:(0,i.jsxs)("table",{className:"w-full border-collapse",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("th",{className:"pb-3 text-left text-sm text-greyscale-500",children:(0,i.jsxs)("div",{className:"flex items-center gap-1",children:["被抽中的行动参与者",(0,i.jsx)(A.Z,{title:"最大激励地址数说明",content:(0,i.jsxs)("p",{className:"leading-relaxed text-base",children:["每轮从所有参与行动的代币中，随机抽取",(0,i.jsx)("span",{className:"font-mono font-bold text-blue-600 mx-1 text-base",children:null==o?void 0:o.body.maxRandomAccounts.toString()}),"份代币，返回对应地址。若多份代币对应相同地址，则会合并为一个地址。"]})})]})}),(0,i.jsx)("th",{className:"pb-3 text-left whitespace-nowrap w-16 text-sm text-greyscale-500",children:(0,i.jsxs)("div",{className:"flex items-center gap-1",children:["打分",(0,i.jsx)("button",{onClick:eh,disabled:ey||ew,className:"ml-1 p-1 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded disabled:text-gray-300 disabled:cursor-not-allowed transition-colors",title:"粘贴分数数据（自动检测剪贴板或手动输入，每行一个数字）",children:(0,i.jsx)(R,{size:14})}),!1]})}),(0,i.jsx)("th",{className:"pb-3 text-center whitespace-nowrap w-14 text-sm text-greyscale-500",children:"分配"})]})}),(0,i.jsxs)("tbody",{children:[b&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:3,className:"text-center py-4",children:(0,i.jsx)(p.Z,{})})}),v&&v.length>0?v.map(function(e,t){return(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("td",{className:"py-1",children:(0,i.jsxs)("div",{className:"text-left",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-xs font-bold text-gray-500 min-w-[4px]",children:t+1}),(0,i.jsx)("div",{className:"font-mono",children:(0,i.jsx)(M.Z,{address:e.account,showCopyLast4Button:!0})})]}),o&&(0,i.jsx)("div",{className:"text-sm text-greyscale-800 ml-3",children:o.body.verificationKeys.map(function(t,s){return(0,i.jsxs)("div",{className:"mb-2",children:[(0,i.jsxs)("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:[t,":"]}),(0,i.jsx)("div",{children:(0,i.jsx)(K.L,{text:e.infos[s]})})]},s)})})]})}),(0,i.jsx)("td",{className:"py-1 w-16 px-1",children:(0,i.jsxs)("div",{className:"flex items-center text-left",children:[(0,i.jsx)("input",{type:"number",min:"0",value:q[e.account]||"",placeholder:"0",onChange:function(t){return em(e.account,t.target.value)},onKeyDown:function(e){return eb(e,t)},tabIndex:t+1,className:"w-10 px-1 py-1 border rounded text-xs focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:ey||ew}),(0,i.jsx)("span",{className:"text-greyscale-500 text-xs",children:"分"})]})}),(0,i.jsx)("td",{className:"py-1 text-center w-14 whitespace-nowrap px-1",children:(0,i.jsxs)("div",{className:"leading-tight",children:[(0,i.jsx)("div",{className:"text-sm text-greyscale-600 ",children:(0,j.rl)(el[e.account]||0)}),(0,i.jsxs)("div",{className:"text-xs text-greyscale-500 ",children:["(当前",(0,j.rl)(eu[e.account]||0),")"]})]})})]},e.account)}):(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:3,className:"text-center py-4",children:"暂无数据"})}),v&&(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:"py-2",children:(0,i.jsx)("div",{className:"text-left",children:(0,i.jsx)("div",{className:"text-sm text-greyscale-800",children:(0,i.jsx)("span",{children:"弃权票数："})})})}),(0,i.jsx)("td",{className:"py-2 w-16 px-1",children:(0,i.jsxs)("div",{className:"flex items-center text-left",children:[(0,i.jsx)("input",{type:"number",min:"0",value:Y,placeholder:"0",onChange:function(e){return ef(e.target.value)},onKeyDown:function(e){return eb(e,(null==v?void 0:v.length)||0)},tabIndex:((null==v?void 0:v.length)||0)+1,className:"w-10 px-1 py-1 border rounded text-xs focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:ey||ew}),(0,i.jsx)("span",{className:"text-greyscale-500 text-xs",children:"分"})]})}),(0,i.jsx)("td",{className:"py-2 text-center w-14 whitespace-nowrap px-1",children:(0,i.jsxs)("div",{className:"text-greyscale-500 text-xs leading-tight",children:[(0,i.jsx)("div",{children:(0,j.rl)(eo)}),(0,i.jsxs)("div",{children:["(当前",(0,j.rl)(ex>BigInt(0)?Number(W||BigInt(0))/Number(ex)*100:0),")"]})]})})]})]})]})}),(0,i.jsx)("div",{className:"mt-4 flex justify-center",children:(0,i.jsxs)("button",{onClick:ev,disabled:ey||ew,className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg border border-gray-200 hover:border-blue-200 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors",title:"复制当前所有分数到剪贴板（每行一个分数）",children:[(0,i.jsx)(P.Z,{size:16}),"复制当前分数"]})}),(0,i.jsxs)(_.z,{onClick:function(){if(f<=BigInt(2)?(E.Am.error("剩余票数不足，无法验证"),!1):!Object.values(q).every(function(e){return 0===parseInt(e)||""===e})||0!==parseInt(Y)&&""!==Y||(E.Am.error("请至少给一个地址或弃权投票打分"),!1)){for(var e=Object.values(q).reduce(function(e,t){return e+(parseInt(t)||0)},0)+(parseInt(Y)||0),t=[],s=BigInt(0),n=BigInt(e),r=0;r<v.length;r++){var a=f*BigInt(parseInt(q[v[r].account])||0)/n,i=s+a>f?f-s:a;if(t.push(i),(s+=i)>=f){for(var c=r+1;c<v.length;c++)t.push(BigInt(0));break}}var o=t.reduce(function(e,t){return e+t},BigInt(0));if(o>f){E.Am.error("票数分配计算错误，请重试");return}var d=f-o;if(d<BigInt(0)){E.Am.error("票数分配计算错误，请重试");return}if(o+d!==f){E.Am.error("票数分配不完整，请重试");return}ep(null==h?void 0:h.address,l,d,t)}},disabled:ey||eN||ew,className:"mt-6 w-1/2",children:[!ey&&!eN&&!ew&&"提交验证",ey&&"提交中...",eN&&"确认中...",ew&&"已验证"]}),(0,i.jsx)(V.Z,{isLoading:ey||eN,text:ey?"提交交易...":"确认交易..."}),(0,i.jsx)(Z,{isOpen:U,onClose:function(){return ee(!1)},onConfirm:eg,title:"粘贴分数数据",description:"请将复制的分数数据粘贴到下方文本框中（每行一个数字）",placeholder:"请粘贴分数数据... 例如： 10 20 5 0"}),(0,i.jsx)(S,{isOpen:es,onClose:function(){return en(!1)},text:ea,title:"请手动复制分数",description:"自动复制功能不可用，请选择以下文本并手动复制（每行一个分数）："})]})},F=s(42171),W=s(4307),H=function(e){var t=e.currentRound,s=e.actionId,n=e.actionInfo,r=((0,d.useContext)(m.M)||{}).token,c=(0,v.m)().address,l=(0,a._)((0,d.useState)(new Set),2),o=l[0],f=l[1],h=(0,u.LW)(null==r?void 0:r.address,t,s,"0x0000000000000000000000000000000000000000"),y=h.scoreByActionIdByAccount,w=h.isPending,I=h.error,k=(0,O.pK)(null==r?void 0:r.address,t,s),_=k.verifiedAddresses,E=k.isPending,A=k.error,Z=(0,O.X5)(null==r?void 0:r.address,t,s),S=Z.verificationInfos,T=Z.isPending,L=Z.error,R=(0,b.wD)(null==r?void 0:r.address,t,s),P=R.votesNumByActionId,V=(R.isPending,R.error),z=(0,x.S)().handleContractError;(0,d.useEffect)(function(){A&&z(A,"dataViewer"),L&&z(L,"dataViewer"),I&&z(I,"verify"),V&&z(V,"vote")},[A,L,I,V]);var D=function(e){var t=new Set(o);t.has(e)?t.delete(e):t.add(e),f(t)},H=((null==_?void 0:_.reduce(function(e,t){return e+t.score},BigInt(0)))||BigInt(0))+(y||BigInt(0)),X=Number(H)/Number(P||BigInt(0))*100;return(0,i.jsxs)("div",{className:"relative px-4 pb-4 w-full",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(g.Z,{title:"当前轮最新验证结果"}),(0,i.jsxs)("span",{className:"text-sm text-greyscale-500 ml-2",children:["(验证进度：",(0,j.rl)(X),")"]})]}),(0,i.jsx)("div",{className:"flex justify-left mt-2",children:(0,i.jsx)(N.Z,{currentRound:t,roundType:"verify"})}),T||E||w?(0,i.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,i.jsx)(p.Z,{})}):S&&0!==S.length?(0,i.jsxs)("table",{className:"table w-full",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("th",{}),(0,i.jsx)("th",{children:"被抽中地址"}),(0,i.jsx)("th",{className:"px-1 text-right",children:"获得验证票"}),(0,i.jsx)("th",{className:"px-1 text-right",children:"验证票占比"})]})}),(0,i.jsxs)("tbody",{children:[S.map(function(e){var t=null==_?void 0:_.find(function(t){return t.account===e.account});return(0,C._)((0,B._)({},e),{score:(null==t?void 0:t.score)||BigInt(0)})}).sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:0}).map(function(e){var t=null==_?void 0:_.find(function(t){return t.account===e.account}),s=o.has(e.account);return(0,i.jsxs)(d.Fragment,{children:[(0,i.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===c?"text-secondary":""),children:[(0,i.jsx)("td",{className:"px-1 w-8",children:(0,i.jsx)("button",{onClick:function(){return D(e.account)},className:"text-greyscale-400 hover:text-greyscale-600",children:s?(0,i.jsx)(F.Z,{size:16}):(0,i.jsx)(W.Z,{size:16})})}),(0,i.jsx)("td",{className:"px-1",children:(0,i.jsx)(M.Z,{address:e.account,showCopyButton:!0,word:e.account===c?"(我)":""})}),(0,i.jsx)("td",{className:"px-1 text-right",children:(0,j.tY)((null==t?void 0:t.score)||BigInt(0))}),(0,i.jsx)("td",{className:"px-1 text-right",children:(0,j.rl)(Number((null==t?void 0:t.score)||BigInt(0))/Number(H||BigInt(0))*100)})]}),n&&s&&(0,i.jsxs)("tr",{className:"border-b border-gray-100 bg-gray-50",children:[(0,i.jsx)("td",{}),(0,i.jsx)("td",{colSpan:3,className:"px-1 py-3",children:(0,i.jsxs)("div",{className:"text-sm text-greyscale-600",children:[(0,i.jsx)("div",{className:"text-xs text-greyscale-400 mb-2",children:"验证信息:"}),n.body.verificationKeys.map(function(t,s){return(0,i.jsxs)("div",{className:"mb-1",children:[(0,i.jsxs)("span",{className:"text-greyscale-500",children:[t,":"]})," ",(0,i.jsx)(K.L,{text:e.infos[s]})]},s)})]})})]})]},e.account)}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:"px-1"}),(0,i.jsx)("td",{className:"px-1 text-greyscale-500",children:"弃权票"}),(0,i.jsx)("td",{className:"px-1 text-right",children:(0,j.tY)(y||BigInt(0))}),(0,i.jsx)("td",{className:"px-1 text-right",children:(0,j.rl)(Number(y||BigInt(0))/Number(H||BigInt(0))*100)})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:"px-1"}),(0,i.jsx)("td",{className:"px-1 text-greyscale-500",children:"汇总 "}),(0,i.jsx)("td",{className:"px-1 text-right",children:(0,j.tY)(H||BigInt(0))}),(0,i.jsx)("td",{className:"px-1 text-right",children:"100%"})]})]})]}):(0,i.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有验证地址"})]})},X=function(){var e=BigInt((0,c.useRouter)().query.id||"0"),t=((0,d.useContext)(m.M)||{}).token,s=(0,u.Bk)(),n=s.currentRound,r=s.error,l=(0,x.S)().handleContractError;(0,d.useEffect)(function(){r&&l(r,"verify")},[r]);var v=(0,a._)((0,d.useState)(BigInt(-1)),2),b=v[0],j=v[1],w=(0,a._)((0,d.useState)(void 0),2),I=w[0],B=w[1];return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f.Z,{title:"验证",backUrl:"/verify/?symbol=".concat(null==t?void 0:t.symbol)}),(0,i.jsxs)("main",{className:"flex-grow",children:[b>0&&(0,i.jsxs)("div",{className:"px-4 pt-4",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)(g.Z,{title:"请分配您的验证票："}),(0,i.jsx)(o(),{href:"/action/info/?id=".concat(e,"&symbol=").concat(null==t?void 0:t.symbol,"&tab=verify&tab2=current"),className:"text-blue-600 hover:text-blue-800 underline text-sm",children:"验证结果>>"})]}),(0,i.jsx)(N.Z,{currentRound:n,roundType:"verify",showCountdown:!1})]}),(0,i.jsx)(y,{currentRound:n,actionId:e,onRemainingVotesChange:function(e){j(e)}}),(0,i.jsxs)("div",{className:"flex flex-col items-center p-4",children:[b>BigInt(1)&&(0,i.jsx)(D,{currentRound:n,actionId:e,actionInfo:I,remainingVotes:b}),b>=BigInt(0)&&b<=BigInt(1)&&(0,i.jsx)(H,{currentRound:n,actionId:e,actionInfo:I}),b<BigInt(0)&&(0,i.jsx)(p.Z,{})]}),(0,i.jsx)(h.Z,{actionId:e,round:BigInt(n||0),showSubmitter:!0,onActionInfo:B})]})]})}}},function(e){e.O(0,[8239,3615,1390,3494,3591,3950,7724,7285,7250,1489,2888,9774,179],function(){return e(e.s=81130)}),_N_E=e.O()}]);