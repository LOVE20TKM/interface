(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5394],{143:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/verify/[id]",function(){return s(37295)}])},20725:function(e,t,s){"use strict";var n=s(85893),r=s(67294),l=s(27245),a=s(41664),i=s.n(a),c=s(94782),o=s(67068),d=s(93778),u=s(91529),m=s(27460),x=s(42083),f=s(64777);t.Z=e=>{var t;let{actionId:s,round:a,showSubmitter:h,showVerifyHistory:j=!0,onActionInfo:v}=e,{token:g}=(0,r.useContext)(d.M)||{},{actionInfo:b,isPending:N,error:p}=(0,c.dI)(null==g?void 0:g.address,s);(0,r.useEffect)(()=>{v&&b&&v(b)},[b]);let{actionSubmits:y,isPending:w,error:I}=(0,c.WZ)(null==g?void 0:g.address,h?a:0n),S=(null==y?void 0:null===(t=y.find(e=>e.actionId==Number(s)))||void 0===t?void 0:t.submitter)||"N/A",{handleContractError:k}=(0,o.S)();return((0,r.useEffect)(()=>{p&&k(p,"submit"),I&&k(I,"submit")},[p,I]),N)?(0,n.jsx)(x.Z,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mx-auto p-4 pb-2 border-t border-greyscale-100",children:(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsx)(f.Z,{title:"行动详情"}),j&&(0,n.jsx)(l.z,{variant:"link",className:"text-secondary border-secondary",asChild:!0,children:(0,n.jsx)(i(),{href:"/my/actrewards/?id=".concat(s,"&symbol=").concat(null==g?void 0:g.symbol),children:"查看历史验证结果 >>"})})]})}),(0,n.jsxs)("div",{className:"mx-auto p-4 pb-2 ",children:[(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsxs)("span",{className:"text-sm text-greyscale-500",children:["No.",null==b?void 0:b.head.id.toString()]}),(0,n.jsx)("span",{className:"text-xl font-bold text-black",children:null==b?void 0:b.body.action})]}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("span",{className:"text-greyscale-600",children:null==b?void 0:b.body.consensus})}),(0,n.jsxs)("div",{className:"mt-0 text-xs text-greyscale-500 flex justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center",children:["创建人 ",(0,n.jsx)(m.Z,{address:null==b?void 0:b.head.author})]}),h&&(0,n.jsxs)("div",{className:"flex items-center",children:["推举人"," ",w?(0,n.jsx)(x.Z,{}):(0,n.jsx)(m.Z,{address:S})]})]})]}),(0,n.jsx)("div",{className:"mx-auto p-4 pb-2",children:(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"最小参与代币数"}),(0,n.jsx)("p",{className:"text-greyscale-500",children:(0,u.LH)((null==b?void 0:b.body.minStake)||BigInt(0))})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"随机奖励地址数"}),(0,n.jsx)("p",{className:"text-greyscale-500",children:(null==b?void 0:b.body.maxRandomAccounts.toString())||"-"})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"验证规则"}),(0,n.jsx)("p",{className:"text-greyscale-500 whitespace-pre-wrap",children:null==b?void 0:b.body.verificationRule})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"验证信息"}),(null==b?void 0:b.body.verificationKeys)&&(null==b?void 0:b.body.verificationKeys.length)>0?(0,n.jsx)("ul",{className:"list-disc pl-5",children:b.body.verificationKeys.map((e,t)=>(0,n.jsxs)("li",{className:"text-greyscale-500",children:[e," : ",b.body.verificationInfoGuides[t]]},t))}):(0,n.jsx)("span",{className:"text-greyscale-500",children:"无"})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"白名单"}),(0,n.jsx)("p",{className:"text-greyscale-500 flex flex-wrap items-center",children:(null==b?void 0:b.body.whiteList.length)?b.body.whiteList.map((e,t)=>(0,n.jsx)("span",{className:"flex items-center mr-2",children:(0,n.jsx)(m.Z,{address:e})},t)):"无限制"})]})]})})]})}},27460:function(e,t,s){"use strict";var n=s(85893),r=s(67294),l=s(74855),a=s(78865),i=s(18289),c=s(86501),o=s(91529);t.Z=e=>{let{address:t,word:s,showCopyButton:d=!0,showAddress:u=!0,colorClassName:m=""}=e,[x,f]=(0,r.useState)(!1);return(0,n.jsxs)("span",{className:"flex items-center space-x-2",children:[s&&(0,n.jsx)("span",{className:"text-xs",children:s}),u&&(0,n.jsx)("span",{className:"text-xs ".concat(null!=m?m:"text-greyscale-500"),children:(0,o.Vu)(t)}),d&&(0,n.jsx)(l.CopyToClipboard,{text:t,onCopy:(e,t)=>{t?f(!0):c.ZP.error("复制失败")},children:(0,n.jsx)("button",{className:"flex items-center justify-center p-1 rounded hover:bg-gray-200 focus:outline-none",onClick:e=>{e.preventDefault(),e.stopPropagation()},"aria-label":"复制地址",children:x?(0,n.jsx)(a.Z,{className:"h-4 w-4 ".concat(null!=m?m:"text-greyscale-500")}):(0,n.jsx)(i.Z,{className:"h-4 w-4 ".concat(null!=m?m:"text-greyscale-500")})})})]})}},64777:function(e,t,s){"use strict";var n=s(85893);t.Z=e=>{let{title:t}=e;return(0,n.jsx)("div",{className:"flex justify-between items-center",children:(0,n.jsx)("h1",{className:"text-lg font-bold",children:t})})}},44576:function(e,t,s){"use strict";var n=s(85893);s(67294);var r=s(23432);t.Z=e=>{let{isLoading:t,text:s="Loading"}=e;return t?(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(r.Z,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,n.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:s})]})}):null}},96693:function(e,t,s){"use strict";s.d(t,{Z:function(){return o}});var n=s(85893),r=s(67294),l=s(42757),a=s(93778),i=e=>{let{initialTimeLeft:t,onTick:s}=e,[l,a]=(0,r.useState)(Date.now()+1e3*t),[i,c]=(0,r.useState)(t);(0,r.useEffect)(()=>{a(Date.now()+1e3*t)},[t]),(0,r.useEffect)(()=>{let e=setInterval(()=>{let t=Math.max(0,Math.floor((l-Date.now())/1e3));c(t),s&&s(t),t<=0&&(clearInterval(e),window.location.reload())},1e3);return()=>clearInterval(e)},[l,s]);let o=Math.floor(i/86400),d=Math.floor(i%86400/3600);return(0,n.jsxs)("div",{className:"inline-flex gap-1 text-secondary",children:[o>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"countdown font-mono",children:(0,n.jsx)("span",{style:{"--value":o}})}),"天"]}),(d>0||o>0)&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"countdown font-mono",children:(0,n.jsx)("span",{style:{"--value":d}})}),"时"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"countdown font-mono",children:(0,n.jsx)("span",{style:{"--value":Math.floor(i%3600/60)}})}),"分"]}),o<=0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"countdown font-mono",children:(0,n.jsx)("span",{style:{"--value":i%60}})}),"秒"]})]})},c=s(42083),o=e=>{let{currentRound:t,roundType:s}=e,{data:o}=(0,l.O)(),d=(0,r.useContext)(a.M),u=d?d.token:void 0,m=!o||!u||void 0===u.voteOriginBlocks||!u.initialStakeRound,[x,f]=(0,r.useState)(0n),h=Number("33784")||0,j=Number("255")||0,v=u?Number(u.voteOriginBlocks):0,g=h-(Number(o)-v)%h,b=g>0?Math.ceil(g*j/100):0,[N,p]=(0,r.useState)(b);(0,r.useEffect)(()=>{if(!o)return;let e=h-(Number(o)-v)%h;p(e>0?Math.ceil(e*j/100):0)},[o,h,j,v]),(0,r.useEffect)(()=>{u&&t>0n&&f(t-BigInt(u.initialStakeRound)+1n)},[t,u]);let y=null!=x?x.toString():"0";return m||null==x||x<0n?((null==x||x<0n)&&(console.log("currentTokenRound",x),console.log("currentRound",t),console.log("token.initialStakeRound",null==u?void 0:u.initialStakeRound),console.log("token",u)),(0,n.jsx)(c.Z,{})):(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsxs)("h1",{className:"text-lg font-bold",children:["第 ",(0,n.jsx)("span",{className:"text-secondary",children:y})," 轮","vote"===s?"投票":"verify"===s?"验证":"行动","阶段"]}),(0,n.jsxs)("span",{className:"text-sm mt-1 pt-0",children:[(0,n.jsx)("span",{className:"text-greyscale-400 mr-1",children:"剩余:"}),(0,n.jsx)("span",{className:"text-secondary mr-1",children:Math.ceil(100*N/j)}),(0,n.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),(0,n.jsx)(i,{initialTimeLeft:b,onTick:p})]})]})}},91529:function(e,t,s){"use strict";s.d(t,{LH:function(){return a},Vu:function(){return l},bM:function(){return c},cK:function(){return d},eb:function(){return u},kP:function(){return o},vz:function(){return i}});var n=s(21803),r=s(15229);let l=e=>e?"".concat(e.substring(0,6),"...").concat(e.substring(e.length-4)):"",a=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t=Number(c(e));if(e<10n)return"0";if(t>=1e5)return new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(t);if(t>=1e3)return new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(t);if(t>=1)return new Intl.NumberFormat("en-US",{maximumFractionDigits:4}).format(t);{if(t>=.001)return new Intl.NumberFormat("en-US",{maximumFractionDigits:4}).format(t);if(0===t)return"0";let e=t.toFixed(14),s=e.split(".");if(s.length<2)return e;let n=s[1],r=0;for(let e of n)if("0"===e)r++;else break;let l=n.slice(r,r+4);return"0.{".concat(r,"}").concat(l)}},i=e=>{let t=parseInt("18",10);try{let s=e.replace(/,/g,"");return(0,n.v)(s,t)}catch(e){return console.error("parseUnits error:",e),0n}},c=e=>{let t=parseInt("18",10);return(0,r.b)(e,t)},o=e=>e.includes(".")?parseFloat(e.replace(/,/g,"")).toString():e,d=(e,t)=>e&&t?e-BigInt(t.initialStakeRound)+1n:0n,u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=Number(e);if(n>=1)return new Intl.NumberFormat("en-US",{maximumFractionDigits:t}).format(n);if(n>=.001)return new Intl.NumberFormat("en-US",{maximumFractionDigits:s+1}).format(n);{if(0===n)return"0";let e=n.toFixed(s+10),t=e.split(".");if(t.length<2)return e;let r=t[1],l=0;for(let e of r)if("0"===e)l++;else break;let a=r.slice(l);return"0.{".concat(l,"}").concat(a)}}},72107:function(e,t,s){"use strict";s.d(t,{L:function(){return l}});var n=s(85893);s(67294);let r=e=>{if(!e)return e;let t=/(https?:\/\/[^\s]+)/g;if(!t.test(e))return e;let s=e.split(t),r=e.match(t)||[];return(0,n.jsx)(n.Fragment,{children:s.map((e,t)=>{if(t%2==0)return e;let s=r[(t-1)/2];return(0,n.jsx)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline hover:text-blue-700",children:s},t)})})},l=e=>{let{text:t}=e;return(0,n.jsx)(n.Fragment,{children:r(t)})}},48105:function(e,t,s){"use strict";s.d(t,{S:function(){return r}});var n=s(86501);let r=e=>!!e||(n.Am.error("请先将钱包链接 ".concat("thinkium801")),!1)},37295:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return S}});var n=s(85893),r=s(11163),l=s(67294),a=s(87250),i=s(67068),c=s(37436),o=s(20725),d=s(92321),u=s(7080),m=s(93778),x=s(91529),f=s(42083),h=e=>{let{currentRound:t,actionId:s,onRemainingVotesChange:r}=e,{token:c}=(0,l.useContext)(m.M)||{},{address:o}=(0,d.m)(),{votesNumByAccountByActionId:h,isPending:j,error:v}=(0,u.Ol)(null==c?void 0:c.address,t,o||"",s),{scoreByVerifierByActionId:g,isPending:b,error:N}=(0,a.Tl)(null==c?void 0:c.address,t,o||"",s),p=j||b?BigInt(0):h-g;(0,l.useEffect)(()=>{j||b||null==r||r(p)},[p]);let{handleContractError:y}=(0,i.S)();return(0,l.useEffect)(()=>{v&&y(v,"vote"),N&&y(N,"verify")},[v,N]),(0,n.jsxs)("div",{className:"mb-4 text-center",children:[(0,n.jsxs)("span",{className:"font-semibold",children:["我的剩余验证票数：",j||b?(0,n.jsx)(f.Z,{}):(0,n.jsx)("span",{className:"text-secondary",children:(0,x.LH)(p)})]}),(0,n.jsx)("div",{className:"mt-2 text-sm text-greyscale-500 text-center",children:"提示: 最大可验证票数，等于您本轮对该行动的投票数"})]})},j=s(96693),v=s(27245),g=s(86501),b=s(48105),N=s(45551),p=s(27460),y=s(44576),w=s(72107),I=e=>{let{currentRound:t,actionId:s,actionInfo:c,remainingVotes:o}=e,{token:u}=(0,l.useContext)(m.M)||{},{chain:x}=(0,d.m)(),h=(0,r.useRouter)(),{verificationInfos:j,isPending:I,error:S}=(0,N.X5)(null==u?void 0:u.address,t,s),[k,F]=(0,l.useState)({}),[Z,E]=(0,l.useState)("0");(0,l.useEffect)(()=>{if(j&&j.length>0){let e={};j.forEach(t=>{e[t.account]=""}),F(e),E("")}},[j]);let{addressPercentages:C,abstainPercentage:R}=(()=>{let e=Object.values(k).map(e=>parseInt(e)||0),t=parseInt(Z)||0,s=e.reduce((e,t)=>e+t,0)+t;if(0===s)return{addressPercentages:{},abstainPercentage:0};let n={};return Object.keys(k).forEach(e=>{let t=parseInt(k[e])||0;n[e]=t/s*100}),{addressPercentages:n,abstainPercentage:t/s*100}})(),M=(e,t)=>{(""===t||/^[0-9]+$/.test(t))&&F({...k,[e]:t})},P=e=>{(""===e||/^[0-9]+$/.test(e))&&E(e)},{verify:_,isWriting:B,isConfirming:D,isConfirmed:L,writeError:O}=(0,a.yl)(),T=()=>!!(0,b.S)(x)&&(o<=2n?(g.Am.error("剩余票数不足，无法验证"),!1):!Object.values(k).every(e=>0===parseInt(e)||""===e)||0!==parseInt(Z)&&""!==Z||(g.Am.error("请至少给一个地址或弃权投票打分"),!1));(0,l.useEffect)(()=>{L&&!O&&(g.Am.success("提交成功",{duration:2e3}),setTimeout(()=>{h.push("/verify/actions/?symbol=".concat(null==u?void 0:u.symbol))},2e3))},[L,O]);let{handleContractError:A}=(0,i.S)();return((0,l.useEffect)(()=>{O&&A(O,"verify"),S&&A(S,"dataViewer")},[O,S]),o<=0)?(0,n.jsx)(n.Fragment,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"w-full max-w-2xl",children:(0,n.jsxs)("ul",{className:"space-y-4",children:[I&&(0,n.jsx)(f.Z,{}),j&&j.length>0?j.map((e,t)=>(0,n.jsxs)("li",{className:"flex justify-between items-center p-4 border-b border-gray-100",children:[(0,n.jsxs)("div",{className:"text-left",children:[(0,n.jsx)("div",{className:"font-mono",children:(0,n.jsx)(p.Z,{address:e.account})}),c&&(0,n.jsx)("div",{className:"text-sm text-greyscale-800",children:c.body.verificationKeys.map((t,s)=>(0,n.jsxs)("div",{children:[t,": ",(0,n.jsx)(w.L,{text:e.infos[s]})]},s))})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"number",min:"0",value:k[e.account]||"",placeholder:"0",onChange:t=>M(e.account,t.target.value),className:"w-10 px-1 py-1 border rounded",disabled:B||L}),(0,n.jsx)("span",{className:"ml-1 text-greyscale-500",children:"分:"})]}),(0,n.jsxs)("div",{className:"w-10 text-right text-greyscale-500",children:[(C[e.account]||0).toFixed(2),"%"]})]})]},e.account)):(0,n.jsx)("div",{className:"text-center text-greyscale-500",children:"没有人参与活动"}),j&&(0,n.jsxs)("li",{className:"flex justify-between items-center p-4 border-b border-gray-100",children:[(0,n.jsx)("div",{className:"text-left",children:(0,n.jsx)("div",{className:"text-sm text-greyscale-800",children:(0,n.jsx)("span",{children:"弃权票数："})})}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"number",min:"0",value:Z,placeholder:"0",onChange:e=>P(e.target.value),className:"w-10 px-1 py-1 border rounded",disabled:B||L}),(0,n.jsx)("span",{className:"ml-1 text-greyscale-500",children:"分:"})]}),(0,n.jsxs)("div",{className:"w-10 text-right text-greyscale-500",children:[R.toFixed(2),"%"]})]})]})]})}),o>0&&(0,n.jsxs)(v.z,{onClick:()=>{if(!T())return;let e=Object.values(k).reduce((e,t)=>e+(parseInt(t)||0),0)+(parseInt(Z)||0);console.log("-------handleSubmit()-------"),console.log("scoreSum",e);let t=[],n=0n;j.forEach((s,r)=>{let l=parseInt(k[s.account])||0,a=BigInt(Math.floor(Number(o)*(l/e)));if((n+=a)>o){let e=n-o;n-=e,t.push(a-e)}else t.push(a)});let r=t.reduce((e,t)=>e+t,0n);if(console.log("remainingVotes",o),console.log("scoresArrayTotal",r),console.log("scoresArrayForSubmit",t),parseInt(Z)>0){let e=o>r?o-r:0n;console.log("abstainVotes",e),_(null==u?void 0:u.address,s,e,t)}else{if(r<o){let e=t.findIndex(e=>e>0n);-1!==e&&(t[e]+=o-r)}console.log("abstainVotes",0n),_(null==u?void 0:u.address,s,0n,t)}},disabled:B||D||L,className:"mt-6 w-1/2",children:[!B&&!D&&!L&&"提交验证",B&&"提交中...",D&&"确认中...",L&&"已验证"]}),!o&&(0,n.jsx)(v.z,{disabled:!0,className:"mt-6 w-1/2",children:"已验证"}),(0,n.jsx)(y.Z,{isLoading:B||D,text:B?"提交交易...":"确认交易..."})]})},S=()=>{let{id:e}=(0,r.useRouter)().query,t=BigInt(e||"0"),{currentRound:s,error:d}=(0,a.Bk)(),{handleContractError:u}=(0,i.S)();(0,l.useEffect)(()=>{d&&u(d,"verify")},[d]);let[m,x]=(0,l.useState)(BigInt(0)),[f,v]=(0,l.useState)(void 0);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.Z,{title:"验证"}),(0,n.jsxs)("main",{className:"flex-grow",children:[(0,n.jsx)("div",{className:"px-4",children:(0,n.jsx)(j.Z,{currentRound:s,roundType:"verify"})}),(0,n.jsx)("div",{className:"flex flex-col items-center p-4",children:(0,n.jsx)(I,{currentRound:s,actionId:t,actionInfo:f,remainingVotes:m})}),(0,n.jsx)("div",{className:"mb-6",children:(0,n.jsx)(h,{currentRound:s,actionId:t,onRemainingVotesChange:function(e){x(e)}})}),(0,n.jsx)(o.Z,{actionId:t,round:BigInt(s||0),showSubmitter:!0,onActionInfo:v})]})]})}}},function(e){e.O(0,[9873,7863,4782,3317,2888,9774,179],function(){return e(e.s=143)}),_N_E=e.O()}]);