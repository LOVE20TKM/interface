(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5394],{143:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/verify/[id]",function(){return t(37295)}])},20725:function(e,s,t){"use strict";var n=t(85893),r=t(67294),l=t(27245),a=t(41664),i=t.n(a),c=t(94782),o=t(67068),d=t(93778),u=t(91529),x=t(27460),m=t(42083),h=t(64777);s.Z=e=>{var s;let{actionId:t,round:a,showSubmitter:f,showVerifyHistory:j=!0,onActionInfo:v}=e,{token:b}=(0,r.useContext)(d.M)||{},{actionInfo:N,isPending:p,error:g}=(0,c.dI)(null==b?void 0:b.address,t);(0,r.useEffect)(()=>{v&&N&&v(N)},[N]);let{actionSubmits:y,isPending:w,error:I}=(0,c.WZ)(null==b?void 0:b.address,f?a:0n),S=(null==y?void 0:null===(s=y.find(e=>e.actionId==Number(t)))||void 0===s?void 0:s.submitter)||"N/A",{handleContractError:Z}=(0,o.S)();return((0,r.useEffect)(()=>{g&&Z(g,"submit"),I&&Z(I,"submit")},[g,I]),p)?(0,n.jsx)(m.Z,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mx-auto p-4 pb-2 border-t border-greyscale-100",children:(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsx)(h.Z,{title:"行动详情"}),j&&(0,n.jsx)(l.z,{variant:"link",className:"text-secondary border-secondary",asChild:!0,children:(0,n.jsx)(i(),{href:"/my/actrewards/?id=".concat(t,"&symbol=").concat(null==b?void 0:b.symbol),children:"查看历史验证结果 >>"})})]})}),(0,n.jsxs)("div",{className:"mx-auto p-4 pb-2 ",children:[(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsxs)("span",{className:"text-sm text-greyscale-500",children:["No.",null==N?void 0:N.head.id.toString()]}),(0,n.jsx)("span",{className:"text-xl font-bold text-black",children:null==N?void 0:N.body.action})]}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("span",{className:"text-greyscale-600",children:null==N?void 0:N.body.consensus})}),(0,n.jsxs)("div",{className:"mt-0 text-xs text-greyscale-500 flex justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center",children:["创建人 ",(0,n.jsx)(x.Z,{address:null==N?void 0:N.head.author})]}),f&&(0,n.jsxs)("div",{className:"flex items-center",children:["推举人"," ",w?(0,n.jsx)(m.Z,{}):(0,n.jsx)(x.Z,{address:S})]})]})]}),(0,n.jsx)("div",{className:"mx-auto p-4 pb-2",children:(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"最小参与代币数"}),(0,n.jsx)("p",{className:"text-greyscale-500",children:(0,u.LH)((null==N?void 0:N.body.minStake)||BigInt(0))})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"随机奖励地址数"}),(0,n.jsx)("p",{className:"text-greyscale-500",children:(null==N?void 0:N.body.maxRandomAccounts.toString())||"-"})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"验证规则"}),(0,n.jsx)("p",{className:"text-greyscale-500 whitespace-pre-wrap",children:null==N?void 0:N.body.verificationRule})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"验证信息"}),(null==N?void 0:N.body.verificationKeys)&&(null==N?void 0:N.body.verificationKeys.length)>0?(0,n.jsx)("ul",{className:"list-disc pl-5",children:N.body.verificationKeys.map((e,s)=>(0,n.jsxs)("li",{className:"text-greyscale-500",children:[e," : ",N.body.verificationInfoGuides[s]]},s))}):(0,n.jsx)("span",{className:"text-greyscale-500",children:"无"})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"白名单"}),(0,n.jsx)("p",{className:"text-greyscale-500 flex flex-wrap items-center",children:(null==N?void 0:N.body.whiteList.length)?N.body.whiteList.map((e,s)=>(0,n.jsx)("span",{className:"flex items-center mr-2",children:(0,n.jsx)(x.Z,{address:e})},s)):"无限制"})]})]})})]})}},27460:function(e,s,t){"use strict";var n=t(85893),r=t(67294),l=t(74855),a=t(78865),i=t(18289),c=t(86501),o=t(91529);s.Z=e=>{let{address:s,showCopyButton:t=!0,showAddress:d=!0,colorClassName:u=""}=e,[x,m]=(0,r.useState)(!1);return(0,n.jsxs)("span",{className:"flex items-center space-x-2",children:[d&&(0,n.jsx)("span",{className:"text-xs ".concat(null!=u?u:"text-greyscale-500"),children:(0,o.Vu)(s)}),t&&(0,n.jsx)(l.CopyToClipboard,{text:s,onCopy:(e,s)=>{s?m(!0):c.ZP.error("复制失败")},children:(0,n.jsx)("button",{className:"flex items-center justify-center p-1 rounded hover:bg-gray-200 focus:outline-none",onClick:e=>{e.preventDefault(),e.stopPropagation()},"aria-label":"复制地址",children:x?(0,n.jsx)(a.Z,{className:"h-4 w-4 ".concat(null!=u?u:"text-greyscale-500")}):(0,n.jsx)(i.Z,{className:"h-4 w-4 ".concat(null!=u?u:"text-greyscale-500")})})})]})}},64777:function(e,s,t){"use strict";var n=t(85893);s.Z=e=>{let{title:s}=e;return(0,n.jsx)("div",{className:"flex justify-between items-center",children:(0,n.jsx)("h1",{className:"text-lg font-bold",children:s})})}},44576:function(e,s,t){"use strict";var n=t(85893);t(67294);var r=t(23432);s.Z=e=>{let{isLoading:s,text:t="Loading"}=e;return s?(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(r.Z,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,n.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:t})]})}):null}},96693:function(e,s,t){"use strict";t.d(s,{Z:function(){return o}});var n=t(85893),r=t(67294),l=t(42757),a=t(93778),i=e=>{let{initialTimeLeft:s,onTick:t}=e,[l,a]=(0,r.useState)(Date.now()+1e3*s),[i,c]=(0,r.useState)(s);(0,r.useEffect)(()=>{a(Date.now()+1e3*s)},[s]),(0,r.useEffect)(()=>{let e=setInterval(()=>{let s=Math.max(0,Math.floor((l-Date.now())/1e3));c(s),t&&t(s),s<=0&&(clearInterval(e),window.location.reload())},1e3);return()=>clearInterval(e)},[l,t]);let o=Math.floor(i/86400),d=Math.floor(i%86400/3600);return(0,n.jsxs)("div",{className:"inline-flex gap-1 text-secondary",children:[o>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"countdown font-mono",children:(0,n.jsx)("span",{style:{"--value":o}})}),"天"]}),(d>0||o>0)&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"countdown font-mono",children:(0,n.jsx)("span",{style:{"--value":d}})}),"时"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"countdown font-mono",children:(0,n.jsx)("span",{style:{"--value":Math.floor(i%3600/60)}})}),"分"]}),o<=0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"countdown font-mono",children:(0,n.jsx)("span",{style:{"--value":i%60}})}),"秒"]})]})},c=t(42083),o=e=>{let{currentRound:s,roundType:t}=e,{data:o}=(0,l.O)(),d=(0,r.useContext)(a.M),u=d?d.token:void 0,x=!o||!u||void 0===u.voteOriginBlocks||!u.initialStakeRound,[m,h]=(0,r.useState)(0n),f=Number("33784")||0,j=Number("255")||0,v=u?Number(u.voteOriginBlocks):0,b=f-(Number(o)-v)%f,N=b>0?Math.ceil(b*j/100):0,[p,g]=(0,r.useState)(N);(0,r.useEffect)(()=>{if(!o)return;let e=f-(Number(o)-v)%f;g(e>0?Math.ceil(e*j/100):0)},[o,f,j,v]),(0,r.useEffect)(()=>{u&&s>0n&&h(s-BigInt(u.initialStakeRound)+1n)},[s,u]);let y=null!=m?m.toString():"0";return x?(0,n.jsx)(c.Z,{}):(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsxs)("h1",{className:"text-lg font-bold",children:["第 ",(0,n.jsx)("span",{className:"text-secondary",children:y})," 轮","vote"===t?"投票":"verify"===t?"验证":"行动","阶段"]}),(0,n.jsxs)("span",{className:"text-sm mt-1 pt-0",children:[(0,n.jsx)("span",{className:"text-greyscale-400 mr-1",children:"剩余:"}),(0,n.jsx)("span",{className:"text-secondary mr-1",children:Math.ceil(100*p/j)}),(0,n.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),(0,n.jsx)(i,{initialTimeLeft:N,onTick:g})]})]})}},91529:function(e,s,t){"use strict";t.d(s,{LH:function(){return a},Vu:function(){return l},bM:function(){return c},cK:function(){return d},eb:function(){return u},kP:function(){return o},vz:function(){return i}});var n=t(21803),r=t(15229);let l=e=>e?"".concat(e.substring(0,6),"...").concat(e.substring(e.length-4)):"",a=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,t=Number(c(e));return e<10n?"0":t<1e-4?"<0.0001":new Intl.NumberFormat("en-US",{maximumFractionDigits:s}).format(t)},i=e=>{let s=parseInt("18",10);try{let t=e.replace(/,/g,"");return(0,n.v)(t,s)}catch(e){return console.error("parseUnits error:",e),0n}},c=e=>{let s=parseInt("18",10);return(0,r.b)(e,s)},o=e=>e.includes(".")?parseFloat(e.replace(/,/g,"")).toString():e,d=(e,s)=>e&&s?e-BigInt(s.initialStakeRound)+1n:0n,u=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=Number(e);if(n>=1)return new Intl.NumberFormat("en-US",{maximumFractionDigits:s}).format(n);if(n>=.001)return new Intl.NumberFormat("en-US",{maximumFractionDigits:t+1}).format(n);{if(0===n)return"0";let e=n.toFixed(t+10),s=e.split(".");if(s.length<2)return e;let r=s[1],l=0;for(let e of r)if("0"===e)l++;else break;let a=r.slice(l);return"0.{".concat(l,"}").concat(a)}}},72107:function(e,s,t){"use strict";t.d(s,{L:function(){return l}});var n=t(85893);t(67294);let r=e=>{if(!e)return e;let s=/(https?:\/\/[^\s]+)/g;if(!s.test(e))return e;let t=e.split(s),r=e.match(s)||[];return(0,n.jsx)(n.Fragment,{children:t.map((e,s)=>{if(s%2==0)return e;let t=r[(s-1)/2];return(0,n.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline hover:text-blue-700",children:t},s)})})},l=e=>{let{text:s}=e;return(0,n.jsx)(n.Fragment,{children:r(s)})}},48105:function(e,s,t){"use strict";t.d(s,{S:function(){return r}});var n=t(86501);let r=e=>!!e||(n.Am.error("请先将钱包链接 ".concat("thinkium801")),!1)},37295:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return S}});var n=t(85893),r=t(11163),l=t(67294),a=t(87250),i=t(67068),c=t(37436),o=t(20725),d=t(92321),u=t(7080),x=t(93778),m=t(91529),h=t(42083),f=e=>{let{currentRound:s,actionId:t,onRemainingVotesChange:r}=e,{token:c}=(0,l.useContext)(x.M)||{},{address:o}=(0,d.m)(),{votesNumByAccountByActionId:f,isPending:j,error:v}=(0,u.Ol)(null==c?void 0:c.address,s,o||"",t),{scoreByVerifierByActionId:b,isPending:N,error:p}=(0,a.Tl)(null==c?void 0:c.address,s,o||"",t),g=j||N?BigInt(0):f-b;(0,l.useEffect)(()=>{j||N||null==r||r(g)},[g]);let{handleContractError:y}=(0,i.S)();return(0,l.useEffect)(()=>{v&&y(v,"vote"),p&&y(p,"verify")},[v,p]),(0,n.jsxs)("div",{className:"mb-4 text-center",children:[(0,n.jsxs)("span",{className:"font-semibold",children:["我的剩余验证票数：",j||N?(0,n.jsx)(h.Z,{}):(0,n.jsx)("span",{className:"text-secondary",children:(0,m.LH)(g)})]}),(0,n.jsx)("div",{className:"mt-2 text-sm text-greyscale-500 text-center",children:"提示: 最大可验证票数，等于您本轮对该行动的投票数"})]})},j=t(96693),v=t(27245),b=t(86501),N=t(48105),p=t(45551),g=t(27460),y=t(44576),w=t(72107),I=e=>{let{currentRound:s,actionId:t,actionInfo:c,remainingVotes:o}=e,{token:u}=(0,l.useContext)(x.M)||{},{chain:m}=(0,d.m)(),f=(0,r.useRouter)(),{verificationInfos:j,isPending:I,error:S}=(0,p.X5)(null==u?void 0:u.address,s,t),[Z,k]=(0,l.useState)({}),[E,F]=(0,l.useState)("0");(0,l.useEffect)(()=>{if(j&&j.length>0){let e={};j.forEach(s=>{e[s.account]=""}),k(e),F("")}},[j]);let{addressPercentages:C,abstainPercentage:M}=(()=>{let e=Object.values(Z).map(e=>parseInt(e)||0),s=parseInt(E)||0,t=e.reduce((e,s)=>e+s,0)+s;if(0===t)return{addressPercentages:{},abstainPercentage:0};let n={};return Object.keys(Z).forEach(e=>{let s=parseInt(Z[e])||0;n[e]=s/t*100}),{addressPercentages:n,abstainPercentage:s/t*100}})(),P=(e,s)=>{(""===s||/^[0-9]+$/.test(s))&&k({...Z,[e]:s})},_=e=>{(""===e||/^[0-9]+$/.test(e))&&F(e)},{verify:B,isWriting:R,isConfirming:L,isConfirmed:O,writeError:A}=(0,a.yl)(),T=()=>!!(0,N.S)(m)&&(o<=2n?(b.Am.error("剩余票数不足，无法验证"),!1):!Object.values(Z).every(e=>0===parseInt(e)||""===e)||0!==parseInt(E)&&""!==E||(b.Am.error("请至少给一个地址或弃权投票打分"),!1));(0,l.useEffect)(()=>{O&&!A&&(b.Am.success("提交成功",{duration:2e3}),setTimeout(()=>{f.push("/verify/actions/?symbol=".concat(null==u?void 0:u.symbol))},2e3))},[O,A]);let{handleContractError:V}=(0,i.S)();return((0,l.useEffect)(()=>{A&&V(A,"verify"),S&&V(S,"dataViewer")},[A,S]),o<=0)?(0,n.jsx)(n.Fragment,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"w-full max-w-2xl",children:(0,n.jsxs)("ul",{className:"space-y-4",children:[I&&(0,n.jsx)(h.Z,{}),j&&j.length>0?j.map((e,s)=>(0,n.jsxs)("li",{className:"flex justify-between items-center p-4 border-b border-gray-100",children:[(0,n.jsxs)("div",{className:"text-left",children:[(0,n.jsx)("div",{className:"font-mono",children:(0,n.jsx)(g.Z,{address:e.account})}),c&&(0,n.jsx)("div",{className:"text-sm text-greyscale-800",children:c.body.verificationKeys.map((s,t)=>(0,n.jsxs)("div",{children:[s,": ",(0,n.jsx)(w.L,{text:e.infos[t]})]},t))})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"number",min:"0",value:Z[e.account]||"",placeholder:"0",onChange:s=>P(e.account,s.target.value),className:"w-10 px-1 py-1 border rounded",disabled:R||O}),(0,n.jsx)("span",{className:"ml-1 text-greyscale-500",children:"分:"})]}),(0,n.jsxs)("div",{className:"w-10 text-right text-greyscale-500",children:[(C[e.account]||0).toFixed(2),"%"]})]})]},e.account)):(0,n.jsx)("div",{className:"text-center text-greyscale-500",children:"没有人参与活动"}),j&&(0,n.jsxs)("li",{className:"flex justify-between items-center p-4 border-b border-gray-100",children:[(0,n.jsx)("div",{className:"text-left",children:(0,n.jsx)("div",{className:"text-sm text-greyscale-800",children:(0,n.jsx)("span",{children:"弃权票数："})})}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"number",min:"0",value:E,placeholder:"0",onChange:e=>_(e.target.value),className:"w-10 px-1 py-1 border rounded",disabled:R||O}),(0,n.jsx)("span",{className:"ml-1 text-greyscale-500",children:"分:"})]}),(0,n.jsxs)("div",{className:"w-10 text-right text-greyscale-500",children:[M.toFixed(2),"%"]})]})]})]})}),o>0&&(0,n.jsxs)(v.z,{onClick:()=>{if(!T())return;let e=Object.values(Z).reduce((e,s)=>e+(parseInt(s)||0),0)+(parseInt(E)||0);console.log("-------handleSubmit()-------"),console.log("scoreSum",e);let s=[],n=0n;j.forEach((t,r)=>{let l=parseInt(Z[t.account])||0,a=BigInt(Math.floor(Number(o)*(l/e)));if((n+=a)>o){let e=n-o;n-=e,s.push(a-e)}else s.push(a)});let r=s.reduce((e,s)=>e+s,0n);if(console.log("remainingVotes",o),console.log("scoresArrayTotal",r),console.log("scoresArrayForSubmit",s),parseInt(E)>0){let e=o>r?o-r:0n;console.log("abstainVotes",e),B(null==u?void 0:u.address,t,e,s)}else{if(r<o){let e=s.findIndex(e=>e>0n);-1!==e&&(s[e]+=o-r)}console.log("abstainVotes",0n),B(null==u?void 0:u.address,t,0n,s)}},disabled:R||L||O,className:"mt-6 w-1/2",children:[!R&&!L&&!O&&"提交验证",R&&"提交中...",L&&"确认中...",O&&"已验证"]}),!o&&(0,n.jsx)(v.z,{disabled:!0,className:"mt-6 w-1/2",children:"已验证"}),(0,n.jsx)(y.Z,{isLoading:R||L,text:R?"提交交易...":"确认交易..."})]})},S=()=>{let{id:e}=(0,r.useRouter)().query,s=BigInt(e||"0"),{currentRound:t,error:d}=(0,a.Bk)(),{handleContractError:u}=(0,i.S)();(0,l.useEffect)(()=>{d&&u(d,"verify")},[d]);let[x,m]=(0,l.useState)(BigInt(0)),[h,v]=(0,l.useState)(void 0);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.Z,{title:"验证"}),(0,n.jsxs)("main",{className:"flex-grow",children:[(0,n.jsx)("div",{className:"px-4",children:(0,n.jsx)(j.Z,{currentRound:t,roundType:"verify"})}),(0,n.jsx)("div",{className:"flex flex-col items-center p-4",children:(0,n.jsx)(I,{currentRound:t,actionId:s,actionInfo:h,remainingVotes:x})}),(0,n.jsx)("div",{className:"mb-6",children:(0,n.jsx)(f,{currentRound:t,actionId:s,onRemainingVotesChange:function(e){m(e)}})}),(0,n.jsx)(o.Z,{actionId:s,round:BigInt(t||0),showSubmitter:!0,onActionInfo:v})]})]})}}},function(e){e.O(0,[1664,9873,7863,4782,3317,2888,9774,179],function(){return e(e.s=143)}),_N_E=e.O()}]);