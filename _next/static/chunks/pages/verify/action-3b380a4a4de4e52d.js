try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="20ab0be7-7c4b-41fa-87f7-1bd1f922e55f",e._sentryDebugIdIdentifier="sentry-dbid-20ab0be7-7c4b-41fa-87f7-1bd1f922e55f")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7690],{81130:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/verify/action",function(){return n(27238)}])},64777:function(e,t,n){"use strict";var s=n(85893);t.Z=function(e){var t=e.title;return(0,s.jsx)("div",{className:"flex justify-between items-center",children:(0,s.jsx)("h1",{className:"text-lg font-bold",children:t})})}},21338:function(e,t,n){"use strict";var s=n(91309),r=n(85893),c=n(67294),a=n(88504),i=n(93778),l=n(74089),d=n(42083);t.Z=function(e){var t=e.currentRound,n=e.roundType,o=e.showCountdown,u=(0,a.O)().data,x=(0,c.useContext)(i.M),f=x?x.token:void 0,m=!u||!f||void 0===f.voteOriginBlocks,h=(0,s._)((0,c.useState)(BigInt(0)),2),g=h[0],j=h[1],v=Number("30126")||0,b=Number("2868")||0,p=f?Number(f.voteOriginBlocks):0,y=v-(Number(u)-p)%v,N=y>0?Math.ceil(y*b/1e3):0,I=(0,s._)((0,c.useState)(N),2),w=I[0],B=I[1];(0,c.useEffect)(function(){if(u){var e=v-(Number(u)-p)%v;B(e>0?Math.ceil(e*b/1e3):0)}},[u,v,b,p]),(0,c.useEffect)(function(){t>BigInt(0)&&j(t)},[t]);var _=null!=g?g.toString():"0";return g<=BigInt(0)?(0,r.jsx)(r.Fragment,{}):m||null==g||g<BigInt(0)?(null==g||BigInt(0),(0,r.jsx)(d.Z,{})):(0,r.jsx)("div",{className:"flex items-center mb-3",children:(0,r.jsxs)("span",{className:"text-sm text-greyscale-400",children:["(第",(0,r.jsx)("span",{className:"text-greyscale-400",children:_}),"轮","vote"===n?"投票":"verify"===n?"验证":"行动","阶段，",(0,r.jsx)("span",{className:"text-greyscale-400",children:"剩余"}),(0,r.jsx)("span",{className:"text-greyscale-400",children:Math.ceil(1e3*w/b)}),(0,r.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),void 0===o||o?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(l.Z,{initialTimeLeft:N,onTick:B})}):(0,r.jsx)("span",{className:"text-greyscale-400",children:w<60?"".concat(w,"秒"):w<=300?"".concat(Math.floor(w/60),"分钟").concat(w%60,"秒"):w<3600?"".concat(Math.floor(w/60),"分钟"):"".concat(Math.floor(w/3600),"小时").concat(Math.floor(w%3600/60),"分钟")}),(0,r.jsx)("span",{className:"text-greyscale-400",children:")"})]})})}},27238:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return T}});var s=n(91309),r=n(85893),c=n(11163),a=n(41664),i=n.n(a),l=n(67294),d=n(87250),o=n(73591),u=n(93778),x=n(83494),f=n(20725),m=n(64777),h=n(42130),g=n(7080),j=n(91529),v=n(42083),b=function(e){var t=e.currentRound,n=e.actionId,s=e.onRemainingVotesChange,c=((0,l.useContext)(u.M)||{}).token,a=(0,h.m)().address,i=(0,g.Ol)(null==c?void 0:c.address,t,a||"",n),x=i.votesNumByAccountByActionId,f=i.isPending,m=i.error,b=(0,d.Tl)(null==c?void 0:c.address,t,a||"",n),p=b.scoreByVerifierByActionId,y=b.isPending,N=b.error,I=f||y?BigInt(0):x-p;(0,l.useEffect)(function(){f||y||null==s||s(I)},[I,f,y]);var w=(0,o.S)().handleContractError;return((0,l.useEffect)(function(){m&&w(m,"vote"),N&&w(N,"verify")},[m,N]),I<=0)?(0,r.jsx)(r.Fragment,{}):(0,r.jsx)("div",{className:"px-4",children:(0,r.jsxs)("div",{className:"text-center bg-greyscale-100 p-4 rounded-lg",children:[(0,r.jsxs)("span",{className:"text-greyscale-800 text-base",children:["我的剩余验证票数：",f||y?(0,r.jsx)(v.Z,{}):(0,r.jsx)("span",{className:"text-secondary",children:(0,j.LH)(I)})]}),(0,r.jsx)("div",{className:"mt-2 text-sm text-greyscale-500 text-center",children:"提示: 您的验证票，将按“打分比例”分配给行动参与者"})]})})},p=n(21338),y=n(75766),N=n(72253),I=n(14932),w=n(27245),B=n(86501),_=n(39360),E=n(44746),C=n(93950),k=n(27460),P=n(44576),S=n(72107),Z=n(1938),A=function(e){var t,n,a=e.currentRound,i=e.actionId,x=e.actionInfo,f=e.remainingVotes,m=((0,l.useContext)(u.M)||{}).token;(0,_.x)(),(0,c.useRouter)();var h=(0,C.X5)(null==m?void 0:m.address,a,i),g=h.verificationInfos,b=h.isPending,p=h.error,A=(0,C.pK)(null==m?void 0:m.address,a,i),R=A.verifiedAddresses,M=(A.isPending,A.error),V=(0,d.LW)(null==m?void 0:m.address,a,i,"0x0000000000000000000000000000000000000000"),T=V.scoreByActionIdByAccount,O=(V.isPending,V.error),D=(0,s._)((0,l.useState)({}),2),L=D[0],F=D[1],K=(0,s._)((0,l.useState)("0"),2),X=K[0],z=K[1];(0,l.useEffect)(function(){if(g&&g.length>0){var e={};g.forEach(function(t){e[t.account]=""}),F(e),z("")}},[g]);var W=function(){var e=Object.values(L).map(function(e){return parseInt(e)||0}),t=parseInt(X)||0,n=e.reduce(function(e,t){return e+t},0)+t;if(0===n)return{addressPercentages:{},abstainPercentage:0};var s={};return Object.keys(L).forEach(function(e){var t=parseInt(L[e])||0;s[e]=t/n*100}),{addressPercentages:s,abstainPercentage:t/n*100}}(),Y=W.addressPercentages,q=W.abstainPercentage,$=(t={},(n=((null==R?void 0:R.reduce(function(e,t){return e+t.score},BigInt(0)))||BigInt(0))+(T||BigInt(0)))>BigInt(0)&&(null==g||g.forEach(function(e){var s=null==R?void 0:R.find(function(t){return t.account===e.account}),r=(null==s?void 0:s.score)||BigInt(0);t[e.account]=Number(r)/Number(n)*100})),{verificationPercentages:t,totalVerifiedVotes:n}),H=$.verificationPercentages,U=$.totalVerifiedVotes,G=function(e,t){(""===t||/^[0-9]+$/.test(t))&&F((0,I._)((0,N._)({},L),(0,y._)({},e,t)))},J=function(e){(""===e||/^[0-9]+$/.test(e))&&z(e)},Q=function(e,t){if("Enter"===e.key||"Tab"===e.key){e.preventDefault();var n=document.querySelectorAll('input[type="number"]:not([disabled])'),s=(t+1)%n.length,r=n[s];r&&(r.focus(),r.select())}},ee=(0,d.yl)(),et=ee.verify,en=ee.isPending,es=ee.isConfirming,er=ee.isConfirmed,ec=ee.writeError;(0,l.useEffect)(function(){er&&!ec&&(B.Am.success("提交成功",{duration:2e3}),setTimeout(function(){Z.N.reloadWithOverlay()},2e3))},[er,ec]);var ea=(0,o.S)().handleContractError;return(0,l.useEffect)(function(){ec&&ea(ec,"verify"),p&&ea(p,"dataViewer"),M&&ea(M,"dataViewer"),O&&ea(O,"verify")},[ec,p,M,O]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-full max-w-2xl",children:(0,r.jsxs)("table",{className:"w-full border-collapse",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,r.jsx)("th",{className:"pb-3 text-left text-sm text-greyscale-500",children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:["被抽中的行动参与者",(0,r.jsx)(E.Z,{title:"最大激励地址数说明",content:(0,r.jsxs)("p",{className:"leading-relaxed text-base",children:["每轮从所有参与行动的代币中，随机抽取",(0,r.jsx)("span",{className:"font-mono font-bold text-blue-600 mx-1 text-base",children:null==x?void 0:x.body.maxRandomAccounts.toString()}),"份代币，返回对应地址。若多份代币对应相同地址，则会合并为一个地址。"]})})]})}),(0,r.jsx)("th",{className:"pb-3 text-left whitespace-nowrap w-16 text-sm text-greyscale-500",children:"打分"}),(0,r.jsx)("th",{className:"pb-3 text-center whitespace-nowrap w-14 text-sm text-greyscale-500",children:"分配"})]})}),(0,r.jsxs)("tbody",{children:[b&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:3,className:"text-center py-4",children:(0,r.jsx)(v.Z,{})})}),g&&g.length>0?g.map(function(e,t){return(0,r.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,r.jsx)("td",{className:"py-1",children:(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xs font-bold text-gray-500 min-w-[4px]",children:t+1}),(0,r.jsx)("div",{className:"font-mono",children:(0,r.jsx)(k.Z,{address:e.account})})]}),x&&(0,r.jsx)("div",{className:"text-sm text-greyscale-800 ml-3",children:x.body.verificationKeys.map(function(t,n){return(0,r.jsxs)("div",{className:"mb-2",children:[(0,r.jsxs)("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:[t,":"]}),(0,r.jsx)("div",{children:(0,r.jsx)(S.L,{text:e.infos[n]})})]},n)})})]})}),(0,r.jsx)("td",{className:"py-1 w-16 px-1",children:(0,r.jsxs)("div",{className:"flex items-center text-left",children:[(0,r.jsx)("input",{type:"number",min:"0",value:L[e.account]||"",placeholder:"0",onChange:function(t){return G(e.account,t.target.value)},onKeyDown:function(e){return Q(e,t)},tabIndex:t+1,className:"w-10 px-1 py-1 border rounded text-xs focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:en||er}),(0,r.jsx)("span",{className:"text-greyscale-500 text-xs",children:"分"})]})}),(0,r.jsx)("td",{className:"py-1 text-center w-14 whitespace-nowrap px-1",children:(0,r.jsxs)("div",{className:"leading-tight",children:[(0,r.jsx)("div",{className:"text-sm text-greyscale-600 ",children:(0,j.rl)(Y[e.account]||0)}),(0,r.jsxs)("div",{className:"text-xs text-greyscale-500 ",children:["(当前",(0,j.rl)(H[e.account]||0),")"]})]})})]},e.account)}):(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:3,className:"text-center py-4",children:"暂无数据"})}),g&&(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"py-2",children:(0,r.jsx)("div",{className:"text-left",children:(0,r.jsx)("div",{className:"text-sm text-greyscale-800",children:(0,r.jsx)("span",{children:"弃权票数："})})})}),(0,r.jsx)("td",{className:"py-2 w-16 px-1",children:(0,r.jsxs)("div",{className:"flex items-center text-left",children:[(0,r.jsx)("input",{type:"number",min:"0",value:X,placeholder:"0",onChange:function(e){return J(e.target.value)},onKeyDown:function(e){return Q(e,(null==g?void 0:g.length)||0)},tabIndex:((null==g?void 0:g.length)||0)+1,className:"w-10 px-1 py-1 border rounded text-xs focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:en||er}),(0,r.jsx)("span",{className:"text-greyscale-500 text-xs",children:"分"})]})}),(0,r.jsx)("td",{className:"py-2 text-center w-14 whitespace-nowrap px-1",children:(0,r.jsxs)("div",{className:"text-greyscale-500 text-xs leading-tight",children:[(0,r.jsx)("div",{children:(0,j.rl)(q)}),(0,r.jsxs)("div",{children:["(当前",(0,j.rl)(U>BigInt(0)?Number(T||BigInt(0))/Number(U)*100:0),")"]})]})})]})]})]})}),(0,r.jsxs)(w.z,{onClick:function(){if(f<=BigInt(2)?(B.Am.error("剩余票数不足，无法验证"),!1):!Object.values(L).every(function(e){return 0===parseInt(e)||""===e})||0!==parseInt(X)&&""!==X||(B.Am.error("请至少给一个地址或弃权投票打分"),!1)){var e=Object.values(L).reduce(function(e,t){return e+(parseInt(t)||0)},0)+(parseInt(X)||0),t=[],n=BigInt(0);g.forEach(function(s,r){var c=parseInt(L[s.account])||0,a=BigInt(Math.floor(Number(f)*(c/e)));if((n+=a)>f){var i=n-f;n-=i,t.push(a-i)}else t.push(a)});var s=t.reduce(function(e,t){return e+t},BigInt(0));if(parseInt(X)>0){var r=f>s?f-s:BigInt(0);et(null==m?void 0:m.address,i,r,t)}else{if(s<f){var c=t.findIndex(function(e){return e>BigInt(0)});-1!==c&&(t[c]+=f-s)}et(null==m?void 0:m.address,i,BigInt(0),t)}}},disabled:en||es||er,className:"mt-6 w-1/2",children:[!en&&!es&&!er&&"提交验证",en&&"提交中...",es&&"确认中...",er&&"已验证"]}),(0,r.jsx)(P.Z,{isLoading:en||es,text:en?"提交交易...":"确认交易..."})]})},R=n(42171),M=n(4307),V=function(e){var t=e.currentRound,n=e.actionId,c=e.actionInfo,a=((0,l.useContext)(u.M)||{}).token,i=(0,h.m)().address,x=(0,s._)((0,l.useState)(new Set),2),f=x[0],b=x[1],y=(0,d.LW)(null==a?void 0:a.address,t,n,"0x0000000000000000000000000000000000000000"),w=y.scoreByActionIdByAccount,B=y.isPending,_=y.error,E=(0,C.pK)(null==a?void 0:a.address,t,n),P=E.verifiedAddresses,Z=E.isPending,A=E.error,V=(0,C.X5)(null==a?void 0:a.address,t,n),T=V.verificationInfos,O=V.isPending,D=V.error,L=(0,g.wD)(null==a?void 0:a.address,t,n),F=L.votesNumByActionId,K=(L.isPending,L.error),X=(0,o.S)().handleContractError;(0,l.useEffect)(function(){A&&X(A,"dataViewer"),D&&X(D,"dataViewer"),_&&X(_,"verify"),K&&X(K,"vote")},[A,D,_,K]);var z=function(e){var t=new Set(f);t.has(e)?t.delete(e):t.add(e),b(t)},W=((null==P?void 0:P.reduce(function(e,t){return e+t.score},BigInt(0)))||BigInt(0))+(w||BigInt(0)),Y=Number(W)/Number(F||BigInt(0))*100;return(0,r.jsxs)("div",{className:"relative px-4 pb-4 w-full",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(m.Z,{title:"当前轮最新验证结果"}),(0,r.jsxs)("span",{className:"text-sm text-greyscale-500 ml-2",children:["(验证进度：",(0,j.rl)(Y),")"]})]}),(0,r.jsx)("div",{className:"flex justify-left mt-2",children:(0,r.jsx)(p.Z,{currentRound:t,roundType:"verify"})}),O||Z||B?(0,r.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,r.jsx)(v.Z,{})}):T&&0!==T.length?(0,r.jsxs)("table",{className:"table w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,r.jsx)("th",{}),(0,r.jsx)("th",{children:"被抽中地址"}),(0,r.jsx)("th",{className:"px-1 text-right",children:"获得验证票"}),(0,r.jsx)("th",{className:"px-1 text-right",children:"验证票占比"})]})}),(0,r.jsxs)("tbody",{children:[T.map(function(e){var t=null==P?void 0:P.find(function(t){return t.account===e.account});return(0,I._)((0,N._)({},e),{score:(null==t?void 0:t.score)||BigInt(0)})}).sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:0}).map(function(e){var t=null==P?void 0:P.find(function(t){return t.account===e.account}),n=f.has(e.account);return(0,r.jsxs)(l.Fragment,{children:[(0,r.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===i?"text-secondary":""),children:[(0,r.jsx)("td",{className:"px-1 w-8",children:(0,r.jsx)("button",{onClick:function(){return z(e.account)},className:"text-greyscale-400 hover:text-greyscale-600",children:n?(0,r.jsx)(R.Z,{size:16}):(0,r.jsx)(M.Z,{size:16})})}),(0,r.jsx)("td",{className:"px-1",children:(0,r.jsx)(k.Z,{address:e.account,showCopyButton:!0,word:e.account===i?"(我)":""})}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,j.tY)((null==t?void 0:t.score)||BigInt(0))}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,j.rl)(Number((null==t?void 0:t.score)||BigInt(0))/Number(W||BigInt(0))*100)})]}),c&&n&&(0,r.jsxs)("tr",{className:"border-b border-gray-100 bg-gray-50",children:[(0,r.jsx)("td",{}),(0,r.jsx)("td",{colSpan:3,className:"px-1 py-3",children:(0,r.jsxs)("div",{className:"text-sm text-greyscale-600",children:[(0,r.jsx)("div",{className:"text-xs text-greyscale-400 mb-2",children:"验证信息:"}),c.body.verificationKeys.map(function(t,n){return(0,r.jsxs)("div",{className:"mb-1",children:[(0,r.jsxs)("span",{className:"text-greyscale-500",children:[t,":"]})," ",(0,r.jsx)(S.L,{text:e.infos[n]})]},n)})]})})]})]},e.account)}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-1"}),(0,r.jsx)("td",{className:"px-1 text-greyscale-500",children:"弃权票"}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,j.tY)(w||BigInt(0))}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,j.rl)(Number(w||BigInt(0))/Number(W||BigInt(0))*100)})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-1"}),(0,r.jsx)("td",{className:"px-1 text-greyscale-500",children:"汇总 "}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,j.tY)(W||BigInt(0))}),(0,r.jsx)("td",{className:"px-1 text-right",children:"100%"})]})]})]}):(0,r.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有验证地址"})]})},T=function(){var e=BigInt((0,c.useRouter)().query.id||"0"),t=((0,l.useContext)(u.M)||{}).token,n=(0,d.Bk)(),a=n.currentRound,h=n.error,g=(0,o.S)().handleContractError;(0,l.useEffect)(function(){h&&g(h,"verify")},[h]);var j=(0,s._)((0,l.useState)(BigInt(-1)),2),y=j[0],N=j[1],I=(0,s._)((0,l.useState)(void 0),2),w=I[0],B=I[1];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.Z,{title:"验证",backUrl:"/verify/?symbol=".concat(null==t?void 0:t.symbol)}),(0,r.jsxs)("main",{className:"flex-grow",children:[y>0&&(0,r.jsxs)("div",{className:"px-4 pt-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(m.Z,{title:"请分配您的验证票："}),(0,r.jsx)(i(),{href:"/action/info/?id=".concat(e,"&symbol=").concat(null==t?void 0:t.symbol,"&tab=verify&tab2=current"),className:"text-blue-600 hover:text-blue-800 underline text-sm",children:"验证结果>>"})]}),(0,r.jsx)(p.Z,{currentRound:a,roundType:"verify",showCountdown:!1})]}),(0,r.jsx)(b,{currentRound:a,actionId:e,onRemainingVotesChange:function(e){N(e)}}),(0,r.jsxs)("div",{className:"flex flex-col items-center p-4",children:[y>BigInt(1)&&(0,r.jsx)(A,{currentRound:a,actionId:e,actionInfo:w,remainingVotes:y}),y>=BigInt(0)&&y<=BigInt(1)&&(0,r.jsx)(V,{currentRound:a,actionId:e,actionInfo:w}),y<BigInt(0)&&(0,r.jsx)(v.Z,{})]}),(0,r.jsx)(f.Z,{actionId:e,round:BigInt(a||0),showSubmitter:!0,onActionInfo:B})]})]})}}},function(e){e.O(0,[8239,367,5249,3494,2252,3950,7724,7285,7250,725,2888,9774,179],function(){return e(e.s=81130)}),_N_E=e.O()}]);