try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="c798975c-79da-42e2-8817-652e59a71422",e._sentryDebugIdIdentifier="sentry-dbid-c798975c-79da-42e2-8817-652e59a71422")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7690],{81130:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/verify/action",function(){return n(76169)}])},20725:function(e,t,n){"use strict";var r=n(85893),s=n(67294),a=n(93566),c=n(73591),i=n(93778),o=n(26858),l=n(72107),d=n(31084),u=n(44746),x=n(27460),m=n(42083);t.Z=function(e){var t=e.actionId,n=e.round,f=e.showSubmitter,h=(e.showVerifyHistory,e.onActionInfo),g=((0,s.useContext)(i.M)||{}).token,v=(0,a.dI)(null==g?void 0:g.address,t),b=v.actionInfo,p=v.isPending,y=v.error;(0,s.useEffect)(function(){h&&b&&h(b)},[b]);var j=(0,a.sK)(null==g?void 0:g.address,f?n:BigInt(0),t),N=j.submitInfo,w=j.isPending,I=j.error,B=(null==N?void 0:N.submitter)||"N/A",A=(0,c.S)().handleContractError;return((0,s.useEffect)(function(){y&&A(y,"submit"),I&&A(I,"submit")},[y,I]),p)?(0,r.jsx)(m.Z,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mx-auto p-4 pb-2 ",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("span",{className:"text-sm text-greyscale-500",children:["No.",null==b?void 0:b.head.id.toString()]}),(0,r.jsx)("span",{className:"text-xl font-bold text-black",children:null==b?void 0:b.body.title})]}),(0,r.jsxs)("div",{className:"mt-0 text-xs text-greyscale-500 flex justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:["创建人 ",(0,r.jsx)(x.Z,{address:null==b?void 0:b.head.author})]}),f&&(0,r.jsxs)("div",{className:"flex items-center",children:["推举人"," ",w?(0,r.jsx)(m.Z,{}):(0,r.jsx)(x.Z,{address:B})]})]})]}),(0,r.jsx)("div",{className:"mx-auto p-4 pb-2",children:(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("h3",{className:"text-sm font-bold",children:"最小参与代币数"}),(0,r.jsx)("p",{className:"text-greyscale-500",children:(0,o.LH)((null==b?void 0:b.body.minStake)||BigInt(0))})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,r.jsx)("h3",{className:"text-sm font-bold",children:"最大激励地址数"}),(0,r.jsx)(u.Z,{title:"最大激励地址数说明",content:(0,r.jsxs)("p",{className:"leading-relaxed text-base",children:["每轮从所有参与行动的代币中，随机抽取",(0,r.jsx)("span",{className:"font-mono font-bold text-blue-600 mx-1 text-base",children:null==b?void 0:b.body.maxRandomAccounts.toString()}),"份代币，返回对应地址。若多份代币对应相同地址，则会合并为一个地址。"]})})]}),(0,r.jsx)("p",{className:"text-greyscale-500",children:(null==b?void 0:b.body.maxRandomAccounts.toString())||"-"})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("h3",{className:"text-sm font-bold mb-2",children:"验证规则"}),(0,r.jsx)("div",{className:"text-greyscale-500",children:(0,r.jsx)(l.L,{text:null==b?void 0:b.body.verificationRule,preserveLineBreaks:!0})})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("h3",{className:"text-sm font-bold mb-2",children:"报名参加行动时，行动者要提供的信息"}),(null==b?void 0:b.body.verificationKeys)&&(null==b?void 0:b.body.verificationKeys.length)>0?(0,r.jsx)("ul",{className:"list-disc pl-5",children:b.body.verificationKeys.map(function(e,t){return(0,r.jsxs)("li",{className:"text-greyscale-500",children:[(0,r.jsxs)("div",{className:"text-sm font-bold text-greyscale-900 mb-1",children:[(0,r.jsx)(d.Z,{text:e,showWarning:!0})," :"]}),(0,r.jsx)("div",{children:(0,r.jsx)(d.Z,{text:b.body.verificationInfoGuides[t],showWarning:!0,preserveLineBreaks:!0})})]},t)})}):(0,r.jsx)("span",{className:"text-greyscale-500",children:"无"})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("h3",{className:"text-sm font-bold",children:"白名单"}),(0,r.jsx)("p",{className:"text-greyscale-500 flex flex-wrap items-center",children:(null==b?void 0:b.body.whiteListAddress)&&"0x0000000000000000000000000000000000000000"!==b.body.whiteListAddress?(0,r.jsx)("span",{className:"flex items-center mr-2",children:(0,r.jsx)(x.Z,{address:b.body.whiteListAddress})}):"无限制"})]})]})})]})}},44746:function(e,t,n){"use strict";n.d(t,{Z:function(){return x}});var r=n(72253),s=n(14932),a=n(91309),c=n(85893),i=n(67294),o=n(74598),l=n(35810),d=n(26986),u=n(79995);function x(e){var t=e.title,n=e.content,x=e.className,m=void 0===x?"":x,f=(0,a._)((0,i.useState)(!1),2),h=f[0],g=f[1],v=(0,u.Z)("(min-width: 768px)"),b=i.forwardRef(function(e,n){return(0,c.jsx)("button",(0,s._)((0,r._)({ref:n,type:"button",className:"inline-flex items-center p-1 rounded hover:bg-gray-100 transition-colors ".concat(m),"aria-label":"查看".concat(t)},e),{children:(0,c.jsx)(o.Z,{className:"h-4 w-4 text-gray-500 hover:text-gray-700"})}))});b.displayName="TriggerButton";var p=function(){return(0,c.jsx)("div",{className:"text-gray-700",children:"string"==typeof n?(0,c.jsx)("p",{className:"leading-relaxed text-sm",children:n}):n})};return(0,c.jsxs)(c.Fragment,{children:[v&&(0,c.jsxs)(l.Vq,{open:h,onOpenChange:g,children:[(0,c.jsx)(l.hg,{asChild:!0,children:(0,c.jsx)(b,{})}),(0,c.jsxs)(l.cZ,{className:"sm:max-w-[425px]",children:[(0,c.jsx)(l.$N,{className:"text-lg font-semibold",children:t}),(0,c.jsx)("div",{className:"pt-2 pb-4",children:(0,c.jsx)(p,{})})]})]}),!v&&(0,c.jsxs)(d.dy,{open:h,onOpenChange:g,children:[(0,c.jsx)(d.Qz,{asChild:!0,children:(0,c.jsx)(b,{})}),(0,c.jsxs)(d.sc,{className:"pb-safe",children:[(0,c.jsx)(d.OX,{children:(0,c.jsx)(d.iI,{className:"text-lg font-semibold",children:t})}),(0,c.jsx)("div",{className:"px-4 pb-8 mb-10",children:(0,c.jsx)(p,{})})]})]})]})}},64777:function(e,t,n){"use strict";var r=n(85893);t.Z=function(e){var t=e.title;return(0,r.jsx)("div",{className:"flex justify-between items-center",children:(0,r.jsx)("h1",{className:"text-lg font-bold",children:t})})}},21338:function(e,t,n){"use strict";var r=n(91309),s=n(85893),a=n(67294),c=n(88504),i=n(93778),o=n(74089),l=n(42083);t.Z=function(e){var t=e.currentRound,n=e.roundType,d=e.showCountdown,u=(0,c.O)().data,x=(0,a.useContext)(i.M),m=x?x.token:void 0,f=!u||!m||void 0===m.voteOriginBlocks,h=(0,r._)((0,a.useState)(BigInt(0)),2),g=h[0],v=h[1],b=Number("30126")||0,p=Number("2868")||0,y=m?Number(m.voteOriginBlocks):0,j=b-(Number(u)-y)%b,N=j>0?Math.ceil(j*p/1e3):0,w=(0,r._)((0,a.useState)(N),2),I=w[0],B=w[1];(0,a.useEffect)(function(){if(u){var e=b-(Number(u)-y)%b;B(e>0?Math.ceil(e*p/1e3):0)}},[u,b,p,y]),(0,a.useEffect)(function(){t>BigInt(0)&&v(t)},[t]);var A=null!=g?g.toString():"0";return g<=BigInt(0)?(0,s.jsx)(s.Fragment,{}):f||null==g||g<BigInt(0)?((null==g||g<BigInt(0))&&(console.log("currentTokenRound",g),console.log("currentRound",t)),(0,s.jsx)(l.Z,{})):(0,s.jsx)("div",{className:"flex items-center mb-3",children:(0,s.jsxs)("span",{className:"text-sm text-greyscale-400",children:["(第",(0,s.jsx)("span",{className:"text-greyscale-400",children:A}),"轮","vote"===n?"投票":"verify"===n?"验证":"行动","阶段，",(0,s.jsx)("span",{className:"text-greyscale-400",children:"剩余"}),(0,s.jsx)("span",{className:"text-greyscale-400",children:Math.ceil(1e3*I/p)}),(0,s.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),void 0===d||d?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(o.Z,{initialTimeLeft:N,onTick:B})}):(0,s.jsx)("span",{className:"text-greyscale-400",children:I<60?"".concat(I,"秒"):I<=300?"".concat(Math.floor(I/60),"分钟").concat(I%60,"秒"):I<3600?"".concat(Math.floor(I/60),"分钟"):"".concat(Math.floor(I/3600),"小时").concat(Math.floor(I%3600/60),"分钟")}),(0,s.jsx)("span",{className:"text-greyscale-400",children:")"})]})})}},31084:function(e,t,n){"use strict";var r=n(85893);n(67294);var s=n(45655);t.Z=function(e){var t=e.text,n=e.className,a=e.maxLength,c=e.showWarning,i=e.preserveLineBreaks;if(!t)return null;var o=t;a&&t.length>a&&(o=t.substring(0,a)+"...");var l=(0,s.KL)(o,void 0!==i&&i),d=t!==o||/<[^>]*>/g.test(t)||/script|javascript|onclick|onerror|onload/gi.test(t);return(0,r.jsxs)("span",{className:void 0===n?"":n,children:[(0,r.jsx)("span",{dangerouslySetInnerHTML:{__html:l}}),void 0!==c&&c&&d&&(0,r.jsx)("span",{className:"text-yellow-500 text-xs ml-1",children:"⚠️ 内容已被安全过滤"})]})}},76169:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ee}});var r,s,a=n(91309),c=n(85893),i=n(11163),o=n(41664),l=n.n(o),d=n(67294),u=n(59271),x=n(73591),m=n(93778),f=n(83494),h=n(20725),g=n(64777),v=n(42130),b=n(7080),p=n(26858),y=n(42083),j=function(e){var t=e.currentRound,n=e.actionId,r=e.onRemainingVotesChange,s=((0,d.useContext)(m.M)||{}).token,a=(0,v.m)().address,i=(0,b.Ol)(null==s?void 0:s.address,t,a||"",n),o=i.votesNumByAccountByActionId,l=i.isPending,f=i.error,h=(0,u.Tl)(null==s?void 0:s.address,t,a||"",n),g=h.scoreByVerifierByActionId,j=h.isPending,N=h.error,w=l||j?BigInt(0):o-g;(0,d.useEffect)(function(){l||j||(console.log("remainingVotes",w),console.log("isPendingVotesNumByAccount",l),console.log("isPendingScoreByVerifier",j),null==r||r(w))},[w,l,j]);var I=(0,x.S)().handleContractError;return((0,d.useEffect)(function(){f&&I(f,"vote"),N&&I(N,"verify")},[f,N]),w<=0)?(0,c.jsx)(c.Fragment,{}):(0,c.jsx)("div",{className:"px-4",children:(0,c.jsxs)("div",{className:"text-center bg-greyscale-100 p-4 rounded-lg",children:[(0,c.jsxs)("span",{className:"text-greyscale-800 text-base",children:["我的剩余验证票数：",l||j?(0,c.jsx)(y.Z,{}):(0,c.jsx)("span",{className:"text-secondary",children:(0,p.LH)(w)})]}),(0,c.jsx)("div",{className:"mt-2 text-sm text-greyscale-500 text-center",children:"提示: 您的验证票，将按“打分比例”分配给行动参与者"})]})})},N=n(21338),w=n(11010),I=n(75766),B=n(72253),A=n(14932),C=n(4586),S=n(97582),k=n(27245),_=n(35810),E=n(21774),Z=n(86501),L=n(44746),V=function(e){var t=e.isOpen,n=e.onClose,r=e.onConfirm,s=e.title,a=e.description,i=e.placeholder,o=(0,d.useRef)(null);return((0,d.useEffect)(function(){var e=function(e){"Escape"===e.key&&n()};return t&&(document.addEventListener("keydown",e),setTimeout(function(){var e;null===(e=o.current)||void 0===e||e.focus()},100)),function(){document.removeEventListener("keydown",e)}},[t,n]),t)?(0,c.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[10000] p-5",onClick:function(e){e.target===e.currentTarget&&n()},children:(0,c.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md text-center shadow-xl",children:[(0,c.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:void 0===s?"粘贴分数数据":s}),(0,c.jsx)("p",{className:"text-sm text-gray-600 mb-4 leading-relaxed",children:void 0===a?"请将复制的分数数据粘贴到下方文本框中（每行一个数字）":a}),(0,c.jsx)("textarea",{ref:o,placeholder:void 0===i?"请粘贴分数数据...":i,className:"w-full h-32 p-3 border border-gray-300 rounded-md font-mono text-sm resize-none mb-4 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"}),(0,c.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,c.jsx)("button",{onClick:function(){var e,t=(null===(e=o.current)||void 0===e?void 0:e.value.trim())||"";t?(r(t),n()):Z.Am.error("请输入分数数据")},className:"px-4 py-2 bg-[#1e3a8a] text-white rounded-md hover:bg-gray-500/90 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors font-medium",children:"确认粘贴"}),(0,c.jsx)("button",{onClick:n,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors font-medium",children:"取消"})]})]})}):null},T=function(e){var t=e.isOpen,n=e.onClose,r=e.text,s=e.title,a=e.description,i=e.autoCloseDelay,o=void 0===i?3e4:i,l=(0,d.useRef)(null);return((0,d.useEffect)(function(){var e=function(e){"Escape"===e.key&&n()};if(t){document.addEventListener("keydown",e),setTimeout(function(){l.current&&(l.current.focus(),l.current.select(),l.current.setSelectionRange(0,l.current.value.length))},100);var r=null;return o>0&&(r=setTimeout(function(){n()},o)),function(){document.removeEventListener("keydown",e),r&&clearTimeout(r)}}},[t,n,o]),t)?(0,c.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[10000] p-5",onClick:function(e){e.target===e.currentTarget&&n()},children:(0,c.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md text-center shadow-xl",children:[(0,c.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:void 0===s?"请手动复制":s}),(0,c.jsx)("p",{className:"text-sm text-gray-600 mb-4 leading-relaxed",children:void 0===a?"自动复制功能不可用，请手动选择并复制以下内容：":a}),(0,c.jsx)("textarea",{ref:l,value:r,readOnly:!0,className:"w-full h-32 p-3 border border-gray-300 rounded-md font-mono text-sm resize-none mb-4 bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"}),(0,c.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,c.jsx)("button",{onClick:function(){l.current&&(l.current.focus(),l.current.select(),l.current.setSelectionRange(0,l.current.value.length),Z.Am.success("已全选文本，请按 Ctrl+C 复制"))},className:"px-4 py-2 bg-[#1e3a8a] text-white rounded-md hover:bg-gray-500/90 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors font-medium",children:"全选文本"}),(0,c.jsx)("button",{onClick:n,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors font-medium",children:"关闭"})]}),o>0&&(0,c.jsxs)("p",{className:"text-xs text-gray-500 mt-3",children:[Math.round(o/1e3)," 秒后自动关闭"]})]})}):null},P=(r=(0,w._)(function(e){var t,n;return(0,S.Jh)(this,function(r){switch(r.label){case 0:if(!(navigator.clipboard&&navigator.clipboard.writeText))return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,navigator.clipboard.writeText(e)];case 2:return r.sent(),[2,{success:!0,method:"clipboard"}];case 3:return console.warn("Clipboard API 失败，尝试降级方案:",r.sent()),[3,4];case 4:try{if((t=document.createElement("textarea")).value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",t.style.opacity="0",t.style.pointerEvents="none",t.setAttribute("readonly",""),document.body.appendChild(t),t.focus(),t.select(),t.setSelectionRange(0,t.value.length),n=document.execCommand("copy"),document.body.removeChild(t),n)return[2,{success:!0,method:"execCommand"}]}catch(e){console.warn("execCommand 复制失败:",e)}return[2,{success:!1,method:"manual",error:"浏览器不支持自动复制，需要手动复制"}]}})}),function(e){return r.apply(this,arguments)}),O=(s=(0,w._)(function(e,t,n){var r;return(0,S.Jh)(this,function(s){switch(s.label){case 0:return[4,P(e)];case 1:return(r=s.sent()).success?Z.Am.success(t):n?n(e):Z.Am.error(r.error||"复制失败，请手动复制"),[2]}})}),function(e,t,n){return s.apply(this,arguments)}),R=n(18289),M=n(31134),K=(0,M.Z)("Clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]),z=(0,M.Z)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),F=n(93950),D=n(67516),q=n(43637),H=function(e){var t=e.verifier,n=e.round,r=e.tokenAddress,s=e.actionId,a=e.accounts,c=e.enabled,i=void 0===c||c,o=(0,d.useMemo)(function(){return i&&0!==a.length&&t&&r?a.map(function(e){return{address:"0x547b4a36980Ec030fBfC0162eE4B4904d9Cc0Da9",abi:q.w,functionName:"scoreByVerifierByActionIdByAccount",args:[r,n,t,s,e]}}):[]},[r,n,t,s,a,i]),l=(0,D.N)({contracts:o,query:{enabled:i&&o.length>0}}),u=l.data,x=l.isLoading,m=l.error,f=l.isSuccess,h=(0,d.useMemo)(function(){if(!i||0===a.length)return{scores:[],isLoading:!1,hasError:!1,allLoaded:!0};var e=a.map(function(e,t){var n=null==u?void 0:u[t];return{account:e,score:(null==n?void 0:n.status)==="success"&&n.result||BigInt(0),isPending:x,error:(null==n?void 0:n.status)==="failure"?n.error:m||null}}),t=!!m||e.some(function(e){return null!==e.error});return{scores:e,isLoading:x,hasError:t,allLoaded:f}},[u,a,i,x,m,f]);return{scores:h.scores,isLoading:h.isLoading,hasError:h.hasError,allLoaded:h.allLoaded,getScoresArray:function(){return h.scores.map(function(e){return e.score})},getScoresMap:function(){var e={};return h.scores.forEach(function(t){e[t.account]=t.score}),e},hasValidData:i&&a.length>0&&!!t&&!!r}},J=n(27460),$=n(44576),W=n(72107),X=n(1938),U=function(e){var t,n,r,s,i,o,l=e.currentRound,f=e.actionId,h=e.actionInfo,g=e.remainingVotes,v=((0,d.useContext)(m.M)||{}).token,b=(0,F.X5)(null==v?void 0:v.address,l,f),j=b.verificationInfos,N=b.isPending,P=b.error,M=(0,F.pK)(null==v?void 0:v.address,l,f),D=M.verifiedAddresses,q=(M.isPending,M.error),U=(0,u.LW)(null==v?void 0:v.address,l,f,"0x0000000000000000000000000000000000000000"),G=U.scoreByActionIdByAccount,Q=(U.isPending,U.error),Y=(0,a._)((0,d.useState)({}),2),ee=Y[0],et=Y[1],en=(0,a._)((0,d.useState)("0"),2),er=en[0],es=en[1],ea=(0,a._)((0,d.useState)(!1),2),ec=ea[0],ei=ea[1],eo=(0,a._)((0,d.useState)(!1),2),el=eo[0],ed=eo[1],eu=(0,a._)((0,d.useState)(""),2),ex=eu[0],em=eu[1],ef=(0,a._)((0,d.useState)(!1),2),eh=ef[0],eg=ef[1],ev=(0,a._)((0,d.useState)(""),2),eb=ev[0],ep=ev[1],ey=(0,a._)((0,d.useState)(!1),2),ej=ey[0],eN=ey[1],ew=(0,a._)((0,d.useState)(!1),2),eI=ew[0],eB=ew[1],eA=(0,a._)((0,d.useState)(""),2),eC=eA[0],eS=eA[1],ek=(0,a._)((0,d.useState)(null),2),e_=ek[0],eE=ek[1],eZ=(0,a._)((0,d.useState)(!1),2),eL=eZ[0],eV=eZ[1],eT=(0,d.useMemo)(function(){return(null==j?void 0:j.map(function(e){return e.account}))||[]},[j]),eP=(0,d.useMemo)(function(){var e,t;return eL?(e=(0,C._)(eT),t="0x0000000000000000000000000000000000000000",e.includes(t)||e.push(t),e):eT},[eT,eL]),eO=H({verifier:eb,round:l,tokenAddress:null==v?void 0:v.address,actionId:f,accounts:eP,enabled:eL&&!!eb&&eP.length>0});(0,d.useEffect)(function(){if(j&&j.length>0){var e={};j.forEach(function(t){e[t.account]=""}),et(e),es("")}},[j]),(0,d.useEffect)(function(){if(eL&&eO.allLoaded&&!eO.isLoading){if(eN(!1),eO.hasError){Z.Am.error("获取验证者打分失败，请检查地址是否正确"),eV(!1);return}var e,t=eO.getScoresMap(),n={};Object.entries(t).forEach(function(e){var t=(0,a._)(e,2),r=t[0],s=t[1];n[r]=s});var r=function(e){var t=Object.values(e);if(console.log("scoreValues",t),0===t.length)return{};var n=t.reduce(function(e,t){return t>e?t:e},BigInt(0));if(n===BigInt(0)){var r={};return Object.keys(e).forEach(function(e){r[e]="0"}),r}var s={};return Object.entries(e).forEach(function(e){var t=(0,a._)(e,2),r=t[0],c=t[1],i=c*BigInt(1e3)/n,o=c*BigInt(1e3)%n*BigInt(2)>=n?Number(i)+1:Number(i);s[r]=o.toString()}),s}(n),s=r["0x0000000000000000000000000000000000000000"]||"0",c=(e=(0,B._)({},r),delete e["0x0000000000000000000000000000000000000000"],e),i=(0,B._)({},ee);j&&j.forEach(function(e){var t=c[e.account];i[e.account]=t||"0"}),et(i),es(s),eg(!1),eV(!1),Z.Am.success("已应用验证者 ".concat(eb.slice(0,6),"...").concat(eb.slice(-4)," 的打分（已缩放到0-1000）"))}},[eL,eO.allLoaded,eO.isLoading,eO.hasError,eO,ee,j,eb]);var eR=function(){var e=Object.values(ee).map(function(e){return parseInt(e)||0}),t=parseInt(er)||0,n=e.reduce(function(e,t){return e+t},0)+t;if(0===n)return{addressPercentages:{},abstainPercentage:0};var r={};return Object.keys(ee).forEach(function(e){var t=parseInt(ee[e])||0;r[e]=t/n*100}),{addressPercentages:r,abstainPercentage:t/n*100}}(),eM=eR.addressPercentages,eK=eR.abstainPercentage,ez=(t={},(n=((null==D?void 0:D.reduce(function(e,t){return e+t.score},BigInt(0)))||BigInt(0))+(G||BigInt(0)))>BigInt(0)&&(null==j||j.forEach(function(e){var r=null==D?void 0:D.find(function(t){return t.account===e.account}),s=(null==r?void 0:r.score)||BigInt(0);t[e.account]=Number(s)/Number(n)*100})),{verificationPercentages:t,totalVerifiedVotes:n}),eF=ez.verificationPercentages,eD=ez.totalVerifiedVotes,eq=function(e,t){(""===t||/^[0-9]+$/.test(t))&&et((0,A._)((0,B._)({},ee),(0,I._)({},e,t)))},eH=function(e){(""===e||/^[0-9]+$/.test(e))&&es(e)},eJ=(r=(0,w._)(function(){var e,t,n;return(0,S.Jh)(this,function(r){switch(r.label){case 0:if(r.trys.push([0,10,,11]),e="",t=!1,n=/Trust/i.test(navigator.userAgent),!(navigator.clipboard&&navigator.clipboard.readText&&!n))return[3,8];r.label=1;case 1:return r.trys.push([1,6,,7]),[4,navigator.permissions.query({name:"clipboard-read"})];case 2:if("denied"!==r.sent().state)return[3,3];return t=!0,[3,5];case 3:return[4,navigator.clipboard.readText()];case 4:e=r.sent(),r.label=5;case 5:return[3,7];case 6:return console.warn("Clipboard API 读取失败:",r.sent()),t=!0,[3,7];case 7:return[3,9];case 8:t=!0,r.label=9;case 9:if(t||!e)return ei(!0),[2];return e$(e),[3,11];case 10:return console.error("粘贴功能出错:",r.sent()),ei(!0),[3,11];case 11:return[2]}})}),function(){return r.apply(this,arguments)}),e$=function(e){var t=e.split("\n").map(function(e){return e.trim()}).filter(function(e){return""!==e}),n=[],r=!0,s=!1,a=void 0;try{for(var c,i=t[Symbol.iterator]();!(r=(c=i.next()).done);r=!0){var o=c.value;if(/^[0-9]+$/.test(o))n.push(o);else if(""!==o){Z.Am.error('无效的数字格式: "'.concat(o,'"'));return}}}catch(e){s=!0,a=e}finally{try{r||null==i.return||i.return()}finally{if(s)throw a}}if(0===n.length){Z.Am.error("没有找到有效的数字");return}var l=((null==j?void 0:j.length)||0)+1;if(n.length>l){Z.Am.error("数字过多，最多支持 ".concat(l," 个数字"));return}var d=(0,B._)({},ee),u=0;if(j)for(var x=0;x<j.length&&u<n.length;x++)d[j[x].account]=n[u],u++;var m=er;u<n.length&&(m=n[u]),et(d),es(m),Z.Am.success("成功粘贴 ".concat(n.length," 个分数"))},eW=(s=(0,w._)(function(){var e;return(0,S.Jh)(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),e=[],j&&j.forEach(function(t){var n=ee[t.account]||"0";e.push(n)}),e.push(er||"0"),[4,O(e.join("\n"),"已复制 ".concat(e.length," 个分数到剪贴板"),function(e){em(e),ed(!0)})];case 1:return t.sent(),[3,3];case 2:return console.error("复制功能出错:",t.sent()),Z.Am.error("复制功能暂时不可用，请手动记录分数"),[3,3];case 3:return[2]}})}),function(){return s.apply(this,arguments)}),eX=(i=(0,w._)(function(){var e,t,n;return(0,S.Jh)(this,function(r){switch(r.label){case 0:if(r.trys.push([0,2,,3]),!j||0===j.length)return Z.Am.error("没有可复制的地址"),[2];return e=[],t=(null==h?void 0:h.body.verificationKeys)||[],n=["地址","后4位"].concat((0,C._)(t)),e.push(n.join("	")),j.forEach(function(t){var n=t.account,r=n.slice(-4),s=t.infos||[],a=[n,r].concat((0,C._)(s));e.push(a.join("	"))}),[4,O(e.join("\n"),"已复制 ".concat(j.length," 个地址信息到剪贴板"),function(e){em(e),ed(!0)})];case 1:return r.sent(),[3,3];case 2:return console.error("复制功能出错:",r.sent()),Z.Am.error("复制功能暂时不可用，请手动记录地址"),[3,3];case 3:return[2]}})}),function(){return i.apply(this,arguments)}),eU=function(e){ep(e)},eG=(o=(0,w._)(function(){return(0,S.Jh)(this,function(e){return eb?/^0x[a-fA-F0-9]{40}$/.test(eb)?j&&0!==j.length?(eN(!0),eV(!0),console.log("开始获取验证者真实打分 (批量RPC调用):",{verifier:eb,round:l.toString(),tokenAddress:null==v?void 0:v.address,actionId:f.toString(),accounts:j.map(function(e){return e.account}),message:"将获取所有账户分数和弃权票，并缩放到0-1000范围"})):Z.Am.error("没有可验证的地址"):Z.Am.error("请输入有效的以太坊地址"):Z.Am.error("请输入验证者地址"),[2]})}),function(){return o.apply(this,arguments)}),eQ=function(e,t){if((e.ctrlKey||e.metaKey)&&"v"===e.key){e.preventDefault(),eJ();return}if("Enter"===e.key||"Tab"===e.key){e.preventDefault();var n=document.querySelectorAll('input[type="number"]:not([disabled])'),r=(t+1)%n.length,s=n[r];s&&(s.focus(),s.select())}},eY=(0,u.yl)(),e0=eY.verify,e1=eY.isPending,e2=eY.isConfirming,e4=eY.isConfirmed,e3=eY.writeError,e5=function(){if(!j||j.length<3)return{hasAbnormal:!1,message:""};var e=[],t=j.length,n=[],r=[];if(j.forEach(function(e,t){var s=parseInt(ee[e.account])||0;s>0?n.push({address:e.account,score:s,index:t}):r.push({address:e.account,index:t})}),r.length>t/10&&f!==BigInt(19)&&e.push("有 ".concat(r.length," 个地址被打了0分")),n.length>=2){n.sort(function(e,t){return t.score-e.score});for(var s=n[0].score,a=0,c=1;c<n.length;c++)if(n[c].score<s){a=n[c].score;break}if(a>0&&s>5*a){var i=n.filter(function(e){return e.score===s});if(1===i.length){var o=i[0].index+1,l=i[0].address.slice(-4);e.push("第 ".concat(o," 行地址 ").concat(l," 得分 ").concat(s," 比其他得分大很多"))}else{var d=i.map(function(e){return"".concat(e.index+1,"(").concat(e.address.slice(-4),")")}).join("、");e.push("第 ".concat(d," 行地址得分都是 ").concat(s,"，比其他得分大很多"))}}}return e.length>0?{hasAbnormal:!0,message:e.join("，")+"，请确认是否提交？"}:{hasAbnormal:!1,message:""}},e6=function(e,t){console.log("currentAbstainVotes",e),e0(null==v?void 0:v.address,f,e,t)};(0,d.useEffect)(function(){e4&&!e3&&(Z.Am.success("提交成功",{duration:2e3}),setTimeout(function(){X.N.reloadWithOverlay()},2e3))},[e4,e3]);var e9=(0,x.S)().handleContractError;return(0,d.useEffect)(function(){e3&&e9(e3,"verify"),P&&e9(P,"dataViewer"),q&&e9(q,"dataViewer"),Q&&e9(Q,"verify")},[e3,P,q,Q]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"w-full max-w-2xl",children:[(0,c.jsx)("div",{className:"mb-4 flex justify-center",children:(0,c.jsxs)("button",{onClick:eX,disabled:e1||e4||!j||0===j.length,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",title:"复制被抽中的地址及验证信息（包含地址、后4位、验证信息）",children:[(0,c.jsx)(R.Z,{size:16}),"复制被抽中地址"]})}),(0,c.jsxs)("table",{className:"w-full border-collapse",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,c.jsx)("th",{className:"pb-3 text-left text-sm text-greyscale-500",children:(0,c.jsxs)("div",{className:"flex items-center gap-1",children:["被抽中的行动参与者",(0,c.jsx)(L.Z,{title:"最大激励地址数说明",content:(0,c.jsxs)("p",{className:"leading-relaxed text-base",children:["每轮从所有参与行动的代币中，随机抽取",(0,c.jsx)("span",{className:"font-mono font-bold text-blue-600 mx-1 text-base",children:null==h?void 0:h.body.maxRandomAccounts.toString()}),"份代币，返回对应地址。若多份代币对应相同地址，则会合并为一个地址。"]})})]})}),(0,c.jsx)("th",{className:"pb-3 text-left whitespace-nowrap w-16 text-sm text-greyscale-500",children:(0,c.jsxs)("div",{className:"flex items-center gap-1",children:["打分",(0,c.jsx)("button",{onClick:eJ,disabled:e1||e4,className:"ml-1 p-1 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded disabled:text-gray-300 disabled:cursor-not-allowed transition-colors",title:"粘贴分数数据（自动检测剪贴板或手动输入，每行一个数字）",children:(0,c.jsx)(K,{size:14})}),!1]})}),(0,c.jsx)("th",{className:"pb-3 text-center whitespace-nowrap w-12 text-sm text-greyscale-500",children:"分配"})]})}),(0,c.jsxs)("tbody",{children:[N&&(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:3,className:"text-center py-4",children:(0,c.jsx)(y.Z,{})})}),j&&j.length>0?j.map(function(e,t){return(0,c.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,c.jsx)("td",{className:"py-1",children:(0,c.jsxs)("div",{className:"text-left",children:[(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsx)("span",{className:"text-xs font-bold text-gray-500 min-w-[4px]",children:t+1}),(0,c.jsx)("div",{className:"font-mono",children:(0,c.jsx)(J.Z,{address:e.account,showCopyLast4Button:!0})})]}),h&&(0,c.jsx)("div",{className:"text-sm text-greyscale-800 ml-3",children:h.body.verificationKeys.map(function(t,n){return(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsxs)("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:[t,":"]}),(0,c.jsx)("div",{children:(0,c.jsx)(W.L,{text:e.infos[n]})})]},n)})})]})}),(0,c.jsx)("td",{className:"py-1 w-18 px-1",children:(0,c.jsxs)("div",{className:"flex items-center text-left",children:[(0,c.jsx)("input",{type:"number",min:"0",value:ee[e.account]||"",placeholder:"0",onChange:function(t){return eq(e.account,t.target.value)},onKeyDown:function(e){return eQ(e,t)},tabIndex:t+1,className:"w-16 px-1 py-1 border rounded text-xs focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:e1||e4}),(0,c.jsx)("span",{className:"text-greyscale-500 text-xs",children:"分"})]})}),(0,c.jsx)("td",{className:"py-1 text-center w-12 whitespace-nowrap px-0",children:(0,c.jsxs)("div",{className:"leading-tight",children:[(0,c.jsx)("div",{className:"text-sm text-greyscale-600 ",children:(0,p.rl)(eM[e.account]||0)}),(0,c.jsxs)("div",{className:"text-xs text-greyscale-500 ",children:["(当前",(0,p.rl)(eF[e.account]||0),")"]})]})})]},e.account)}):(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:3,className:"text-center py-4",children:"暂无数据"})}),j&&(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{className:"py-2",children:(0,c.jsx)("div",{className:"text-left",children:(0,c.jsx)("div",{className:"text-sm text-greyscale-800",children:(0,c.jsx)("span",{children:"弃权票数："})})})}),(0,c.jsx)("td",{className:"py-2 w-16 px-1",children:(0,c.jsxs)("div",{className:"flex items-center text-left",children:[(0,c.jsx)("input",{type:"number",min:"0",value:er,placeholder:"0",onChange:function(e){return eH(e.target.value)},onKeyDown:function(e){return eQ(e,(null==j?void 0:j.length)||0)},tabIndex:((null==j?void 0:j.length)||0)+1,className:"w-14 px-1 py-1 border rounded text-xs focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:e1||e4}),(0,c.jsx)("span",{className:"text-greyscale-500 text-xs",children:"分"})]})}),(0,c.jsx)("td",{className:"py-2 text-center w-14 whitespace-nowrap px-0",children:(0,c.jsxs)("div",{className:"text-greyscale-500 text-xs leading-tight",children:[(0,c.jsx)("div",{children:(0,p.rl)(eK)}),(0,c.jsxs)("div",{children:["(当前",(0,p.rl)(eD>BigInt(0)?Number(G||BigInt(0))/Number(eD)*100:0),")"]})]})})]})]})]})]}),(0,c.jsxs)("div",{className:"mt-4 flex justify-center gap-1",children:[(0,c.jsx)("button",{onClick:eW,disabled:e1||e4,className:"flex items-center gap-0 px-2 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg border border-gray-200 hover:border-blue-200 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors",title:"复制当前所有分数到剪贴板（每行一个分数）",children:"复制分数"}),(0,c.jsx)("button",{onClick:eJ,disabled:e1||e4,className:"flex items-center gap-0 px-2 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg border border-gray-200 hover:border-blue-200 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors",title:"粘贴分数数据（自动检测剪贴板或手动输入，每行一个数字）",children:"从剪贴板粘贴"}),(0,c.jsxs)("button",{onClick:function(){return eg(!0)},disabled:e1||e4||!j||0===j.length,className:"flex items-center gap-1 px-2 py-2 text-sm text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg border border-gray-200 hover:border-green-200 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors",title:"输入验证者地址，自动获取其打分并填入表单",children:[(0,c.jsx)(z,{size:16}),"用其他验证者打分"]})]}),(0,c.jsxs)(k.z,{onClick:function(){if(g<=BigInt(2)?(Z.Am.error("剩余票数不足，无法验证"),!1):!Object.values(ee).every(function(e){return 0===parseInt(e)||""===e})||0!==parseInt(er)&&""!==er||(Z.Am.error("请至少给一个地址或弃权投票打分"),!1)){var e=Object.values(ee).reduce(function(e,t){return e+(parseInt(t)||0)},0)+(parseInt(er)||0);console.log("-------handleSubmit()-------"),console.log("scoreSum",e);for(var t=[],n=BigInt(0),r=BigInt(e),s=0;s<j.length;s++){var a=g*BigInt(parseInt(ee[j[s].account])||0)/r,c=n+a>g?g-n:a;if(t.push(c),(n+=c)>=g){for(var i=s+1;i<j.length;i++)t.push(BigInt(0));break}}var o=t.reduce(function(e,t){return e+t},BigInt(0));if(o>g){console.error("计算错误：分配票数超过剩余票数",{scoresArrayTotal:o.toString(),remainingVotes:g.toString()}),Z.Am.error("票数分配计算错误，请重试");return}console.log("remainingVotes",g),console.log("scoresArrayTotal",o),console.log("scoresArrayForSubmit",t);var l=g-o;if(l<BigInt(0)){console.error("计算错误：弃权票数为负数",{remainingVotes:g.toString(),scoresArrayTotal:o.toString(),currentAbstainVotes:l.toString()}),Z.Am.error("票数分配计算错误，请重试");return}var d=o+l;if(d!==g){console.error("最终检查失败：总票数不等于剩余票数",{finalTotalVotes:d.toString(),remainingVotes:g.toString(),scoresArrayTotal:o.toString(),currentAbstainVotes:l.toString()}),Z.Am.error("票数分配不完整，请重试");return}var u=e5();if(u.hasAbnormal){eE({currentAbstainVotes:l,scoresArrayForSubmit:t}),eS(u.message),eB(!0);return}e6(l,t)}},disabled:e1||e2||e4,className:"mt-6 w-1/2",children:[!e1&&!e2&&!e4&&"提交验证",e1&&"提交中...",e2&&"确认中...",e4&&"已验证"]}),(0,c.jsx)($.Z,{isLoading:e1||e2,text:e1?"提交交易...":"确认交易..."}),(0,c.jsx)(V,{isOpen:ec,onClose:function(){return ei(!1)},onConfirm:e$,title:"粘贴分数数据",description:"请将复制的分数数据粘贴到下方文本框中（每行一个数字）",placeholder:"请粘贴分数数据... 例如： 10 20 5 0"}),(0,c.jsx)(T,{isOpen:el,onClose:function(){return ed(!1)},text:ex,title:"请手动复制分数",description:"自动复制功能不可用，请选择以下文本并手动复制（每行一个分数）："}),(0,c.jsx)(_.Vq,{open:eh,onOpenChange:eg,children:(0,c.jsxs)(_.cZ,{className:"sm:max-w-md",children:[(0,c.jsx)(_.fK,{children:(0,c.jsx)(_.$N,{children:"选择他验证者"})}),(0,c.jsx)("div",{className:"space-y-4",children:(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsx)("label",{htmlFor:"verifier-address",className:"text-sm font-medium text-gray-700",children:"验证者地址"}),(0,c.jsx)(E.I,{id:"verifier-address",type:"text",placeholder:"请输入验证者的以太坊地址 (0x...)",value:eb,onChange:function(e){return eU(e.target.value)},className:"font-mono text-sm",disabled:ej}),(0,c.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"验证者打分，会等比例缩放到区间 0~1000"})]})}),(0,c.jsxs)(_.cN,{className:"flex gap-2",children:[(0,c.jsx)(k.z,{variant:"outline",onClick:function(){eg(!1),ep(""),eN(!1),eV(!1)},disabled:ej,children:"取消"}),(0,c.jsx)(k.z,{onClick:eG,disabled:!eb||ej,className:"min-w-[100px]",children:ej?(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsx)(y.Z,{}),"获取中..."]}):"确认"})]})]})}),(0,c.jsx)(_.Vq,{open:eI,onOpenChange:eB,children:(0,c.jsxs)(_.cZ,{className:"w-[calc(100vw-2rem)] sm:max-w-md",children:[(0,c.jsx)(_.fK,{children:(0,c.jsx)(_.$N,{className:"flex items-center gap-2",children:(0,c.jsx)("span",{children:"友情提醒"})})}),(0,c.jsx)("div",{className:"space-y-4 py-4",children:(0,c.jsx)("p",{className:"text-base text-gray-700 leading-relaxed",children:eC})}),(0,c.jsxs)(_.cN,{className:"flex gap-2",children:[(0,c.jsx)(k.z,{variant:"outline",onClick:function(){eE(null),eB(!1)},className:"flex-1",children:"取消提交"}),(0,c.jsx)(k.z,{onClick:function(){e_&&(e6(e_.currentAbstainVotes,e_.scoresArrayForSubmit),eE(null)),eB(!1)},className:"flex-1 ",children:"确认提交"})]})]})})]})},G=n(42171),Q=n(4307),Y=function(e){var t=e.currentRound,n=e.actionId,r=e.actionInfo,s=((0,d.useContext)(m.M)||{}).token,i=(0,v.m)().address,o=(0,a._)((0,d.useState)(new Set),2),l=o[0],f=o[1],h=(0,u.LW)(null==s?void 0:s.address,t,n,"0x0000000000000000000000000000000000000000"),j=h.scoreByActionIdByAccount,w=h.isPending,I=h.error,C=(0,F.pK)(null==s?void 0:s.address,t,n),S=C.verifiedAddresses,k=C.isPending,_=C.error,E=(0,F.X5)(null==s?void 0:s.address,t,n),Z=E.verificationInfos,L=E.isPending,V=E.error,T=(0,b.wD)(null==s?void 0:s.address,t,n),P=T.votesNumByActionId,O=(T.isPending,T.error),R=(0,x.S)().handleContractError;(0,d.useEffect)(function(){_&&R(_,"dataViewer"),V&&R(V,"dataViewer"),I&&R(I,"verify"),O&&R(O,"vote")},[_,V,I,O]);var M=function(e){var t=new Set(l);t.has(e)?t.delete(e):t.add(e),f(t)},K=((null==S?void 0:S.reduce(function(e,t){return e+t.score},BigInt(0)))||BigInt(0))+(j||BigInt(0)),z=Number(K)/Number(P||BigInt(0))*100;return(0,c.jsxs)("div",{className:"relative px-2 pb-4 w-full",children:[(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)(g.Z,{title:"当前轮最新验证结果"}),(0,c.jsxs)("span",{className:"text-sm text-greyscale-500 ml-2",children:["(验证进度：",(0,p.rl)(z),")"]})]}),(0,c.jsx)("div",{className:"flex justify-left mt-2",children:(0,c.jsx)(N.Z,{currentRound:t,roundType:"verify"})}),L||k||w?(0,c.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,c.jsx)(y.Z,{})}):Z&&0!==Z.length?(0,c.jsxs)("table",{className:"table w-full",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,c.jsx)("th",{}),(0,c.jsx)("th",{children:"被抽中地址"}),(0,c.jsx)("th",{className:"px-1 text-right",children:"获得验证票"}),(0,c.jsx)("th",{className:"px-1 text-right",children:"验证票占比"})]})}),(0,c.jsxs)("tbody",{children:[Z.map(function(e){var t=null==S?void 0:S.find(function(t){return t.account===e.account});return(0,A._)((0,B._)({},e),{score:(null==t?void 0:t.score)||BigInt(0)})}).sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:0}).map(function(e){var t=null==S?void 0:S.find(function(t){return t.account===e.account}),n=l.has(e.account);return(0,c.jsxs)(d.Fragment,{children:[(0,c.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===i?"text-secondary":""),children:[(0,c.jsx)("td",{className:"px-1 w-8",children:(0,c.jsx)("button",{onClick:function(){return M(e.account)},className:"text-greyscale-400 hover:text-greyscale-600",children:n?(0,c.jsx)(G.Z,{size:16}):(0,c.jsx)(Q.Z,{size:16})})}),(0,c.jsx)("td",{className:"px-1",children:(0,c.jsx)(J.Z,{address:e.account,showCopyButton:!0,word:e.account===i?"(我)":""})}),(0,c.jsx)("td",{className:"px-1 text-right",children:(0,p.LH)((null==t?void 0:t.score)||BigInt(0))}),(0,c.jsx)("td",{className:"px-1 text-right",children:(0,p.rl)(Number((null==t?void 0:t.score)||BigInt(0))/Number(K||BigInt(0))*100)})]}),r&&n&&(0,c.jsxs)("tr",{className:"border-b border-gray-100 bg-gray-50",children:[(0,c.jsx)("td",{}),(0,c.jsx)("td",{colSpan:3,className:"px-1 py-3",children:(0,c.jsxs)("div",{className:"text-sm text-greyscale-600",children:[(0,c.jsx)("div",{className:"text-xs text-greyscale-400 mb-2",children:"验证信息:"}),r.body.verificationKeys.map(function(t,n){return(0,c.jsxs)("div",{className:"mb-1",children:[(0,c.jsxs)("span",{className:"text-greyscale-500",children:[t,":"]})," ",(0,c.jsx)(W.L,{text:e.infos[n]})]},n)})]})})]})]},e.account)}),(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{className:"px-1"}),(0,c.jsx)("td",{className:"px-1 text-greyscale-500",children:"弃权票"}),(0,c.jsx)("td",{className:"px-1 text-right",children:(0,p.LH)(j||BigInt(0))}),(0,c.jsx)("td",{className:"px-1 text-right",children:(0,p.rl)(Number(j||BigInt(0))/Number(K||BigInt(0))*100)})]}),(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{className:"px-1"}),(0,c.jsx)("td",{className:"px-1 text-greyscale-500",children:"汇总 "}),(0,c.jsx)("td",{className:"px-1 text-right",children:(0,p.LH)(K||BigInt(0))}),(0,c.jsx)("td",{className:"px-1 text-right",children:"100%"})]})]})]}):(0,c.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有验证地址"})]})},ee=function(){var e=BigInt((0,i.useRouter)().query.id||"0"),t=((0,d.useContext)(m.M)||{}).token,n=(0,u.Bk)(),r=n.currentRound,s=n.error,o=(0,x.S)().handleContractError;(0,d.useEffect)(function(){s&&o(s,"verify")},[s]);var v=(0,a._)((0,d.useState)(BigInt(-1)),2),b=v[0],p=v[1];console.log("remainingVotes",b);var w=(0,a._)((0,d.useState)(void 0),2),I=w[0],B=w[1];return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(f.Z,{title:"验证",backUrl:"/verify/?symbol=".concat(null==t?void 0:t.symbol)}),(0,c.jsxs)("main",{className:"flex-grow",children:[b>0&&(0,c.jsxs)("div",{className:"px-2 pt-4",children:[(0,c.jsxs)("div",{className:"flex justify-between items-center",children:[(0,c.jsx)(g.Z,{title:"请分配您的验证票："}),(0,c.jsx)(l(),{href:"/action/info/?id=".concat(e,"&symbol=").concat(null==t?void 0:t.symbol,"&tab=verify&tab2=current"),className:"text-blue-600 hover:text-blue-800 underline text-sm",children:"验证结果>>"})]}),(0,c.jsx)(N.Z,{currentRound:r,roundType:"verify",showCountdown:!1})]}),(0,c.jsx)(j,{currentRound:r,actionId:e,onRemainingVotesChange:function(e){p(e)}}),(0,c.jsxs)("div",{className:"flex flex-col items-center px-2 py-4",children:[b>BigInt(1)&&(0,c.jsx)(U,{currentRound:r,actionId:e,actionInfo:I,remainingVotes:b}),b>=BigInt(0)&&b<=BigInt(1)&&(0,c.jsx)(Y,{currentRound:r,actionId:e,actionInfo:I}),b<BigInt(0)&&(0,c.jsx)(y.Z,{})]}),(0,c.jsx)(h.Z,{actionId:e,round:BigInt(r||0),showSubmitter:!0,onActionInfo:B})]})]})}},67516:function(e,t,n){"use strict";n.d(t,{N:function(){return u}});var r=n(72253),s=n(14932),a=n(97995),c=n(36100),i=n(67294),o=n(95159),l=n(39360),d=n(78942);function u(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.contracts,u=void 0===n?[]:n,x=t.query,m=void 0===x?{}:x,f=(0,d.Z)(t),h=(0,l.x)({config:f}),g=function(e,t={}){return{async queryFn({queryKey:n}){let r=[],s=n[1].contracts.length;for(let e=0;e<s;e++){let s=n[1].contracts[e],a=(t.contracts?.[e]).abi;r.push({...s,abi:a})}let{scopeKey:c,...i}=n[1];return(0,a.J)(e,{...i,contracts:r})},queryKey:function(e={}){let t=[];for(let n of e.contracts??[]){let{abi:r,...s}=n;t.push({...s,chainId:s.chainId??e.chainId})}return["readContracts",(0,c.OP)({...e,contracts:t})]}(t)}}(f,(0,s._)((0,r._)({},t),{chainId:h})),v=(0,i.useMemo)(function(){var e,t=!1,n=!0,r=!1,s=void 0;try{for(var a,c=u[Symbol.iterator]();!(n=(a=c.next()).done);n=!0){var i=a.value,o=i.abi,l=i.address,d=i.functionName;if(!o||!l||!d){t=!1;break}t=!0}}catch(e){r=!0,s=e}finally{try{n||null==c.return||c.return()}finally{if(r)throw s}}return!!(t&&(null===(e=m.enabled)||void 0===e||e))},[u,m.enabled]);return(0,o.aM)((0,s._)((0,r._)({},g,m),{enabled:v,structuralSharing:null!==(e=m.structuralSharing)&&void 0!==e?e:c.if}))}}},function(e){e.O(0,[8501,4463,1390,3494,3591,3950,7724,7285,9271,1489,2888,9774,179],function(){return e(e.s=81130)}),_N_E=e.O()}]);