try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="7fb51343-4d3c-40bf-9db4-65c933a2595c",e._sentryDebugIdIdentifier="sentry-dbid-7fb51343-4d3c-40bf-9db4-65c933a2595c")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7690],{81130:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/verify/action",function(){return t(21105)}])},20725:function(e,n,t){"use strict";var s=t(85893),r=t(67294),a=t(93566),c=t(73591),i=t(93778),o=t(91529),l=t(72107),d=t(31084),u=t(44746),x=t(27460),f=t(42083),m=t(5971);n.Z=function(e){var n=e.actionId,t=e.round,h=e.showSubmitter,g=(e.showVerifyHistory,e.onActionInfo),v=e.isExtensionAction,b=e.extensionAddress,p=e.factory,y=((0,r.useContext)(i.M)||{}).token,j=(0,a.dI)(null==y?void 0:y.address,n),N=j.actionInfo,w=j.isPending,I=j.error;(0,r.useEffect)(function(){g&&N&&g(N)},[N]);var A=(0,a.sK)(null==y?void 0:y.address,h?t:BigInt(0),n),B=A.submitInfo,k=A.isPending,C=A.error,S=(null==B?void 0:B.submitter)||"N/A",_=(0,c.S)().handleContractError;return((0,r.useEffect)(function(){I&&_(I,"submit"),C&&_(C,"submit")},[I,C]),w)?(0,s.jsx)(f.Z,{}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"mx-auto p-4 pb-2 ",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("span",{className:"text-sm text-greyscale-500",children:["No.",null==N?void 0:N.head.id.toString()]}),(0,s.jsx)("span",{className:"text-xl font-bold text-black",children:null==N?void 0:N.body.title})]}),(0,s.jsxs)("div",{className:"mt-0 text-xs text-greyscale-500 flex justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center",children:["创建人 ",(0,s.jsx)(x.Z,{address:null==N?void 0:N.head.author})]}),h&&(0,s.jsxs)("div",{className:"flex items-center",children:["推举人"," ",k?(0,s.jsx)(f.Z,{}):(0,s.jsx)(x.Z,{address:S})]})]})]}),(0,s.jsx)("div",{className:"mx-auto p-4 pb-2",children:(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h3",{className:"text-sm font-bold",children:"最小参与代币数"}),(0,s.jsx)("p",{className:"text-greyscale-500",children:(0,o.LH)((null==N?void 0:N.body.minStake)||BigInt(0))})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,s.jsx)("h3",{className:"text-sm font-bold",children:"最大激励地址数"}),(0,s.jsx)(u.Z,{title:"最大激励地址数说明",content:(0,s.jsxs)("p",{className:"leading-relaxed text-base",children:["每轮从所有参与行动的代币中，随机抽取",(0,s.jsx)("span",{className:"font-mono font-bold text-blue-600 mx-1 text-base",children:null==N?void 0:N.body.maxRandomAccounts.toString()}),"份代币，返回对应地址。若多份代币对应相同地址，则会合并为一个地址。"]})})]}),(0,s.jsx)("p",{className:"text-greyscale-500",children:(null==N?void 0:N.body.maxRandomAccounts.toString())||"-"})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h3",{className:"text-sm font-bold mb-2",children:"验证规则"}),(0,s.jsx)("div",{className:"text-greyscale-500",children:(0,s.jsx)(l.L,{text:null==N?void 0:N.body.verificationRule,preserveLineBreaks:!0})})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h3",{className:"text-sm font-bold mb-2",children:"报名参加行动时，行动者要提供的信息"}),(null==N?void 0:N.body.verificationKeys)&&(null==N?void 0:N.body.verificationKeys.length)>0?(0,s.jsx)("ul",{className:"list-disc pl-5",children:N.body.verificationKeys.map(function(e,n){return(0,s.jsxs)("li",{className:"text-greyscale-500",children:[(0,s.jsxs)("div",{className:"text-sm font-bold text-greyscale-900 mb-1",children:[(0,s.jsx)(d.Z,{text:e,showWarning:!0})," :"]}),(0,s.jsx)("div",{children:(0,s.jsx)(d.Z,{text:N.body.verificationInfoGuides[n],showWarning:!0,preserveLineBreaks:!0})})]},n)})}):(0,s.jsx)("span",{className:"text-greyscale-500",children:"无"})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h3",{className:"text-sm font-bold",children:"白名单"}),(0,s.jsx)("p",{className:"text-greyscale-500 flex flex-wrap items-center",children:(null==N?void 0:N.body.whiteListAddress)&&"0x0000000000000000000000000000000000000000"!==N.body.whiteListAddress?(0,s.jsx)("span",{className:"flex items-center mr-2",children:(0,s.jsx)(x.Z,{address:N.body.whiteListAddress})}):"无限制"})]}),v&&b&&p&&(0,s.jsx)(m.Z,{extensionAddress:b,factoryAddress:p.address,actionId:n,actionInfo:N})]})})]})}},74089:function(e,n,t){"use strict";var s=t(91309),r=t(85893),a=t(67294);n.Z=function(e){var n=e.initialTimeLeft,t=e.onTick,c=e.forceShowSeconds,i=e.fontClass,o=void 0===i?"":i,l=(0,s._)((0,a.useState)(Date.now()+1e3*n),2),d=l[0],u=l[1],x=(0,s._)((0,a.useState)(n),2),f=x[0],m=x[1];(0,a.useEffect)(function(){u(Date.now()+1e3*n)},[n]),(0,a.useEffect)(function(){var e=setInterval(function(){var n=Math.max(0,Math.floor((d-Date.now())/1e3));m(n),t&&t(n),n<=0&&(clearInterval(e),window.location.reload())},1e3);return function(){return clearInterval(e)}},[d,t]);var h=Math.floor(f/86400),g=Math.floor(f%86400/3600);return(0,r.jsxs)("span",{className:"inline-flex space-x-1 text-greyscale-400",children:[h>0&&(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"countdown font-mono ".concat(o),children:(0,r.jsx)("span",{style:{"--value":h}})}),(0,r.jsx)("span",{className:o,children:"天"})]}),(g>0||h>0)&&(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"countdown font-mono ".concat(o),children:(0,r.jsx)("span",{style:{"--value":g}})}),(0,r.jsx)("span",{className:o,children:"时"})]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"countdown font-mono ".concat(o),children:(0,r.jsx)("span",{style:{"--value":Math.floor(f%3600/60)}})}),(0,r.jsx)("span",{className:o,children:"分"})]}),(h<=0||void 0!==c&&c)&&(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"countdown font-mono ".concat(o),children:(0,r.jsx)("span",{style:{"--value":f%60}})}),(0,r.jsx)("span",{className:o,children:"秒"})]})]})}},64777:function(e,n,t){"use strict";var s=t(85893);n.Z=function(e){var n=e.title;return(0,s.jsx)("div",{className:"flex justify-between items-center",children:(0,s.jsx)("h1",{className:"text-lg font-bold",children:n})})}},51790:function(e,n,t){"use strict";var s=t(85893),r=t(67294),a=t(86501);n.Z=function(e){var n=e.isOpen,t=e.onClose,c=e.text,i=e.title,o=e.description,l=e.autoCloseDelay,d=void 0===l?3e4:l,u=(0,r.useRef)(null);return((0,r.useEffect)(function(){var e=function(e){"Escape"===e.key&&t()};if(n){document.addEventListener("keydown",e),setTimeout(function(){u.current&&(u.current.focus(),u.current.select(),u.current.setSelectionRange(0,u.current.value.length))},100);var s=null;return d>0&&(s=setTimeout(function(){t()},d)),function(){document.removeEventListener("keydown",e),s&&clearTimeout(s)}}},[n,t,d]),n)?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[10000] p-5",onClick:function(e){e.target===e.currentTarget&&t()},children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md text-center shadow-xl",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:void 0===i?"请手动复制":i}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-4 leading-relaxed",children:void 0===o?"自动复制功能不可用，请手动选择并复制以下内容：":o}),(0,s.jsx)("textarea",{ref:u,value:c,readOnly:!0,className:"w-full h-32 p-3 border border-gray-300 rounded-md font-mono text-sm resize-none mb-4 bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"}),(0,s.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,s.jsx)("button",{onClick:function(){u.current&&(u.current.focus(),u.current.select(),u.current.setSelectionRange(0,u.current.value.length),a.Am.success("已全选文本，请按 Ctrl+C 复制"))},className:"px-4 py-2 bg-[#1e3a8a] text-white rounded-md hover:bg-gray-500/90 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors font-medium",children:"全选文本"}),(0,s.jsx)("button",{onClick:t,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors font-medium",children:"关闭"})]}),d>0&&(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-3",children:[Math.round(d/1e3)," 秒后自动关闭"]})]})}):null}},21338:function(e,n,t){"use strict";var s=t(91309),r=t(85893),a=t(67294),c=t(88504),i=t(93778),o=t(74089),l=t(42083);n.Z=function(e){var n=e.currentRound,t=e.roundType,d=e.showCountdown,u=(0,c.O)().data,x=(0,a.useContext)(i.M),f=x?x.token:void 0,m=!u||!f||void 0===f.voteOriginBlocks,h=(0,s._)((0,a.useState)(BigInt(0)),2),g=h[0],v=h[1],b=Number("30126")||0,p=Number("2868")||0,y=f?Number(f.voteOriginBlocks):0,j=b-(Number(u)-y)%b,N=j>0?Math.ceil(j*p/1e3):0,w=(0,s._)((0,a.useState)(N),2),I=w[0],A=w[1];(0,a.useEffect)(function(){if(u){var e=b-(Number(u)-y)%b;A(e>0?Math.ceil(e*p/1e3):0)}},[u,b,p,y]),(0,a.useEffect)(function(){n>BigInt(0)&&v(n)},[n]);var B=null!=g?g.toString():"0";return g<=BigInt(0)?(0,r.jsx)(r.Fragment,{}):m||null==g||g<BigInt(0)?((null==g||g<BigInt(0))&&(console.log("currentTokenRound",g),console.log("currentRound",n)),(0,r.jsx)(l.Z,{})):(0,r.jsx)("div",{className:"flex items-center mb-3",children:(0,r.jsxs)("span",{className:"text-sm text-greyscale-400",children:["(第",(0,r.jsx)("span",{className:"text-greyscale-400",children:B}),"轮","vote"===t?"投票":"verify"===t?"验证":"行动","阶段，",(0,r.jsx)("span",{className:"text-greyscale-400",children:"剩余"}),(0,r.jsx)("span",{className:"text-greyscale-400",children:Math.ceil(1e3*I/p)}),(0,r.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),void 0===d||d?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(o.Z,{initialTimeLeft:N,onTick:A})}):(0,r.jsx)("span",{className:"text-greyscale-400",children:I<60?"".concat(I,"秒"):I<=300?"".concat(Math.floor(I/60),"分钟").concat(I%60,"秒"):I<3600?"".concat(Math.floor(I/60),"分钟"):"".concat(Math.floor(I/3600),"小时").concat(Math.floor(I%3600/60),"分钟")}),(0,r.jsx)("span",{className:"text-greyscale-400",children:")"})]})})}},49189:function(e,n,t){"use strict";t.d(n,{P:function(){return l}});var s,r,a=t(11010),c=t(97582),i=t(86501),o=(s=(0,a._)(function(e){var n,t;return(0,c.Jh)(this,function(s){switch(s.label){case 0:if(!(navigator.clipboard&&navigator.clipboard.writeText))return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,navigator.clipboard.writeText(e)];case 2:return s.sent(),[2,{success:!0,method:"clipboard"}];case 3:return console.warn("Clipboard API 失败，尝试降级方案:",s.sent()),[3,4];case 4:try{if((n=document.createElement("textarea")).value=e,n.style.position="fixed",n.style.left="-999999px",n.style.top="-999999px",n.style.opacity="0",n.style.pointerEvents="none",n.setAttribute("readonly",""),document.body.appendChild(n),n.focus(),n.select(),n.setSelectionRange(0,n.value.length),t=document.execCommand("copy"),document.body.removeChild(n),t)return[2,{success:!0,method:"execCommand"}]}catch(e){console.warn("execCommand 复制失败:",e)}return[2,{success:!1,method:"manual",error:"浏览器不支持自动复制，需要手动复制"}]}})}),function(e){return s.apply(this,arguments)}),l=(r=(0,a._)(function(e,n,t){var s;return(0,c.Jh)(this,function(r){switch(r.label){case 0:return[4,o(e)];case 1:return(s=r.sent()).success?i.Am.success(n):t?t(e):i.Am.error(s.error||"复制失败，请手动复制"),[2]}})}),function(e,n,t){return r.apply(this,arguments)})},21105:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return G}});var s=t(91309),r=t(85893),a=t(11163),c=t(41664),i=t.n(c),o=t(67294),l=t(42130),d=t(93778),u=t(59271),x=t(73591),f=t(45231),m=t(83494),h=t(20725),g=t(64777),v=t(72260),b=t(91529),p=t(42083),y=function(e){var n=e.currentRound,t=e.actionId,s=e.onRemainingVotesChange,a=((0,o.useContext)(d.M)||{}).token,c=(0,l.m)().address,i=(0,v.Ol)(null==a?void 0:a.address,n,c||"",t),f=i.votesNumByAccountByActionId,m=i.isPending,h=i.error,g=(0,u.Tl)(null==a?void 0:a.address,n,c||"",t),y=g.scoreByVerifierByActionId,j=g.isPending,N=g.error,w=m||j?BigInt(0):f-y;(0,o.useEffect)(function(){m||j||(console.log("remainingVotes",w),console.log("isPendingVotesNumByAccount",m),console.log("isPendingScoreByVerifier",j),null==s||s(w))},[w,m,j]);var I=(0,x.S)().handleContractError;return((0,o.useEffect)(function(){h&&I(h,"vote"),N&&I(N,"verify")},[h,N]),w<=0)?(0,r.jsx)(r.Fragment,{}):(0,r.jsx)("div",{className:"px-4",children:(0,r.jsxs)("div",{className:"text-center bg-greyscale-100 p-4 rounded-lg",children:[(0,r.jsxs)("span",{className:"text-greyscale-800 text-base",children:["我的剩余验证票数：",m||j?(0,r.jsx)(p.Z,{}):(0,r.jsx)("span",{className:"text-secondary",children:(0,b.LH)(w)})]}),(0,r.jsx)("div",{className:"mt-2 text-sm text-greyscale-500 text-center",children:"提示: 您的验证票，将按“打分比例”分配给行动参与者"})]})})},j=t(21338),N=t(11010),w=t(75766),I=t(72253),A=t(14932),B=t(4586),k=t(97582),C=t(27245),S=t(35810),_=t(21774),E=t(86501),Z=t(44746),L=function(e){var n=e.isOpen,t=e.onClose,s=e.onConfirm,a=e.title,c=e.description,i=e.placeholder,l=(0,o.useRef)(null);return((0,o.useEffect)(function(){var e=function(e){"Escape"===e.key&&t()};return n&&(document.addEventListener("keydown",e),setTimeout(function(){var e;null===(e=l.current)||void 0===e||e.focus()},100)),function(){document.removeEventListener("keydown",e)}},[n,t]),n)?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[10000] p-5",onClick:function(e){e.target===e.currentTarget&&t()},children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md text-center shadow-xl",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:void 0===a?"粘贴分数数据":a}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-4 leading-relaxed",children:void 0===c?"请将复制的分数数据粘贴到下方文本框中（每行一个数字）":c}),(0,r.jsx)("textarea",{ref:l,placeholder:void 0===i?"请粘贴分数数据...":i,className:"w-full h-32 p-3 border border-gray-300 rounded-md font-mono text-sm resize-none mb-4 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"}),(0,r.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,r.jsx)("button",{onClick:function(){var e,n=(null===(e=l.current)||void 0===e?void 0:e.value.trim())||"";n?(s(n),t()):E.Am.error("请输入分数数据")},className:"px-4 py-2 bg-[#1e3a8a] text-white rounded-md hover:bg-gray-500/90 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors font-medium",children:"确认粘贴"}),(0,r.jsx)("button",{onClick:t,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors font-medium",children:"取消"})]})]})}):null},V=t(51790),P=t(49189),T=t(18289),M=t(31134),O=(0,M.Z)("Clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]),R=(0,M.Z)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),K=t(90278),D=t(67516),z=t(43637),F=function(e){var n=e.verifier,t=e.round,s=e.tokenAddress,r=e.actionId,a=e.accounts,c=e.enabled,i=void 0===c||c,l=(0,o.useMemo)(function(){return i&&0!==a.length&&n&&s?a.map(function(e){return{address:"0x547b4a36980Ec030fBfC0162eE4B4904d9Cc0Da9",abi:z.w,functionName:"scoreByVerifierByActionIdByAccount",args:[s,t,n,r,e]}}):[]},[s,t,n,r,a,i]),d=(0,D.N)({contracts:l,query:{enabled:i&&l.length>0}}),u=d.data,x=d.isLoading,f=d.error,m=d.isSuccess,h=(0,o.useMemo)(function(){if(!i||0===a.length)return{scores:[],isLoading:!1,hasError:!1,allLoaded:!0};var e=a.map(function(e,n){var t=null==u?void 0:u[n];return{account:e,score:(null==t?void 0:t.status)==="success"&&t.result||BigInt(0),isPending:x,error:(null==t?void 0:t.status)==="failure"?t.error:f||null}}),n=!!f||e.some(function(e){return null!==e.error});return{scores:e,isLoading:x,hasError:n,allLoaded:m}},[u,a,i,x,f,m]);return{scores:h.scores,isLoading:h.isLoading,hasError:h.hasError,allLoaded:h.allLoaded,getScoresArray:function(){return h.scores.map(function(e){return e.score})},getScoresMap:function(){var e={};return h.scores.forEach(function(n){e[n.account]=n.score}),e},hasValidData:i&&a.length>0&&!!n&&!!s}},q=t(27460),H=t(44576),J=t(72107),$=t(11066),W=function(e){var n,t,a,c,i,l,f=e.currentRound,m=e.actionId,h=e.actionInfo,g=e.remainingVotes,v=((0,o.useContext)(d.M)||{}).token,y=(0,K.X5)(null==v?void 0:v.address,f,m),j=y.verificationInfos,M=y.isPending,D=y.error,z=(0,K.pK)(null==v?void 0:v.address,f,m),W=z.verifiedAddresses,X=(z.isPending,z.error),Q=(0,u.LW)(null==v?void 0:v.address,f,m,"0x0000000000000000000000000000000000000000"),U=Q.scoreByActionIdByAccount,G=(Q.isPending,Q.error),Y=(0,s._)((0,o.useState)({}),2),ee=Y[0],en=Y[1],et=(0,s._)((0,o.useState)("0"),2),es=et[0],er=et[1],ea=(0,s._)((0,o.useState)(!1),2),ec=ea[0],ei=ea[1],eo=(0,s._)((0,o.useState)(!1),2),el=eo[0],ed=eo[1],eu=(0,s._)((0,o.useState)(""),2),ex=eu[0],ef=eu[1],em=(0,s._)((0,o.useState)(!1),2),eh=em[0],eg=em[1],ev=(0,s._)((0,o.useState)(""),2),eb=ev[0],ep=ev[1],ey=(0,s._)((0,o.useState)(!1),2),ej=ey[0],eN=ey[1],ew=(0,s._)((0,o.useState)(!1),2),eI=ew[0],eA=ew[1],eB=(0,s._)((0,o.useState)(""),2),ek=eB[0],eC=eB[1],eS=(0,s._)((0,o.useState)(null),2),e_=eS[0],eE=eS[1],eZ=(0,s._)((0,o.useState)(!1),2),eL=eZ[0],eV=eZ[1],eP=(0,o.useMemo)(function(){return(null==j?void 0:j.map(function(e){return e.account}))||[]},[j]),eT=(0,o.useMemo)(function(){var e,n;return eL?(e=(0,B._)(eP),n="0x0000000000000000000000000000000000000000",e.includes(n)||e.push(n),e):eP},[eP,eL]),eM=F({verifier:eb,round:f,tokenAddress:null==v?void 0:v.address,actionId:m,accounts:eT,enabled:eL&&!!eb&&eT.length>0});(0,o.useEffect)(function(){if(j&&j.length>0){var e={};j.forEach(function(n){e[n.account]=""}),en(e),er("")}},[j]),(0,o.useEffect)(function(){if(eL&&eM.allLoaded&&!eM.isLoading){if(eN(!1),eM.hasError){E.Am.error("获取验证者打分失败，请检查地址是否正确"),eV(!1);return}var e,n=eM.getScoresMap(),t={};Object.entries(n).forEach(function(e){var n=(0,s._)(e,2),r=n[0],a=n[1];t[r]=a});var r=function(e){var n=Object.values(e);if(console.log("scoreValues",n),0===n.length)return{};var t=n.reduce(function(e,n){return n>e?n:e},BigInt(0));if(t===BigInt(0)){var r={};return Object.keys(e).forEach(function(e){r[e]="0"}),r}var a={};return Object.entries(e).forEach(function(e){var n=(0,s._)(e,2),r=n[0],c=n[1],i=c*BigInt(1e3)/t,o=c*BigInt(1e3)%t*BigInt(2)>=t?Number(i)+1:Number(i);a[r]=o.toString()}),a}(t),a=r["0x0000000000000000000000000000000000000000"]||"0",c=(e=(0,I._)({},r),delete e["0x0000000000000000000000000000000000000000"],e),i=(0,I._)({},ee);j&&j.forEach(function(e){var n=c[e.account];i[e.account]=n||"0"}),en(i),er(a),eg(!1),eV(!1),E.Am.success("已应用验证者 ".concat(eb.slice(0,6),"...").concat(eb.slice(-4)," 的打分（已缩放到0-1000）"))}},[eL,eM.allLoaded,eM.isLoading,eM.hasError,eM,ee,j,eb]);var eO=function(){var e=Object.values(ee).map(function(e){return parseInt(e)||0}),n=parseInt(es)||0,t=e.reduce(function(e,n){return e+n},0)+n;if(0===t)return{addressPercentages:{},abstainPercentage:0};var s={};return Object.keys(ee).forEach(function(e){var n=parseInt(ee[e])||0;s[e]=n/t*100}),{addressPercentages:s,abstainPercentage:n/t*100}}(),eR=eO.addressPercentages,eK=eO.abstainPercentage,eD=(n={},(t=((null==W?void 0:W.reduce(function(e,n){return e+n.score},BigInt(0)))||BigInt(0))+(U||BigInt(0)))>BigInt(0)&&(null==j||j.forEach(function(e){var s=null==W?void 0:W.find(function(n){return n.account===e.account}),r=(null==s?void 0:s.score)||BigInt(0);n[e.account]=Number(r)/Number(t)*100})),{verificationPercentages:n,totalVerifiedVotes:t}),ez=eD.verificationPercentages,eF=eD.totalVerifiedVotes,eq=function(e,n){(""===n||/^[0-9]+$/.test(n))&&en((0,A._)((0,I._)({},ee),(0,w._)({},e,n)))},eH=function(e){(""===e||/^[0-9]+$/.test(e))&&er(e)},eJ=(a=(0,N._)(function(){var e,n,t;return(0,k.Jh)(this,function(s){switch(s.label){case 0:if(s.trys.push([0,10,,11]),e="",n=!1,t=/Trust/i.test(navigator.userAgent),!(navigator.clipboard&&navigator.clipboard.readText&&!t))return[3,8];s.label=1;case 1:return s.trys.push([1,6,,7]),[4,navigator.permissions.query({name:"clipboard-read"})];case 2:if("denied"!==s.sent().state)return[3,3];return n=!0,[3,5];case 3:return[4,navigator.clipboard.readText()];case 4:e=s.sent(),s.label=5;case 5:return[3,7];case 6:return console.warn("Clipboard API 读取失败:",s.sent()),n=!0,[3,7];case 7:return[3,9];case 8:n=!0,s.label=9;case 9:if(n||!e)return ei(!0),[2];return e$(e),[3,11];case 10:return console.error("粘贴功能出错:",s.sent()),ei(!0),[3,11];case 11:return[2]}})}),function(){return a.apply(this,arguments)}),e$=function(e){var n=e.split("\n").map(function(e){return e.trim()}).filter(function(e){return""!==e}),t=[],s=!0,r=!1,a=void 0;try{for(var c,i=n[Symbol.iterator]();!(s=(c=i.next()).done);s=!0){var o=c.value;if(/^[0-9]+$/.test(o))t.push(o);else if(""!==o){E.Am.error('无效的数字格式: "'.concat(o,'"'));return}}}catch(e){r=!0,a=e}finally{try{s||null==i.return||i.return()}finally{if(r)throw a}}if(0===t.length){E.Am.error("没有找到有效的数字");return}var l=((null==j?void 0:j.length)||0)+1;if(t.length!==l){t.length===l-1?E.Am.error("打分行数不一致。如果不需要弃权票，请在最后添加一行数字0后再复制即可~"):E.Am.error("数字数量不匹配，需要 ".concat(l," 个数字，实际有 ").concat(t.length," 个数字"));return}var d=(0,I._)({},ee),u=0;if(j)for(var x=0;x<j.length&&u<t.length;x++)d[j[x].account]=t[u],u++;var f=es;u<t.length&&(f=t[u]),en(d),er(f),E.Am.success("成功粘贴 ".concat(t.length," 个分数"))},eW=(c=(0,N._)(function(){var e,n;return(0,k.Jh)(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),e=[],j&&j.forEach(function(n){var t=ee[n.account]||"0";e.push(t)}),e.push(es||"0"),n=e.join("\n"),[4,(0,P.P)(n,"已复制 ".concat(e.length," 个分数到剪贴板"),function(e){ef(e),ed(!0)})];case 1:return t.sent(),[3,3];case 2:return console.error("复制功能出错:",t.sent()),E.Am.error("复制功能暂时不可用，请手动记录分数"),[3,3];case 3:return[2]}})}),function(){return c.apply(this,arguments)}),eX=(i=(0,N._)(function(){var e,n,t,s;return(0,k.Jh)(this,function(r){switch(r.label){case 0:if(r.trys.push([0,2,,3]),!j||0===j.length)return E.Am.error("没有可复制的地址"),[2];return e=[],n=(null==h?void 0:h.body.verificationKeys)||[],t=["地址","后4位"].concat((0,B._)(n)),e.push(t.join("	")),j.forEach(function(n){var t=n.account,s=t.slice(-4),r=n.infos||[],a=[t,s].concat((0,B._)(r));e.push(a.join("	"))}),s=e.join("\n"),[4,(0,P.P)(s,"已复制 ".concat(j.length," 个地址信息到剪贴板"),function(e){ef(e),ed(!0)})];case 1:return r.sent(),[3,3];case 2:return console.error("复制功能出错:",r.sent()),E.Am.error("复制功能暂时不可用，请手动记录地址"),[3,3];case 3:return[2]}})}),function(){return i.apply(this,arguments)}),eQ=function(e){ep(e)},eU=(l=(0,N._)(function(){return(0,k.Jh)(this,function(e){return eb?/^0x[a-fA-F0-9]{40}$/.test(eb)?j&&0!==j.length?(eN(!0),eV(!0),console.log("开始获取验证者真实打分 (批量RPC调用):",{verifier:eb,round:f.toString(),tokenAddress:null==v?void 0:v.address,actionId:m.toString(),accounts:j.map(function(e){return e.account}),message:"将获取所有账户分数和弃权票，并缩放到0-1000范围"})):E.Am.error("没有可验证的地址"):E.Am.error("请输入有效的以太坊地址"):E.Am.error("请输入验证者地址"),[2]})}),function(){return l.apply(this,arguments)}),eG=function(e,n){if((e.ctrlKey||e.metaKey)&&"v"===e.key){e.preventDefault(),eJ();return}if("Enter"===e.key||"Tab"===e.key){e.preventDefault();var t=document.querySelectorAll('input[type="number"]:not([disabled])'),s=(n+1)%t.length,r=t[s];r&&(r.focus(),r.select())}},eY=(0,u.yl)(),e0=eY.verify,e1=eY.isPending,e2=eY.isConfirming,e4=eY.isConfirmed,e3=eY.writeError,e5=function(){if(!j||j.length<3)return{hasAbnormal:!1,message:""};var e=[],n=j.length,t=[],s=[];if(j.forEach(function(e,n){var r=parseInt(ee[e.account])||0;r>0?t.push({address:e.account,score:r,index:n}):s.push({address:e.account,index:n})}),s.length>n/10&&m!==BigInt(19)&&e.push("有 ".concat(s.length," 个地址被打了0分")),t.length>=2){t.sort(function(e,n){return n.score-e.score});for(var r=t[0].score,a=0,c=1;c<t.length;c++)if(t[c].score<r){a=t[c].score;break}if(a>0&&r>5*a){var i=t.filter(function(e){return e.score===r});if(1===i.length){var o=i[0].index+1,l=i[0].address.slice(-4);e.push("第 ".concat(o," 行地址 ").concat(l," 得分 ").concat(r," 比其他得分大很多"))}else{var d=i.map(function(e){return"".concat(e.index+1,"(").concat(e.address.slice(-4),")")}).join("、");e.push("第 ".concat(d," 行地址得分都是 ").concat(r,"，比其他得分大很多"))}}}return e.length>0?{hasAbnormal:!0,message:e.join("，")+"，请确认是否提交？"}:{hasAbnormal:!1,message:""}},e6=function(e,n){console.log("currentAbstainVotes",e),e0(null==v?void 0:v.address,m,e,n)};(0,o.useEffect)(function(){e4&&!e3&&(E.Am.success("提交成功",{duration:2e3}),setTimeout(function(){$.N.reloadWithOverlay()},2e3))},[e4,e3]);var e9=(0,x.S)().handleContractError;return(0,o.useEffect)(function(){e3&&e9(e3,"verify"),D&&e9(D,"dataViewer"),X&&e9(X,"dataViewer"),G&&e9(G,"verify")},[e3,D,X,G]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"w-full max-w-2xl",children:[(0,r.jsx)("div",{className:"mb-4 flex justify-center",children:(0,r.jsxs)("button",{onClick:eX,disabled:e1||e4||!j||0===j.length,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",title:"复制被抽中的地址及验证信息（包含地址、后4位、验证信息）",children:[(0,r.jsx)(T.Z,{size:16}),"复制被抽中地址"]})}),(0,r.jsxs)("table",{className:"w-full border-collapse",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,r.jsx)("th",{className:"pb-3 text-left text-sm text-greyscale-500",children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:["被抽中的行动参与者",(0,r.jsx)(Z.Z,{title:"最大激励地址数说明",content:(0,r.jsxs)("p",{className:"leading-relaxed text-base",children:["每轮从所有参与行动的代币中，随机抽取",(0,r.jsx)("span",{className:"font-mono font-bold text-blue-600 mx-1 text-base",children:null==h?void 0:h.body.maxRandomAccounts.toString()}),"份代币，返回对应地址。若多份代币对应相同地址，则会合并为一个地址。"]})})]})}),(0,r.jsx)("th",{className:"pb-3 text-left whitespace-nowrap w-16 text-sm text-greyscale-500",children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:["打分",(0,r.jsx)("button",{onClick:eJ,disabled:e1||e4,className:"ml-1 p-1 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded disabled:text-gray-300 disabled:cursor-not-allowed transition-colors",title:"粘贴分数数据（自动检测剪贴板或手动输入，每行一个数字）",children:(0,r.jsx)(O,{size:14})}),!1]})}),(0,r.jsx)("th",{className:"pb-3 text-center whitespace-nowrap w-12 text-sm text-greyscale-500",children:"分配"})]})}),(0,r.jsxs)("tbody",{children:[M&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:3,className:"text-center py-4",children:(0,r.jsx)(p.Z,{})})}),j&&j.length>0?j.map(function(e,n){return(0,r.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,r.jsx)("td",{className:"py-1",children:(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xs font-bold text-gray-500 min-w-[4px]",children:n+1}),(0,r.jsx)("div",{className:"font-mono",children:(0,r.jsx)(q.Z,{address:e.account,showCopyLast4Button:!0})})]}),h&&(0,r.jsx)("div",{className:"text-sm text-greyscale-800 ml-3",children:h.body.verificationKeys.map(function(n,t){return(0,r.jsxs)("div",{className:"mb-2",children:[(0,r.jsxs)("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:[n,":"]}),(0,r.jsx)("div",{children:(0,r.jsx)(J.L,{text:e.infos[t]})})]},t)})})]})}),(0,r.jsx)("td",{className:"py-1 w-18 px-1",children:(0,r.jsxs)("div",{className:"flex items-center text-left",children:[(0,r.jsx)("input",{type:"number",min:"0",value:ee[e.account]||"",placeholder:"0",onChange:function(n){return eq(e.account,n.target.value)},onKeyDown:function(e){return eG(e,n)},tabIndex:n+1,className:"w-16 px-1 py-1 border rounded text-xs focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:e1||e4}),(0,r.jsx)("span",{className:"text-greyscale-500 text-xs",children:"分"})]})}),(0,r.jsx)("td",{className:"py-1 text-center w-12 whitespace-nowrap px-0",children:(0,r.jsxs)("div",{className:"leading-tight",children:[(0,r.jsx)("div",{className:"text-sm text-greyscale-600 ",children:(0,b.rl)(eR[e.account]||0)}),(0,r.jsxs)("div",{className:"text-xs text-greyscale-500 ",children:["(当前",(0,b.rl)(ez[e.account]||0),")"]})]})})]},e.account)}):(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:3,className:"text-center py-4",children:"暂无数据"})}),j&&(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"py-2",children:(0,r.jsx)("div",{className:"text-left",children:(0,r.jsx)("div",{className:"text-sm text-greyscale-800",children:(0,r.jsx)("span",{children:"弃权票数："})})})}),(0,r.jsx)("td",{className:"py-2 w-16 px-1",children:(0,r.jsxs)("div",{className:"flex items-center text-left",children:[(0,r.jsx)("input",{type:"number",min:"0",value:es,placeholder:"0",onChange:function(e){return eH(e.target.value)},onKeyDown:function(e){return eG(e,(null==j?void 0:j.length)||0)},tabIndex:((null==j?void 0:j.length)||0)+1,className:"w-14 px-1 py-1 border rounded text-xs focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:e1||e4}),(0,r.jsx)("span",{className:"text-greyscale-500 text-xs",children:"分"})]})}),(0,r.jsx)("td",{className:"py-2 text-center w-14 whitespace-nowrap px-0",children:(0,r.jsxs)("div",{className:"text-greyscale-500 text-xs leading-tight",children:[(0,r.jsx)("div",{children:(0,b.rl)(eK)}),(0,r.jsxs)("div",{children:["(当前",(0,b.rl)(eF>BigInt(0)?Number(U||BigInt(0))/Number(eF)*100:0),")"]})]})})]})]})]})]}),(0,r.jsxs)("div",{className:"mt-4 flex justify-center gap-1",children:[(0,r.jsx)("button",{onClick:eW,disabled:e1||e4,className:"flex items-center gap-0 px-2 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg border border-gray-200 hover:border-blue-200 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors",title:"复制当前所有分数到剪贴板（每行一个分数）",children:"复制分数"}),(0,r.jsx)("button",{onClick:eJ,disabled:e1||e4,className:"flex items-center gap-0 px-2 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg border border-gray-200 hover:border-blue-200 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors",title:"粘贴分数数据（自动检测剪贴板或手动输入，每行一个数字）",children:"从剪贴板粘贴"}),(0,r.jsxs)("button",{onClick:function(){return eg(!0)},disabled:e1||e4||!j||0===j.length,className:"flex items-center gap-1 px-2 py-2 text-sm text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg border border-gray-200 hover:border-green-200 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors",title:"输入验证者地址，自动获取其打分并填入表单",children:[(0,r.jsx)(R,{size:16}),"用其他验证者打分"]})]}),(0,r.jsxs)(C.z,{onClick:function(){if(g<=BigInt(2)?(E.Am.error("剩余票数不足，无法验证"),!1):!Object.values(ee).every(function(e){return 0===parseInt(e)||""===e})||0!==parseInt(es)&&""!==es||(E.Am.error("请至少给一个地址或弃权投票打分"),!1)){var e=Object.values(ee).reduce(function(e,n){return e+(parseInt(n)||0)},0)+(parseInt(es)||0);console.log("-------handleSubmit()-------"),console.log("scoreSum",e);for(var n=[],t=BigInt(0),s=BigInt(e),r=0;r<j.length;r++){var a=g*BigInt(parseInt(ee[j[r].account])||0)/s,c=t+a>g?g-t:a;if(n.push(c),(t+=c)>=g){for(var i=r+1;i<j.length;i++)n.push(BigInt(0));break}}var o=n.reduce(function(e,n){return e+n},BigInt(0));if(o>g){console.error("计算错误：分配票数超过剩余票数",{scoresArrayTotal:o.toString(),remainingVotes:g.toString()}),E.Am.error("票数分配计算错误，请重试");return}console.log("remainingVotes",g),console.log("scoresArrayTotal",o),console.log("scoresArrayForSubmit",n);var l=g-o;if(l<BigInt(0)){console.error("计算错误：弃权票数为负数",{remainingVotes:g.toString(),scoresArrayTotal:o.toString(),currentAbstainVotes:l.toString()}),E.Am.error("票数分配计算错误，请重试");return}var d=o+l;if(d!==g){console.error("最终检查失败：总票数不等于剩余票数",{finalTotalVotes:d.toString(),remainingVotes:g.toString(),scoresArrayTotal:o.toString(),currentAbstainVotes:l.toString()}),E.Am.error("票数分配不完整，请重试");return}var u=e5();if(u.hasAbnormal){eE({currentAbstainVotes:l,scoresArrayForSubmit:n}),eC(u.message),eA(!0);return}e6(l,n)}},disabled:e1||e2||e4,className:"mt-6 w-1/2",children:[!e1&&!e2&&!e4&&"提交验证",e1&&"提交中...",e2&&"确认中...",e4&&"已验证"]}),(0,r.jsx)(H.Z,{isLoading:e1||e2,text:e1?"提交交易...":"确认交易..."}),(0,r.jsx)(L,{isOpen:ec,onClose:function(){return ei(!1)},onConfirm:e$,title:"粘贴分数数据",description:"请将复制的分数数据粘贴到下方文本框中（每行一个数字）",placeholder:"请粘贴分数数据... 例如： 10 20 5 0"}),(0,r.jsx)(V.Z,{isOpen:el,onClose:function(){return ed(!1)},text:ex,title:"请手动复制分数",description:"自动复制功能不可用，请选择以下文本并手动复制（每行一个分数）："}),(0,r.jsx)(S.Vq,{open:eh,onOpenChange:eg,children:(0,r.jsxs)(S.cZ,{className:"sm:max-w-md",children:[(0,r.jsx)(S.fK,{children:(0,r.jsx)(S.$N,{children:"选择他验证者"})}),(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{htmlFor:"verifier-address",className:"text-sm font-medium text-gray-700",children:"验证者地址"}),(0,r.jsx)(_.I,{id:"verifier-address",type:"text",placeholder:"请输入验证者的以太坊地址 (0x...)",value:eb,onChange:function(e){return eQ(e.target.value)},className:"font-mono text-sm",disabled:ej}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"验证者打分，会等比例缩放到区间 0~1000"})]})}),(0,r.jsxs)(S.cN,{className:"flex gap-2",children:[(0,r.jsx)(C.z,{variant:"outline",onClick:function(){eg(!1),ep(""),eN(!1),eV(!1)},disabled:ej,children:"取消"}),(0,r.jsx)(C.z,{onClick:eU,disabled:!eb||ej,className:"min-w-[100px]",children:ej?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(p.Z,{}),"获取中..."]}):"确认"})]})]})}),(0,r.jsx)(S.Vq,{open:eI,onOpenChange:eA,children:(0,r.jsxs)(S.cZ,{className:"w-[calc(100vw-2rem)] sm:max-w-md",children:[(0,r.jsx)(S.fK,{children:(0,r.jsx)(S.$N,{className:"flex items-center gap-2",children:(0,r.jsx)("span",{children:"友情提醒"})})}),(0,r.jsx)("div",{className:"space-y-4 py-4",children:(0,r.jsx)("p",{className:"text-base text-gray-700 leading-relaxed",children:ek})}),(0,r.jsxs)(S.cN,{className:"flex gap-2",children:[(0,r.jsx)(C.z,{variant:"outline",onClick:function(){eE(null),eA(!1)},className:"flex-1",children:"取消提交"}),(0,r.jsx)(C.z,{onClick:function(){e_&&(e6(e_.currentAbstainVotes,e_.scoresArrayForSubmit),eE(null)),eA(!1)},className:"flex-1 ",children:"确认提交"})]})]})})]})},X=t(42171),Q=t(4307),U=function(e){var n=e.currentRound,t=e.actionId,a=e.actionInfo,c=((0,o.useContext)(d.M)||{}).token,i=(0,l.m)().address,f=(0,s._)((0,o.useState)(new Set),2),m=f[0],h=f[1],y=(0,u.LW)(null==c?void 0:c.address,n,t,"0x0000000000000000000000000000000000000000"),N=y.scoreByActionIdByAccount,w=y.isPending,B=y.error,k=(0,K.pK)(null==c?void 0:c.address,n,t),C=k.verifiedAddresses,S=k.isPending,_=k.error,E=(0,K.X5)(null==c?void 0:c.address,n,t),Z=E.verificationInfos,L=E.isPending,V=E.error,P=(0,v.wD)(null==c?void 0:c.address,n,t),T=P.votesNumByActionId,M=(P.isPending,P.error),O=(0,x.S)().handleContractError;(0,o.useEffect)(function(){_&&O(_,"dataViewer"),V&&O(V,"dataViewer"),B&&O(B,"verify"),M&&O(M,"vote")},[_,V,B,M]);var R=function(e){var n=new Set(m);n.has(e)?n.delete(e):n.add(e),h(n)},D=((null==C?void 0:C.reduce(function(e,n){return e+n.score},BigInt(0)))||BigInt(0))+(N||BigInt(0)),z=Number(D)/Number(T||BigInt(0))*100;return(0,r.jsxs)("div",{className:"relative px-2 pb-4 w-full",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(g.Z,{title:"当前轮最新验证结果"}),(0,r.jsxs)("span",{className:"text-sm text-greyscale-500 ml-2",children:["(验证进度：",(0,b.rl)(z),")"]})]}),(0,r.jsx)("div",{className:"flex justify-left mt-2",children:(0,r.jsx)(j.Z,{currentRound:n,roundType:"verify"})}),L||S||w?(0,r.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,r.jsx)(p.Z,{})}):Z&&0!==Z.length?(0,r.jsxs)("table",{className:"table w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,r.jsx)("th",{}),(0,r.jsx)("th",{children:"被抽中地址"}),(0,r.jsx)("th",{className:"px-1 text-right",children:"获得验证票"}),(0,r.jsx)("th",{className:"px-1 text-right",children:"验证票占比"})]})}),(0,r.jsxs)("tbody",{children:[Z.map(function(e){var n=null==C?void 0:C.find(function(n){return n.account===e.account});return(0,A._)((0,I._)({},e),{score:(null==n?void 0:n.score)||BigInt(0)})}).sort(function(e,n){return e.score>n.score?-1:e.score<n.score?1:0}).map(function(e){var n=null==C?void 0:C.find(function(n){return n.account===e.account}),t=m.has(e.account);return(0,r.jsxs)(o.Fragment,{children:[(0,r.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===i?"text-secondary":""),children:[(0,r.jsx)("td",{className:"px-1 w-8",children:(0,r.jsx)("button",{onClick:function(){return R(e.account)},className:"text-greyscale-400 hover:text-greyscale-600",children:t?(0,r.jsx)(X.Z,{size:16}):(0,r.jsx)(Q.Z,{size:16})})}),(0,r.jsx)("td",{className:"px-1",children:(0,r.jsx)(q.Z,{address:e.account,showCopyButton:!0,word:e.account===i?"(我)":""})}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,b.LH)((null==n?void 0:n.score)||BigInt(0))}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,b.rl)(Number((null==n?void 0:n.score)||BigInt(0))/Number(D||BigInt(0))*100)})]}),a&&t&&(0,r.jsxs)("tr",{className:"border-b border-gray-100 bg-gray-50",children:[(0,r.jsx)("td",{}),(0,r.jsx)("td",{colSpan:3,className:"px-1 py-3",children:(0,r.jsxs)("div",{className:"text-sm text-greyscale-600",children:[(0,r.jsx)("div",{className:"text-xs text-greyscale-400 mb-2",children:"验证信息:"}),a.body.verificationKeys.map(function(n,t){return(0,r.jsxs)("div",{className:"mb-1",children:[(0,r.jsxs)("span",{className:"text-greyscale-500",children:[n,":"]})," ",(0,r.jsx)(J.L,{text:e.infos[t]})]},t)})]})})]})]},e.account)}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-1"}),(0,r.jsx)("td",{className:"px-1 text-greyscale-500",children:"弃权票"}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,b.LH)(N||BigInt(0))}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,b.rl)(Number(N||BigInt(0))/Number(D||BigInt(0))*100)})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-1"}),(0,r.jsx)("td",{className:"px-1 text-greyscale-500",children:"汇总 "}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,b.LH)(D||BigInt(0))}),(0,r.jsx)("td",{className:"px-1 text-right",children:"100%"})]})]})]}):(0,r.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有验证地址"})]})},G=function(){var e=BigInt((0,a.useRouter)().query.id||"0"),n=(0,l.m)().address,t=((0,o.useContext)(d.M)||{}).token,c=(0,u.Bk)(),v=c.currentRound,b=c.error,N=(0,x.S)().handleContractError;(0,o.useEffect)(function(){b&&N(b,"verify")},[b]);var w=(0,s._)((0,o.useState)(BigInt(-1)),2),I=w[0],A=w[1];console.log("remainingVotes",I);var B=(0,s._)((0,o.useState)(void 0),2),k=B[0],C=B[1],S=(0,f.Q)({tokenAddress:null==t?void 0:t.address,actionId:e,account:n}),_=S.isExtensionAction,E=S.extensionAddress,Z=S.factory;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.Z,{title:"验证",showBackButton:!0,backUrl:"/verify/?symbol=".concat(null==t?void 0:t.symbol)}),(0,r.jsxs)("main",{className:"flex-grow",children:[I>0&&(0,r.jsxs)("div",{className:"px-2 pt-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(g.Z,{title:"请分配您的验证票："}),(0,r.jsx)(i(),{href:"/action/info/?id=".concat(e,"&symbol=").concat(null==t?void 0:t.symbol,"&tab=verify&tab2=current"),className:"text-blue-600 hover:text-blue-800 underline text-sm",children:"验证结果>>"})]}),(0,r.jsx)(j.Z,{currentRound:v,roundType:"verify",showCountdown:!1})]}),(0,r.jsx)(y,{currentRound:v,actionId:e,onRemainingVotesChange:function(e){A(e)}}),(0,r.jsxs)("div",{className:"flex flex-col items-center px-2 py-4",children:[I>BigInt(1)&&(0,r.jsx)(W,{currentRound:v,actionId:e,actionInfo:k,remainingVotes:I}),I>=BigInt(0)&&I<=BigInt(1)&&(0,r.jsx)(U,{currentRound:v,actionId:e,actionInfo:k}),I<BigInt(0)&&(0,r.jsx)(p.Z,{})]}),(0,r.jsx)(h.Z,{actionId:e,round:BigInt(v||0),showSubmitter:!0,onActionInfo:C,isExtensionAction:_,extensionAddress:E,factory:Z})]})]})}},88504:function(e,n,t){"use strict";t.d(n,{O:function(){return f}});var s=t(72253),r=t(14932),a=t(3628),c=t(97712),i=t(81946),o=t(36100),l=t(10352),d=t(39360),u=t(78942),x=t(63973);function f(){var e,n,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},f=t.query,m=void 0===f?{}:f,h=t.watch,g=(0,u.Z)(t),v=(0,a.NL)(),b=(0,d.x)({config:g}),p=null!==(e=t.chainId)&&void 0!==e?e:b,y=function(e,n={}){return{gcTime:0,async queryFn({queryKey:n}){let{scopeKey:t,...s}=n[1];return await function(e,n={}){let{chainId:t,...s}=n,r=e.getClient({chainId:t});return(0,i.s)(r,c.z,"getBlockNumber")(s)}(e,s)??null},queryKey:function(e={}){return["blockNumber",(0,o.OP)(e)]}(n)}}(g,(0,r._)((0,s._)({},t),{chainId:p}));return(0,x.x)((0,r._)((0,s._)({},(0,s._)({config:t.config,chainId:t.chainId},"object"==typeof h?h:{})),{enabled:!!((null===(n=m.enabled)||void 0===n||n)&&("object"==typeof h?h.enabled:h)),onBlockNumber:function(e){v.setQueryData(y.queryKey,e)}})),(0,l.aM)((0,s._)({},m,y))}},63973:function(e,n,t){"use strict";t.d(n,{x:function(){return u}});var s=t(72253),r=t(14932),a=t(47702),c=t(65185),i=t(81946),o=t(67294),l=t(39360),d=t(78942);function u(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.enabled,u=void 0===t||t,x=n.onBlockNumber,f=(n.config,(0,a._)(n,["enabled","onBlockNumber","config"])),m=(0,d.Z)(n),h=(0,l.x)({config:m}),g=null!==(e=n.chainId)&&void 0!==e?e:h;(0,o.useEffect)(function(){if(u&&x)return function(e,n){let t,s;let{syncConnectedChain:r=e._internal.syncConnectedChain,...a}=n,o=n=>{t&&t();let s=e.getClient({chainId:n});return t=(0,i.s)(s,c.q,"watchBlockNumber")(a)},l=o(n.chainId);return r&&!n.chainId&&(s=e.subscribe(({chainId:e})=>e,async e=>o(e))),()=>{l?.(),s?.()}}(m,(0,r._)((0,s._)({},f),{chainId:g,onBlockNumber:x}))},[g,m,u,x,f.onError,f.emitMissed,f.emitOnBegin,f.poll,f.pollingInterval,f.syncConnectedChain])}}},function(e){e.O(0,[8501,4463,3798,8139,3494,3591,5787,8300,2112,6268,6097,9330,7568,4018,2888,9774,179],function(){return e(e.s=81130)}),_N_E=e.O()}]);