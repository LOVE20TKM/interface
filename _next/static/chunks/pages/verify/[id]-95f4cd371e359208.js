(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9871],{1709:(e,s,t)=>{"use strict";t.d(s,{A:()=>n});var a=t(37876);let n=e=>{var s=e.title;return(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsx)("h1",{className:"text-lg font-bold",children:s})})}},12293:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});var a=t(37876),n=t(7446);let r=()=>(0,a.jsx)(n.A,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})},18651:(e,s,t)=>{"use strict";t.d(s,{A:()=>d});var a=t(40854),n=t(37876),r=t(14232),l=t(63934),i=t(83416);let c=e=>{var s=e.initialTimeLeft,t=e.onTick,l=(0,a._)((0,r.useState)(Date.now()+1e3*s),2),i=l[0],c=l[1],o=(0,a._)((0,r.useState)(s),2),d=o[0],x=o[1];(0,r.useEffect)(()=>{c(Date.now()+1e3*s)},[s]),(0,r.useEffect)(()=>{var e=setInterval(()=>{var s=Math.max(0,Math.floor((i-Date.now())/1e3));x(s),t&&t(s),s<=0&&(clearInterval(e),window.location.reload())},1e3);return()=>clearInterval(e)},[i,t]);var m=Math.floor(d/86400),u=Math.floor(d%86400/3600),h=Math.floor(d%3600/60);return(0,n.jsxs)("div",{className:"inline-flex gap-1 text-greyscale-400",children:[m>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"countdown font-mono",children:(0,n.jsx)("span",{style:{"--value":m}})}),"天"]}),(u>0||m>0)&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"countdown font-mono",children:(0,n.jsx)("span",{style:{"--value":u}})}),"时"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"countdown font-mono",children:(0,n.jsx)("span",{style:{"--value":h}})}),"分"]}),m<=0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"countdown font-mono",children:(0,n.jsx)("span",{style:{"--value":d%60}})}),"秒"]})]})};var o=t(12293);let d=e=>{var s=e.currentRound,t=e.roundType,d=e.showCountdown,x=(0,l.y)().data,m=(0,r.useContext)(i.N),u=m?m.token:void 0,h=!x||!u||void 0===u.voteOriginBlocks,v=(0,a._)((0,r.useState)(0n),2),j=v[0],f=v[1],g=Number("33784")||0,N=Number("255")||0,p=u?Number(u.voteOriginBlocks):0,y=g-(Number(x)-p)%g,b=y>0?Math.ceil(y*N/100):0,w=(0,a._)((0,r.useState)(b),2),I=w[0],A=w[1];(0,r.useEffect)(()=>{if(x){var e=g-(Number(x)-p)%g;A(e>0?Math.ceil(e*N/100):0)}},[x,g,N,p]),(0,r.useEffect)(()=>{u&&s>0n&&f(s-BigInt(u.initialStakeRound)+1n)},[s,u]);var C=null!=j?j.toString():"0";return(null==u?void 0:u.initialStakeRound)&&!(j<=0n)?h||null==j||j<0n?((null==j||j<0n)&&(console.log("currentTokenRound",j),console.log("currentRound",s),console.log("token.initialStakeRound",null==u?void 0:u.initialStakeRound),console.log("token",u)),(0,n.jsx)(o.A,{})):(0,n.jsx)("div",{className:"flex items-center mb-3",children:(0,n.jsxs)("span",{className:"text-sm text-greyscale-400",children:["( 第",(0,n.jsx)("span",{className:"text-greyscale-400",children:C}),"轮","vote"===t?"投票":"verify"===t?"验证":"行动","阶段，",(0,n.jsx)("span",{className:"text-greyscale-400",children:"剩余"}),(0,n.jsx)("span",{className:"text-greyscale-400",children:Math.ceil(100*I/N)}),(0,n.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),void 0===d||d?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(c,{initialTimeLeft:b,onTick:A})}):(0,n.jsx)("span",{className:"text-greyscale-400",children:I<60?"".concat(I,"秒"):I<=300?"".concat(Math.floor(I/60),"分钟").concat(I%60,"秒"):I<3600?"".concat(Math.floor(I/60),"分钟"):"".concat(Math.floor(I/3600),"小时").concat(Math.floor(I%3600/60),"分钟")}),(0,n.jsx)("span",{className:"text-greyscale-400",children:" )"})]})}):(0,n.jsx)(n.Fragment,{})}},42038:(e,s,t)=>{"use strict";t.d(s,{C:()=>n});var a=t(97685),n=e=>!!e||(a.oR.error("请先将钱包链接 ".concat("thinkium801")),!1)},42467:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>_});var a=t(40854),n=t(37876),r=t(89099),l=t(14232),i=t(29898),c=t(20451),o=t(66663),d=t(92101),x=t(1709),m=t(8047),u=t(98684),h=t(83416),v=t(20442),j=t(12293);let f=e=>{var s=e.currentRound,t=e.actionId,a=e.onRemainingVotesChange,r=((0,l.useContext)(h.N)||{}).token,o=(0,m.F)().address,d=(0,u.$6)(null==r?void 0:r.address,s,o||"",t),x=d.votesNumByAccountByActionId,f=d.isPending,g=d.error,N=(0,i.XC)(null==r?void 0:r.address,s,o||"",t),p=N.scoreByVerifierByActionId,y=N.isPending,b=N.error,w=f||y?BigInt(0):x-p;(0,l.useEffect)(()=>{f||y||null==a||a(w)},[w]);var I=(0,c.g)().handleContractError;return((0,l.useEffect)(()=>{g&&I(g,"vote"),b&&I(b,"verify")},[g,b]),w<=0)?(0,n.jsx)(n.Fragment,{}):(0,n.jsxs)("div",{className:"mb-4 text-center",children:[(0,n.jsxs)("span",{className:"font-semibold",children:["我的剩余验证票数：",f||y?(0,n.jsx)(j.A,{}):(0,n.jsx)("span",{className:"text-secondary",children:(0,v.NJ)(w)})]}),(0,n.jsx)("div",{className:"mt-2 text-sm text-greyscale-500 text-center",children:"提示: 最大可验证票数，等于您本轮对该行动的投票数"})]})};var g=t(18651),N=t(3576),p=t(62701),y=t(6960),b=t(97685),w=t(42038),I=t(52372),A=t(87577),C=t(99574),k=t(43885);let E=e=>{var s=e.currentRound,t=e.actionId,o=e.actionInfo,d=e.remainingVotes,x=((0,l.useContext)(h.N)||{}).token,u=(0,m.F)().chain,v=(0,r.useRouter)(),f=(0,I.Zp)(null==x?void 0:x.address,s,t),g=f.verificationInfos,E=f.isPending,_=f.error,R=(0,a._)((0,l.useState)({}),2),S=R[0],B=R[1],F=(0,a._)((0,l.useState)("0"),2),M=F[0],P=F[1];(0,l.useEffect)(()=>{if(g&&g.length>0){var e={};g.forEach(s=>{e[s.account]=""}),B(e),P("")}},[g]);var T=(()=>{var e=Object.values(S).map(e=>parseInt(e)||0),s=parseInt(M)||0,t=e.reduce((e,s)=>e+s,0)+s;if(0===t)return{addressPercentages:{},abstainPercentage:0};var a={};return Object.keys(S).forEach(e=>{var s=parseInt(S[e])||0;a[e]=s/t*100}),{addressPercentages:a,abstainPercentage:s/t*100}})(),V=T.addressPercentages,O=T.abstainPercentage,L=(e,s)=>{(""===s||/^[0-9]+$/.test(s))&&B((0,p._)((0,N._)({},S),{[e]:s}))},D=e=>{(""===e||/^[0-9]+$/.test(e))&&P(e)},$=(0,i.VI)(),H=$.verify,K=$.isWriting,X=$.isConfirming,J=$.isConfirmed,W=$.writeError,q=()=>!!(0,w.C)(u)&&(d<=2n?(b.oR.error("剩余票数不足，无法验证"),!1):!Object.values(S).every(e=>0===parseInt(e)||""===e)||0!==parseInt(M)&&""!==M||(b.oR.error("请至少给一个地址或弃权投票打分"),!1));(0,l.useEffect)(()=>{J&&!W&&(b.oR.success("提交成功",{duration:2e3}),setTimeout(()=>{v.push("/verify/actions/?symbol=".concat(null==x?void 0:x.symbol))},2e3))},[J,W]);var z=(0,c.g)().handleContractError;return(0,l.useEffect)(()=>{W&&z(W,"verify"),_&&z(_,"dataViewer")},[W,_]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"w-full max-w-2xl",children:(0,n.jsxs)("ul",{className:"space-y-4",children:[(0,n.jsxs)("li",{className:"flex justify-between items-center p-4 bg-greyscale-50",children:[(0,n.jsx)("div",{className:"text-left font-semibold",children:"被抽中的行动参与者"}),d>0&&(0,n.jsx)("div",{className:"font-semibold",children:"打分 (分数占比)"})]}),E&&(0,n.jsx)(j.A,{}),g&&g.length>0?g.map((e,s)=>(0,n.jsxs)("li",{className:"flex justify-between items-center px-2 py-1 border-b border-gray-100",children:[(0,n.jsxs)("div",{className:"text-left",children:[(0,n.jsx)("div",{className:"font-mono",children:(0,n.jsx)(A.A,{address:e.account})}),o&&(0,n.jsx)("div",{className:"text-sm text-greyscale-800",children:o.body.verificationKeys.map((s,t)=>(0,n.jsxs)("div",{children:[s,": ",(0,n.jsx)(k.H,{text:e.infos[t]})]},t))})]}),d>0&&(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"number",min:"0",value:S[e.account]||"",placeholder:"0",onChange:s=>L(e.account,s.target.value),className:"w-10 px-1 py-1 border rounded",disabled:K||J}),(0,n.jsx)("span",{className:"ml-1 text-greyscale-500",children:"分:"})]}),(0,n.jsxs)("div",{className:"w-10 text-right text-greyscale-500",children:[(V[e.account]||0).toFixed(2),"%"]})]})]},e.account)):(0,n.jsx)("div",{className:"text-center text-greyscale-500",children:"没有人参与活动"}),g&&d>0&&(0,n.jsxs)("li",{className:"flex justify-between items-center p-4 border-b border-gray-100",children:[(0,n.jsx)("div",{className:"text-left",children:(0,n.jsx)("div",{className:"text-sm text-greyscale-800",children:(0,n.jsx)("span",{children:"弃权票数："})})}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"number",min:"0",value:M,placeholder:"0",onChange:e=>D(e.target.value),className:"w-10 px-1 py-1 border rounded",disabled:K||J}),(0,n.jsx)("span",{className:"ml-1 text-greyscale-500",children:"分:"})]}),(0,n.jsxs)("div",{className:"w-10 text-right text-greyscale-500",children:[O.toFixed(2),"%"]})]})]})]})}),d>0&&(0,n.jsxs)(y.$,{onClick:()=>{if(q()){var e=Object.values(S).reduce((e,s)=>e+(parseInt(s)||0),0)+(parseInt(M)||0);console.log("-------handleSubmit()-------"),console.log("scoreSum",e);var s=[],a=0n;g.forEach((t,n)=>{var r=parseInt(S[t.account])||0,l=BigInt(Math.floor(Number(d)*(r/e)));if((a+=l)>d){var i=a-d;a-=i,s.push(l-i)}else s.push(l)});var n=s.reduce((e,s)=>e+s,0n);if(console.log("remainingVotes",d),console.log("scoresArrayTotal",n),console.log("scoresArrayForSubmit",s),parseInt(M)>0){var r=d>n?d-n:0n;console.log("abstainVotes",r),H(null==x?void 0:x.address,t,r,s)}else{if(n<d){var l=s.findIndex(e=>e>0n);-1!==l&&(s[l]+=d-n)}console.log("abstainVotes",0n),H(null==x?void 0:x.address,t,0n,s)}}},disabled:K||X||J,className:"mt-6 w-1/2",children:[!K&&!X&&!J&&"提交验证",K&&"提交中...",X&&"确认中...",J&&"已验证"]}),(0,n.jsx)(C.A,{isLoading:K||X,text:K?"提交交易...":"确认交易..."})]})},_=()=>{var e=BigInt((0,r.useRouter)().query.id||"0"),s=(0,i.vC)(),t=s.currentRound,m=s.error,u=(0,c.g)().handleContractError;(0,l.useEffect)(()=>{m&&u(m,"verify")},[m]);var h=(0,a._)((0,l.useState)(BigInt(0)),2),v=h[0],j=h[1],N=(0,a._)((0,l.useState)(void 0),2),p=N[0],y=N[1];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.A,{title:"验证"}),(0,n.jsxs)("main",{className:"flex-grow",children:[v>0&&(0,n.jsxs)("div",{className:"px-4",children:[(0,n.jsx)(x.A,{title:"请给行动的参与者打分："}),(0,n.jsx)(g.A,{currentRound:t,roundType:"verify",showCountdown:!1})]}),(0,n.jsx)("div",{className:"flex flex-col items-center p-4",children:(0,n.jsx)(E,{currentRound:t,actionId:e,actionInfo:p,remainingVotes:v})}),(0,n.jsx)("div",{className:"".concat(v>0?"mb-6":""),children:(0,n.jsx)(f,{currentRound:t,actionId:e,onRemainingVotesChange:function(e){j(e)}})}),(0,n.jsx)(d.A,{actionId:e,round:BigInt(t||0),showSubmitter:!0,onActionInfo:y})]})]})}},43885:(e,s,t)=>{"use strict";t.d(s,{H:()=>r});var a=t(37876);t(14232);var n=e=>{if(!e)return e;var s=/(https?:\/\/[^\s]+)/g;if(!s.test(e))return e;var t=e.split(s),n=e.match(s)||[];return(0,a.jsx)(a.Fragment,{children:t.map((e,s)=>{if(s%2==0)return e;var t=n[(s-1)/2];return(0,a.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline hover:text-blue-700",children:t},s)})})},r=e=>{var s=e.text;return(0,a.jsx)(a.Fragment,{children:n(s)})}},87577:(e,s,t)=>{"use strict";t.d(s,{A:()=>x});var a=t(40854),n=t(37876),r=t(14232),l=t(48447),i=t(33276),c=t(70801),o=t(97685),d=t(20442);let x=e=>{var s=e.address,t=e.word,x=e.showCopyButton,m=e.showAddress,u=void 0===m||m,h=e.colorClassName,v=void 0===h?"":h,j=e.colorClassName2,f=void 0===j?"":j,g=(0,a._)((0,r.useState)(!1),2),N=g[0],p=g[1];return(0,n.jsxs)("span",{className:"inline-flex items-center space-x-2",children:[t&&(0,n.jsx)("span",{className:"text-xs",children:t}),u&&!f&&(0,n.jsx)("span",{className:"text-xs ".concat(null!=v?v:"text-greyscale-500"),children:(0,d.W_)(s)}),u&&f&&(0,n.jsxs)("span",{className:"text-[0px]",children:[(0,n.jsx)("span",{className:"text-xs ".concat(null!=v?v:"text-greyscale-500"),children:"".concat(s.substring(0,6),"...")}),(0,n.jsx)("span",{className:"text-xs ".concat(f),children:"".concat(s.substring(s.length-4))})]}),(void 0===x||x)&&(0,n.jsx)(l.CopyToClipboard,{text:s,onCopy:(e,s)=>{s?p(!0):o.Ay.error("复制失败")},children:(0,n.jsx)("button",{className:"flex items-center justify-center p-1 rounded hover:bg-gray-200 focus:outline-none",onClick:e=>{e.preventDefault(),e.stopPropagation()},"aria-label":"复制地址",children:N?(0,n.jsx)(i.A,{className:"h-4 w-4 ".concat(null!=v?v:"text-greyscale-500")}):(0,n.jsx)(c.A,{className:"h-4 w-4 ".concat(null!=v?v:"text-greyscale-500")})})})]})}},92101:(e,s,t)=>{"use strict";t.d(s,{A:()=>j});var a=t(37876),n=t(14232),r=t(6960),l=t(48230),i=t.n(l),c=t(64115),o=t(20451),d=t(83416),x=t(20442),m=t(43885),u=t(87577),h=t(12293),v=t(1709);let j=e=>{var s,t=e.actionId,l=e.round,j=e.showSubmitter,f=e.showVerifyHistory,g=e.onActionInfo,N=((0,n.useContext)(d.N)||{}).token,p=(0,c.Y4)(null==N?void 0:N.address,t),y=p.actionInfo,b=p.isPending,w=p.error;(0,n.useEffect)(()=>{g&&y&&g(y)},[y]);var I=(0,c.VD)(null==N?void 0:N.address,j?l:0n),A=I.actionSubmits,C=I.isPending,k=I.error,E=(null==A||null==(s=A.find(e=>e.actionId==Number(t)))?void 0:s.submitter)||"N/A",_=(0,o.g)().handleContractError;return((0,n.useEffect)(()=>{w&&_(w,"submit"),k&&_(k,"submit")},[w,k]),b)?(0,a.jsx)(h.A,{}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mx-auto p-4 pb-2 border-t border-greyscale-100",children:(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)(v.A,{title:"行动详情"}),(void 0===f||f)&&(0,a.jsx)(r.$,{variant:"link",className:"text-secondary border-secondary",asChild:!0,children:(0,a.jsx)(i(),{href:"/my/actrewards/?id=".concat(t,"&symbol=").concat(null==N?void 0:N.symbol),children:"查看验证结果 >>"})})]})}),(0,a.jsxs)("div",{className:"mx-auto p-4 pb-2 ",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("span",{className:"text-sm text-greyscale-500",children:["No.",null==y?void 0:y.head.id.toString()]}),(0,a.jsx)("span",{className:"text-xl font-bold text-black",children:null==y?void 0:y.body.action})]}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("span",{className:"text-greyscale-600",children:null==y?void 0:y.body.consensus})}),(0,a.jsxs)("div",{className:"mt-0 text-xs text-greyscale-500 flex justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:["创建人 ",(0,a.jsx)(u.A,{address:null==y?void 0:y.head.author})]}),j&&(0,a.jsxs)("div",{className:"flex items-center",children:["推举人"," ",C?(0,a.jsx)(h.A,{}):(0,a.jsx)(u.A,{address:E})]})]})]}),(0,a.jsx)("div",{className:"mx-auto p-4 pb-2",children:(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-sm font-bold",children:"最小参与代币数"}),(0,a.jsx)("p",{className:"text-greyscale-500",children:(0,x.NJ)((null==y?void 0:y.body.minStake)||BigInt(0))})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-sm font-bold",children:"最大抽取验证地址数"}),(0,a.jsx)("p",{className:"text-greyscale-500",children:(null==y?void 0:y.body.maxRandomAccounts.toString())||"-"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-sm font-bold",children:"验证规则"}),(0,a.jsx)("p",{className:"text-greyscale-500 whitespace-pre-wrap",children:(0,a.jsx)(m.H,{text:null==y?void 0:y.body.verificationRule})})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-sm font-bold",children:"报名参加行动时，行动者要提供的信息"}),(null==y?void 0:y.body.verificationKeys)&&(null==y?void 0:y.body.verificationKeys.length)>0?(0,a.jsx)("ul",{className:"list-disc pl-5",children:y.body.verificationKeys.map((e,s)=>(0,a.jsxs)("li",{className:"text-greyscale-500",children:[e," : ",y.body.verificationInfoGuides[s]]},s))}):(0,a.jsx)("span",{className:"text-greyscale-500",children:"无"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-sm font-bold",children:"白名单"}),(0,a.jsx)("p",{className:"text-greyscale-500 flex flex-wrap items-center",children:(null==y?void 0:y.body.whiteList.length)?y.body.whiteList.map((e,s)=>(0,a.jsx)("span",{className:"flex items-center mr-2",children:(0,a.jsx)(u.A,{address:e})},s)):"无限制"})]})]})})]})}},98980:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/verify/[id]",function(){return t(42467)}])},99574:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});var a=t(37876);t(14232);var n=t(7446);let r=e=>{var s=e.isLoading,t=e.text;return s?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(n.A,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,a.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:void 0===t?"Loading":t})]})}):null}}},e=>{var s=s=>e(e.s=s);e.O(0,[3363,2569,2840,9898,636,6593,8792],()=>s(98980)),_N_E=e.O()}]);