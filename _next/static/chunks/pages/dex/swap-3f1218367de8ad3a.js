(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8026],{17137:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dex/swap",function(){return n(61322)}])},76929:function(e,t,n){"use strict";n.d(t,{l0:function(){return u},NI:function(){return b},pf:function(){return j},Wi:function(){return f},xJ:function(){return h},lX:function(){return y},zG:function(){return g}});var s=n(85893),r=n(67294),a=n(4222),l=n(87536),i=n(40108),o=n(99489);let d=(0,n(12003).j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(o.f,{ref:t,className:(0,i.cn)(d(),n),...r})});c.displayName=o.f.displayName;let u=l.RV,m=r.createContext({}),f=e=>{let{...t}=e;return(0,s.jsx)(m.Provider,{value:{name:t.name},children:(0,s.jsx)(l.Qr,{...t})})},x=()=>{let e=r.useContext(m),t=r.useContext(p),{getFieldState:n,formState:s}=(0,l.Gc)(),a=n(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=t;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...a}},p=r.createContext({}),h=r.forwardRef((e,t)=>{let{className:n,...a}=e,l=r.useId();return(0,s.jsx)(p.Provider,{value:{id:l},children:(0,s.jsx)("div",{ref:t,className:(0,i.cn)("space-y-2",n),...a})})});h.displayName="FormItem";let y=r.forwardRef((e,t)=>{let{className:n,...r}=e,{error:a,formItemId:l}=x();return(0,s.jsx)(c,{ref:t,className:(0,i.cn)(a&&"text-destructive",n),htmlFor:l,...r})});y.displayName="FormLabel";let b=r.forwardRef((e,t)=>{let{...n}=e,{error:r,formItemId:l,formDescriptionId:i,formMessageId:o}=x();return(0,s.jsx)(a.g7,{ref:t,id:l,"aria-describedby":r?"".concat(i," ").concat(o):"".concat(i),"aria-invalid":!!r,...n})});b.displayName="FormControl";let j=r.forwardRef((e,t)=>{let{className:n,...r}=e,{formDescriptionId:a}=x();return(0,s.jsx)("p",{ref:t,id:a,className:(0,i.cn)("text-sm text-muted-foreground",n),...r})});j.displayName="FormDescription";let g=r.forwardRef((e,t)=>{let{className:n,children:r,...a}=e,{error:l,formMessageId:o}=x(),d=l?String(null==l?void 0:l.message):r;return d?(0,s.jsx)("p",{ref:t,id:o,className:(0,i.cn)("text-sm font-medium text-destructive",n),...a,children:d}):null});g.displayName="FormMessage"},88659:function(e,t,n){"use strict";n.d(t,{Bw:function(){return p},Ph:function(){return c},Ql:function(){return h},i4:function(){return m},ki:function(){return u}});var s=n(85893),r=n(67294),a=n(86443),l=n(42171),i=n(15432),o=n(78865),d=n(40108);let c=a.fC;a.ZA;let u=a.B4,m=r.forwardRef((e,t)=>{let{className:n,children:r,...i}=e;return(0,s.jsxs)(a.xz,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",n),...i,children:[r,(0,s.jsx)(a.JO,{asChild:!0,children:(0,s.jsx)(l.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=a.xz.displayName;let f=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(a.u_,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",n),...r,children:(0,s.jsx)(i.Z,{className:"h-4 w-4"})})});f.displayName=a.u_.displayName;let x=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(a.$G,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",n),...r,children:(0,s.jsx)(l.Z,{className:"h-4 w-4"})})});x.displayName=a.$G.displayName;let p=r.forwardRef((e,t)=>{let{className:n,children:r,position:l="popper",...i}=e;return(0,s.jsx)(a.h_,{children:(0,s.jsxs)(a.VY,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",n),position:l,...i,children:[(0,s.jsx)(f,{}),(0,s.jsx)(a.l_,{className:(0,d.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,s.jsx)(x,{})]})})});p.displayName=a.VY.displayName,r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(a.__,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",n),...r})}).displayName=a.__.displayName;let h=r.forwardRef((e,t)=>{let{className:n,children:r,...l}=e;return(0,s.jsxs)(a.ck,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...l,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(a.wU,{children:(0,s.jsx)(o.Z,{className:"h-4 w-4"})})}),(0,s.jsx)(a.eT,{children:r})]})});h.displayName=a.ck.displayName,r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(a.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",n),...r})}).displayName=a.Z0.displayName},42083:function(e,t,n){"use strict";var s=n(85893),r=n(23432);t.Z=()=>(0,s.jsx)(r.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})},44576:function(e,t,n){"use strict";var s=n(85893);n(67294);var r=n(23432);t.Z=e=>{let{isLoading:t,text:n="Loading"}=e;return t?(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(r.Z,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,s.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:n})]})}):null}},91529:function(e,t,n){"use strict";n.d(t,{LH:function(){return l},Vu:function(){return a},bM:function(){return o},cK:function(){return c},eb:function(){return u},kP:function(){return d},vz:function(){return i}});var s=n(21803),r=n(15229);let a=e=>e?"".concat(e.substring(0,6),"...").concat(e.substring(e.length-4)):"",l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=Number(o(e));return e<10n?"0":n<1e-4?"<0.0001":new Intl.NumberFormat("en-US",{maximumFractionDigits:t}).format(n)},i=e=>{let t=parseInt("18",10);try{let n=e.replace(/,/g,"");return(0,s.v)(n,t)}catch(e){return console.error("parseUnits error:",e),0n}},o=e=>{let t=parseInt("18",10);return(0,r.b)(e,t)},d=e=>e.includes(".")?parseFloat(e.replace(/,/g,"")).toString():e,c=(e,t)=>e&&t?e-BigInt(t.initialStakeRound)+1n:0n,u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,s=Number(e);if(s>=1)return new Intl.NumberFormat("en-US",{maximumFractionDigits:t}).format(s);if(s>=.001)return new Intl.NumberFormat("en-US",{maximumFractionDigits:n+1}).format(s);{if(0===s)return"0";let e=s.toFixed(n+10),t=e.split(".");if(t.length<2)return e;let r=t[1],a=0;for(let e of r)if("0"===e)a++;else break;let l=r.slice(a);return"0.{".concat(a,"}").concat(l)}}},48105:function(e,t,n){"use strict";n.d(t,{S:function(){return r}});var s=n(86501);let r=e=>!!e||(s.Am.error("请先将钱包链接 ".concat("thinkium801")),!1)},61322:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return _}});var s=n(85893),r=n(67294),a=n(11163),l=n(37436),i=n(86501),o=n(1604),d=n(56312),c=n(92321),u=n(87536);let m=(0,n(31134).Z)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);var f=n(27245),x=n(21774),p=n(88659),h=n(76929),y=n(48105),b=n(91529),j=n(67068),g=n(19638),w=n(89810),N=n(71366),v=n(83540);let k=[{type:"function",name:"swapExactTokensForTokens",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"amountOutMin",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"},{name:"to",type:"address",internalType:"address"},{name:"deadline",type:"uint256",internalType:"uint256"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"nonpayable"},{type:"function",name:"getAmountsOut",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"},{type:"function",name:"getAmountsIn",inputs:[{name:"amountOut",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"}],T="0x64242EF641E12cf6FF9Ba8e05bDDeeC5A21CE30D",A=function(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:s,error:r,isLoading:a}=(0,w.u)({address:T,abi:k,functionName:"getAmountsOut",args:[e,t],query:{enabled:!!e&&t.length>=2&&n}});return{data:s,error:r,isLoading:a}};var F=n(93778),C=()=>{let e=(0,r.useContext)(F.M);if(void 0===e)throw Error("useTokenContext must be used within a TokenProvider");return e},S=n(64777),E=n(42083),I=n(44576);let z=e=>o.z.object({fromTokenAmount:o.z.string().nonempty("请输入兑换数量").refine(t=>{if(t.endsWith(".")||"0"===t)return!0;try{let n=(0,b.vz)(t);return n>0n&&n<=e}catch(e){return!1}},{message:"输入数量必须大于0且不超过您的可用余额"}),fromTokenAddress:o.z.string().regex(/^0x[0-9a-fA-F]{40}$/,"无效合约地址"),toTokenAddress:o.z.string().regex(/^0x[0-9a-fA-F]{40}$/,"无效合约地址")});var R=()=>{let e=(0,a.useRouter)(),{address:t,chain:n}=(0,c.m)(),{token:l}=C(),[o,w]=(0,r.useState)({symbol:"",address:"0x0",amount:0n,amountShow:"0",balance:0n}),[F,R]=(0,r.useState)({symbol:"",address:"0x0",amount:0n,amountShow:"0",balance:0n});(0,r.useEffect)(()=>{l&&(w(e=>({...e,address:l.parentTokenAddress,symbol:l.parentTokenSymbol})),R(e=>({...e,address:l.address,symbol:l.symbol})))},[l]);let _=(0,u.cI)({resolver:(0,d.F)(z(o.balance)),defaultValues:{fromTokenAddress:(null==l?void 0:l.parentTokenAddress)||"0x0",toTokenAddress:(null==l?void 0:l.address)||"0x0",fromTokenAmount:""},mode:"onChange"});(0,r.useEffect)(()=>{_.setValue("fromTokenAddress",o.address),_.setValue("toTokenAddress",F.address)},[o.address,F.address,_]);let Z=_.watch("fromTokenAmount");(0,r.useEffect)(()=>{w(e=>{let t=0n;try{var n;t=null!==(n=(0,b.vz)(Z||"0"))&&void 0!==n?n:0n}catch(e){}return{...e,amount:t,amountShow:Z||"0"}})},[Z]);let{balance:M,error:V,isPending:D}=(0,g.hS)(o.address,t),{balance:P,error:B,isPending:L}=(0,g.hS)(F.address,t);(0,r.useEffect)(()=>{M&&w(e=>({...e,balance:M})),P&&R(e=>({...e,balance:P}))},[M,P]);let{data:O,error:W,isLoading:G}=A(o.amount,[o.address,F.address]);(0,r.useEffect)(()=>{if(O&&O.length>1){let e=BigInt(O[1]);R(t=>({...t,amount:e,amountShow:(0,b.bM)(e)}))}},[O]);let{approve:U,isWriting:J,isConfirming:Q,isConfirmed:$,writeError:H}=(0,g.yA)(null==l?void 0:l.address),{approve:X,isWriting:q,isConfirming:Y,isConfirmed:K,writeError:ee}=(0,g.yA)(null==l?void 0:l.parentTokenAddress),{swap:et,isWriting:en,isConfirming:es,isConfirmed:er,writeError:ea}=function(){let{writeContract:e,isPending:t,data:n,error:s}=(0,N.S)(),r=async(t,n,s,r,a)=>{try{await e({address:T,abi:k,functionName:"swapExactTokensForTokens",args:[t,n,s,r,a]})}catch(e){console.error("Swap failed:",e)}},{isLoading:a,isSuccess:l}=(0,v.A)({hash:n});return{swap:r,writeData:n,isWriting:t,writeError:s,isConfirming:a,isConfirmed:l}}(),el=J||q||Q||Y,ei=$||K,eo=_.handleSubmit(async e=>{if((0,y.S)(n))try{let e=(null==l?void 0:l.symbol)===o.symbol?U:X;await e("0x64242EF641E12cf6FF9Ba8e05bDDeeC5A21CE30D",o.amount)}catch(e){console.error(e),i.Am.error((null==e?void 0:e.message)||"授权失败")}}),ed=_.handleSubmit(async e=>{if((0,y.S)(n))try{let e=BigInt(Math.floor(Date.now()/1e3)+1200);await et(o.amount,F.amount/1000n*995n,[o.address,F.address],t,e)}catch(e){console.error(e),i.Am.error((null==e?void 0:e.message)||"兑换失败")}});(0,r.useEffect)(()=>{er&&(i.Am.success("兑换成功"),setTimeout(()=>{e.push("/my/?symbol=".concat(null==l?void 0:l.symbol))},2e3))},[er,e,null==l?void 0:l.symbol]);let[ec,eu]=(0,r.useState)("0");(0,r.useEffect)(()=>{if(o.amountShow){let e=.3*(parseFloat(o.amountShow)||0)/100;eu(e<1e-4?e.toExponential(2):e.toFixed(6))}else eu("0")},[o.amountShow]);let{handleContractError:em}=(0,j.S)();if((0,r.useEffect)(()=>{H&&em(H,"token"),ee&&em(ee,"token"),W&&em(W,"uniswapV2Router"),ea&&em(ea,"uniswapV2Router"),B&&em(B,"token"),V&&em(V,"token")},[H,ee,W,ea,B,V]),!l)return(0,s.jsx)(E.Z,{});let ef=el||en||es,ex=o.amount>0n&&O&&O.length>1?(0,b.eb)((0,b.bM)(O[1]*10n**18n/o.amount),2,4):"0";return(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)(S.Z,{title:"兑换"}),(0,s.jsxs)("div",{className:"w-full max-w-md mt-4",children:[(0,s.jsx)(h.l0,{..._,children:(0,s.jsxs)("form",{children:[(0,s.jsxs)("div",{className:"mb-4 flex flex-col",children:[(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)(h.Wi,{control:_.control,name:"fromTokenAmount",render:e=>{let{field:t}=e;return(0,s.jsxs)(h.xJ,{className:"w-2/3",children:[(0,s.jsx)(h.NI,{children:(0,s.jsx)(x.I,{placeholder:"请填写数量",type:"number",className:"w-full !ring-secondary-foreground",disabled:D||L||ei,...t})}),(0,s.jsx)(h.zG,{})]})}}),(0,s.jsx)(h.Wi,{control:_.control,name:"fromTokenAddress",render:e=>{let{field:t}=e;return(0,s.jsxs)(h.xJ,{className:"w-1/3",children:[(0,s.jsx)(h.NI,{children:(0,s.jsxs)(p.Ph,{value:t.value,onValueChange:e=>{t.onChange(e),w(t=>({...t,address:e}))},disabled:D||L||ei,children:[(0,s.jsx)(p.i4,{className:"w-full",children:(0,s.jsx)(p.ki,{placeholder:"选择代币"})}),(0,s.jsx)(p.Bw,{children:(0,s.jsx)(p.Ql,{value:o.address,children:o.symbol})})]})}),(0,s.jsx)(h.zG,{})]})}})]}),(0,s.jsxs)("div",{className:"flex items-center text-sm mt-2",children:[(0,s.jsxs)("span",{className:"text-greyscale-400",children:[(0,b.LH)(o.balance||0n)," ",o.symbol]}),(0,s.jsx)(f.z,{variant:"link",type:"button",size:"sm",className:"text-secondary ml-2",onClick:()=>{let e=(0,b.bM)(o.balance);_.setValue("fromTokenAmount",e)},disabled:D||L||ei,children:"最高"})]})]}),(0,s.jsx)("div",{className:"flex justify-center my-4",children:(0,s.jsx)(f.z,{variant:"ghost",type:"button",size:"icon",className:"rounded-full hover:bg-gray-100",onClick:()=>{let e={...o},t={...F};"0x0"!==e.address&&"0x0"!==t.address&&(w(t),R(e),_.setValue("fromTokenAmount","0"))},disabled:D||L||ei,children:(0,s.jsx)(m,{className:"h-6 w-6"})})}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)(x.I,{type:"number",disabled:!0,placeholder:"0.0",className:"flex-grow w-2/3 !ring-secondary-foreground",value:F.amountShow,readOnly:!0}),(0,s.jsx)(h.Wi,{control:_.control,name:"toTokenAddress",render:e=>{let{field:t}=e;return(0,s.jsxs)(h.xJ,{className:"w-1/3",children:[(0,s.jsx)(h.NI,{children:(0,s.jsxs)(p.Ph,{value:t.value,onValueChange:e=>{t.onChange(e),R(t=>({...t,address:e}))},disabled:D||L||ei,children:[(0,s.jsx)(p.i4,{className:"w-full",children:(0,s.jsx)(p.ki,{placeholder:"选择代币"})}),(0,s.jsx)(p.Bw,{children:(0,s.jsx)(p.Ql,{value:F.address,children:F.symbol})})]})}),(0,s.jsx)(h.zG,{})]})}})]}),(0,s.jsx)("div",{className:"flex justify-between items-center text-sm mt-2",children:(0,s.jsxs)("span",{className:"text-greyscale-400",children:[(0,b.LH)(F.balance||0n)," ",F.symbol]})})]}),(0,s.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,s.jsx)(f.z,{className:"w-1/2",onClick:eo,disabled:el||ei,children:J||q?"1.授权中...":Q||Y?"1.确认中...":ei?"1.已授权":"1.授权"}),(0,s.jsx)(f.z,{className:"w-1/2",onClick:ed,disabled:!ei||el||en||es||er,children:en?"2.兑换中...":es?"2.确认中...":er?"2.已兑换":"2.兑换"})]})]})}),o.amount>0n&&(0,s.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-md",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-greyscale-400",children:"兑换率: "}),(0,s.jsxs)("span",{children:["1 ",o.symbol," = ",ex," ",F.symbol]})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-greyscale-400",children:"手续费 (0.3%)："}),(0,s.jsxs)("span",{children:[ec," ",o.symbol]})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-greyscale-400",children:"滑点上限 (自动)："}),(0,s.jsx)("span",{children:"5.5%"})]})]})]}),(0,s.jsx)(I.Z,{isLoading:ef,text:J||q||en?"提交交易...":"确认交易..."})]})};function _(){let e=(0,a.useRouter)(),{token:t}=(0,r.useContext)(F.M)||{};return(0,r.useEffect)(()=>{t&&!t.hasEnded?e.push("/launch?symbol=".concat(t.symbol)):t&&!t.initialStakeRound&&e.push("/gov/stakelp/?symbol=".concat(t.symbol,"&first=true"))},[t]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Z,{title:"兑换代币"}),(0,s.jsxs)("main",{className:"flex-grow",children:[(0,s.jsx)(R,{}),(0,s.jsxs)("div",{className:"bg-gray-100 text-greyscale-500 rounded-lg p-4 text-sm mt-0 m-6",children:[(0,s.jsx)("p",{className:"mb-1",children:"说明："}),(0,s.jsx)("p",{children:"1. 本交易功能基于 Uniswap V2 协议实现，合约代码为官方最新版本；"}),(0,s.jsx)("p",{children:"2. 手续费为 0.3%，滑点上限为 0.5%；"})]})]})]})}}},function(e){e.O(0,[2624,7569,7863,7380,2888,9774,179],function(){return e(e.s=17137)}),_N_E=e.O()}]);