(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7407],{28638:(e,s,r)=>{"use strict";r.d(s,{BT:()=>u,Wu:()=>m,ZB:()=>c,Zp:()=>d,aR:()=>l,wL:()=>f});var a=r(3576),n=r(65699),t=r(37876),o=r(14232),i=r(30684),d=o.forwardRef((e,s)=>{var r=e.className,o=(0,n._)(e,["className"]);return(0,t.jsx)("div",(0,a._)({ref:s,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r)},o))});d.displayName="Card";var l=o.forwardRef((e,s)=>{var r=e.className,o=(0,n._)(e,["className"]);return(0,t.jsx)("div",(0,a._)({ref:s,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",r)},o))});l.displayName="CardHeader";var c=o.forwardRef((e,s)=>{var r=e.className,o=(0,n._)(e,["className"]);return(0,t.jsx)("div",(0,a._)({ref:s,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",r)},o))});c.displayName="CardTitle";var u=o.forwardRef((e,s)=>{var r=e.className,o=(0,n._)(e,["className"]);return(0,t.jsx)("div",(0,a._)({ref:s,className:(0,i.cn)("text-sm text-muted-foreground",r)},o))});u.displayName="CardDescription";var m=o.forwardRef((e,s)=>{var r=e.className,o=(0,n._)(e,["className"]);return(0,t.jsx)("div",(0,a._)({ref:s,className:(0,i.cn)("p-6 pt-0",r)},o))});m.displayName="CardContent";var f=o.forwardRef((e,s)=>{var r=e.className,o=(0,n._)(e,["className"]);return(0,t.jsx)("div",(0,a._)({ref:s,className:(0,i.cn)("flex items-center p-6 pt-0",r)},o))});f.displayName="CardFooter"},42038:(e,s,r)=>{"use strict";r.d(s,{C:()=>n});var a=r(97685),n=e=>!!e||(a.oR.error("请先将钱包链接 ".concat("thinkium801")),!1)},44356:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>Z});var a=r(37876),n=r(14232),t=r(62212),o=r(66663),i=r(16927),d=r(3576),l=r(62701),c=r(40854),u=r(4902),m=r(89099),f=r(97685),p=r(60513),x=r(13810),g=r(57238),v=r(8047),h=r(88992),y=(0,r(11713).A)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),b=r(6960),N=r(77932),T=r(28638),w=r(78256),j=r(92659),_=r(42038),C=r(20442),E=r(20451),A=r(9215),k=r(75569),F=r(59493),I=r(40162),R=r(77351),S=[{type:"function",name:"swapExactTokensForTokens",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"amountOutMin",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"},{name:"to",type:"address",internalType:"address"},{name:"deadline",type:"uint256",internalType:"uint256"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"nonpayable"},{type:"function",name:"swapExactETHForTokens",inputs:[{name:"amountOutMin",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"},{name:"to",type:"address",internalType:"address"},{name:"deadline",type:"uint256",internalType:"uint256"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"payable"},{type:"function",name:"swapExactTokensForETH",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"amountOutMin",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"},{name:"to",type:"address",internalType:"address"},{name:"deadline",type:"uint256",internalType:"uint256"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"nonpayable"},{type:"function",name:"getAmountsOut",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"},{type:"function",name:"getAmountsIn",inputs:[{name:"amountOut",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"}],H=r(14237),B="0x2A2Dc26469F9C8ccA09BbB5C1124bCaA758c014d",O=function(e,s){var r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],a=(0,k.Q)({address:B,abi:S,functionName:"getAmountsOut",args:[e,s],query:{enabled:!!e&&s.length>=2&&r}}),n=a.data;return{data:n,error:a.error,isLoading:a.isLoading}},W=r(80693),D=r(83416);let P=()=>{var e=(0,n.useContext)(D.N);if(void 0===e)throw Error("useTokenContext must be used within a TokenProvider");return e};var L=r(1709),M=r(12293),V=r(99574),U=function(e){var s=!(arguments.length>1)||void 0===arguments[1]||arguments[1],r=[];r.push({symbol:"TKM",address:"NATIVE",decimals:18,isNative:!0});var a="TestTKM20",n="0x015b1A506F2aa2B1ecC000aB799ED6C59005fBb3";return a&&n&&r.push({symbol:a,address:n,decimals:18,isNative:!1,isWETH:!0}),e&&(s&&e.symbol&&e.address&&!r.find(s=>s.address===e.address)&&r.push({symbol:e.symbol,address:e.address,decimals:18,isNative:!1}),e.parentTokenSymbol&&e.parentTokenAddress&&!r.find(s=>s.address===e.parentTokenAddress)&&r.push({symbol:e.parentTokenSymbol,address:e.parentTokenAddress,decimals:18,isNative:!1,isWETH:"0x015b1A506F2aa2B1ecC000aB799ED6C59005fBb3"===e.parentTokenAddress})),console.log("buildSupportedTokens result:",r),r},z=(e,s)=>e.isNative&&s.isWETH||e.isWETH&&s.isNative?"WETH9":!e.isNative||s.isNative||s.isWETH?e.isNative||e.isWETH||!s.isNative?"UniswapV2_TOKEN_TO_TOKEN":"UniswapV2_TOKEN_TO_ETH":"UniswapV2_ETH_TO_TOKEN",q=(e,s)=>{var r="0x015b1A506F2aa2B1ecC000aB799ED6C59005fBb3";return e.isNative?[r,s.address]:s.isNative?[e.address,r]:[e.address,s.address]},K=(e,s)=>{var r=(0,g.A)({address:s,query:{enabled:!!s&&e.isNative}}),a=r.data,n=r.isLoading,t=(0,A.lW)(e.isNative?"0x0000000000000000000000000000000000000000":e.address,s),o=t.balance,i=t.isPending;return{balance:e.isNative?null==a?void 0:a.value:o,isPending:e.isNative?n:i}},J=e=>p.z.object({fromTokenAmount:p.z.string().nonempty("请输入兑换数量").refine(s=>{if(s.endsWith(".")||"0"===s)return!0;try{var r=(0,C.XS)(s);return r>0n&&r<=e}catch(e){return!1}},{message:"输入数量必须大于0且不超过您的可用余额"}),fromTokenAddress:p.z.string(),toTokenAddress:p.z.string()});let X=e=>{var s=e.showCurrentToken,r=void 0===s||s,t=(0,m.useRouter)(),o=(0,v.F)(),p=o.address,g=o.chain,k=P().token,D=(0,n.useMemo)(()=>U(k,r),[k,r]),X=(0,c._)((0,n.useState)({symbol:"TKM",address:"NATIVE",decimals:18,isNative:!0}),2),Z=X[0],$=X[1],Q=(0,c._)((0,n.useState)({symbol:"TestLOVE20",address:"0x034D08a8102cE7CdEa5Dcc7b3109de24f261b3e6",decimals:18,isNative:!1,isWETH:!1}),2),Y=Q[0],G=Q[1];(0,n.useEffect)(()=>{if(console.log("supportedTokens updated:",D),console.log("router.query:",t.query),console.log("token context:",k),!k)return void console.log("Token not loaded yet, skipping initialization");if(D.length>0){var e=t.query,s=e.from,r=e.to;console.log("Available token symbols:",D.map(e=>e.symbol));var a=void 0,n=void 0,o=!1;s&&"string"==typeof s&&(console.log("Looking for fromSymbol:",s),console.log("Found fromToken:",a=D.find(e=>e.symbol&&e.symbol.toLowerCase()===s.toLowerCase())),a||(f.oR.error("找不到代币 ".concat(s)),o=!0)),r&&"string"==typeof r&&(console.log("Looking for toSymbol:",r),console.log("Found toToken:",n=D.find(e=>e.symbol&&e.symbol.toLowerCase()===r.toLowerCase())),n||(f.oR.error("找不到代币 ".concat(r)),o=!0)),a&&n&&a.address===n.address&&(f.oR.error("不能选择相同的代币进行兑换"),o=!0,a=void 0,n=void 0),a?(console.log("Setting fromToken from URL:",a),$(a)):D[0]&&(console.log("Setting fromToken as default:",D[0]),$(D[0]));var i=a||D[0];if(n&&n.address!==(null==i?void 0:i.address))console.log("Setting toToken from URL:",n),G(n);else{var l=void 0,c="TestLOVE20";if(c&&(l=D.find(e=>e.symbol===c&&e.address!==(null==i?void 0:i.address))),!l){for(var u=1;u<D.length;u++)if(D[u].address!==(null==i?void 0:i.address)){l=D[u];break}}!l&&D.length>1&&(D[1].address!==(null==i?void 0:i.address)?l=D[1]:D[0].address!==(null==i?void 0:i.address)&&(l=D[0])),l&&(console.log("Setting toToken as default:",l),G(l))}if(o){f.oR.error("已切换为默认代币对儿");var m=(0,d._)({},t.query);delete m.from,delete m.to,t.replace({pathname:t.pathname,query:m},void 0,{shallow:!0})}}},[D,t,k]);var ee=K(Z,p),es=ee.balance,er=ee.isPending,ea=K(Y,p),en=ea.balance,et=ea.isPending;(0,n.useEffect)(()=>{console.log("Balance states:",{fromBalance:es,toBalance:en,isPendingFromBalance:er,isPendingToBalance:et,fromToken:Z,toToken:Y,account:p})},[es,en,er,et,Z,Y,p]);var eo=(0,h.mN)({resolver:(0,x.u)(J(es||0n)),defaultValues:{fromTokenAmount:"",fromTokenAddress:Z.address,toTokenAddress:Y.address},mode:"onChange"});(0,n.useEffect)(()=>{console.log("Syncing form values:",{fromAddress:Z.address,toAddress:Y.address}),eo.setValue("fromTokenAddress",Z.address),eo.setValue("toTokenAddress",Y.address)},[Z.address,Y.address,eo]);var ei=(0,c._)((0,n.useState)(0n),2),ed=ei[0],el=ei[1],ec=(0,c._)((0,n.useState)(0n),2),eu=ec[0],em=ec[1],ef=eo.watch("fromTokenAmount");(0,n.useEffect)(()=>{try{var e=(0,C.XS)(ef||"0");el(e)}catch(e){el(0n)}},[ef]);var ep=()=>{var e=(0,C.Js)(es||0n);eo.setValue("fromTokenAmount",e)},ex=(0,n.useMemo)(()=>z(Z,Y),[Z,Y]),eg=(0,n.useMemo)(()=>"WETH9"===ex?[]:q(Z,Y),[Z,Y,ex]);(0,n.useEffect)(()=>{if(console.log("\uD83D\uDD0D Swap Path Debug:",{swapMethod:ex,fromToken:{symbol:Z.symbol,address:Z.address,isNative:Z.isNative},toToken:{symbol:Y.symbol,address:Y.address,isNative:Y.isNative},swapPath:eg,wethAddress:"0x015b1A506F2aa2B1ecC000aB799ED6C59005fBb3",routerAddress:"0x2A2Dc26469F9C8ccA09BbB5C1124bCaA758c014d"}),"UniswapV2_ETH_TO_TOKEN"===ex&&eg.length>=2){var e="0x015b1A506F2aa2B1ecC000aB799ED6C59005fBb3";eg[0]!==e&&(console.error("❌ 路径错误: path[0] 应该是 WETH 地址",{expected:e,actual:eg[0]}),f.oR.error("交换路径配置错误，请检查 WETH 地址配置"))}},[ex,Z,Y,eg]);var ev=O(ed,eg,"WETH9"!==ex&&ed>0n&&eg.length>=2),eh=ev.data,ey=ev.error;ev.isLoading,(0,n.useEffect)(()=>{if(ey){var e,s,r,a,n,t;console.error("\uD83D\uDEA8 getAmountsOut 详细错误:",{error:ey,errorMessage:ey.message,fromAmount:ed.toString(),swapPath:eg,swapMethod:ex,isPositionError:(null==(e=ey.message)?void 0:e.includes("Position"))&&(null==(s=ey.message)?void 0:s.includes("out of bounds"))}),(null==(r=ey.message)?void 0:r.includes("Position"))&&(null==(a=ey.message)?void 0:a.includes("out of bounds"))?(console.warn("⚠️ 检测到 position out of bounds 错误"),f.oR.error("价格查询失败，可能是流动性池问题或网络异常")):(null==(n=ey.message)?void 0:n.includes("INVALID_PATH"))?(console.error("❌ 无效路径错误"),f.oR.error("交换路径无效，请检查代币配置")):(null==(t=ey.message)?void 0:t.includes("INSUFFICIENT_LIQUIDITY"))&&(console.error("❌ 流动性不足错误"),f.oR.error("流动性不足，请尝试较小的交换金额"))}},[ey,ed,eg,ex]),(0,n.useEffect)(()=>{"WETH9"===ex?em(ed):eh&&eh.length>1?em(BigInt(eh[1])):em(0n)},[ex,ed,eh]);var eb=(0,n.useMemo)(()=>{if("WETH9"===ex)return{feePercentage:0,feeAmount:"0"};var e=.3*parseFloat(ef||"0")/100;return{feePercentage:.3,feeAmount:e<1e-4?e.toExponential(2):e.toFixed(6)}},[ex,ef]),eN=(0,n.useMemo)(()=>{if(ed>0n&&eu>0n)try{var e=(0,C.Js)(ed),s=(0,C.Js)(eu),r=parseFloat(e),a=parseFloat(s);if(r>0)return(0,C.lM)((a/r).toString(),2,4)}catch(e){console.warn("转换率计算出错:",e)}return"0"},[ed,eu]),eT=!Z.isNative&&"WETH9"!==ex,ew="WETH9"===ex?"0x015b1A506F2aa2B1ecC000aB799ED6C59005fBb3":"0x2A2Dc26469F9C8ccA09BbB5C1124bCaA758c014d",ej=(0,A.zH)(Z.address),e_=ej.approve,eC=ej.isWriting,eE=ej.isConfirming,eA=ej.isConfirmed,ek=ej.writeError,eF=(0,W.qX)(),eI=eF.deposit,eR=(eF.writeData,eF.isPending),eS=eF.error,eH=eF.isConfirming,eB=eF.isConfirmed,eO=(0,W.S1)(),eW=eO.withdraw,eD=(eO.writeData,eO.isPending),eP=eO.error,eL=eO.isConfirming,eM=eO.isConfirmed,eV=function(){var e,s=(0,F.x)(),r=s.writeContract,a=s.isPending,n=s.data,t=s.error,o=(e=(0,i._)(function(e,s,a,n,t){var o;return(0,u.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,r({address:B,abi:S,functionName:"swapExactTokensForTokens",args:[e,s,a,n,t]})];case 1:return i.sent(),[3,3];case 2:throw console.error("Swap failed:",o=i.sent()),o;case 3:return[2]}})}),function(s,r,a,n,t){return e.apply(this,arguments)}),d=(0,I.g)({hash:n});return{swap:o,writeData:n,isWriting:a,writeError:t,isConfirming:d.isLoading,isConfirmed:d.isSuccess}}(),eU=eV.swap,ez=eV.isWriting,eq=eV.isConfirming,eK=eV.isConfirmed,eJ=eV.writeError,eX=function(){var e,s=(0,F.x)(),r=s.writeContract,a=s.isPending,n=s.data,t=s.error,o=(e=(0,i._)(function(e,s,a,n,t){var o;return(0,u.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,r({address:B,abi:S,functionName:"swapExactETHForTokens",args:[e,s,a,n],value:t})];case 1:return i.sent(),[3,3];case 2:throw console.error("swapExactETHForTokens 兑换代币失败:",o=i.sent()),o;case 3:return[2]}})}),function(s,r,a,n,t){return e.apply(this,arguments)}),d=(0,I.g)({hash:n});return{swap:o,writeData:n,isWriting:a,writeError:t,isConfirming:d.isLoading,isConfirmed:d.isSuccess}}(),eZ=eX.swap,e$=eX.isWriting,eQ=eX.isConfirming,eY=eX.isConfirmed,eG=eX.writeError,e0=function(){var e,s=(0,R.s)(),r=s.sendTransaction,a=s.data,n=s.isPending,t=s.error,o=(e=(0,i._)(function(e,s,a,n,t){var o,i;return(0,u.__generator)(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),o=(0,H.p)({abi:S,functionName:"swapExactETHForTokens",args:[e,s,a,n]}),console.log("\uD83D\uDD27 直接发送交易，绕过 simulateContract:",{to:B,value:t.toString(),data:o,args:[e.toString(),s,a,n.toString()]}),[4,r({to:B,value:t,data:o})];case 1:return d.sent(),console.log("✅ 交易请求已发送"),[3,3];case 2:throw console.error("直接交易失败:",i=d.sent()),i;case 3:return[2]}})}),function(s,r,a,n,t){return e.apply(this,arguments)}),d=(0,I.g)({hash:a});return{swap:o,txHash:a,isWriting:n,writeError:t,isConfirming:d.isLoading,isConfirmed:d.isSuccess}}(),e2=e0.swap,e1=e0.isWriting,e5=e0.isConfirming,e6=e0.isConfirmed,e3=e0.writeError;e0.txHash;var e9=function(){var e,s=(0,F.x)(),r=s.writeContract,a=s.isPending,n=s.data,t=s.error,o=(e=(0,i._)(function(e,s,a,n,t){var o;return(0,u.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,r({address:B,abi:S,functionName:"swapExactTokensForETH",args:[e,s,a,n,t]})];case 1:return i.sent(),[3,3];case 2:throw console.error("代币兑换 swapExactTokensForETH 失败:",o=i.sent()),o;case 3:return[2]}})}),function(s,r,a,n,t){return e.apply(this,arguments)}),d=(0,I.g)({hash:n});return{swap:o,writeData:n,isWriting:a,writeError:t,isConfirming:d.isLoading,isConfirmed:d.isSuccess}}(),e4=e9.swap,e7=e9.isWriting,e8=e9.isConfirming,se=e9.isConfirmed,ss=e9.writeError,sr=eC||eE,sa=eA||!eT,sn=eR||eH||eD||eL||ez||eq||e$||eQ||e1||e5||e7||e8,st=eB||eM||eK||eY||e6||se,so=er||et;(0,n.useEffect)(()=>{console.log("Disabled states:",{isPendingFromBalance:er,isPendingToBalance:et,isApproved:sa,isConfirmedApprove:eA,needsApproval:eT,isDisabled:so})},[er,et,sa,eA,eT,so]);var si=eo.handleSubmit((0,i._)(function(){var e;return(0,u.__generator)(this,function(s){switch(s.label){case 0:if(!(0,_.C)(g))return[2];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,e_(ew,ed)];case 2:return s.sent(),[3,4];case 3:return console.error(e=s.sent()),f.oR.error((null==e?void 0:e.message)||"授权失败"),[3,4];case 4:return[2]}})})),sd=eo.handleSubmit((0,i._)(function(){var e,s,r,a,n,t,o,i,d,l,c,m;return(0,u.__generator)(this,function(u){switch(u.label){case 0:if(!(0,_.C)(g))return[2];u.label=1;case 1:u.trys.push([1,21,,22]),e="0x015b1A506F2aa2B1ecC000aB799ED6C59005fBb3",!1;if("UniswapV2_ETH_TO_TOKEN"===ex){if(2!==eg.length)return console.error("❌ Native to Token 路径长度错误:",eg),f.oR.error("交换路径配置错误"),[2];if(eg[0]!==e)return console.error("❌ 路径第一个地址不是 WETH:",{expected:e,actual:eg[0]}),f.oR.error("WETH 地址配置错误"),[2]}if(eu<=0n)return f.oR.error("无法获取兑换价格，请检查流动性池"),[2];switch(s=BigInt(Math.floor(Date.now()/1e3)+1200),r=995n*eu/1000n,console.log("\uD83D\uDE80 执行交换，参数详情:",{swapMethod:ex,fromAmount:ed.toString(),toAmount:eu.toString(),minAmountOut:r.toString(),swapPath:eg,deadline:s.toString(),account:p}),ex){case"WETH9":return[3,2];case"UniswapV2_ETH_TO_TOKEN":return[3,7];case"UniswapV2_TOKEN_TO_ETH":return[3,16];case"UniswapV2_TOKEN_TO_TOKEN":return[3,18]}return[3,20];case 2:if(!Z.isNative)return[3,4];return[4,eI(ed)];case 3:return u.sent(),[3,6];case 4:return[4,eW(ed)];case 5:u.sent(),u.label=6;case 6:return[3,20];case 7:console.log("\uD83D\uDCDE 调用 swapETHForTokens (直接交易模式):",{minAmountOut:r.toString(),path:eg,to:p,deadline:s.toString(),value:ed.toString()}),u.label=8;case 8:return u.trys.push([8,10,,15]),[4,e2(r,eg,p,s,ed)];case 9:return u.sent(),console.log("✅ 直接交易模式成功"),[3,15];case 10:console.warn("⚠️ 直接交易模式失败，尝试标准模式:",u.sent().message),u.label=11;case 11:return u.trys.push([11,13,,14]),[4,eZ(r,eg,p,s,ed)];case 12:return u.sent(),console.log("✅ 标准交易模式成功"),[3,14];case 13:if(a=u.sent(),console.error("❌ 所有交易模式都失败了"),(null==(n=a.message)?void 0:n.includes("Position"))&&(null==(t=a.message)?void 0:t.includes("out of bounds")))f.oR.error("检测到 viem 库的已知解析问题，但交易本身应该是有效的。请直接在钱包中确认交易。"),console.warn("\uD83D\uDCA1 建议: 这是前端库的问题，合约功能正常");else throw a;return[3,14];case 14:return[3,15];case 15:return[3,20];case 16:return[4,e4(ed,r,[Z.address,"0x015b1A506F2aa2B1ecC000aB799ED6C59005fBb3"],p,s)];case 17:case 19:return u.sent(),[3,20];case 18:return[4,eU(ed,r,[Z.address,Y.address],p,s)];case 20:return[3,22];case 21:return console.error("\uD83D\uDEA8 交换执行错误:",{error:o=u.sent(),errorMessage:o.message,errorCause:o.cause,errorDetails:o.details}),(null==(i=o.message)?void 0:i.includes("Position"))&&(null==(d=o.message)?void 0:d.includes("out of bounds"))?f.oR.error("交易数据解析失败，请稍后重试或联系技术支持"):(null==(l=o.message)?void 0:l.includes("INVALID_PATH"))?f.oR.error("交换路径无效，请检查代币配置"):(null==(c=o.message)?void 0:c.includes("INSUFFICIENT_OUTPUT_AMOUNT"))?f.oR.error("输出金额不足，请调整滑点设置或减少交换金额"):(null==(m=o.message)?void 0:m.includes("INSUFFICIENT_LIQUIDITY"))?f.oR.error("流动性不足，请尝试较小的交换金额"):f.oR.error((null==o?void 0:o.message)||"兑换失败"),[3,22];case 22:return[2]}})}));(0,n.useEffect)(()=>{st&&(f.oR.success("兑换成功"),setTimeout(()=>{var e=new URL(window.location.href);e.searchParams.set("from",Z.symbol),e.searchParams.set("to",Y.symbol),window.location.href=e.toString()},2e3))},[st,Z.symbol,Y.symbol]);var sl=(0,E.g)().handleContractError;if((0,n.useEffect)(()=>{[ek,eS,eP,eJ,eG,e3,ss,ey].forEach(e=>{e&&sl(e,"swap")})},[ek,eS,eP,eJ,eG,e3,ss,ey]),!k)return(0,a.jsx)(M.A,{});if(0===D.length)return(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)(L.A,{title:"兑换"}),(0,a.jsx)("div",{className:"text-center text-greyscale-500 mt-4",children:"正在加载代币信息..."})]});var sc=sr||sn;return(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)(L.A,{title:"兑换代币"}),(0,a.jsxs)("div",{className:"w-full max-w-md mt-4",children:[(0,a.jsx)(j.lV,(0,l._)((0,d._)({},eo),{children:(0,a.jsxs)("form",{children:[(0,a.jsx)("div",{className:"mb-2",children:(0,a.jsx)(j.zB,{control:eo.control,name:"fromTokenAmount",render:e=>{var s=e.field;return(0,a.jsxs)(j.eI,{children:[(0,a.jsx)(T.Zp,{className:"bg-[#f7f8f9] border-none",children:(0,a.jsxs)(T.Wu,{className:"py-4 px-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)(N.p,(0,l._)((0,d._)({type:"number",placeholder:"0"},s),{disabled:so,className:"text-xl border-none p-0 h-auto bg-transparent focus:ring-0 focus:outline-none mr-2"})),(0,a.jsx)(j.zB,{control:eo.control,name:"fromTokenAddress",render:e=>{var s=e.field;return(0,a.jsx)(j.eI,{children:(0,a.jsx)(j.MJ,{children:(0,a.jsxs)(w.l6,{value:s.value,onValueChange:e=>{var r=D.find(s=>s.address===e);r&&(r.address===Y.address?($(r),G(Z),s.onChange(r.address),eo.setValue("toTokenAddress",Z.address),eo.setValue("fromTokenAmount","")):(s.onChange(e),$(r)))},disabled:so,children:[(0,a.jsx)(w.bq,{className:"w-auto border-none bg-white hover:bg-gray-50 px-3 py-1.5 rounded-full transition-colors border border-gray-200",children:(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("span",{className:"font-medium text-gray-800",children:Z.symbol})})}),(0,a.jsx)(w.gC,{children:D.map(e=>(0,a.jsx)(w.eb,{value:e.address,children:(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("span",{children:e.symbol})})},e.address))})]})})})}})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex gap-1",children:[[25,50,75].map(e=>(0,a.jsxs)(b.$,{variant:"outline",size:"sm",type:"button",onClick:()=>{var s=(null!=es?es:0n)*BigInt(e)/100n;eo.setValue("fromTokenAmount",(0,C.Js)(s))},disabled:so||0n>=(es||0n),className:"text-xs h-7 px-2 rounded-lg",children:[e,"%"]},e)),(0,a.jsx)(b.$,{variant:"outline",size:"sm",type:"button",onClick:ep,disabled:so||0n>=(es||0n),className:"text-xs h-7 px-2 rounded-lg",children:"最高"})]}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[(0,C.NJ)(es||0n)," ",Z.symbol]})]})]})}),(0,a.jsx)(j.C5,{})]})}})}),(0,a.jsx)("div",{className:"flex justify-center mb-1",children:(0,a.jsx)("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(b.$,{variant:"ghost",type:"button",size:"icon",className:"rounded-full hover:bg-gray-100",onClick:()=>{var e=(0,d._)({},Z),s=(0,d._)({},Y);$(s),G(e),eo.setValue("fromTokenAmount",""),console.log("Swapped tokens:",{newFrom:s.symbol,newTo:e.symbol})},disabled:so,children:(0,a.jsx)(y,{className:"w-5 h-5 text-gray-600"})})})}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(T.Zp,{className:"bg-[#f7f8f9] border-none",children:(0,a.jsxs)(T.Wu,{className:"py-4 px-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)(N.p,{type:"number",placeholder:"0",value:(0,C.Js)(eu),disabled:!0,readOnly:!0,className:"text-xl border-none p-0 h-auto bg-transparent focus:ring-0 focus:outline-none mr-2"}),(0,a.jsx)(j.zB,{control:eo.control,name:"toTokenAddress",render:e=>{var s=e.field;return(0,a.jsx)(j.eI,{children:(0,a.jsx)(j.MJ,{children:(0,a.jsxs)(w.l6,{value:s.value,onValueChange:e=>{var r=D.find(s=>s.address===e);r&&(r.address===Z.address?($(Y),G(r),s.onChange(r.address),eo.setValue("fromTokenAddress",Y.address),eo.setValue("fromTokenAmount","")):(s.onChange(e),G(r)))},disabled:so,children:[(0,a.jsx)(w.bq,{className:"w-auto border-none bg-white hover:bg-gray-50 px-3 py-1.5 rounded-full transition-colors border border-gray-200",children:(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("span",{className:"font-medium text-gray-800",children:Y.symbol})})}),(0,a.jsx)(w.gC,{children:D.map(e=>(0,a.jsx)(w.eb,{value:e.address,children:(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("span",{children:e.symbol})})},e.address))})]})})})}})]}),(0,a.jsx)("div",{className:"flex items-center justify-end",children:(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[(0,C.NJ)(en||0n)," ",Y.symbol]})})]})})}),(0,a.jsxs)("div",{className:"flex flex-row gap-2",children:[eT&&(0,a.jsx)(b.$,{className:"w-1/2",onClick:si,disabled:sr||sa,children:eC?"1.授权中...":eE?"1.确认中...":sa?"1.已授权":"1.授权"}),(0,a.jsx)(b.$,{className:eT?"w-1/2":"w-full",onClick:sd,disabled:!sa||sr||sn||st,children:sn?eT?"2.兑换中...":"兑换中...":st?eT?"2.已兑换":"已兑换":eT?"2.兑换":"兑换"})]})]})})),ed>0n&&(0,a.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-md",children:["WETH9"===ex&&(0,a.jsx)("div",{className:"text-sm text-green-600 mb-2",children:"\uD83D\uDCA1 这是 1:1 包装转换，无手续费，无滑点"}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-greyscale-400",children:"兑换率: "}),(0,a.jsxs)("span",{children:["1 ",Z.symbol," = ",eN," ",Y.symbol]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsxs)("span",{className:"text-greyscale-400",children:["手续费 (",eb.feePercentage,"%)："]}),(0,a.jsxs)("span",{children:[eb.feeAmount," ",Z.symbol]})]}),"WETH9"!==ex&&(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-greyscale-400",children:"滑点上限 (自动)："}),(0,a.jsx)("span",{children:"0.5%"})]})]})]}),(0,a.jsx)(V.A,{isLoading:sc,text:sr?"授权中...":"交换中..."})]})};function Z(){var e=((0,n.useContext)(D.N)||{}).token;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.A,{title:"兑换代币"}),(0,a.jsxs)("main",{className:"flex-grow",children:[(0,a.jsx)(X,{showCurrentToken:!!e&&!!e.hasEnded}),(0,a.jsxs)("div",{className:"bg-blue-50/30 border-l-4 border-l-blue-50 rounded-r-lg p-4 mb-8 text-sm mt-0 m-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-base font-bold text-blue-800 pb-2",children:[(0,a.jsx)(t.A,{className:"w-4 h-4"}),"提示"]}),(0,a.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"交易协议："}),(0,a.jsx)("div",{className:"text-sm text-blue-700",children:"本交易功能基于 Uniswap V2 协议实现，合约代码为官方最新版本"}),(0,a.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"费用说明："}),(0,a.jsx)("div",{className:"text-sm text-blue-700",children:"手续费为 0.3%，滑点上限为 0.5%"})]})]})]})}},47078:(e,s,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dex/swap",function(){return r(44356)}])},77351:(e,s,r)=>{"use strict";r.d(s,{s:()=>l});var a=r(79909),n=r(81035),t=r(629),o=r(90203);async function i(e,s){let r,{account:a,chainId:i,connector:d,...l}=s;r="object"==typeof a&&a?.type==="local"?e.getClient({chainId:i}):await (0,o.r)(e,{account:a??void 0,chainId:i,connector:d});let c=(0,t.T)(r,n.v,"sendTransaction");return await c({...l,...a?{account:a}:{},chain:i?{id:i}:null,gas:l.gas??void 0})}var d=r(43387);function l(e={}){var s;let{mutation:r}=e,n=(s=(0,d.U)(e),{mutationFn:e=>i(s,e),mutationKey:["sendTransaction"]}),{mutate:t,mutateAsync:o,...c}=(0,a.n)({...r,...n});return{...c,sendTransaction:t,sendTransactionAsync:o}}},78256:(e,s,r)=>{"use strict";r.d(s,{bq:()=>x,eb:()=>y,gC:()=>h,l6:()=>f,yv:()=>p});var a=r(3576),n=r(62701),t=r(65699),o=r(37876),i=r(14232),d=r(760),l=r(30822),c=r(21575),u=r(33276),m=r(30684),f=d.bL;d.YJ;var p=d.WT,x=i.forwardRef((e,s)=>{var r=e.className,i=e.children,c=(0,t._)(e,["className","children"]);return(0,o.jsxs)(d.l9,(0,n._)((0,a._)({ref:s,className:(0,m.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r)},c),{children:[i,(0,o.jsx)(d.In,{asChild:!0,children:(0,o.jsx)(l.A,{className:"h-4 w-4 opacity-50"})})]}))});x.displayName=d.l9.displayName;var g=i.forwardRef((e,s)=>{var r=e.className,i=(0,t._)(e,["className"]);return(0,o.jsx)(d.PP,(0,n._)((0,a._)({ref:s,className:(0,m.cn)("flex cursor-default items-center justify-center py-1",r)},i),{children:(0,o.jsx)(c.A,{className:"h-4 w-4"})}))});g.displayName=d.PP.displayName;var v=i.forwardRef((e,s)=>{var r=e.className,i=(0,t._)(e,["className"]);return(0,o.jsx)(d.wn,(0,n._)((0,a._)({ref:s,className:(0,m.cn)("flex cursor-default items-center justify-center py-1",r)},i),{children:(0,o.jsx)(l.A,{className:"h-4 w-4"})}))});v.displayName=d.wn.displayName;var h=i.forwardRef((e,s)=>{var r=e.className,i=e.children,l=e.position,c=void 0===l?"popper":l,u=(0,t._)(e,["className","children","position"]);return(0,o.jsx)(d.ZL,{children:(0,o.jsxs)(d.UC,(0,n._)((0,a._)({ref:s,className:(0,m.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===c&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:c},u),{children:[(0,o.jsx)(g,{}),(0,o.jsx)(d.LM,{className:(0,m.cn)("p-1","popper"===c&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i}),(0,o.jsx)(v,{})]}))})});h.displayName=d.UC.displayName,i.forwardRef((e,s)=>{var r=e.className,n=(0,t._)(e,["className"]);return(0,o.jsx)(d.JU,(0,a._)({ref:s,className:(0,m.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",r)},n))}).displayName=d.JU.displayName;var y=i.forwardRef((e,s)=>{var r=e.className,i=e.children,l=(0,t._)(e,["className","children"]);return(0,o.jsxs)(d.q7,(0,n._)((0,a._)({ref:s,className:(0,m.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r)},l),{children:[(0,o.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,o.jsx)(d.VF,{children:(0,o.jsx)(u.A,{className:"h-4 w-4"})})}),(0,o.jsx)(d.p4,{children:i})]}))});y.displayName=d.q7.displayName,i.forwardRef((e,s)=>{var r=e.className,n=(0,t._)(e,["className"]);return(0,o.jsx)(d.wv,(0,a._)({ref:s,className:(0,m.cn)("-mx-1 my-1 h-px bg-muted",r)},n))}).displayName=d.wv.displayName},92659:(e,s,r)=>{"use strict";r.d(s,{lV:()=>g,MJ:()=>w,Rr:()=>j,zB:()=>h,eI:()=>N,lR:()=>T,C5:()=>_});var a=r(81110),n=r(40120),t=r(3576),o=r(62701),i=r(65699),d=r(37876),l=r(14232),c=r(39358),u=r(88992),m=r(30684),f=r(49794),p=(0,r(47137).F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),x=l.forwardRef((e,s)=>{var r=e.className,a=(0,i._)(e,["className"]);return(0,d.jsx)(f.b,(0,t._)({ref:s,className:(0,m.cn)(p(),r)},a))});x.displayName=f.b.displayName;var g=u.Op,v=l.createContext({}),h=e=>{var s=(0,a._)({},(0,n._)(e));return(0,d.jsx)(v.Provider,{value:{name:s.name},children:(0,d.jsx)(u.xI,(0,t._)({},s))})},y=()=>{var e=l.useContext(v),s=l.useContext(b),r=(0,u.xW)(),a=r.getFieldState,n=r.formState,o=a(e.name,n);if(!e)throw Error("useFormField should be used within <FormField>");var i=s.id;return(0,t._)({id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message")},o)},b=l.createContext({}),N=l.forwardRef((e,s)=>{var r=e.className,a=(0,i._)(e,["className"]),n=l.useId();return(0,d.jsx)(b.Provider,{value:{id:n},children:(0,d.jsx)("div",(0,t._)({ref:s,className:(0,m.cn)("space-y-2",r)},a))})});N.displayName="FormItem";var T=l.forwardRef((e,s)=>{var r=e.className,a=(0,i._)(e,["className"]),n=y(),o=n.error,l=n.formItemId;return(0,d.jsx)(x,(0,t._)({ref:s,className:(0,m.cn)(o&&"text-destructive",r),htmlFor:l},a))});T.displayName="FormLabel";var w=l.forwardRef((e,s)=>{var r=(0,a._)({},(0,n._)(e)),o=y(),i=o.error,l=o.formItemId,u=o.formDescriptionId,m=o.formMessageId;return(0,d.jsx)(c.DX,(0,t._)({ref:s,id:l,"aria-describedby":i?"".concat(u," ").concat(m):"".concat(u),"aria-invalid":!!i},r))});w.displayName="FormControl";var j=l.forwardRef((e,s)=>{var r=e.className,a=(0,i._)(e,["className"]),n=y().formDescriptionId;return(0,d.jsx)("p",(0,t._)({ref:s,id:n,className:(0,m.cn)("text-sm text-muted-foreground",r)},a))});j.displayName="FormDescription";var _=l.forwardRef((e,s)=>{var r=e.className,a=e.children,n=(0,i._)(e,["className","children"]),l=y(),c=l.error,u=l.formMessageId,f=c?String(null==c?void 0:c.message):a;return f?(0,d.jsx)("p",(0,o._)((0,t._)({ref:s,id:u,className:(0,m.cn)("text-sm font-medium text-destructive",r)},n),{children:f})):null});_.displayName="FormMessage"},99574:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});var a=r(37876);r(14232);var n=r(7446);let t=e=>{var s=e.isLoading,r=e.text;return s?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(n.A,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,a.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:void 0===r?"Loading":r})]})}):null}}},e=>{var s=s=>e(e.s=s);e.O(0,[6869,3921,2569,5139,3634,636,6593,8792],()=>s(47078)),_N_E=e.O()}]);