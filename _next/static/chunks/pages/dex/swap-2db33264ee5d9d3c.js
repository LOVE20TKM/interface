(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8026],{17137:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dex/swap",function(){return n(61322)}])},34680:function(e,t,n){"use strict";n.d(t,{Ol:function(){return o},SZ:function(){return d},Zb:function(){return i},aY:function(){return u},eW:function(){return c},ll:function(){return l}});var s=n(85893),a=n(67294),r=n(40108);let i=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",n),...a})});i.displayName="Card";let o=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",n),...a})});o.displayName="CardHeader";let l=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",n),...a})});l.displayName="CardTitle";let d=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",n),...a})});d.displayName="CardDescription";let u=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("p-6 pt-0",n),...a})});u.displayName="CardContent";let c=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("flex items-center p-6 pt-0",n),...a})});c.displayName="CardFooter"},76929:function(e,t,n){"use strict";n.d(t,{l0:function(){return c},NI:function(){return g},pf:function(){return h},Wi:function(){return f},xJ:function(){return x},lX:function(){return b},zG:function(){return T}});var s=n(85893),a=n(67294),r=n(4222),i=n(87536),o=n(40108),l=n(41850);let d=(0,n(12003).j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),u=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)(l.f,{ref:t,className:(0,o.cn)(d(),n),...a})});u.displayName=l.f.displayName;let c=i.RV,m=a.createContext({}),f=e=>{let{...t}=e;return(0,s.jsx)(m.Provider,{value:{name:t.name},children:(0,s.jsx)(i.Qr,{...t})})},p=()=>{let e=a.useContext(m),t=a.useContext(y),{getFieldState:n,formState:s}=(0,i.Gc)(),r=n(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");let{id:o}=t;return{id:o,name:e.name,formItemId:"".concat(o,"-form-item"),formDescriptionId:"".concat(o,"-form-item-description"),formMessageId:"".concat(o,"-form-item-message"),...r}},y=a.createContext({}),x=a.forwardRef((e,t)=>{let{className:n,...r}=e,i=a.useId();return(0,s.jsx)(y.Provider,{value:{id:i},children:(0,s.jsx)("div",{ref:t,className:(0,o.cn)("space-y-2",n),...r})})});x.displayName="FormItem";let b=a.forwardRef((e,t)=>{let{className:n,...a}=e,{error:r,formItemId:i}=p();return(0,s.jsx)(u,{ref:t,className:(0,o.cn)(r&&"text-destructive",n),htmlFor:i,...a})});b.displayName="FormLabel";let g=a.forwardRef((e,t)=>{let{...n}=e,{error:a,formItemId:i,formDescriptionId:o,formMessageId:l}=p();return(0,s.jsx)(r.g7,{ref:t,id:i,"aria-describedby":a?"".concat(o," ").concat(l):"".concat(o),"aria-invalid":!!a,...n})});g.displayName="FormControl";let h=a.forwardRef((e,t)=>{let{className:n,...a}=e,{formDescriptionId:r}=p();return(0,s.jsx)("p",{ref:t,id:r,className:(0,o.cn)("text-sm text-muted-foreground",n),...a})});h.displayName="FormDescription";let T=a.forwardRef((e,t)=>{let{className:n,children:a,...r}=e,{error:i,formMessageId:l}=p(),d=i?String(null==i?void 0:i.message):a;return d?(0,s.jsx)("p",{ref:t,id:l,className:(0,o.cn)("text-sm font-medium text-destructive",n),...r,children:d}):null});T.displayName="FormMessage"},88659:function(e,t,n){"use strict";n.d(t,{Bw:function(){return y},Ph:function(){return u},Ql:function(){return x},i4:function(){return m},ki:function(){return c}});var s=n(85893),a=n(67294),r=n(86443),i=n(42171),o=n(15432),l=n(78865),d=n(40108);let u=r.fC;r.ZA;let c=r.B4,m=a.forwardRef((e,t)=>{let{className:n,children:a,...o}=e;return(0,s.jsxs)(r.xz,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",n),...o,children:[a,(0,s.jsx)(r.JO,{asChild:!0,children:(0,s.jsx)(i.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=r.xz.displayName;let f=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)(r.u_,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",n),...a,children:(0,s.jsx)(o.Z,{className:"h-4 w-4"})})});f.displayName=r.u_.displayName;let p=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)(r.$G,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",n),...a,children:(0,s.jsx)(i.Z,{className:"h-4 w-4"})})});p.displayName=r.$G.displayName;let y=a.forwardRef((e,t)=>{let{className:n,children:a,position:i="popper",...o}=e;return(0,s.jsx)(r.h_,{children:(0,s.jsxs)(r.VY,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",n),position:i,...o,children:[(0,s.jsx)(f,{}),(0,s.jsx)(r.l_,{className:(0,d.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,s.jsx)(p,{})]})})});y.displayName=r.VY.displayName,a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)(r.__,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",n),...a})}).displayName=r.__.displayName;let x=a.forwardRef((e,t)=>{let{className:n,children:a,...i}=e;return(0,s.jsxs)(r.ck,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...i,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(r.wU,{children:(0,s.jsx)(l.Z,{className:"h-4 w-4"})})}),(0,s.jsx)(r.eT,{children:a})]})});x.displayName=r.ck.displayName,a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)(r.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",n),...a})}).displayName=r.Z0.displayName},42083:function(e,t,n){"use strict";var s=n(85893),a=n(23432);t.Z=()=>(0,s.jsx)(a.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})},44576:function(e,t,n){"use strict";var s=n(85893);n(67294);var a=n(23432);t.Z=e=>{let{isLoading:t,text:n="Loading"}=e;return t?(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(a.Z,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,s.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:n})]})}):null}},33838:function(e,t,n){"use strict";n.d(t,{hS:function(){return l},Qo:function(){return d},Qc:function(){return u}});var s=n(89810),a=n(71366),r=n(83540);let i=[{type:"fallback",stateMutability:"payable"},{type:"function",name:"allowance",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"address",internalType:"address"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"approve",inputs:[{name:"guy",type:"address",internalType:"address"},{name:"wad",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"nonpayable"},{type:"function",name:"balanceOf",inputs:[{name:"",type:"address",internalType:"address"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"decimals",inputs:[],outputs:[{name:"",type:"uint8",internalType:"uint8"}],stateMutability:"view"},{type:"function",name:"deposit",inputs:[],outputs:[],stateMutability:"payable"},{type:"function",name:"name",inputs:[],outputs:[{name:"",type:"string",internalType:"string"}],stateMutability:"view"},{type:"function",name:"symbol",inputs:[],outputs:[{name:"",type:"string",internalType:"string"}],stateMutability:"view"},{type:"function",name:"totalSupply",inputs:[],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"transfer",inputs:[{name:"dst",type:"address",internalType:"address"},{name:"wad",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"nonpayable"},{type:"function",name:"transferFrom",inputs:[{name:"src",type:"address",internalType:"address"},{name:"dst",type:"address",internalType:"address"},{name:"wad",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"nonpayable"},{type:"function",name:"withdraw",inputs:[{name:"wad",type:"uint256",internalType:"uint256"}],outputs:[],stateMutability:"nonpayable"},{type:"event",name:"Approval",inputs:[{name:"src",type:"address",indexed:!0,internalType:"address"},{name:"guy",type:"address",indexed:!0,internalType:"address"},{name:"wad",type:"uint256",indexed:!1,internalType:"uint256"}],anonymous:!1},{type:"event",name:"Deposit",inputs:[{name:"dst",type:"address",indexed:!0,internalType:"address"},{name:"wad",type:"uint256",indexed:!1,internalType:"uint256"}],anonymous:!1},{type:"event",name:"Transfer",inputs:[{name:"src",type:"address",indexed:!0,internalType:"address"},{name:"dst",type:"address",indexed:!0,internalType:"address"},{name:"wad",type:"uint256",indexed:!1,internalType:"uint256"}],anonymous:!1},{type:"event",name:"Withdrawal",inputs:[{name:"src",type:"address",indexed:!0,internalType:"address"},{name:"wad",type:"uint256",indexed:!1,internalType:"uint256"}],anonymous:!1}],o="0x015b1A506F2aa2B1ecC000aB799ED6C59005fBb3",l=(e,t)=>{let{data:n,isPending:a,error:r}=(0,s.u)({address:e,abi:i,functionName:"balanceOf",args:[t],query:{enabled:!!e&&!!t}});return{balance:n,isPending:a,error:r}},d=()=>{let{writeContract:e,data:t,isPending:n,error:s}=(0,a.S)(),l=async t=>{try{await e({address:o,abi:i,functionName:"deposit",args:[],value:t})}catch(e){console.error("Deposit failed:",e)}},{isLoading:d,isSuccess:u}=(0,r.A)({hash:t});return{deposit:l,writeData:t,isPending:n,error:s,isConfirming:d,isConfirmed:u}},u=()=>{let{writeContract:e,data:t,isPending:n,error:s}=(0,a.S)(),l=async t=>{try{await e({address:o,abi:i,functionName:"withdraw",args:[t]})}catch(e){console.error("Withdraw failed:",e)}},{isLoading:d,isSuccess:u}=(0,r.A)({hash:t});return{withdraw:l,writeData:t,isPending:n,error:s,isConfirming:d,isConfirmed:u}}},91529:function(e,t,n){"use strict";n.d(t,{LH:function(){return i},Vu:function(){return r},bM:function(){return l},cK:function(){return u},eb:function(){return c},kP:function(){return d},vz:function(){return o}});var s=n(21803),a=n(15229);let r=e=>e?"".concat(e.substring(0,6),"...").concat(e.substring(e.length-4)):"",i=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t=Number(l(e));if(e<10n)return"0";if(t>=1e5)return new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(t);if(t>=1e3)return new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(t);if(t>=1)return new Intl.NumberFormat("en-US",{maximumFractionDigits:4}).format(t);{if(t>=.001)return new Intl.NumberFormat("en-US",{maximumFractionDigits:4}).format(t);if(0===t)return"0";let e=t.toFixed(14),n=e.split(".");if(n.length<2)return e;let s=n[1],a=0;for(let e of s)if("0"===e)a++;else break;let r=s.slice(a,a+4);return"0.0{".concat(a,"}").concat(r)}},o=e=>{let t=parseInt("18",10);try{let n=e.replace(/,/g,"");return(0,s.v)(n,t)}catch(e){return console.error("parseUnits error:",e),0n}},l=e=>{let t=parseInt("18",10);return(0,a.b)(e,t)},d=e=>e.includes(".")?parseFloat(e.replace(/,/g,"")).toString():e,u=(e,t)=>e&&t?e-BigInt(t.initialStakeRound)+1n:0n,c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,s=Number(e);if(s>=1)return new Intl.NumberFormat("en-US",{maximumFractionDigits:t}).format(s);if(s>=.001)return new Intl.NumberFormat("en-US",{maximumFractionDigits:n+1}).format(s);{if(0===s)return"0";let e=s.toFixed(n+10),t=e.split(".");if(t.length<2)return e;let a=t[1],r=0;for(let e of a)if("0"===e)r++;else break;let i=a.slice(r);return"0.0{".concat(r,"}").concat(i)}}},48105:function(e,t,n){"use strict";n.d(t,{S:function(){return a}});var s=n(86501);let a=e=>!!e||(s.Am.error("请先将钱包链接 ".concat("thinkium801")),!1)},61322:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return z}});var s=n(85893),a=n(67294),r=n(67997),i=n(37436),o=n(11163),l=n(86501),d=n(1604),u=n(56312),c=n(53438),m=n(92321),f=n(87536);let p=(0,n(31134).Z)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);var y=n(27245),x=n(21774),b=n(34680),g=n(88659),h=n(76929),T=n(48105),v=n(91529),w=n(67068),N=n(19638),j=n(89810),E=n(71366),A=n(83540),C=n(22017);let k=[{type:"function",name:"swapExactTokensForTokens",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"amountOutMin",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"},{name:"to",type:"address",internalType:"address"},{name:"deadline",type:"uint256",internalType:"uint256"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"nonpayable"},{type:"function",name:"swapExactETHForTokens",inputs:[{name:"amountOutMin",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"},{name:"to",type:"address",internalType:"address"},{name:"deadline",type:"uint256",internalType:"uint256"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"payable"},{type:"function",name:"swapExactTokensForETH",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"amountOutMin",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"},{name:"to",type:"address",internalType:"address"},{name:"deadline",type:"uint256",internalType:"uint256"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"nonpayable"},{type:"function",name:"getAmountsOut",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"},{type:"function",name:"getAmountsIn",inputs:[{name:"amountOut",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"}];var D=n(55629);let F="0x2A2Dc26469F9C8ccA09BbB5C1124bCaA758c014d",S=function(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:s,error:a,isLoading:r}=(0,j.u)({address:F,abi:k,functionName:"getAmountsOut",args:[e,t],query:{enabled:!!e&&t.length>=2&&n}});return{data:s,error:a,isLoading:r}};var _=n(33838),I=n(93778),H=()=>{let e=(0,a.useContext)(I.M);if(void 0===e)throw Error("useTokenContext must be used within a TokenProvider");return e},B=n(64777),M=n(42083),O=n(44576);let W=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=[];n.push({symbol:"TKM",address:"NATIVE",decimals:18,isNative:!0});let s="TestTKM20",a="0x015b1A506F2aa2B1ecC000aB799ED6C59005fBb3";return s&&a&&n.push({symbol:s,address:a,decimals:18,isNative:!1,isWETH:!0}),e&&(t&&e.symbol&&e.address&&!n.find(t=>t.address===e.address)&&n.push({symbol:e.symbol,address:e.address,decimals:18,isNative:!1}),e.parentTokenSymbol&&e.parentTokenAddress&&!n.find(t=>t.address===e.parentTokenAddress)&&n.push({symbol:e.parentTokenSymbol,address:e.parentTokenAddress,decimals:18,isNative:!1,isWETH:"0x015b1A506F2aa2B1ecC000aB799ED6C59005fBb3"===e.parentTokenAddress})),console.log("buildSupportedTokens result:",n),n},P=(e,t)=>e.isNative&&t.isWETH||e.isWETH&&t.isNative?"WETH9":!e.isNative||t.isNative||t.isWETH?e.isNative||e.isWETH||!t.isNative?"UniswapV2_TOKEN_TO_TOKEN":"UniswapV2_TOKEN_TO_ETH":"UniswapV2_ETH_TO_TOKEN",V=(e,t)=>{let n="0x015b1A506F2aa2B1ecC000aB799ED6C59005fBb3";return e.isNative?[n,t.address]:t.isNative?[e.address,n]:[e.address,t.address]},L=(e,t)=>{let{data:n,isLoading:s}=(0,c.K)({address:t,query:{enabled:!!t&&e.isNative}}),{balance:a,isPending:r}=(0,N.hS)(e.isNative?"0x0000000000000000000000000000000000000000":e.address,t);return{balance:e.isNative?null==n?void 0:n.value:a,isPending:e.isNative?s:r}},U=e=>d.z.object({fromTokenAmount:d.z.string().nonempty("请输入兑换数量").refine(t=>{if(t.endsWith(".")||"0"===t)return!0;try{let n=(0,v.vz)(t);return n>0n&&n<=e}catch(e){return!1}},{message:"输入数量必须大于0且不超过您的可用余额"}),fromTokenAddress:d.z.string(),toTokenAddress:d.z.string()});var R=e=>{let{showCurrentToken:t=!0}=e,n=(0,o.useRouter)(),{address:r,chain:i}=(0,m.m)(),{token:d}=H(),c=(0,a.useMemo)(()=>W(d,t),[d,t]),[j,I]=(0,a.useState)({symbol:"TKM",address:"NATIVE",decimals:18,isNative:!0}),[R,z]=(0,a.useState)({symbol:"TestLOVE20",address:"0x034D08a8102cE7CdEa5Dcc7b3109de24f261b3e6",decimals:18,isNative:!1,isWETH:!1});(0,a.useEffect)(()=>{if(console.log("supportedTokens updated:",c),console.log("router.query:",n.query),console.log("token context:",d),!d){console.log("Token not loaded yet, skipping initialization");return}if(c.length>0){let e,t;let{from:s,to:a}=n.query;console.log("Available token symbols:",c.map(e=>e.symbol));let r=!1;s&&"string"==typeof s&&(console.log("Looking for fromSymbol:",s),console.log("Found fromToken:",e=c.find(e=>e.symbol&&e.symbol.toLowerCase()===s.toLowerCase())),e||(l.Am.error("找不到代币 ".concat(s)),r=!0)),a&&"string"==typeof a&&(console.log("Looking for toSymbol:",a),console.log("Found toToken:",t=c.find(e=>e.symbol&&e.symbol.toLowerCase()===a.toLowerCase())),t||(l.Am.error("找不到代币 ".concat(a)),r=!0)),e&&t&&e.address===t.address&&(l.Am.error("不能选择相同的代币进行兑换"),r=!0,e=void 0,t=void 0),e?(console.log("Setting fromToken from URL:",e),I(e)):c[0]&&(console.log("Setting fromToken as default:",c[0]),I(c[0]));let i=e||c[0];if(t&&t.address!==(null==i?void 0:i.address))console.log("Setting toToken from URL:",t),z(t);else{let e;let t="TestLOVE20";if(t&&(e=c.find(e=>e.symbol===t&&e.address!==(null==i?void 0:i.address))),!e){for(let t=1;t<c.length;t++)if(c[t].address!==(null==i?void 0:i.address)){e=c[t];break}}!e&&c.length>1&&(c[1].address!==(null==i?void 0:i.address)?e=c[1]:c[0].address!==(null==i?void 0:i.address)&&(e=c[0])),e&&(console.log("Setting toToken as default:",e),z(e))}if(r){l.Am.error("已切换为默认代币对儿");let e={...n.query};delete e.from,delete e.to,n.replace({pathname:n.pathname,query:e},void 0,{shallow:!0})}}},[c,n,d]);let{balance:Z,isPending:K}=L(j,r),{balance:Q,isPending:q}=L(R,r);(0,a.useEffect)(()=>{console.log("Balance states:",{fromBalance:Z,toBalance:Q,isPendingFromBalance:K,isPendingToBalance:q,fromToken:j,toToken:R,account:r})},[Z,Q,K,q,j,R,r]);let Y=(0,f.cI)({resolver:(0,u.F)(U(Z||0n)),defaultValues:{fromTokenAmount:"",fromTokenAddress:j.address,toTokenAddress:R.address},mode:"onChange"});(0,a.useEffect)(()=>{console.log("Syncing form values:",{fromAddress:j.address,toAddress:R.address}),Y.setValue("fromTokenAddress",j.address),Y.setValue("toTokenAddress",R.address)},[j.address,R.address,Y]);let[G,J]=(0,a.useState)(0n),[X,$]=(0,a.useState)(0n),ee=Y.watch("fromTokenAmount");(0,a.useEffect)(()=>{try{let e=(0,v.vz)(ee||"0");J(e)}catch(e){J(0n)}},[ee]);let et=()=>{let e=(0,v.bM)(Z||0n);Y.setValue("fromTokenAmount",e)},en=(0,a.useMemo)(()=>P(j,R),[j,R]),es=(0,a.useMemo)(()=>"WETH9"===en?[]:V(j,R),[j,R,en]);(0,a.useEffect)(()=>{if(console.log("\uD83D\uDD0D Swap Path Debug:",{swapMethod:en,fromToken:{symbol:j.symbol,address:j.address,isNative:j.isNative},toToken:{symbol:R.symbol,address:R.address,isNative:R.isNative},swapPath:es,wethAddress:"0x015b1A506F2aa2B1ecC000aB799ED6C59005fBb3",routerAddress:"0x2A2Dc26469F9C8ccA09BbB5C1124bCaA758c014d"}),"UniswapV2_ETH_TO_TOKEN"===en&&es.length>=2){let e="0x015b1A506F2aa2B1ecC000aB799ED6C59005fBb3";es[0]!==e&&(console.error("❌ 路径错误: path[0] 应该是 WETH 地址",{expected:e,actual:es[0]}),l.Am.error("交换路径配置错误，请检查 WETH 地址配置"))}},[en,j,R,es]);let{data:ea,error:er,isLoading:ei}=S(G,es,"WETH9"!==en&&G>0n&&es.length>=2);(0,a.useEffect)(()=>{if(er){var e,t,n,s,a,r;console.error("\uD83D\uDEA8 getAmountsOut 详细错误:",{error:er,errorMessage:er.message,fromAmount:G.toString(),swapPath:es,swapMethod:en,isPositionError:(null===(e=er.message)||void 0===e?void 0:e.includes("Position"))&&(null===(t=er.message)||void 0===t?void 0:t.includes("out of bounds"))}),(null===(n=er.message)||void 0===n?void 0:n.includes("Position"))&&(null===(s=er.message)||void 0===s?void 0:s.includes("out of bounds"))?(console.warn("⚠️ 检测到 position out of bounds 错误"),l.Am.error("价格查询失败，可能是流动性池问题或网络异常")):(null===(a=er.message)||void 0===a?void 0:a.includes("INVALID_PATH"))?(console.error("❌ 无效路径错误"),l.Am.error("交换路径无效，请检查代币配置")):(null===(r=er.message)||void 0===r?void 0:r.includes("INSUFFICIENT_LIQUIDITY"))&&(console.error("❌ 流动性不足错误"),l.Am.error("流动性不足，请尝试较小的交换金额"))}},[er,G,es,en]),(0,a.useEffect)(()=>{"WETH9"===en?$(G):ea&&ea.length>1?$(BigInt(ea[1])):$(0n)},[en,G,ea]);let eo=(0,a.useMemo)(()=>{if("WETH9"===en)return{feePercentage:0,feeAmount:"0"};let e=.3*parseFloat(ee||"0")/100;return{feePercentage:.3,feeAmount:e<1e-4?e.toExponential(2):e.toFixed(6)}},[en,ee]),el=(0,a.useMemo)(()=>G>0n&&X>0n?(0,v.eb)((0,v.bM)(X*10n**18n/G),2,4):"0",[G,X]),ed=!j.isNative&&"WETH9"!==en,eu="WETH9"===en?"0x015b1A506F2aa2B1ecC000aB799ED6C59005fBb3":"0x2A2Dc26469F9C8ccA09BbB5C1124bCaA758c014d",{approve:ec,isWriting:em,isConfirming:ef,isConfirmed:ep,writeError:ey}=(0,N.yA)(j.address),{deposit:ex,writeData:eb,isPending:eg,error:eh,isConfirming:eT,isConfirmed:ev}=(0,_.Qo)(),{withdraw:ew,writeData:eN,isPending:ej,error:eE,isConfirming:eA,isConfirmed:eC}=(0,_.Qc)(),{swap:ek,isWriting:eD,isConfirming:eF,isConfirmed:eS,writeError:e_}=function(){let{writeContract:e,isPending:t,data:n,error:s}=(0,E.S)(),a=async(t,n,s,a,r)=>{try{await e({address:F,abi:k,functionName:"swapExactTokensForTokens",args:[t,n,s,a,r]})}catch(e){throw console.error("Swap failed:",e),e}},{isLoading:r,isSuccess:i}=(0,A.A)({hash:n});return{swap:a,writeData:n,isWriting:t,writeError:s,isConfirming:r,isConfirmed:i}}(),{swap:eI,isWriting:eH,isConfirming:eB,isConfirmed:eM,writeError:eO}=function(){let{writeContract:e,isPending:t,data:n,error:s}=(0,E.S)(),a=async(t,n,s,a,r)=>{try{await e({address:F,abi:k,functionName:"swapExactETHForTokens",args:[t,n,s,a],value:r})}catch(e){throw console.error("swapExactETHForTokens 兑换代币失败:",e),e}},{isLoading:r,isSuccess:i}=(0,A.A)({hash:n});return{swap:a,writeData:n,isWriting:t,writeError:s,isConfirming:r,isConfirmed:i}}(),{swap:eW,isWriting:eP,isConfirming:eV,isConfirmed:eL,writeError:eU,txHash:eR}=function(){let{sendTransaction:e,data:t,isPending:n,error:s}=(0,C.p)(),a=async(t,n,s,a,r)=>{try{let i=(0,D.R)({abi:k,functionName:"swapExactETHForTokens",args:[t,n,s,a]});console.log("\uD83D\uDD27 直接发送交易，绕过 simulateContract:",{to:F,value:r.toString(),data:i,args:[t.toString(),n,s,a.toString()]}),await e({to:F,value:r,data:i}),console.log("✅ 交易请求已发送")}catch(e){throw console.error("直接交易失败:",e),e}},{isLoading:r,isSuccess:i}=(0,A.A)({hash:t});return{swap:a,txHash:t,isWriting:n,writeError:s,isConfirming:r,isConfirmed:i}}(),{swap:ez,isWriting:eZ,isConfirming:eK,isConfirmed:eQ,writeError:eq}=function(){let{writeContract:e,isPending:t,data:n,error:s}=(0,E.S)(),a=async(t,n,s,a,r)=>{try{await e({address:F,abi:k,functionName:"swapExactTokensForETH",args:[t,n,s,a,r]})}catch(e){throw console.error("代币兑换 swapExactTokensForETH 失败:",e),e}},{isLoading:r,isSuccess:i}=(0,A.A)({hash:n});return{swap:a,writeData:n,isWriting:t,writeError:s,isConfirming:r,isConfirmed:i}}(),eY=em||ef,eG=ep||!ed,eJ=eg||eT||ej||eA||eD||eF||eH||eB||eP||eV||eZ||eK,eX=ev||eC||eS||eM||eL||eQ,e$=K||q;(0,a.useEffect)(()=>{console.log("Disabled states:",{isPendingFromBalance:K,isPendingToBalance:q,isApproved:eG,isConfirmedApprove:ep,needsApproval:ed,isDisabled:e$})},[K,q,eG,ep,ed,e$]);let e0=Y.handleSubmit(async()=>{if((0,T.S)(i))try{await ec(eu,G)}catch(e){console.error(e),l.Am.error((null==e?void 0:e.message)||"授权失败")}}),e2=Y.handleSubmit(async()=>{var e,t,n,s,a,o,d;if((0,T.S)(i))try{let n="0x015b1A506F2aa2B1ecC000aB799ED6C59005fBb3";if(!n){console.error("❌ 缺少必要的环境变量配置"),l.Am.error("系统配置错误，请联系管理员");return}if("UniswapV2_ETH_TO_TOKEN"===en){if(2!==es.length){console.error("❌ Native to Token 路径长度错误:",es),l.Am.error("交换路径配置错误");return}if(es[0]!==n){console.error("❌ 路径第一个地址不是 WETH:",{expected:n,actual:es[0]}),l.Am.error("WETH 地址配置错误");return}}if(X<=0n){l.Am.error("无法获取兑换价格，请检查流动性池");return}let s=BigInt(Math.floor(Date.now()/1e3)+1200),a=995n*X/1000n;switch(console.log("\uD83D\uDE80 执行交换，参数详情:",{swapMethod:en,fromAmount:G.toString(),toAmount:X.toString(),minAmountOut:a.toString(),swapPath:es,deadline:s.toString(),account:r}),en){case"WETH9":j.isNative?await ex(G):await ew(G);break;case"UniswapV2_ETH_TO_TOKEN":console.log("\uD83D\uDCDE 调用 swapETHForTokens (直接交易模式):",{minAmountOut:a.toString(),path:es,to:r,deadline:s.toString(),value:G.toString()});try{await eW(a,es,r,s,G),console.log("✅ 直接交易模式成功")}catch(n){console.warn("⚠️ 直接交易模式失败，尝试标准模式:",n.message);try{await eI(a,es,r,s,G),console.log("✅ 标准交易模式成功")}catch(n){if(console.error("❌ 所有交易模式都失败了"),(null===(e=n.message)||void 0===e?void 0:e.includes("Position"))&&(null===(t=n.message)||void 0===t?void 0:t.includes("out of bounds")))l.Am.error("检测到 viem 库的已知解析问题，但交易本身应该是有效的。请直接在钱包中确认交易。"),console.warn("\uD83D\uDCA1 建议: 这是前端库的问题，合约功能正常");else throw n}}break;case"UniswapV2_TOKEN_TO_ETH":await ez(G,a,[j.address,"0x015b1A506F2aa2B1ecC000aB799ED6C59005fBb3"],r,s);break;case"UniswapV2_TOKEN_TO_TOKEN":await ek(G,a,[j.address,R.address],r,s)}}catch(e){console.error("\uD83D\uDEA8 交换执行错误:",{error:e,errorMessage:e.message,errorCause:e.cause,errorDetails:e.details}),(null===(n=e.message)||void 0===n?void 0:n.includes("Position"))&&(null===(s=e.message)||void 0===s?void 0:s.includes("out of bounds"))?l.Am.error("交易数据解析失败，请稍后重试或联系技术支持"):(null===(a=e.message)||void 0===a?void 0:a.includes("INVALID_PATH"))?l.Am.error("交换路径无效，请检查代币配置"):(null===(o=e.message)||void 0===o?void 0:o.includes("INSUFFICIENT_OUTPUT_AMOUNT"))?l.Am.error("输出金额不足，请调整滑点设置或减少交换金额"):(null===(d=e.message)||void 0===d?void 0:d.includes("INSUFFICIENT_LIQUIDITY"))?l.Am.error("流动性不足，请尝试较小的交换金额"):l.Am.error((null==e?void 0:e.message)||"兑换失败")}});(0,a.useEffect)(()=>{eX&&(l.Am.success("兑换成功"),setTimeout(()=>{let e=new URL(window.location.href);e.searchParams.set("from",j.symbol),e.searchParams.set("to",R.symbol),window.location.href=e.toString()},2e3))},[eX,j.symbol,R.symbol]);let{handleContractError:e1}=(0,w.S)();if((0,a.useEffect)(()=>{[ey,eh,eE,e_,eO,eU,eq,er].forEach(e=>{e&&e1(e,"swap")})},[ey,eh,eE,e_,eO,eU,eq,er]),!d)return(0,s.jsx)(M.Z,{});if(0===c.length)return(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)(B.Z,{title:"兑换"}),(0,s.jsx)("div",{className:"text-center text-greyscale-500 mt-4",children:"正在加载代币信息..."})]});let e5=eY||eJ;return(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)(B.Z,{title:"兑换代币"}),(0,s.jsxs)("div",{className:"w-full max-w-md mt-4",children:[(0,s.jsx)(h.l0,{...Y,children:(0,s.jsxs)("form",{children:[(0,s.jsx)("div",{className:"mb-2",children:(0,s.jsx)(h.Wi,{control:Y.control,name:"fromTokenAmount",render:e=>{let{field:t}=e;return(0,s.jsxs)(h.xJ,{children:[(0,s.jsx)(b.Zb,{className:"bg-[#f7f8f9] border-none",children:(0,s.jsxs)(b.aY,{className:"py-4 px-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)(x.I,{type:"number",placeholder:"0",...t,disabled:e$,className:"text-xl border-none p-0 h-auto bg-transparent focus:ring-0 focus:outline-none mr-2"}),(0,s.jsx)(h.Wi,{control:Y.control,name:"fromTokenAddress",render:e=>{let{field:t}=e;return(0,s.jsx)(h.xJ,{children:(0,s.jsx)(h.NI,{children:(0,s.jsxs)(g.Ph,{value:t.value,onValueChange:e=>{let n=c.find(t=>t.address===e);n&&(n.address===R.address?(I(n),z(j),t.onChange(n.address),Y.setValue("toTokenAddress",j.address),Y.setValue("fromTokenAmount","")):(t.onChange(e),I(n)))},disabled:e$,children:[(0,s.jsx)(g.i4,{className:"w-auto border-none bg-white hover:bg-gray-50 px-3 py-1.5 rounded-full transition-colors border border-gray-200",children:(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)("span",{className:"font-medium text-gray-800",children:j.symbol})})}),(0,s.jsx)(g.Bw,{children:c.map(e=>(0,s.jsx)(g.Ql,{value:e.address,children:(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)("span",{children:e.symbol})})},e.address))})]})})})}})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex gap-1",children:[[25,50,75].map(e=>(0,s.jsxs)(y.z,{variant:"outline",size:"sm",type:"button",onClick:()=>{let t=(null!=Z?Z:0n)*BigInt(e)/100n;Y.setValue("fromTokenAmount",(0,v.bM)(t))},disabled:e$||0n>=(Z||0n),className:"text-xs h-7 px-2 rounded-lg",children:[e,"%"]},e)),(0,s.jsx)(y.z,{variant:"outline",size:"sm",type:"button",onClick:et,disabled:e$||0n>=(Z||0n),className:"text-xs h-7 px-2 rounded-lg",children:"最高"})]}),(0,s.jsxs)("span",{className:"text-sm text-gray-600",children:[(0,v.LH)(Z||0n)," ",j.symbol]})]})]})}),(0,s.jsx)(h.zG,{})]})}})}),(0,s.jsx)("div",{className:"flex justify-center mb-1",children:(0,s.jsx)("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center",children:(0,s.jsx)(y.z,{variant:"ghost",type:"button",size:"icon",className:"rounded-full hover:bg-gray-100",onClick:()=>{let e={...j},t={...R};I(t),z(e),Y.setValue("fromTokenAmount",""),console.log("Swapped tokens:",{newFrom:t.symbol,newTo:e.symbol})},disabled:e$,children:(0,s.jsx)(p,{className:"w-5 h-5 text-gray-600"})})})}),(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(b.Zb,{className:"bg-[#f7f8f9] border-none",children:(0,s.jsxs)(b.aY,{className:"py-4 px-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)(x.I,{type:"number",placeholder:"0",value:(0,v.bM)(X),disabled:!0,readOnly:!0,className:"text-xl border-none p-0 h-auto bg-transparent focus:ring-0 focus:outline-none mr-2"}),(0,s.jsx)(h.Wi,{control:Y.control,name:"toTokenAddress",render:e=>{let{field:t}=e;return(0,s.jsx)(h.xJ,{children:(0,s.jsx)(h.NI,{children:(0,s.jsxs)(g.Ph,{value:t.value,onValueChange:e=>{let n=c.find(t=>t.address===e);n&&(n.address===j.address?(I(R),z(n),t.onChange(n.address),Y.setValue("fromTokenAddress",R.address),Y.setValue("fromTokenAmount","")):(t.onChange(e),z(n)))},disabled:e$,children:[(0,s.jsx)(g.i4,{className:"w-auto border-none bg-white hover:bg-gray-50 px-3 py-1.5 rounded-full transition-colors border border-gray-200",children:(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)("span",{className:"font-medium text-gray-800",children:R.symbol})})}),(0,s.jsx)(g.Bw,{children:c.map(e=>(0,s.jsx)(g.Ql,{value:e.address,children:(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)("span",{children:e.symbol})})},e.address))})]})})})}})]}),(0,s.jsx)("div",{className:"flex items-center justify-end",children:(0,s.jsxs)("span",{className:"text-sm text-gray-600",children:[(0,v.LH)(Q||0n)," ",R.symbol]})})]})})}),(0,s.jsxs)("div",{className:"flex flex-row gap-2",children:[ed&&(0,s.jsx)(y.z,{className:"w-1/2",onClick:e0,disabled:eY||eG,children:em?"1.授权中...":ef?"1.确认中...":eG?"1.已授权":"1.授权"}),(0,s.jsx)(y.z,{className:ed?"w-1/2":"w-full",onClick:e2,disabled:!eG||eY||eJ||eX,children:eJ?ed?"2.兑换中...":"兑换中...":eX?ed?"2.已兑换":"已兑换":ed?"2.兑换":"兑换"})]})]})}),G>0n&&(0,s.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-md",children:["WETH9"===en&&(0,s.jsx)("div",{className:"text-sm text-green-600 mb-2",children:"\uD83D\uDCA1 这是 1:1 包装转换，无手续费，无滑点"}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-greyscale-400",children:"兑换率: "}),(0,s.jsxs)("span",{children:["1 ",j.symbol," = ",el," ",R.symbol]})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsxs)("span",{className:"text-greyscale-400",children:["手续费 (",eo.feePercentage,"%)："]}),(0,s.jsxs)("span",{children:[eo.feeAmount," ",j.symbol]})]}),"WETH9"!==en&&(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-greyscale-400",children:"滑点上限 (自动)："}),(0,s.jsx)("span",{children:"0.5%"})]})]})]}),(0,s.jsx)(O.Z,{isLoading:e5,text:eY?"授权中...":"交换中..."})]})};function z(){let{token:e}=(0,a.useContext)(I.M)||{};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Z,{title:"兑换代币"}),(0,s.jsxs)("main",{className:"flex-grow",children:[(0,s.jsx)(R,{showCurrentToken:!!e&&!!e.hasEnded}),(0,s.jsxs)("div",{className:"bg-blue-50/30 border-l-4 border-l-blue-50 rounded-r-lg p-4 mb-8 text-sm mt-0 m-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-base font-bold text-blue-800 pb-2",children:[(0,s.jsx)(r.Z,{className:"w-4 h-4"}),"提示"]}),(0,s.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"交易协议："}),(0,s.jsx)("div",{className:"text-sm text-blue-700",children:"本交易功能基于 Uniswap V2 协议实现，合约代码为官方最新版本"}),(0,s.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"费用说明："}),(0,s.jsx)("div",{className:"text-sm text-blue-700",children:"手续费为 0.3%，滑点上限为 0.5%"})]})]})]})}},22017:function(e,t,n){"use strict";n.d(t,{p:function(){return c}});var s=n(98029),a=n(81841),r=n(96128),i=n(81946),o=n(52425),l=n(87831);async function d(e,t){let n;let{account:s,chainId:d,connector:u,gas:c,...m}=t;n="object"==typeof s&&s?.type==="local"?e.getClient({chainId:d}):await (0,l.e)(e,{account:s??void 0,chainId:d,connector:u});let{connector:f}=(0,o.D)(e),p=await (async()=>{if(!(!("data"in t)||!t.data||(u??f)?.supportsSimulation)&&null!==c)return void 0===c?(0,i.s)(n,a.Q,"estimateGas")({...m,account:s,chain:d?{id:d}:null}):c})(),y=(0,i.s)(n,r.T,"sendTransaction");return await y({...m,...s?{account:s}:{},gas:p,chain:d?{id:d}:null})}var u=n(80666);function c(e={}){var t;let{mutation:n}=e,a=(t=(0,u.Z)(e),{mutationFn:e=>d(t,e),mutationKey:["sendTransaction"]}),{mutate:r,mutateAsync:i,...o}=(0,s.D)({...n,...a});return{...o,sendTransaction:r,sendTransactionAsync:i}}}},function(e){e.O(0,[5828,5974,7863,7380,2888,9774,179],function(){return e(e.s=17137)}),_N_E=e.O()}]);