(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[188],{1709:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(37876);let o=e=>{var t=e.title;return(0,n.jsx)("div",{className:"flex justify-between items-center",children:(0,n.jsx)("h1",{className:"text-lg font-bold",children:t})})}},7446:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var n=(0,r(11713).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},18449:(e,t,r)=>{"use strict";r.d(t,{X:()=>s});var n=r(76200);class o extends n.C{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function s(e,t){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new o({value:e});let[r,n="0"]=e.split("."),s=r.startsWith("-");if(s&&(r=r.slice(1)),n=n.replace(/(0+)$/,""),0===t)1===Math.round(Number(`.${n}`))&&(r=`${BigInt(r)+1n}`),n="";else if(n.length>t){let[e,o,s]=[n.slice(0,t-1),n.slice(t-1,t),n.slice(t)],i=Math.round(Number(`${o}.${s}`));(n=i>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${i}`).length>t&&(n=n.slice(1),r=`${BigInt(r)+1n}`),n=n.slice(0,t)}else n=n.padEnd(t,"0");return BigInt(`${s?"-":""}${r}${n}`)}},26269:(e,t,r)=>{"use strict";var n=r(99680),o={"text/plain":"Text","text/html":"Url",default:"Text"};e.exports=function(e,t){var r,s,i,a,c,l,u,d,f=!1;t||(t={}),i=t.debug||!1;try{if(c=n(),l=document.createRange(),u=document.getSelection(),(d=document.createElement("span")).textContent=e,d.ariaHidden="true",d.style.all="unset",d.style.position="fixed",d.style.top=0,d.style.clip="rect(0, 0, 0, 0)",d.style.whiteSpace="pre",d.style.webkitUserSelect="text",d.style.MozUserSelect="text",d.style.msUserSelect="text",d.style.userSelect="text",d.addEventListener("copy",function(r){if(r.stopPropagation(),t.format)if(r.preventDefault(),void 0===r.clipboardData){i&&console.warn("unable to use e.clipboardData"),i&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var n=o[t.format]||o.default;window.clipboardData.setData(n,e)}else r.clipboardData.clearData(),r.clipboardData.setData(t.format,e);t.onCopy&&(r.preventDefault(),t.onCopy(r.clipboardData))}),document.body.appendChild(d),l.selectNodeContents(d),u.addRange(l),!document.execCommand("copy"))throw Error("copy command was unsuccessful");f=!0}catch(n){i&&console.error("unable to copy using execCommand: ",n),i&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(t.format||"text",e),t.onCopy&&t.onCopy(window.clipboardData),f=!0}catch(n){i&&console.error("unable to copy using clipboardData: ",n),i&&console.error("falling back to prompt"),r="message"in t?t.message:"Copy to clipboard: #{key}, Enter",s=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C",a=r.replace(/#{\s*key\s*}/g,s),window.prompt(a,e)}}finally{u&&("function"==typeof u.removeRange?u.removeRange(l):u.removeAllRanges()),d&&document.body.removeChild(d),c()}return f}},30604:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/action/[id]",function(){return r(65868)}])},33276:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var n=(0,r(11713).A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},46852:(e,t,r)=>{"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.CopyToClipboard=void 0;var o=a(r(14232)),s=a(r(26269)),i=["text","onCopy","options","children"];function a(e){return e&&e.__esModule?e:{default:e}}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach(function(t){p(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var y=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");c.prototype=Object.create(e&&e.prototype,{constructor:{value:c,writable:!0,configurable:!0}}),Object.defineProperty(c,"prototype",{writable:!1}),e&&u(c,e);var t,r,a=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=f(c);return e=t?Reflect.construct(r,arguments,f(this).constructor):r.apply(this,arguments),function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return d(e)}(this,e)});function c(){var e;if(!(this instanceof c))throw TypeError("Cannot call a class as a function");for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return p(d(e=a.call.apply(a,[this].concat(r))),"onClick",function(t){var r=e.props,n=r.text,i=r.onCopy,a=r.children,c=r.options,l=o.default.Children.only(a),u=(0,s.default)(n,c);i&&i(n,u),l&&l.props&&"function"==typeof l.props.onClick&&l.props.onClick(t)}),e}return r=[{key:"render",value:function(){var e=this.props,t=(e.text,e.onCopy,e.options,e.children),r=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,i),n=o.default.Children.only(t);return o.default.cloneElement(n,l(l({},r),{},{onClick:this.onClick}))}}],function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(c.prototype,r),Object.defineProperty(c,"prototype",{writable:!1}),c}(o.default.PureComponent);t.CopyToClipboard=y,p(y,"defaultProps",{onCopy:void 0,options:void 0})},48447:(e,t,r)=>{"use strict";var n=r(46852).CopyToClipboard;n.CopyToClipboard=n,e.exports=n},65868:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>E});var n=r(40854),o=r(37876),s=r(14232),i=r(89099),a=r(66663),c=r(92101),l=r(6960),u=r(97685),d=r(8047),f=r(42038),p=r(64115),y=r(20451),m=r(70642),v=r(83416),b=r(91323),g=r(12293),x=r(99574),h=r(20442);let j=e=>{var t=e.actionId,r=e.submitted,n=e.onRoundChange,a=((0,s.useContext)(v.N)||{}).token,c=(0,d.F)().chain,j=(0,i.useRouter)(),C=(0,p.vC)(),w=C.currentRound,N=C.isPending,O=C.error;(0,s.useEffect)(()=>{n&&"function"==typeof n&&n(w)},[w,n]);var E=(0,m.O)(),P=E.hasEnoughVotes,A=E.percentage,k=E.validGovVotes,R=E.govData,_=E.SUBMIT_MIN_PERCENTAGE,I=E.isPending,D=E.error,S=(0,p.of)(),$=S.submit,T=S.isWriting,B=S.isConfirming,M=S.isConfirmed,V=S.writeError;(0,s.useEffect)(()=>{M&&!V&&(u.oR.success("推举成功",{duration:2e3}),setTimeout(()=>{j.push("/vote/?symbol=".concat(null==a?void 0:a.symbol))},2e3))},[M,V]);var F=(0,y.g)().handleContractError;return((0,s.useEffect)(()=>{O&&F(O,"submit"),D&&F(D,"submit"),V&&F(V,"submit")},[O,D,V]),I||N)?(0,o.jsx)(g.A,{}):(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"flex flex-col m-4",children:[!P&&void 0!==k&&(null==R?void 0:R.govVotes)&&(0,o.jsx)(b.A,{type:"error",message:"有效治理票，须达到总治理票的".concat((100*_).toFixed(1),"%，才能新建、推举行动（您当前有效治理票为").concat((0,h.NJ)(k,2),"，占比").concat((100*A).toFixed(2),"%）"),className:"mb-4"}),(0,o.jsx)("div",{className:"flex justify-center",children:r||M?(0,o.jsxs)("div",{className:"flex space-x-4 justify-center w-full",children:[(0,o.jsx)(l.$,{disabled:!0,className:"w-1/2",children:"已推举"}),r&&!M&&(0,o.jsx)(l.$,{onClick:()=>j.push("/vote/?symbol=".concat(null==a?void 0:a.symbol)),className:"w-1/2",children:"去投票"})]}):(0,o.jsxs)(l.$,{onClick:()=>{(0,f.C)(c)&&!T&&!B&&P&&$(null==a?void 0:a.address,t)},className:"w-1/2",disabled:T||B||!P,children:[T&&"提交中...",B&&"确认中...",!T&&!B&&"推举本行动"]})}),(0,o.jsxs)("div",{className:"bg-gray-100 text-greyscale-500 rounded-lg p-4 text-sm mt-4 w-full",children:[(0,o.jsx)("p",{className:"mb-1",children:"说明："}),(0,o.jsx)("p",{children:"1. 有效治理票数 ≥ 总治理票的0.5%，才能推举；"}),(0,o.jsx)("p",{children:"2. 每轮次，1个地址最多可 创建/推举 1 个行动；"})]})]}),(0,o.jsx)(x.A,{isLoading:T||B,text:T?"提交交易...":"确认交易..."})]})};var C=r(19591),w=r(98684);let N=e=>{var t=e.actionId,r=e.onRoundChange,n=(0,d.F)().address,a=((0,s.useContext)(v.N)||{}).token,c=(0,i.useRouter)(),f=(0,w.vC)(),p=f.currentRound,m=(f.isPending,f.error);(0,s.useEffect)(()=>{r&&"function"==typeof r&&r(p)},[p,r]);var b=(0,C.Fd)(null==a?void 0:a.address,n),j=b.validGovVotes,N=b.isPending,O=b.error,E=(0,w.$6)(null==a?void 0:a.address,p,n,t),P=E.votesNumByAccountByActionId,A=E.isPending,k=E.error,R=(0,w.Pb)((null==a?void 0:a.address)||"",p,n||""),_=R.votesNumByAccount,I=R.isPending,D=R.error,S=N||I||A,$=S?0n:j-_,T=(0,w.eU)(),B=T.vote,M=T.isWriting,V=T.isConfirming,F=T.isConfirmed,U=T.writeError,G=(0,y.g)().handleContractError;return(0,s.useEffect)(()=>{U&&G(U,"vote"),m&&G(m,"vote"),k&&G(k,"vote"),O&&G(O,"stake"),D&&G(D,"vote")},[U,m,k,O,D]),(0,s.useEffect)(()=>{F&&!U&&(u.Ay.success("提交成功",{duration:2e3}),setTimeout(()=>{c.push("/vote/actions/?symbol=".concat(null==a?void 0:a.symbol))},2e3))},[F,U]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"flex flex-col items-center space-y-3 p-4 mb-2",children:[(0,o.jsxs)("div",{className:"stats w-full border grid grid-cols-2 divide-x-0 mb-2",children:[(0,o.jsxs)("div",{className:"stat place-items-center",children:[(0,o.jsx)("div",{className:"stat-title",children:"我已投本行动票数"}),(0,o.jsx)("div",{className:"stat-value text-2xl",children:A?(0,o.jsx)(g.A,{}):(0,h.NJ)(P)})]}),(0,o.jsxs)("div",{className:"stat place-items-center",children:[(0,o.jsx)("div",{className:"stat-title",children:"我的剩余票数"}),(0,o.jsx)("div",{className:"stat-value text-2xl",children:S?(0,o.jsx)(g.A,{}):(0,h.NJ)($,2)})]})]}),!A&&$>0n?(0,o.jsx)(l.$,{className:"w-1/2",onClick:()=>{M||V||B(null==a?void 0:a.address,[t],[$])},disabled:M||V,children:M||V?(0,o.jsx)(g.A,{}):"将100%票投给此行动"}):(0,o.jsx)(l.$,{className:"w-1/2",disabled:!0,children:S?(0,o.jsx)(g.A,{}):"没有剩余票数"}),!N&&(0,o.jsxs)("div",{className:"text-sm text-greyscale-500 text-center",children:["提示: 每轮最大可投票数，等于您的治理票数 (",(0,h.NJ)(j,2),")"]})]}),(0,o.jsx)(x.A,{isLoading:M||V,text:M?"提交交易...":"确认交易..."})]})};var O=r(22605);let E=()=>{var e=(0,i.useRouter)().query,t=e.id,r=e.type,l=e.submitted,u=(0,n._)((0,s.useState)(null),2),d=u[0],f=u[1],p=e=>{f(e)},y=(0,n._)((0,s.useState)(void 0),2),m=y[0],v=y[1];return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a.A,{title:"行动详情"}),(0,o.jsxs)("main",{className:"flex-grow",children:["submit"===r&&(0,o.jsx)(j,{actionId:BigInt(t||0),submitted:"true"===l,onRoundChange:p}),"vote"===r&&(0,o.jsx)(N,{actionId:BigInt(t||0),onRoundChange:p}),("join"===r||void 0===r)&&(0,o.jsx)(O.A,{actionId:BigInt(t||0),onRoundChange:p,actionInfo:m}),(0,o.jsx)(c.A,{actionId:BigInt(t||0),round:BigInt(d||0),showSubmitter:"submit"!==r,onActionInfo:v})]})]})}},70642:(e,t,r)=>{"use strict";r.d(t,{O:()=>l});var n=r(14232),o=r(19591),s=r(52372),i=r(83416),a=r(8047),c=Number("5")/1e3,l=()=>{var e=((0,n.useContext)(i.N)||{}).token,t=(0,a.F)().address,r=(0,o.Fd)((null==e?void 0:e.address)||"",t||""),l=r.validGovVotes,u=r.isPending,d=r.error,f=(0,s.W6)(null==e?void 0:e.address),p=f.govData,y=f.isPending,m=f.error,v=(0,n.useMemo)(()=>l&&(null==p?void 0:p.govVotes)&&0n!==p.govVotes?Number(l)/Number(p.govVotes):0,[l,null==p?void 0:p.govVotes]);return{hasEnoughVotes:(0,n.useMemo)(()=>v>=c,[v]),percentage:v,validGovVotes:l,govData:p,SUBMIT_MIN_PERCENTAGE:c,isPending:u||y,error:null!=d?d:m}}},70801:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var n=(0,r(11713).A)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]])},77328:(e,t,r)=>{e.exports=r(89836)},86739:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var n=(0,r(11713).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},91323:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(37876),o=r(30684);let s=e=>{var t=e.type,r=e.message,s=e.className;return(0,n.jsx)("div",{className:(0,o.cn)("p-3 rounded border text-sm",{error:"bg-red-50 border-red-200 text-red-700",warning:"bg-yellow-50 border-yellow-200 text-yellow-700",info:"bg-blue-50 border-blue-200 text-blue-700",success:"bg-green-50 border-green-200 text-green-700"}[void 0===t?"error":t],s),children:r})}},99680:e=>{e.exports=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var t=document.activeElement,r=[],n=0;n<e.rangeCount;n++)r.push(e.getRangeAt(n));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||r.forEach(function(t){e.addRange(t)}),t&&t.focus()}}}},e=>{var t=t=>e(e.s=t);e.O(0,[2569,4115,5284,7432,7835,636,6593,8792],()=>t(30604)),_N_E=e.O()}]);