(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[781],{1709:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});var a=s(37876);let t=e=>{var r=e.title;return(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsx)("h1",{className:"text-lg font-bold",children:r})})}},7446:(e,r,s)=>{"use strict";s.d(r,{A:()=>a});var a=(0,s(11713).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},18449:(e,r,s)=>{"use strict";s.d(r,{X:()=>n});var a=s(76200);class t extends a.C{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function n(e,r){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new t({value:e});let[s,a="0"]=e.split("."),n=s.startsWith("-");if(n&&(s=s.slice(1)),a=a.replace(/(0+)$/,""),0===r)1===Math.round(Number(`.${a}`))&&(s=`${BigInt(s)+1n}`),a="";else if(a.length>r){let[e,t,n]=[a.slice(0,r-1),a.slice(r-1,r),a.slice(r)],i=Math.round(Number(`${t}.${n}`));(a=i>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${i}`).length>r&&(a=a.slice(1),s=`${BigInt(s)+1n}`),a=a.slice(0,r)}else a=a.padEnd(r,"0");return BigInt(`${n?"-":""}${s}${a}`)}},28638:(e,r,s)=>{"use strict";s.d(r,{BT:()=>m,Wu:()=>u,ZB:()=>d,Zp:()=>o,aR:()=>c,wL:()=>x});var a=s(3576),t=s(65699),n=s(37876),i=s(14232),l=s(30684),o=i.forwardRef((e,r)=>{var s=e.className,i=(0,t._)(e,["className"]);return(0,n.jsx)("div",(0,a._)({ref:r,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s)},i))});o.displayName="Card";var c=i.forwardRef((e,r)=>{var s=e.className,i=(0,t._)(e,["className"]);return(0,n.jsx)("div",(0,a._)({ref:r,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s)},i))});c.displayName="CardHeader";var d=i.forwardRef((e,r)=>{var s=e.className,i=(0,t._)(e,["className"]);return(0,n.jsx)("div",(0,a._)({ref:r,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s)},i))});d.displayName="CardTitle";var m=i.forwardRef((e,r)=>{var s=e.className,i=(0,t._)(e,["className"]);return(0,n.jsx)("div",(0,a._)({ref:r,className:(0,l.cn)("text-sm text-muted-foreground",s)},i))});m.displayName="CardDescription";var u=i.forwardRef((e,r)=>{var s=e.className,i=(0,t._)(e,["className"]);return(0,n.jsx)("div",(0,a._)({ref:r,className:(0,l.cn)("p-6 pt-0",s)},i))});u.displayName="CardContent";var x=i.forwardRef((e,r)=>{var s=e.className,i=(0,t._)(e,["className"]);return(0,n.jsx)("div",(0,a._)({ref:r,className:(0,l.cn)("flex items-center p-6 pt-0",s)},i))});x.displayName="CardFooter"},40150:(e,r,s)=>{"use strict";s.d(r,{T:()=>o});var a=s(3576),t=s(65699),n=s(37876),i=s(14232),l=s(30684),o=i.forwardRef((e,r)=>{var s=e.className,i=(0,t._)(e,["className"]);return(0,n.jsx)("textarea",(0,a._)({className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r},i))});o.displayName="Textarea"},42038:(e,r,s)=>{"use strict";s.d(r,{C:()=>t});var a=s(97685),t=e=>!!e||(a.oR.error("请先将钱包链接 ".concat("thinkium801")),!1)},65104:(e,r,s)=>{"use strict";s.d(r,{A:()=>a});var a=(0,s(11713).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},70642:(e,r,s)=>{"use strict";s.d(r,{O:()=>c});var a=s(14232),t=s(19591),n=s(52372),i=s(83416),l=s(8047),o=Number("5")/1e3,c=()=>{var e=((0,a.useContext)(i.N)||{}).token,r=(0,l.F)().address,s=(0,t.Fd)((null==e?void 0:e.address)||"",r||""),c=s.validGovVotes,d=s.isPending,m=s.error,u=(0,n.W6)(null==e?void 0:e.address),x=u.govData,f=u.isPending,v=u.error,h=(0,a.useMemo)(()=>c&&(null==x?void 0:x.govVotes)&&0n!==x.govVotes?Number(c)/Number(x.govVotes):0,[c,null==x?void 0:x.govVotes]);return{hasEnoughVotes:(0,a.useMemo)(()=>h>=o,[h]),percentage:h,validGovVotes:c,govData:x,SUBMIT_MIN_PERCENTAGE:o,isPending:d||f,error:null!=m?m:v}}},71778:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>F});var a=s(16927),t=s(3576),n=s(62701),i=s(4902),l=s(37876),o=s(8047),c=s(14232),d=s(89099),m=s(88992),u=(0,s(11713).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),x=s(65104),f=s(60513),v=s(13810),h=s(6960),p=s(77932),g=s(40150),N=s(28638),j=s(92659),y=s(64115),b=s(20451),w=s(70642),_=s(83416),C=s(66663),k=s(91323),I=s(1709),R=s(99574),A=s(42038),M=s(20442),z=f.z.object({actionName:f.z.string().min(1,{message:"行动名称不能为空"}),consensus:f.z.string().min(1,{message:"行动共识不能为空"}),verificationRule:f.z.string().min(1,{message:"验证规则不能为空"}),verificationPairs:f.z.array(f.z.object({key:f.z.string().min(1,{message:"验证名称不能为空"}),value:f.z.string().min(1,{message:"验证信息提示不能为空"})})),rewardAddressCount:f.z.string().min(1,{message:"奖励地址数不能为空"}).refine(e=>Number(e)>0,{message:"奖励地址数必须大于0"}),minStake:f.z.string().min(1,{message:"最小参与代币数不能为空"}).refine(e=>Number(e)>0,{message:"最小参与代币数必须大于0"}),whiteList:f.z.string().optional()});function F(){var e,r=(0,o.F)().chain,s=((0,c.useContext)(_.N)||{}).token,f=(0,m.mN)({resolver:(0,v.u)(z),defaultValues:{actionName:"",consensus:"",verificationRule:"",verificationPairs:[{key:"",value:""}],rewardAddressCount:"",minStake:"",whiteList:""},mode:"onChange"}),F=(0,m.jz)({control:f.control,name:"verificationPairs"}),B=F.fields,E=F.append,P=F.remove,$=(0,w.O)(),S=$.hasEnoughVotes,V=$.percentage,L=$.validGovVotes,D=$.govData,J=$.SUBMIT_MIN_PERCENTAGE,T=$.isPending,W=$.error,O=(0,y.SU)(),X=O.submitNewAction,G=O.isWriting,Z=O.isConfirming,H=O.isConfirmed,U=O.writeError,q=O.writeData,K=(e=(0,a._)(function(e){var a,t,n,l;return(0,i.__generator)(this,function(i){switch(i.label){case 0:if(!(0,A.C)(r))return[2];if(!S)return a=(100*J).toFixed(2),f.setError("actionName",{type:"manual",message:"有效治理票，须达到总治理票的".concat(a,"%，才能新建、推举行动（您当前有效治理票为").concat(L,"，占比").concat((100*V).toFixed(2),"%）")}),[2];return t=e.verificationPairs.map(e=>e.key),n=e.verificationPairs.map(e=>e.value),l={minStake:e.minStake?(0,M.XS)(e.minStake):0n,maxRandomAccounts:e.rewardAddressCount?BigInt(e.rewardAddressCount):0n,whiteList:e.whiteList?e.whiteList.split(",").map(e=>e.trim()):[],action:e.actionName,consensus:e.consensus,verificationRule:e.verificationRule,verificationKeys:t,verificationInfoGuides:n},[4,X(null==s?void 0:s.address,l)];case 1:return i.sent(),[2]}})}),function(r){return e.apply(this,arguments)}),Q=(0,d.useRouter)();(0,c.useEffect)(()=>{H&&Q.push("/vote/?symbol=".concat(null==s?void 0:s.symbol))},[H,q,Q,null==s?void 0:s.symbol]);var Y=(0,b.g)().handleContractError;return(0,c.useEffect)(()=>{W&&Y(W,"submit"),U&&Y(U,"submit")},[W,U,Y]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(C.A,{title:"创建新行动"}),(0,l.jsxs)("div",{className:"max-w-xl p-4",children:[!S&&void 0!==L&&D&&(0,l.jsx)(k.A,{type:"error",message:"有效治理票，须达到总治理票的".concat((100*J).toFixed(1),"%，才能新建、推举行动（您当前有效治理票为").concat((0,M.NJ)(L,2),"，占比").concat((100*V).toFixed(2),"%））"),className:"mb-4"}),(0,l.jsx)(I.A,{title:"创建新行动"}),(0,l.jsx)(j.lV,(0,n._)((0,t._)({},f),{children:(0,l.jsxs)("form",{onSubmit:f.handleSubmit(K),className:"mt-4 space-y-4",children:[(0,l.jsx)(j.zB,{control:f.control,name:"actionName",render:e=>{var r=e.field;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{children:"行动名称"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(p.p,(0,t._)({type:"text",placeholder:"一句话说明行动",className:"!ring-secondary-foreground"},r))}),(0,l.jsx)(j.C5,{})]})}}),(0,l.jsx)(j.zB,{control:f.control,name:"consensus",render:e=>{var r=e.field;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{children:"行动共识"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(p.p,(0,t._)({type:"text",placeholder:"描述行动所基于的共识",className:"!ring-secondary-foreground"},r))}),(0,l.jsx)(j.C5,{})]})}}),(0,l.jsx)(j.zB,{control:f.control,name:"verificationRule",render:e=>{var r=e.field;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{children:"验证规则"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(g.T,(0,t._)({placeholder:"验证者，会根据这个规则来打分",className:"!ring-secondary-foreground"},r))}),(0,l.jsx)(j.C5,{})]})}}),(0,l.jsxs)("div",{children:[(0,l.jsx)(j.lR,{children:"报名参加行动时，行动者要提供的信息"}),(0,l.jsx)("div",{className:"space-y-4 mt-2",children:B.map((e,r)=>(0,l.jsx)(N.Zp,{className:"overflow-hidden",children:(0,l.jsx)(N.Wu,{className:"p-4",children:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(j.zB,{control:f.control,name:"verificationPairs.".concat(r,".key"),render:e=>{var r=e.field;return(0,l.jsxs)(j.eI,{className:"flex-grow",children:[(0,l.jsx)(j.MJ,{children:(0,l.jsx)(p.p,(0,t._)({type:"text",placeholder:"名称，比如 '微博地址'",className:"!ring-secondary-foreground"},r))}),(0,l.jsx)(j.C5,{})]})}}),(0,l.jsx)(h.$,{variant:"ghost",size:"icon",onClick:()=>P(r),className:"flex-shrink-0",type:"button",children:(0,l.jsx)(u,{className:"h-4 w-4"})})]}),(0,l.jsx)(j.zB,{control:f.control,name:"verificationPairs.".concat(r,".value"),render:e=>{var r=e.field;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.MJ,{children:(0,l.jsx)(p.p,(0,t._)({type:"text",placeholder:"提示信息，比如 '例如 https://weibo.com/12345678'",className:"!ring-secondary-foreground"},r))}),(0,l.jsx)(j.C5,{})]})}})]})})},e.id))}),(0,l.jsx)("div",{className:"flex justify-center",children:(0,l.jsxs)(h.$,{type:"button",variant:"outline",onClick:()=>E({key:"",value:""}),className:"w-1/2 mt-2 border-secondary text-secondary",children:[(0,l.jsx)(x.A,{className:"mr-2 h-4 w-4"}),"添加验证信息"]})})]}),(0,l.jsx)(j.zB,{control:f.control,name:"rewardAddressCount",render:e=>{var r=e.field;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{children:"奖励地址数"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(p.p,(0,t._)({type:"number",placeholder:"地址数必须大于0",className:"!ring-secondary-foreground",autoComplete:"off"},r))}),(0,l.jsx)(j.C5,{})]})}}),(0,l.jsx)(j.zB,{control:f.control,name:"minStake",render:e=>{var r=e.field;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{children:"最小参与代币数"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(p.p,(0,t._)({type:"number",placeholder:"最小参与代币数必须大于0",className:"!ring-secondary-foreground",autoComplete:"off"},r))}),(0,l.jsx)(j.C5,{})]})}}),(0,l.jsx)(j.zB,{control:f.control,name:"whiteList",render:e=>{var r=e.field;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{children:"白名单"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(p.p,(0,t._)({type:"text",placeholder:"不填为不限，或多个地址用逗号分隔",className:"!ring-secondary-foreground"},r))}),(0,l.jsx)(j.Rr,{children:"多个地址用逗号分隔"}),(0,l.jsx)(j.C5,{})]})}}),(0,l.jsx)(h.$,{type:"submit",disabled:G||Z||H||!S||T,className:"mt-4 w-full",children:G?"提交中...":Z?"确认中...":H?"已提交":"提交"})]})})),(0,l.jsxs)("div",{className:"bg-gray-100 text-greyscale-500 rounded-lg p-4 text-sm mt-4",children:[(0,l.jsx)("p",{className:"mb-1",children:"说明："}),(0,l.jsx)("p",{children:"1. 每个轮次，1个地址最多可以 创建/推举 1 个行动；"}),(0,l.jsx)("p",{children:"2. 创建后，会自动推举该行动；"})]})]}),(0,l.jsx)(R.A,{isLoading:G||Z,text:G?"提交交易...":"确认交易..."})]})}},77328:(e,r,s)=>{e.exports=s(89836)},86739:(e,r,s)=>{"use strict";s.d(r,{A:()=>a});var a=(0,s(11713).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},91323:(e,r,s)=>{"use strict";s.d(r,{A:()=>n});var a=s(37876),t=s(30684);let n=e=>{var r=e.type,s=e.message,n=e.className;return(0,a.jsx)("div",{className:(0,t.cn)("p-3 rounded border text-sm",{error:"bg-red-50 border-red-200 text-red-700",warning:"bg-yellow-50 border-yellow-200 text-yellow-700",info:"bg-blue-50 border-blue-200 text-blue-700",success:"bg-green-50 border-green-200 text-green-700"}[void 0===r?"error":r],n),children:s})}},92659:(e,r,s)=>{"use strict";s.d(r,{lV:()=>h,MJ:()=>w,Rr:()=>_,zB:()=>g,eI:()=>y,lR:()=>b,C5:()=>C});var a=s(81110),t=s(40120),n=s(3576),i=s(62701),l=s(65699),o=s(37876),c=s(14232),d=s(39358),m=s(88992),u=s(30684),x=s(49794),f=(0,s(47137).F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),v=c.forwardRef((e,r)=>{var s=e.className,a=(0,l._)(e,["className"]);return(0,o.jsx)(x.b,(0,n._)({ref:r,className:(0,u.cn)(f(),s)},a))});v.displayName=x.b.displayName;var h=m.Op,p=c.createContext({}),g=e=>{var r=(0,a._)({},(0,t._)(e));return(0,o.jsx)(p.Provider,{value:{name:r.name},children:(0,o.jsx)(m.xI,(0,n._)({},r))})},N=()=>{var e=c.useContext(p),r=c.useContext(j),s=(0,m.xW)(),a=s.getFieldState,t=s.formState,i=a(e.name,t);if(!e)throw Error("useFormField should be used within <FormField>");var l=r.id;return(0,n._)({id:l,name:e.name,formItemId:"".concat(l,"-form-item"),formDescriptionId:"".concat(l,"-form-item-description"),formMessageId:"".concat(l,"-form-item-message")},i)},j=c.createContext({}),y=c.forwardRef((e,r)=>{var s=e.className,a=(0,l._)(e,["className"]),t=c.useId();return(0,o.jsx)(j.Provider,{value:{id:t},children:(0,o.jsx)("div",(0,n._)({ref:r,className:(0,u.cn)("space-y-2",s)},a))})});y.displayName="FormItem";var b=c.forwardRef((e,r)=>{var s=e.className,a=(0,l._)(e,["className"]),t=N(),i=t.error,c=t.formItemId;return(0,o.jsx)(v,(0,n._)({ref:r,className:(0,u.cn)(i&&"text-destructive",s),htmlFor:c},a))});b.displayName="FormLabel";var w=c.forwardRef((e,r)=>{var s=(0,a._)({},(0,t._)(e)),i=N(),l=i.error,c=i.formItemId,m=i.formDescriptionId,u=i.formMessageId;return(0,o.jsx)(d.DX,(0,n._)({ref:r,id:c,"aria-describedby":l?"".concat(m," ").concat(u):"".concat(m),"aria-invalid":!!l},s))});w.displayName="FormControl";var _=c.forwardRef((e,r)=>{var s=e.className,a=(0,l._)(e,["className"]),t=N().formDescriptionId;return(0,o.jsx)("p",(0,n._)({ref:r,id:t,className:(0,u.cn)("text-sm text-muted-foreground",s)},a))});_.displayName="FormDescription";var C=c.forwardRef((e,r)=>{var s=e.className,a=e.children,t=(0,l._)(e,["className","children"]),c=N(),d=c.error,m=c.formMessageId,x=d?String(null==d?void 0:d.message):a;return x?(0,o.jsx)("p",(0,i._)((0,n._)({ref:r,id:m,className:(0,u.cn)("text-sm font-medium text-destructive",s)},t),{children:x})):null});C.displayName="FormMessage"},94382:(e,r,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/action/new",function(){return s(71778)}])},99574:(e,r,s)=>{"use strict";s.d(r,{A:()=>n});var a=s(37876);s(14232);var t=s(7446);let n=e=>{var r=e.isLoading,s=e.text;return r?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(t.A,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,a.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:void 0===s?"Loading":s})]})}):null}}},e=>{var r=r=>e(e.s=r);e.O(0,[6869,2569,2840,9591,636,6593,8792],()=>r(94382)),_N_E=e.O()}]);