try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},s=(new e.Error).stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="cda98a6c-ba12-430e-8da7-02559edd40ba",e._sentryDebugIdIdentifier="sentry-dbid-cda98a6c-ba12-430e-8da7-02559edd40ba")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9822],{8286:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/action/info",function(){return t(46513)}])},34680:function(e,s,t){"use strict";t.d(s,{Ol:function(){return d},SZ:function(){return x},Zb:function(){return l},aY:function(){return u},eW:function(){return m},ll:function(){return o}});var n=t(72253),r=t(47702),a=t(85893),c=t(67294),i=t(40108),l=c.forwardRef(function(e,s){var t=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:s,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t)},c))});l.displayName="Card";var d=c.forwardRef(function(e,s){var t=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:s,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",t)},c))});d.displayName="CardHeader";var o=c.forwardRef(function(e,s){var t=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:s,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",t)},c))});o.displayName="CardTitle";var x=c.forwardRef(function(e,s){var t=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:s,className:(0,i.cn)("text-sm text-muted-foreground",t)},c))});x.displayName="CardDescription";var u=c.forwardRef(function(e,s){var t=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:s,className:(0,i.cn)("p-6 pt-0",t)},c))});u.displayName="CardContent";var m=c.forwardRef(function(e,s){var t=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:s,className:(0,i.cn)("flex items-center p-6 pt-0",t)},c))});m.displayName="CardFooter"},94193:function(e,s,t){"use strict";t.d(s,{_:function(){return x}});var n=t(72253),r=t(47702),a=t(85893),c=t(67294),i=t(49102),l=t(12003),d=t(40108),o=(0,l.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),x=c.forwardRef(function(e,s){var t=e.className,c=(0,r._)(e,["className"]);return(0,a.jsx)(i.f,(0,n._)({ref:s,className:(0,d.cn)(o(),t)},c))});x.displayName=i.f.displayName},21338:function(e,s,t){"use strict";var n=t(91309),r=t(85893),a=t(67294),c=t(88504),i=t(93778),l=t(74089),d=t(42083);s.Z=function(e){var s=e.currentRound,t=e.roundType,o=e.showCountdown,x=(0,c.O)().data,u=(0,a.useContext)(i.M),m=u?u.token:void 0,h=!x||!m||void 0===m.voteOriginBlocks,f=(0,n._)((0,a.useState)(BigInt(0)),2),j=f[0],g=f[1],v=Number("30126")||0,y=Number("2868")||0,N=m?Number(m.voteOriginBlocks):0,p=v-(Number(x)-N)%v,b=p>0?Math.ceil(p*y/1e3):0,w=(0,n._)((0,a.useState)(b),2),I=w[0],k=w[1];(0,a.useEffect)(function(){if(x){var e=v-(Number(x)-N)%v;k(e>0?Math.ceil(e*y/1e3):0)}},[x,v,y,N]),(0,a.useEffect)(function(){s>BigInt(0)&&g(s)},[s]);var B=null!=j?j.toString():"0";return j<=BigInt(0)?(0,r.jsx)(r.Fragment,{}):h||null==j||j<BigInt(0)?((null==j||j<BigInt(0))&&(console.log("currentTokenRound",j),console.log("currentRound",s)),(0,r.jsx)(d.Z,{})):(0,r.jsx)("div",{className:"flex items-center mb-3",children:(0,r.jsxs)("span",{className:"text-sm text-greyscale-400",children:["(第",(0,r.jsx)("span",{className:"text-greyscale-400",children:B}),"轮","vote"===t?"投票":"verify"===t?"验证":"行动","阶段，",(0,r.jsx)("span",{className:"text-greyscale-400",children:"剩余"}),(0,r.jsx)("span",{className:"text-greyscale-400",children:Math.ceil(1e3*I/y)}),(0,r.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),void 0===o||o?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(l.Z,{initialTimeLeft:b,onTick:k})}):(0,r.jsx)("span",{className:"text-greyscale-400",children:I<60?"".concat(I,"秒"):I<=300?"".concat(Math.floor(I/60),"分钟").concat(I%60,"秒"):I<3600?"".concat(Math.floor(I/60),"分钟"):"".concat(Math.floor(I/3600),"小时").concat(Math.floor(I%3600/60),"分钟")}),(0,r.jsx)("span",{className:"text-greyscale-400",children:")"})]})})}},31084:function(e,s,t){"use strict";var n=t(85893);t(67294);var r=t(45655);s.Z=function(e){var s=e.text,t=e.className,a=e.maxLength,c=e.showWarning,i=e.preserveLineBreaks;if(!s)return null;var l=s;a&&s.length>a&&(l=s.substring(0,a)+"...");var d=(0,r.KL)(l,void 0!==i&&i),o=s!==l||/<[^>]*>/g.test(s)||/script|javascript|onclick|onerror|onload/gi.test(s);return(0,n.jsxs)("span",{className:void 0===t?"":t,children:[(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:d}}),void 0!==c&&c&&o&&(0,n.jsx)("span",{className:"text-yellow-500 text-xs ml-1",children:"⚠️ 内容已被安全过滤"})]})}},92429:function(e,s,t){"use strict";t.d(s,{hq:function(){return j},Hw:function(){return g}});var n=t(48564),r=t(2267),a=t(75766),c=t(45775),i=t(60480),l=t(13550),d=t.n(l),o=function(e,s){for(var t=e;t.length<2*s;)t="0"+t;return t},x=function(e){return(e=(e=e.toUpperCase()).substr(4)+e.substr(0,4)).split("").map(function(e){var s=e.charCodeAt(0);return s>=65&&s<=90?(s-65+10).toString():e}).join("")},u=function(e){for(var s,t=e;t.length>2;)t=(parseInt(s=t.slice(0,9),10)%97).toString()+t.slice(s.length);return parseInt(t,10)%97},m=function(){function e(s){(0,n._)(this,e),(0,a._)(this,"_iban",void 0),this._iban=s}return(0,r._)(e,[{key:"isValid",value:function(){return/^TH[0-9]{2}(ETH[0-9A-Z]{13}|[0-9A-Z]{30,31})$/.test(this._iban)&&1===u(x(this._iban))}},{key:"isDirect",value:function(){return 34===this._iban.length||35===this._iban.length}},{key:"isIndirect",value:function(){return 20===this._iban.length}},{key:"checksum",value:function(){return this._iban.substr(2,2)}},{key:"toAddress",value:function(){if(this.isDirect()){var e=this._iban.substr(4),s=new(d())(e,36);return(0,c.K)("0x".concat(s.toString(16).padStart(40,"0")))}return""}},{key:"toString",value:function(){return this._iban}}],[{key:"fromAddress",value:function(s){if(!(0,i.U)(s))throw Error("Provided address is not a valid address: "+s);var t=s.replace("0x","").replace("0X",""),n=o(new(d())(t,16).toString(36),15);return e.fromBban(n.toUpperCase())}},{key:"fromBban",value:function(s){return new e("TH"+("0"+(98-u(x("TH00"+s)))).slice(-2)+s)}},{key:"toIban",value:function(s){return e.fromAddress(s).toString()}},{key:"toAddress",value:function(s){var t=new e(s);if(!t.isDirect())throw Error("IBAN is indirect and can't be converted");return t.toAddress()}},{key:"isValid",value:function(s){return new e(s).isValid()}}]),e}();function h(e){return/^0[Xx][A-Fa-f0-9]{40}$/.test(e)}function f(e){try{return m.isValid(e)}catch(e){return!1}}function j(e){if(!e||""===e)return"";var s=e.trim();return h(s)?s.toLowerCase():f(s)?function(e){if(!e||""===e)return"";if("TH48000000000000000000000000001EKI"===e)return"0x0000000000000000000000000000000000010002";try{return m.toAddress(e).toLowerCase()}catch(e){return console.error("转换TH地址为0x失败:",e),""}}(s):""}function g(e){if(!e||""===e.trim())return"请输入收款地址";var s=e.trim();return h(s)||f(s)&&j(s)?null:"请输入有效的地址格式（支持 0x、XE 或 TH 格式）"}},46513:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return $}});var n=t(72253),r=t(91309),a=t(85893),c=t(67294),i=t(11163),l=t(42130),d=t(93778),o=t(36893),x=t(11418),u=t(27460),m=t(26858),h=t(72107),f=t(31084),j=t(93566),g=t(20442),v=t(31134),y=(0,v.Z)("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),N=t(35810);function p(e){var s=e.actionInfo,t=e.currentRound,n=((0,c.useContext)(d.M)||{}).token,i=(0,r._)((0,c.useState)(!1),2),l=i[0],o=i[1],x=(0,j.sK)((null==n?void 0:n.address)||"0x0000000000000000000000000000000000000000",t||BigInt(0),s.head.id),v=x.submitInfo,p=x.isPending,b=(0,g.PL)((null==n?void 0:n.address)||"0x0000000000000000000000000000000000000000",s.head.id),w=b.joinedAmountByActionId,I=b.isPending;if(!n)return(0,a.jsx)("div",{children:"Token信息加载中..."});var k=w||BigInt(0),B=s.body.maxRandomAccounts,_=B>BigInt(0)?k/B:BigInt(0);return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between md:max-w-xs",children:[(0,a.jsx)("span",{className:"font-bold",children:"最小参与代币数:"}),(0,a.jsx)("span",{className:"font-mono text-secondary",children:(0,m.LH)(s.body.minStake)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between md:max-w-xs",children:[(0,a.jsx)("span",{className:"font-bold",children:"最大激励地址数:"}),(0,a.jsx)("span",{className:"font-mono text-secondary",children:s.body.maxRandomAccounts.toString()})]})]}),(0,a.jsx)("div",{className:"mt-1 text-sm md:text-base text-gray-700 bg-gray-50 p-1 md:p-4 rounded-md md:rounded-lg w-full",children:(0,a.jsxs)("div",{className:"flex items-start gap-1 md:gap-3",children:[(0,a.jsx)(y,{className:"w-4 h-4 md:w-5 md:h-5 text-amber-500 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{children:["“实际”激励地址数可能小于最大激励地址数。",(0,a.jsxs)(N.Vq,{open:l,onOpenChange:o,children:[(0,a.jsx)(N.hg,{asChild:!0,children:(0,a.jsx)("button",{className:"text-blue-600 hover:text-blue-800 underline ml-1",children:"详情算法>>"})}),(0,a.jsxs)(N.cZ,{className:"w-[calc(100%-2rem)] max-w-2xl max-h-[80vh] overflow-y-auto sm:w-full",children:[(0,a.jsx)(N.fK,{className:"text-center",children:(0,a.jsx)(N.$N,{className:"text-center",children:"激励地址说明"})}),(0,a.jsxs)("div",{className:"space-y-4 text-base",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"font-bold text-gray-900",children:"随机抽取地址算法："}),(0,a.jsxs)("p",{className:"text-gray-700",children:["每轮验证阶段，会从所有参与行动的代币（例如当前行动为"," ",I?(0,a.jsx)("span",{className:"text-gray-400",children:"加载中..."}):(0,a.jsx)("span",{className:"font-mono font-semibold text-blue-600",children:(0,m.LH)(k)})," ",'个）中，随机选中"最大激励地址数"个（例如当前行动目前为'," ",(0,a.jsx)("span",{className:"font-mono font-semibold text-blue-600",children:B.toString()})," ","个）代币，返回对应地址。若多份代币对应相同地址，则会合并为一个地址。"]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"font-bold text-gray-900",children:"想要100%被抽中的代币数："}),(0,a.jsxs)("p",{className:"text-gray-700",children:["计算公式：总参与代币数 / 最大激励地址数。比如，当前行动目前想要 100%概率被抽中的代币数为"," ",I?(0,a.jsx)("span",{className:"text-gray-400",children:"加载中..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"font-mono font-semibold text-blue-600",children:(0,m.LH)(k)})," / ",(0,a.jsx)("span",{className:"font-mono font-semibold text-blue-600",children:B.toString()})," = ",(0,a.jsx)("span",{className:"font-mono font-semibold text-green-600",children:(0,m.LH)(_,4,"ceil")})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,a.jsx)("h3",{className:"font-bold text-gray-900",children:"如何铸造激励："}),(0,a.jsx)("p",{className:"text-gray-700",children:"被抽中的地址，经社群验证后，会获得行动铸币激励资格。可以点击“我的”=> “我参与的行动”=> “铸造行动激励”进行铸造。"})]})]})]})]})]})]})})]}),s.body.verificationRule&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("div",{className:"font-bold mb-2",children:"验证规则:"}),(0,a.jsx)("div",{className:"leading-loose bg-gray-50 p-2 rounded-md",children:(0,a.jsx)(h.L,{text:s.body.verificationRule,preserveLineBreaks:!0})})]}),s.body.verificationKeys&&s.body.verificationKeys.length>0&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("div",{className:"font-bold mb-2",children:"报名参加行动时，行动者要提供的信息:"}),(0,a.jsx)("ul",{className:"list-disc pl-5",children:s.body.verificationKeys.map(function(e,t){var n;return(0,a.jsxs)("li",{className:"text-gray-700",children:[(0,a.jsxs)("div",{className:"text-sm font-bold text-greyscale-900",children:[(0,a.jsx)(f.Z,{text:e,showWarning:!0})," :"]}),(0,a.jsx)("div",{children:(0,a.jsx)(f.Z,{text:null===(n=s.body.verificationInfoGuides)||void 0===n?void 0:n[t],showWarning:!0,preserveLineBreaks:!0})})]},t)})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4 md:max-w-md",children:[(0,a.jsx)("span",{className:"font-bold",children:"白名单:"}),(0,a.jsx)("div",{children:"0x0000000000000000000000000000000000000000"===s.body.whiteListAddress?(0,a.jsx)("span",{className:"text-gray-400 text-sm",children:"无限制"}):(0,a.jsx)(u.Z,{address:s.body.whiteListAddress,showCopyButton:!0,colorClassName:"text-sm"})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4 md:max-w-md",children:[(0,a.jsx)("span",{className:"font-bold",children:"创建人:"}),(0,a.jsx)(u.Z,{address:s.head.author,showCopyButton:!0,colorClassName:"text-sm"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4 md:max-w-md",children:[(0,a.jsx)("span",{className:"font-bold",children:"推举人:"}),(0,a.jsx)("div",{children:p?(0,a.jsx)("span",{className:"text-gray-400 text-sm",children:"加载中..."}):(null==v?void 0:v.submitter)&&"0x0000000000000000000000000000000000000000"!==v.submitter?(0,a.jsx)(u.Z,{address:v.submitter,showCopyButton:!0,colorClassName:"text-sm"}):(0,a.jsx)("span",{className:"text-gray-400 text-sm",children:"当前行动轮未被推举"})})]})]})}var b=t(4586),w=t(41664),I=t.n(w),k=t(93950),B=t(90963),_=t(64777),C=t(42083);function Z(e){var s=e.actionId,t=e.currentRound,l=(0,i.useRouter)(),o=((0,c.useContext)(d.M)||{}).token,x=(0,r._)((0,c.useState)(t||BigInt(1)),2),h=x[0],f=x[1],j=l.query.round;(0,c.useEffect)(function(){j&&!isNaN(Number(j))?f(BigInt(j)):t&&f(t+BigInt(1))},[j,t]);var g=(0,k.pA)((null==o?void 0:o.address)||"0x0000000000000000000000000000000000000000",h,s),v=g.actionVoters,y=g.isPending,N=g.error;if(!o)return(0,a.jsx)("div",{children:"Token信息加载中..."});var p=(null==v?void 0:v.reduce(function(e,s){return e+s.voteCount},BigInt(0)))||BigInt(0),w=v?(0,b._)(v).sort(function(e,s){return e.voteCount>s.voteCount?-1:e.voteCount<s.voteCount?1:0}):[];return(0,a.jsxs)("div",{className:"relative pb-4",children:[h===BigInt(0)&&(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-500",children:"暂无投票数据"})}),(0,a.jsx)("div",{className:"flex items-center",children:h>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_.Z,{title:"第 ".concat(h.toString()," 轮投票详情")}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"("}),(0,a.jsx)(B.Z,{currentRound:t?(0,m.cK)(t+BigInt(1),o):BigInt(0),handleChangedRound:function(e){var s=BigInt(e);f(s);var t=(0,n._)({},l.query);t.round=s.toString(),l.push({pathname:l.pathname,query:t},void 0,{shallow:!0})}}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500",children:")"})]})}),h>0&&v&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-0 mt-4 mb-4",children:[(0,a.jsxs)("div",{className:"",children:[(0,a.jsx)("span",{className:"text-gray-500 mr-3",children:"投票地址数:"}),(0,a.jsx)("span",{className:"font-mono text-secondary",children:v.length})]}),(0,a.jsxs)("div",{className:"",children:[(0,a.jsx)("span",{className:"text-gray-500 mr-3",children:"票数:"}),(0,a.jsx)("span",{className:"font-mono text-secondary",children:(0,m.LH)(p)})]})]}),y&&(0,a.jsx)("div",{className:"flex justify-center py-8",children:(0,a.jsx)(C.Z,{})}),N&&(0,a.jsxs)("div",{className:"alert alert-error",children:[(0,a.jsx)("svg",{className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsxs)("span",{children:["加载投票数据失败: ",N.message]})]}),!y&&!N&&v&&h>0&&(0===w.length?(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"该轮次暂无投票记录"}):(0,a.jsxs)("table",{className:"table w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,a.jsx)("th",{className:"px-1 text-left",children:"排名"}),(0,a.jsx)("th",{className:"px-1 text-left",children:"投票地址"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"投票数"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"占比"})]})}),(0,a.jsx)("tbody",{children:w.map(function(e,s){var t;return(0,a.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,a.jsx)("td",{className:"px-1 text-greyscale-400",children:s+1}),(0,a.jsx)("td",{className:"px-1",children:(0,a.jsx)(I(),{href:"/vote/my_history?account=".concat(e.account),children:(0,a.jsxs)("div",{className:"inline-flex items-center bg-gray-50 hover:bg-gray-100 rounded-md px-2 py-1 transition-colors duration-150 active:bg-gray-200",children:[(0,a.jsx)(u.Z,{address:e.account,showCopyButton:!0}),(0,a.jsx)("svg",{className:"h-3 w-3 text-gray-400 ml-2 opacity-60 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})}),(0,a.jsx)("td",{className:"px-1 text-right font-mono text-secondary",children:(0,m.LH)(e.voteCount)}),(0,a.jsxs)("td",{className:"px-1 text-right text-greyscale-500",children:[(t=e.voteCount,p===BigInt(0)?"0.00":(Number(t)/Number(p)*100).toFixed(2)),"%"]})]},e.account)})})]}))]})}var S=t(14932),R=t(42171),A=t(4307),L=t(44746),E=t(59271),T=t(7080),M=t(73591),H=t(21338),P=function(e){var s=e.currentRound,t=e.actionId,o=e.actionInfo,x=(0,i.useRouter)(),f=((0,c.useContext)(d.M)||{}).token,j=(0,l.m)().address,g=(0,r._)((0,c.useState)(new Set),2),v=g[0],y=g[1],N=(0,E.LW)(null==f?void 0:f.address,s,t,"0x0000000000000000000000000000000000000000"),p=N.scoreByActionIdByAccount,b=N.isPending,w=N.error,I=(0,k.pK)(null==f?void 0:f.address,s,t),B=I.verifiedAddresses,Z=I.isPending,P=I.error,q=(0,k.X5)(null==f?void 0:f.address,s,t),K=q.verificationInfos,D=q.isPending,F=q.error,V=(0,T.wD)(null==f?void 0:f.address,s,t),O=V.votesNumByActionId,Y=(V.isPending,V.error),z=(0,M.S)().handleContractError;(0,c.useEffect)(function(){P&&z(P,"dataViewer"),F&&z(F,"dataViewer"),w&&z(w,"verify"),Y&&z(Y,"vote")},[P,F,w,Y]);var W=function(e){var s=new Set(v);s.has(e)?s.delete(e):s.add(e),y(s)},X=((null==B?void 0:B.reduce(function(e,s){return e+s.score},BigInt(0)))||BigInt(0))+(p||BigInt(0)),J=Number(X)/Number(O||BigInt(0))*100;return(0,a.jsxs)("div",{className:"relative pb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(_.Z,{title:"第 ".concat(s," 轮验证")}),J>0&&(0,a.jsxs)("span",{className:"text-sm text-greyscale-500 ml-2",children:["(当前进度：",(0,m.rl)(J),")"]})]}),(null==K?void 0:K.length)>0&&(0,a.jsx)("button",{onClick:function(){return x.push("/action/verify_detail?symbol=".concat(null==f?void 0:f.symbol,"&id=").concat(t,"&round=").concat(s))},className:"text-sm text-secondary hover:text-secondary-600 ",children:"查看明细 >>"})]}),(0,a.jsx)("div",{className:"flex justify-left mt-2",children:(0,a.jsx)(H.Z,{currentRound:s,roundType:"verify"})}),D||Z||b?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)(C.Z,{})}):K&&0!==K.length?(0,a.jsxs)("table",{className:"table w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,a.jsx)("th",{}),(0,a.jsx)("th",{children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:["被抽中地址",(0,a.jsx)(L.Z,{title:"最大激励地址数说明",content:(0,a.jsxs)("p",{className:"leading-relaxed text-base",children:["每轮从所有参与行动的代币中，随机抽取",(0,a.jsx)("span",{className:"font-mono font-bold text-blue-600 mx-1 text-base",children:null==o?void 0:o.body.maxRandomAccounts.toString()}),"份代币，返回对应地址。若多份代币对应相同地址，则会合并为一个地址。"]})})]})}),(0,a.jsx)("th",{className:"px-1 text-right",children:"获得验证票"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"验证票占比"})]})}),(0,a.jsxs)("tbody",{children:[K.map(function(e){var s=null==B?void 0:B.find(function(s){return s.account===e.account});return(0,S._)((0,n._)({},e),{score:(null==s?void 0:s.score)||BigInt(0)})}).sort(function(e,s){return e.score>s.score?-1:e.score<s.score?1:0}).map(function(e){var s=null==B?void 0:B.find(function(s){return s.account===e.account}),t=v.has(e.account);return(0,a.jsxs)(c.Fragment,{children:[(0,a.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===j?"text-secondary":""),children:[(0,a.jsx)("td",{className:"px-1 w-8",children:(0,a.jsx)("button",{onClick:function(){return W(e.account)},className:"text-greyscale-400 hover:text-greyscale-600",children:t?(0,a.jsx)(R.Z,{size:16}):(0,a.jsx)(A.Z,{size:16})})}),(0,a.jsx)("td",{className:"px-1",children:(0,a.jsx)(u.Z,{address:e.account,showCopyButton:!0,word:e.account===j?"(我)":""})}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.tY)((null==s?void 0:s.score)||BigInt(0))}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.rl)(Number((null==s?void 0:s.score)||BigInt(0))/Number(X||BigInt(0))*100)})]}),o&&t&&(0,a.jsxs)("tr",{className:"border-b border-gray-100 bg-gray-50",children:[(0,a.jsx)("td",{}),(0,a.jsx)("td",{colSpan:3,className:"px-1 py-3",children:(0,a.jsxs)("div",{className:"text-sm text-greyscale-600",children:[(0,a.jsx)("div",{className:"text-xs text-greyscale-400 mb-2",children:"验证信息:"}),o.body.verificationKeys.map(function(s,t){return(0,a.jsxs)("div",{className:"mb-1",children:[(0,a.jsxs)("span",{className:"text-greyscale-500",children:[s,":"]})," ",(0,a.jsx)(h.L,{text:e.infos[t]})]},t)})]})})]})]},e.account)}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-1"}),(0,a.jsx)("td",{className:"px-1 text-greyscale-500",children:"弃权票"}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.tY)(p||BigInt(0))}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.rl)(Number(p||BigInt(0))/Number(X||BigInt(0))*100)})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-1"}),(0,a.jsx)("td",{className:"px-1 text-greyscale-500",children:"汇总 "}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.tY)(X||BigInt(0))}),(0,a.jsx)("td",{className:"px-1 text-right",children:"100%"})]})]})]}):(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有验证地址"})]})},q=function(e){var s=e.currentJoinRound,t=e.actionId,o=e.actionInfo,x=(0,i.useRouter)(),f=((0,c.useContext)(d.M)||{}).token,j=(0,l.m)().address,g=(0,r._)((0,c.useState)(BigInt(0)),2),v=g[0],y=g[1],N=(0,r._)((0,c.useState)(new Set),2),p=N[0],w=N[1],I=x.query.round;(0,c.useEffect)(function(){I&&!isNaN(Number(I))?y(BigInt(I)):f&&s-BigInt(f.initialStakeRound)>=BigInt(2)&&y(s-BigInt(2))},[I,s,f]);var Z=(0,k.pK)(null==f?void 0:f.address,f&&v?v:BigInt(0),t),S=Z.verifiedAddresses,L=Z.isPending,E=Z.error,T=(0,k.X5)(null==f?void 0:f.address,f&&v?v:BigInt(0),t),H=T.verificationInfos,P=T.isPending,q=T.error,K=(0,r._)((0,c.useState)([]),2),D=K[0],F=K[1];(0,c.useEffect)(function(){S&&F(S)},[S]);var V=(0,M.S)().handleContractError;(0,c.useEffect)(function(){E&&V(E,"dataViewer"),q&&V(q,"dataViewer")},[E,q]),(0,c.useEffect)(function(){D.length>0&&0===p.size&&w(new Set([(0,b._)(D).sort(function(e,s){return e.score>s.score?-1:e.score<s.score?1:0})[0].account]))},[D]);var O=(0,b._)(D).sort(function(e,s){return e.score>s.score?-1:e.score<s.score?1:0}),Y=function(e){var s=new Set(p);s.has(e)?s.delete(e):s.add(e),w(s)};return(0,a.jsxs)("div",{className:"relative ",children:[v===BigInt(0)&&(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-500",children:"暂无验证结果"})}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center",children:v>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_.Z,{title:"第 ".concat(v.toString()," 轮验证结果")}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"("}),(0,a.jsx)(B.Z,{currentRound:f&&s?(0,m.cK)(s-BigInt(2),f):BigInt(0),handleChangedRound:function(e){var s=BigInt(e);y(s);var t=(0,n._)({},x.query);t.round=s.toString(),x.push({pathname:x.pathname,query:t},void 0,{shallow:!0})}}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500",children:")"})]})}),v>0&&D.length>0&&(0,a.jsx)("button",{onClick:function(){return x.push("/action/verify_detail?symbol=".concat(null==f?void 0:f.symbol,"&id=").concat(t,"&round=").concat(v))},className:"text-sm text-secondary hover:text-secondary-600 transition-colors",children:"查看明细 >>"})]}),L||P?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)(C.Z,{})}):0===D.length?v>BigInt(0)&&(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有验证地址"}):(0,a.jsxs)("table",{className:"table w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,a.jsx)("th",{}),(0,a.jsx)("th",{children:"被抽中地址"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"获得验证票"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"可铸造激励"})]})}),(0,a.jsx)("tbody",{children:O.map(function(e){var s=null==H?void 0:H.find(function(s){return s.account===e.account}),t=p.has(e.account);return(0,a.jsxs)(c.Fragment,{children:[(0,a.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===j?"text-secondary":""),children:[(0,a.jsx)("td",{className:"px-1 w-8",children:s&&(0,a.jsx)("button",{onClick:function(){return Y(e.account)},className:"text-greyscale-400 hover:text-greyscale-600",children:t?(0,a.jsx)(R.Z,{size:16}):(0,a.jsx)(A.Z,{size:16})})}),(0,a.jsx)("td",{className:"px-1 ",children:(0,a.jsx)(u.Z,{address:e.account,showCopyButton:!0,word:e.account===j?"(我)":""})}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.tY)(e.score)}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.tY)(e.reward||BigInt(0))})]}),s&&o&&t&&(0,a.jsxs)("tr",{className:"border-b border-gray-100 bg-gray-50",children:[(0,a.jsx)("td",{}),(0,a.jsx)("td",{colSpan:3,className:"px-1 py-3",children:(0,a.jsxs)("div",{className:"text-sm text-greyscale-600",children:[(0,a.jsx)("div",{className:"text-xs text-greyscale-400 mb-2",children:"验证信息:"}),o.body.verificationKeys.map(function(e,t){return(0,a.jsxs)("div",{className:"mb-1",children:[(0,a.jsxs)("span",{className:"text-greyscale-500",children:[e,":"]})," ",(0,a.jsx)(h.L,{text:s.infos[t]})]},t)})]})})]})]},e.account)})})]})]})},K=function(e){var s=e.actionId,t=e.currentRound,l=e.actionInfo,d=(0,i.useRouter)(),o=(0,r._)((0,c.useState)("current"),2),x=o[0],u=o[1],m=d.query.tab2;(0,c.useEffect)(function(){m&&["current","history"].includes(m)&&u(m)},[m]);var h=function(e){u(e);var s=(0,n._)({},d.query);s.tab2=e,d.push({pathname:d.pathname,query:s},void 0,{shallow:!0})};return(0,a.jsxs)("div",{className:"bg-white rounded-lg",children:[(0,a.jsx)("div",{className:"flex bg-muted rounded-lg p-1 mb-4 mx-16",children:[{key:"current",label:"当前验证"},{key:"history",label:"历史验证"}].map(function(e){return(0,a.jsx)("button",{onClick:function(){return h(e.key)},className:"flex-1 px-2 py-1 text-sm font-medium rounded-md transition-all duration-200 ".concat(x===e.key?"bg-white text-secondary shadow-sm":"text-gray-500 hover:text-gray-800 hover:bg-gray-50"),children:e.label},e.key)})}),function(){switch(x){case"current":return(0,a.jsx)(P,{actionId:s,currentRound:t&&t>BigInt(0)?t-BigInt(1):BigInt(0),actionInfo:l});case"history":return(0,a.jsx)(q,{currentJoinRound:t,actionId:s,actionInfo:l});default:return null}}()]})},D=t(34680),F=t(21774),V=t(27245),O=t(94193),Y=(0,v.Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),z=t(68655),W=t(92429),X=t(17301);function J(e){var s=e.actionId,t=((0,c.useContext)(d.M)||{}).token,n=(0,r._)((0,c.useState)(""),2),i=n[0],l=n[1],o=(0,r._)((0,c.useState)(null),2),x=o[0],u=o[1],h=(0,r._)((0,c.useState)(null),2),f=h[0],j=h[1],v=(0,g.X9)(null==t?void 0:t.address,s,x),y=v.joinedAmountByActionIdByAccount,N=v.isPending,p=v.error,b=function(e){l(e),j((0,W.Hw)(e))},w=function(){if(i.trim()){var e=(0,W.hq)(i);if(!e){j("请输入有效的地址格式（支持 0x 或 TH 格式）");return}u(e),j(null)}},I=!f;return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(D.Zb,{className:"border-0 md:border shadow-none md:shadow-sm",children:[(0,a.jsx)(D.Ol,{children:(0,a.jsxs)(D.ll,{className:"flex items-center gap-2 text-lg",children:[(0,a.jsx)(Y,{className:"h-5 w-5"}),"查询地址参与情况"]})}),(0,a.jsxs)(D.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F.I,{id:"address",placeholder:"请输入要查询的钱包地址 (支持 0x 或 TH 格式)",value:i,onChange:function(e){return b(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&w()},className:f?"border-red-500":""}),f&&(0,a.jsxs)("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[(0,a.jsx)(z.Z,{className:"h-4 w-4"}),f]})]}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(V.z,{onClick:w,disabled:!i.trim()||!I||!!x&&N,className:"px-8",children:x&&N?(0,a.jsx)(C.Z,{}):"查询"})})]})]}),x&&(0,a.jsxs)(D.Zb,{className:"border-0 md:border shadow-none md:shadow-sm",children:[(0,a.jsx)(D.Ol,{children:(0,a.jsx)(D.ll,{className:"text-lg",children:"查询结果"})}),(0,a.jsx)(D.aY,{children:N?(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)(C.Z,{}),(0,a.jsx)("span",{className:"ml-2",children:"查询中..."})]}):p?(0,a.jsx)(X.Z,{type:"error",message:"查询失败：".concat(p.message)}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O._,{className:"text-sm text-gray-600",children:"查询地址"}),(0,a.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg",children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("code",{className:"text-sm font-mono break-all",children:x}),i!==x&&(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["原始输入：",i]})]})})]}),void 0!==y&&y>BigInt(0)?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O._,{className:"text-sm text-gray-600",children:"参与代币数量"}),(0,a.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg",children:(0,a.jsxs)("div",{className:"text-lg font-semibold",children:[(0,m.LH)(y)," ",(null==t?void 0:t.symbol)||""]})})]}):(0,a.jsxs)("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-yellow-800",children:[(0,a.jsx)(z.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:"font-medium",children:"该地址未参与此行动"})]}),(0,a.jsx)("p",{className:"text-sm text-yellow-700 mt-1",children:"参与代币数量为 0"})]})]})})]}),(0,a.jsxs)(D.Zb,{className:"border-0 md:border shadow-none md:shadow-sm",children:[(0,a.jsx)(D.Ol,{children:(0,a.jsx)(D.ll,{className:"text-base",children:"使用说明"})}),(0,a.jsxs)(D.aY,{className:"text-sm text-gray-600 space-y-2",children:[(0,a.jsx)("p",{children:"• 支持两种地址格式：0x 开头的以太坊地址 或 TH 开头的 TKM 地址"}),(0,a.jsx)("p",{children:"• 查询结果显示该地址参与此行动质押的代币总数量"}),(0,a.jsx)("p",{children:"• 如果显示 0，表示该地址未参与此行动"})]})]})]})}var U=t(83494);function $(){var e=(0,i.useRouter)(),s=(0,l.m)().address,t=((0,c.useContext)(d.M)||{}).token,u=(0,r._)((0,c.useState)("basic"),2),m=u[0],h=u[1],f=e.query,j=f.symbol,g=f.id,v=f.tab,y=g?BigInt(g):void 0,N=(0,o.r)({tokenAddress:null==t?void 0:t.address,actionId:y,account:s}),b=N.actionInfo,w=N.participantCount,I=N.totalAmount,k=N.userJoinedAmount,B=N.isJoined,_=N.currentRound,S=N.isPending,R=N.error;if((0,c.useEffect)(function(){v&&["basic","vote","verify","join"].includes(v)&&h(v)},[v]),(0,c.useEffect)(function(){j&&t&&j!==t.symbol&&e.push("/tokens")},[j,t,e]),!t)return(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(C.Z,{}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"加载Token信息中..."})]})});if(void 0==y)return(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsx)(X.Z,{type:"error",message:"参数错误：缺少行动ID参数"})});var A=function(s){h(s);var t=(0,n._)({},e.query);t.tab=s,e.push({pathname:e.pathname,query:t},void 0,{shallow:!0})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(U.Z,{title:"行动详情",showBackButton:!0}),(0,a.jsx)("main",{className:"flex-grow",children:(0,a.jsxs)("div",{className:"px-4 pt-0 pb-3",children:[b&&(0,a.jsx)(x.Z,{actionInfo:b,participantCount:w,totalAmount:I,isJoined:B,userJoinedAmount:k,isPending:S}),(0,a.jsx)("div",{className:"flex border-b border-gray-200 mb-4",children:[{key:"basic",label:"行动详情"},{key:"vote",label:"投票公示"},{key:"join",label:"参与公示"},{key:"verify",label:"验证公示"}].map(function(e){return(0,a.jsx)("button",{onClick:function(){return A(e.key)},className:"flex-1 px-2 py-2 text-sm font-medium border-b-2 transition-colors ".concat(m===e.key?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700"),children:e.label},e.key)})}),function(){if(S)return(0,a.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(C.Z,{}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"加载数据中..."})]})});if(R)return(0,a.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,a.jsx)(X.Z,{type:"error",message:"加载失败：".concat(R.message||"获取行动信息失败，请稍后重试")})});if(!b)return(0,a.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,a.jsx)(X.Z,{type:"warning",message:"行动不存在：找不到指定的行动信息"})});switch(m){case"basic":return(0,a.jsx)(p,{actionInfo:b,currentRound:_});case"join":return(0,a.jsx)(J,{actionId:y});case"vote":return(0,a.jsx)(Z,{actionId:y,currentRound:_});case"verify":return(0,a.jsx)(K,{actionId:y,currentRound:_||BigInt(0),actionInfo:b});default:return null}}()]})})]})}},49102:function(e,s,t){"use strict";t.d(s,{f:function(){return i}});var n=t(67294),r=t(75320),a=t(85893),c=n.forwardRef((e,s)=>(0,a.jsx)(r.WV.label,{...e,ref:s,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(e.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));c.displayName="Label";var i=c}},function(e){e.O(0,[8501,4463,1390,3494,3591,3950,7724,7285,9271,1489,1462,2888,9774,179],function(){return e(e.s=8286)}),_N_E=e.O()}]);