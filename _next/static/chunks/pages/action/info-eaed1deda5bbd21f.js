try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="21c61234-5c7a-4749-a378-8a28a700841f",e._sentryDebugIdIdentifier="sentry-dbid-21c61234-5c7a-4749-a378-8a28a700841f")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9822],{8286:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/action/info",function(){return s(48057)}])},34680:function(e,t,s){"use strict";s.d(t,{Ol:function(){return o},SZ:function(){return u},Zb:function(){return d},aY:function(){return x},eW:function(){return m},ll:function(){return l}});var n=s(72253),r=s(47702),a=s(85893),i=s(67294),c=s(40108),d=i.forwardRef(function(e,t){var s=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:t,className:(0,c.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s)},i))});d.displayName="Card";var o=i.forwardRef(function(e,t){var s=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:t,className:(0,c.cn)("flex flex-col space-y-1.5 p-6",s)},i))});o.displayName="CardHeader";var l=i.forwardRef(function(e,t){var s=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:t,className:(0,c.cn)("text-2xl font-semibold leading-none tracking-tight",s)},i))});l.displayName="CardTitle";var u=i.forwardRef(function(e,t){var s=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:t,className:(0,c.cn)("text-sm text-muted-foreground",s)},i))});u.displayName="CardDescription";var x=i.forwardRef(function(e,t){var s=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:t,className:(0,c.cn)("p-6 pt-0",s)},i))});x.displayName="CardContent";var m=i.forwardRef(function(e,t){var s=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:t,className:(0,c.cn)("flex items-center p-6 pt-0",s)},i))});m.displayName="CardFooter"},88659:function(e,t,s){"use strict";s.d(t,{Bw:function(){return j},Ph:function(){return m},Ql:function(){return v},i4:function(){return g},ki:function(){return h}});var n=s(72253),r=s(14932),a=s(47702),i=s(85893),c=s(67294),d=s(76405),o=s(42171),l=s(15432),u=s(78865),x=s(40108),m=d.fC;d.ZA;var h=d.B4,g=c.forwardRef(function(e,t){var s=e.className,c=e.children,l=(0,a._)(e,["className","children"]);return(0,i.jsxs)(d.xz,(0,r._)((0,n._)({ref:t,className:(0,x.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s)},l),{children:[c,(0,i.jsx)(d.JO,{asChild:!0,children:(0,i.jsx)(o.Z,{className:"h-4 w-4 opacity-50"})})]}))});g.displayName=d.xz.displayName;var f=c.forwardRef(function(e,t){var s=e.className,c=(0,a._)(e,["className"]);return(0,i.jsx)(d.u_,(0,r._)((0,n._)({ref:t,className:(0,x.cn)("flex cursor-default items-center justify-center py-1",s)},c),{children:(0,i.jsx)(l.Z,{className:"h-4 w-4"})}))});f.displayName=d.u_.displayName;var p=c.forwardRef(function(e,t){var s=e.className,c=(0,a._)(e,["className"]);return(0,i.jsx)(d.$G,(0,r._)((0,n._)({ref:t,className:(0,x.cn)("flex cursor-default items-center justify-center py-1",s)},c),{children:(0,i.jsx)(o.Z,{className:"h-4 w-4"})}))});p.displayName=d.$G.displayName;var j=c.forwardRef(function(e,t){var s=e.className,c=e.children,o=e.position,l=void 0===o?"popper":o,u=(0,a._)(e,["className","children","position"]);return(0,i.jsx)(d.h_,{children:(0,i.jsxs)(d.VY,(0,r._)((0,n._)({ref:t,className:(0,x.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:l},u),{children:[(0,i.jsx)(f,{}),(0,i.jsx)(d.l_,{className:(0,x.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:c}),(0,i.jsx)(p,{})]}))})});j.displayName=d.VY.displayName,c.forwardRef(function(e,t){var s=e.className,r=(0,a._)(e,["className"]);return(0,i.jsx)(d.__,(0,n._)({ref:t,className:(0,x.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s)},r))}).displayName=d.__.displayName;var v=c.forwardRef(function(e,t){var s=e.className,c=e.children,o=(0,a._)(e,["className","children"]);return(0,i.jsxs)(d.ck,(0,r._)((0,n._)({ref:t,className:(0,x.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s)},o),{children:[(0,i.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,i.jsx)(d.wU,{children:(0,i.jsx)(u.Z,{className:"h-4 w-4"})})}),(0,i.jsx)(d.eT,{children:c})]}))});v.displayName=d.ck.displayName,c.forwardRef(function(e,t){var s=e.className,r=(0,a._)(e,["className"]);return(0,i.jsx)(d.Z0,(0,n._)({ref:t,className:(0,x.cn)("-mx-1 my-1 h-px bg-muted",s)},r))}).displayName=d.Z0.displayName},82022:function(e,t,s){"use strict";s.d(t,{mQ:function(){return S},nU:function(){return L},dr:function(){return M},SP:function(){return P}});var n=s(72253),r=s(47702),a=s(85893),i=s(67294),c=s(36206),d=s(25360),o=s(66681),l=s(29115),u=s(75320),x=s(78990),m=s(77342),h=s(91276),g="Tabs",[f,p]=(0,d.b)(g,[o.Pc]),j=(0,o.Pc)(),[v,N]=f(g),y=i.forwardRef((e,t)=>{let{__scopeTabs:s,value:n,onValueChange:r,defaultValue:i,orientation:c="horizontal",dir:d,activationMode:o="automatic",...l}=e,f=(0,x.gm)(d),[p,j]=(0,m.T)({prop:n,onChange:r,defaultProp:i??"",caller:g});return(0,a.jsx)(v,{scope:s,baseId:(0,h.M)(),value:p,onValueChange:j,orientation:c,dir:f,activationMode:o,children:(0,a.jsx)(u.WV.div,{dir:f,"data-orientation":c,...l,ref:t})})});y.displayName=g;var b="TabsList",I=i.forwardRef((e,t)=>{let{__scopeTabs:s,loop:n=!0,...r}=e,i=N(b,s),c=j(s);return(0,a.jsx)(o.fC,{asChild:!0,...c,orientation:i.orientation,dir:i.dir,loop:n,children:(0,a.jsx)(u.WV.div,{role:"tablist","aria-orientation":i.orientation,...r,ref:t})})});I.displayName=b;var w="TabsTrigger",B=i.forwardRef((e,t)=>{let{__scopeTabs:s,value:n,disabled:r=!1,...i}=e,d=N(w,s),l=j(s),x=k(d.baseId,n),m=C(d.baseId,n),h=n===d.value;return(0,a.jsx)(o.ck,{asChild:!0,...l,focusable:!r,active:h,children:(0,a.jsx)(u.WV.button,{type:"button",role:"tab","aria-selected":h,"aria-controls":m,"data-state":h?"active":"inactive","data-disabled":r?"":void 0,disabled:r,id:x,...i,ref:t,onMouseDown:(0,c.Mj)(e.onMouseDown,e=>{r||0!==e.button||!1!==e.ctrlKey?e.preventDefault():d.onValueChange(n)}),onKeyDown:(0,c.Mj)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&d.onValueChange(n)}),onFocus:(0,c.Mj)(e.onFocus,()=>{let e="manual"!==d.activationMode;h||r||!e||d.onValueChange(n)})})})});B.displayName=w;var A="TabsContent",R=i.forwardRef((e,t)=>{let{__scopeTabs:s,value:n,forceMount:r,children:c,...d}=e,o=N(A,s),x=k(o.baseId,n),m=C(o.baseId,n),h=n===o.value,g=i.useRef(h);return i.useEffect(()=>{let e=requestAnimationFrame(()=>g.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,a.jsx)(l.z,{present:r||h,children:({present:s})=>(0,a.jsx)(u.WV.div,{"data-state":h?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":x,hidden:!s,id:m,tabIndex:0,...d,ref:t,style:{...e.style,animationDuration:g.current?"0s":void 0},children:s&&c})})});function k(e,t){return`${e}-trigger-${t}`}function C(e,t){return`${e}-content-${t}`}R.displayName=A;var _=s(40108),S=y,M=i.forwardRef(function(e,t){var s=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)(I,(0,n._)({ref:t,className:(0,_.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s)},i))});M.displayName=I.displayName;var P=i.forwardRef(function(e,t){var s=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)(B,(0,n._)({ref:t,className:(0,_.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s)},i))});P.displayName=B.displayName;var L=i.forwardRef(function(e,t){var s=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)(R,(0,n._)({ref:t,className:(0,_.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s)},i))});L.displayName=R.displayName},76453:function(e,t,s){"use strict";s.d(t,{g:function(){return d}});var n=s(72253),r=s(47702),a=s(85893),i=s(67294),c=s(40108),d=i.forwardRef(function(e,t){var s=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("textarea",(0,n._)({className:(0,c.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t},i))});d.displayName="Textarea"},11418:function(e,t,s){"use strict";s.d(t,{Z:function(){return g}});var n=s(85893),r=s(67294),a=s(42130),i=s(41664),c=s.n(i),d=s(93778),o=s(91529),l=s(27245),u=s(20442),x=s(72260);function m(e){var t=e.isJoined,s=e.actionId,a=e.isPending,i=((0,r.useContext)(d.M)||{}).token,o=(0,u.Bk)(),m=o.currentRound,h=o.isPending,g=(0,x.Dn)((null==i?void 0:i.address)||"0x0000000000000000000000000000000000000000",m||BigInt(0),s),f=g.isActionIdVoted,p=g.isPending;if(!i)return null;var j="/acting/join?symbol=".concat(i.symbol,"&id=").concat(s),v="/my/myaction?symbol=".concat(i.symbol,"&id=").concat(s),N=!(null==i?void 0:i.address)||h||p||!m,y=!!(null==i?void 0:i.address)&&!!m;return void 0!==a&&a?(0,n.jsx)("div",{className:"flex justify-center mb-6",children:(0,n.jsx)("div",{className:"loading loading-spinner loading-md"})}):(0,n.jsx)("div",{className:"mt-4 flex justify-center",children:t?(0,n.jsx)(c(),{className:"text-secondary hover:text-secondary/80 text-sm cursor-pointer",href:v,children:"我的参与 >>"}):N?(0,n.jsx)(l.z,{className:"w-1/2",disabled:!0,children:"加载中..."}):y&&!1===f?(0,n.jsx)(l.z,{className:"w-1/2",disabled:!0,children:"未投票，不能加入"}):(0,n.jsx)(l.z,{className:"w-1/2",asChild:!0,children:(0,n.jsx)(c(),{href:j,children:"加入行动 >>"})})})}var h=s(44746);function g(e){var t=e.actionInfo,s=e.participantCount,i=e.totalAmount,l=e.convertedTotalAmount,u=e.joinedAmountTokenSymbol,x=e.joinedAmountTokenIsLP,g=e.isJoined,f=e.isPending,p=e.showActionButtons,j=void 0===p||p,v=((0,r.useContext)(d.M)||{}).token,N=(0,a.m)().address;if(!v)return(0,n.jsx)("div",{children:"Token信息加载中..."});var y=l&&l>BigInt(0),b=y?l:i,I=b?(0,o.LH)(b):"0",w=!!(u&&(null==v?void 0:v.symbol)&&u!==v.symbol),B=x?"LP":u,A=y?"• 实际总参与代币： ".concat(i?(0,o.LH)(i):"0"," ").concat(u||"","\n• 估算值是根据 UniswapV2 池价格实时换算。"):"";return(0,n.jsxs)("div",{className:"!bg-gray-100 rounded-lg px-2 pt-2 pb-2 text-sm my-4",children:[(0,n.jsx)("div",{className:"mb-2",children:(0,n.jsx)("h1",{className:"text-lg mb-1",children:(0,n.jsxs)("div",{className:"flex items-baseline",children:[(0,n.jsx)("span",{className:"text-gray-400 text-sm",children:"No."}),(0,n.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:t.head.id.toString()}),(0,n.jsx)("span",{className:"font-bold text-gray-800",children:t.body.title})]})})}),(0,n.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"text-gray-500 mr-2",children:y?"总参与代币(估):":"总参与代币:"}),(0,n.jsxs)("span",{className:"font-mono text-secondary",children:[I,i&&w&&!y&&(0,n.jsx)("span",{className:"ml-1 text-xs text-gray-500",children:B})," "]}),y&&A&&(0,n.jsx)(h.Z,{title:"参与代币数量说明",content:A,className:"ml-1"})]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"text-gray-500 mr-2",children:"总参与地址:"}),(0,n.jsx)("span",{className:"font-mono text-secondary",children:(null==s?void 0:s.toString())||"0"})]})]}),j&&t&&N&&(0,n.jsx)(m,{isJoined:g,actionId:t.head.id,isPending:f}),!j&&(0,n.jsx)("div",{className:"mt-4 flex justify-center",children:(0,n.jsx)(c(),{className:"text-secondary hover:text-secondary/80 text-sm cursor-pointer",href:"/action/info?symbol=".concat(null==v?void 0:v.symbol,"&id=").concat(t.head.id),children:"行动详情 >>"})})]})}},90963:function(e,t,s){"use strict";var n=s(91309),r=s(85893),a=s(67294),i=s(27245),c=s(21774),d=s(26986);t.Z=function(e){var t=e.currentRound,s=e.maxRound,o=e.handleChangedRound,l=(0,n._)((0,a.useState)(!1),2),u=l[0],x=l[1],m=(0,n._)((0,a.useState)(""),2),h=m[0],g=m[1],f=(0,n._)((0,a.useState)(""),2),p=f[0],j=f[1],v=function(e){o(e),x(!1),g(""),j("")},N=Number(null!=s?s:t),y=Math.min(N,30),b=function(e){g(e),j("")},I=function(){var e=parseInt(h,10);if(isNaN(e)){j("请输入有效的数字");return}if(e<1){j("轮次不能小于 1");return}if(e>N){j("轮次不能超过 ".concat(N));return}v(e)},w=(0,a.useRef)(null),B=(0,a.useRef)(!1);return(0,r.jsxs)(d.dy,{open:u,onOpenChange:x,children:[(0,r.jsx)(d.Qz,{asChild:!0,children:(0,r.jsx)(i.z,{variant:"link",className:"text-secondary no-underline pl-2 pr-1",children:"切换轮次"})}),(0,r.jsxs)(d.sc,{className:"z-[9999] min-h-[25vh]",overlayClassName:"z-[9998]",children:[(0,r.jsxs)(d.OX,{children:[(0,r.jsx)(d.iI,{}),(0,r.jsx)(d.u6,{})]}),(0,r.jsxs)("div",{className:"px-4 flex-grow",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-3 pb-3 border-b",children:[(0,r.jsx)("span",{className:"text-sm text-gray-600 whitespace-nowrap",children:"跳到"}),(0,r.jsx)(c.I,{type:"number",min:1,max:N,value:h,onChange:function(e){return b(e.target.value)},onKeyDown:function(e){"Enter"===e.key&&I()},placeholder:"1 - ".concat(N),className:"w-28 h-8 text-center"}),(0,r.jsx)("span",{className:"text-sm text-gray-600 whitespace-nowrap",children:"轮"}),(0,r.jsx)(i.z,{size:"sm",variant:"secondary",onClick:I,className:"h-8",children:"确认"})]}),p&&(0,r.jsx)("p",{className:"text-red-500 text-sm mb-2 -mt-2 text-center w-full",children:p}),(0,r.jsxs)("div",{className:"max-h-64 overflow-y-auto",children:[Array.from({length:y},function(e,t){var s=N-t;return(0,r.jsx)(i.z,{variant:"ghost",className:"w-full p-2 text-center rounded-none hover:bg-gray-100 touch-manipulation",onPointerDown:function(e){"touch"===e.pointerType?w.current=e.clientY:w.current=null,B.current=!1},onPointerMove:function(e){"touch"===e.pointerType&&null!==w.current&&Math.abs(e.clientY-w.current)>10&&(B.current=!0)},onPointerUp:function(e){"touch"===e.pointerType?(B.current||v(s),w.current=null,B.current=!1):v(s)},style:{touchAction:"manipulation"},children:(0,r.jsxs)("span",{className:"text-lg",children:["第 ",s," 轮"]})},s)}),N>30&&(0,r.jsxs)("p",{className:"text-center text-gray-400 text-sm py-2",children:["仅显示最近 ",30," 轮，更早轮次请使用上方输入框跳转"]})]})]}),(0,r.jsx)(d.ze,{children:(0,r.jsx)(d.uh,{asChild:!0,children:(0,r.jsx)(i.z,{variant:"outline",children:"关闭"})})})]})]})}},88308:function(e,t,s){"use strict";s.d(t,{h:function(){return c}});var n=s(67294),r=s(67516),a=s(50095);function i(e){return"".concat("group_name_").concat(e.toString())}var c=function(e){var t=e.groupIds,s=e.enabled,c=void 0===s||s,d=!!t&&t.length>0,o=(0,n.useMemo)(function(){if(!c||!d)return{cachedData:new Map,uncachedGroupIds:[]};var e=new Map,s=[];return t.forEach(function(t){var n=function(e){try{var t=i(e),s=localStorage.getItem(t);if(null===s)return null;var n=JSON.parse(s);return null===n.data?void 0:n.data}catch(e){return console.error("读取群名称缓存失败:",e),null}}(t);null!==n?e.set(t,n):s.push(t)}),{cachedData:e,uncachedGroupIds:s}},[t,c,d]),l=o.cachedData,u=o.uncachedGroupIds,x=(0,n.useMemo)(function(){return c&&d&&0!==u.length?u.map(function(e){return{address:"0xA0a5BB442214988D0c6e707d825640C026fB1d04",abi:a.s,functionName:"groupNameOf",args:[e]}}):[]},[u,c,d]),m=(0,r.N)({contracts:x,query:{enabled:c&&d&&x.length>0}}),h=m.data,g=m.isPending,f=m.error;(0,n.useEffect)(function(){h&&0!==u.length&&h.forEach(function(e,t){(null==e?void 0:e.status)==="success"&&function(e,t){try{var s=i(e);localStorage.setItem(s,JSON.stringify({data:void 0===t?null:t}))}catch(e){console.error("保存群名称缓存失败:",e)}}(u[t],e.result)})},[h,u]);var p=(0,n.useMemo)(function(){var e=new Map;return h&&u.length>0&&h.forEach(function(t,s){var n=u[s];(null==t?void 0:t.status)==="success"&&e.set(n,t.result)}),e},[h,u]);return{groupNameMap:(0,n.useMemo)(function(){var e=new Map;return c&&d&&t.forEach(function(t){l.has(t)?e.set(t,l.get(t)):p.has(t)&&e.set(t,p.get(t))}),e},[t,l,p,c,d]),isPending:(0,n.useMemo)(function(){return!!c&&!!d&&u.length>0&&g},[c,d,u.length,g]),error:f||null}}},13523:function(e,t,s){"use strict";s.d(t,{id:function(){return a}});var n=s(71104),r=s(58494),a=function(e){var t=(0,n.u)({address:e,abi:r.U,functionName:"FACTORY_ADDRESS",query:{enabled:!!e}});return{factory:t.data,isPending:t.isPending,error:t.error}}},97357:function(e,t,s){"use strict";s.d(t,{GD:function(){return d},VW:function(){return r.VW}});var n=s(13523);s(80332);var r=s(36268),a=s(67294),i=s(92261),c=function(e,t){switch(e||"hasExtension"){case"always":return!0;case"hasExtension":return!!t.isExtensionAction;default:return!1}},d=function(e){var t=e.extensionAddress,s=e.isExtensionAction;e.account;var r=(0,n.id)(t),d=r.factory,o=r.isPending,l=(0,a.useMemo)(function(){return d?(0,i.qD)(d):null},[d]),u=(null==l?void 0:l.type)||null,x=(0,a.useMemo)(function(){if(!t||!s||o||!d||!l||!l.actionDetailTabs)return[];var e={isExtensionAction:s};return l.actionDetailTabs.filter(function(t){return c(t.showCondition,e)}).map(function(e){return{key:e.key,label:e.label}})},[t,s,o,d,l]);return{tabs:(0,a.useMemo)(function(){return x},[x]),isPending:(0,a.useMemo)(function(){return o},[o]),extensionType:u}}},87333:function(e,t,s){"use strict";s.d(t,{Q:function(){return d}});var n=s(67294),r=s(67516),a=s(65293),i=s(87974),c=s(8926);function d(e){var t=e.tokenAddress,s=e.account,d=(0,i.Od)(t),o=d.actionIds,l=d.isPending,u=d.error,x=(0,c.W)({token:{address:t},actionIds:o||[],enabled:!!t&&!!o&&o.length>0}),m=x.extensions,h=x.isPending,g=x.error,f=(0,n.useMemo)(function(){var e=new Map;return m.forEach(function(t){t.isExtension&&t.extensionAddress&&e.set(t.actionId,t.extensionAddress)}),e},[m]),p=(0,n.useMemo)(function(){if(!s||!o||0===o.length||0===f.size)return{groupIdsContracts:[],contractIndexToActionIdMap:new Map};var e=[],t=new Map;return o.forEach(function(n){var r=f.get(n);if(r){var i=e.length;e.push({address:"0xf2084E73bF047aF26d72CEFde25e22536a1f37C8",abi:a.i,functionName:"activeGroupIdsByOwner",args:[r,s]}),t.set(i,n)}}),{groupIdsContracts:e,contractIndexToActionIdMap:t}},[s,o,f]),j=p.groupIdsContracts,v=p.contractIndexToActionIdMap,N=(0,r.N)({contracts:j,query:{enabled:!!s&&!!o&&o.length>0&&f.size>0&&!h}}),y=N.data,b=N.isPending,I=N.error;return{actionIdsWithGroupIds:(0,n.useMemo)(function(){if(!y||0===j.length)return[];var e=[];return y.forEach(function(t,s){if((null==t?void 0:t.status)==="success"&&t.result){var n=v.get(s);if(void 0!==n){var r=t.result;r.length>0&&e.push({actionId:n,groupIds:r})}}}),e},[y,j,v]),isPending:(0,n.useMemo)(function(){return!t||!s||!!l||!!o&&0!==o.length&&(!!h||0!==f.size&&b)},[t,s,l,o,h,f.size,b]),error:u||g||I}}},20714:function(e,t,s){"use strict";s.d(t,{A:function(){return u}});var n=s(67294),r=s(67516),a=s(35611),i=s(87333),c=s(58149),d=s(88308),o=s(8926),l=s(37742);function u(e){var t=e.groupActionTokenAddress,s=e.account,u=e.round,x=(0,i.Q)({tokenAddress:t,account:s}),m=x.actionIdsWithGroupIds,h=x.isPending,g=x.error,f=(0,n.useMemo)(function(){return m.map(function(e){return e.actionId})},[m]),p=(0,o.W)({token:{address:t},actionIds:f,enabled:!!t&&f.length>0}),j=p.extensions,v=p.isPending,N=p.error,y=(0,n.useMemo)(function(){var e=new Map;return j.forEach(function(t){t.isExtension&&t.extensionAddress&&e.set(t.actionId,t.extensionAddress)}),e},[j]),b=(0,c.I)({tokenAddress:t,actionIds:f,enabled:!!t&&f.length>0&&!v}),I=b.actionInfos,w=b.isPending,B=b.error,A=(0,n.useMemo)(function(){var e=new Set;return m.forEach(function(t){t.groupIds.forEach(function(t){e.add(t.toString())})}),Array.from(e).map(function(e){return BigInt(e)})},[m]),R=(0,d.h)({groupIds:A.length>0?A:void 0,enabled:A.length>0&&!h}),k=R.groupNameMap,C=R.isPending,_=R.error,S=(0,n.useMemo)(function(){var e=[];return m.forEach(function(t){var s=y.get(t.actionId);s&&t.groupIds.forEach(function(n){e.push({actionId:t.actionId,extensionAddress:s,groupId:n,index:e.length})})}),e},[m,y]),M=(0,n.useMemo)(function(){return 0!==S.length&&u?S.map(function(e){var t=e.extensionAddress,s=e.groupId;return{address:"0xd94e4Fc2108B78Aa57438BFe5E85192687f74322",abi:a.w,functionName:"totalJoinedAmountByGroupId",args:[t,u,s]}}):[]},[S,u]),P=(0,r.N)({contracts:M,query:{enabled:!!u&&M.length>0&&!v}}),L=P.data,Z=P.isPending,E=P.error,H=(0,n.useMemo)(function(){var e=new Map;return L&&S.length>0&&S.forEach(function(t,s){var n=t.actionId,r=t.groupId,a=L[s];if((null==a?void 0:a.status)==="success"&&void 0!==a.result){var i="".concat(n,"_").concat(r);e.set(i,(0,l.Zu)(a.result))}}),e},[L,S]);return{actionsWithGroups:(0,n.useMemo)(function(){if(0===f.length)return[];var e=[];return m.forEach(function(t,s){var n=t.actionId,r=I[s];if(r){var a=y.get(n);if(a){var i=t.groupIds.map(function(e){var t="".concat(n,"_").concat(e),s=H.get(t)||BigInt(0);return{groupId:e,groupName:k.get(e),totalJoinedAmount:s}});e.push({actionId:n,actionTitle:r.body.title||"行动 #".concat(n.toString()),extensionAddress:a,groups:i})}}}),e},[m,I,y,k,H]),isPending:(0,n.useMemo)(function(){return!t||!s||!u||!!h||0!==m.length&&(!!v||0!==y.size&&(!!w||!!C||Z))},[t,s,u,h,m.length,v,y.size,w,C,Z]),error:g||N||B||_||E}}},92429:function(e,t,s){"use strict";s.d(t,{Fw:function(){return h},hq:function(){return f},Hw:function(){return p}});var n=s(48564),r=s(2267),a=s(75766),i=s(45775),c=s(60480),d=s(13550),o=s.n(d),l=function(e,t){for(var s=e;s.length<2*t;)s="0"+s;return s},u=function(e){return(e=(e=e.toUpperCase()).substr(4)+e.substr(0,4)).split("").map(function(e){var t=e.charCodeAt(0);return t>=65&&t<=90?(t-65+10).toString():e}).join("")},x=function(e){for(var t,s=e;s.length>2;)s=(parseInt(t=s.slice(0,9),10)%97).toString()+s.slice(t.length);return parseInt(s,10)%97},m=function(){function e(t){(0,n._)(this,e),(0,a._)(this,"_iban",void 0),this._iban=t}return(0,r._)(e,[{key:"isValid",value:function(){return/^TH[0-9]{2}(ETH[0-9A-Z]{13}|[0-9A-Z]{30,31})$/.test(this._iban)&&1===x(u(this._iban))}},{key:"isDirect",value:function(){return 34===this._iban.length||35===this._iban.length}},{key:"isIndirect",value:function(){return 20===this._iban.length}},{key:"checksum",value:function(){return this._iban.substr(2,2)}},{key:"toAddress",value:function(){if(this.isDirect()){var e=this._iban.substr(4),t=new(o())(e,36);return(0,i.K)("0x".concat(t.toString(16).padStart(40,"0")))}return""}},{key:"toString",value:function(){return this._iban}}],[{key:"fromAddress",value:function(t){if(!(0,c.U)(t))throw Error("Provided address is not a valid address: "+t);var s=t.replace("0x","").replace("0X",""),n=l(new(o())(s,16).toString(36),15);return e.fromBban(n.toUpperCase())}},{key:"fromBban",value:function(t){return new e("TH"+("0"+(98-x(u("TH00"+t)))).slice(-2)+t)}},{key:"toIban",value:function(t){return e.fromAddress(t).toString()}},{key:"toAddress",value:function(t){var s=new e(t);if(!s.isDirect())throw Error("IBAN is indirect and can't be converted");return s.toAddress()}},{key:"isValid",value:function(t){return new e(t).isValid()}}]),e}();function h(e){return/^0[Xx][A-Fa-f0-9]{40}$/.test(e)}function g(e){try{return m.isValid(e)}catch(e){return!1}}function f(e){if(!e||""===e)return"";var t=e.trim();return h(t)?t.toLowerCase():g(t)?function(e){if(!e||""===e)return"";if("TH48000000000000000000000000001EKI"===e)return"0x0000000000000000000000000000000000010002";try{return m.toAddress(e).toLowerCase()}catch(e){return console.error("转换TH地址为0x失败:",e),""}}(t):""}function p(e){if(!e||""===e.trim())return"请输入收款地址";var t=e.trim();return h(t)||g(t)&&f(t)?null:"请输入有效的地址格式（支持 0x、XE 或 TH 格式）"}},48057:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return tp}});var n=s(72253),r=s(91309),a=s(4586),i=s(85893),c=s(67294),d=s(11163),o=s(42130),l=s(93778),u=s(45231),x=s(97357),m=s(11418),h=s(27460),g=s(91529),f=s(72107),p=s(31084),j=s(93566),v=s(20442),N=s(31134),y=(0,N.Z)("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),b=s(35810);function I(e){var t=e.actionInfo,s=e.currentRound,n=e.isExtensionAction,a=((0,c.useContext)(l.M)||{}).token,d=(0,r._)((0,c.useState)(!1),2),o=d[0],u=d[1],x=(0,j.sK)((null==a?void 0:a.address)||"0x0000000000000000000000000000000000000000",s||BigInt(0),t.head.id),m=x.submitInfo,N=x.isPending,I=(0,v.PL)((null==a?void 0:a.address)||"0x0000000000000000000000000000000000000000",t.head.id),w=I.joinedAmountByActionId,B=I.isPending;if(!a)return(0,i.jsx)("div",{children:"Token信息加载中..."});var A=w||BigInt(0),R=t.body.maxRandomAccounts,k=R>BigInt(0)?A/R:BigInt(0);return(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"",children:[!n&&(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between md:max-w-xs",children:[(0,i.jsx)("span",{className:"font-bold",children:"单地址最小参与代币数:"}),(0,i.jsx)("span",{className:"font-mono text-secondary",children:(0,g.LH)(t.body.minStake)})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between md:max-w-xs",children:[(0,i.jsx)("span",{className:"font-bold",children:"最大激励地址数:"}),(0,i.jsx)("span",{className:"font-mono text-secondary",children:t.body.maxRandomAccounts.toString()})]})]}),!n&&"0x0000000000000000000000000000000000000000"===t.body.whiteListAddress&&(0,i.jsx)("div",{className:"mt-1 text-sm md:text-base text-gray-700 bg-gray-50 p-1 md:p-4 rounded-md md:rounded-lg w-full",children:(0,i.jsxs)("div",{className:"flex items-start gap-1 md:gap-3",children:[(0,i.jsx)(y,{className:"w-4 h-4 md:w-5 md:h-5 text-amber-500 flex-shrink-0 mt-0.5"}),(0,i.jsxs)("div",{children:["“实际”激励地址数可能小于最大激励地址数。",(0,i.jsxs)(b.Vq,{open:o,onOpenChange:u,children:[(0,i.jsx)(b.hg,{asChild:!0,children:(0,i.jsx)("button",{className:"text-blue-600 hover:text-blue-800 underline ml-1",children:"详情算法>>"})}),(0,i.jsxs)(b.cZ,{className:"w-[calc(100%-2rem)] max-w-2xl max-h-[80vh] overflow-y-auto sm:w-full",children:[(0,i.jsx)(b.fK,{className:"text-center",children:(0,i.jsx)(b.$N,{className:"text-center",children:"激励地址说明"})}),(0,i.jsxs)("div",{className:"space-y-4 text-base",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("h3",{className:"font-bold text-gray-900",children:"随机抽取地址算法："}),(0,i.jsxs)("p",{className:"text-gray-700",children:["每轮验证阶段，会从所有参与行动的代币（例如当前行动为"," ",B?(0,i.jsx)("span",{className:"text-gray-400",children:"加载中..."}):(0,i.jsx)("span",{className:"font-mono font-semibold text-blue-600",children:(0,g.LH)(A)})," ",'个）中，随机选中"最大激励地址数"个（例如当前行动目前为'," ",(0,i.jsx)("span",{className:"font-mono font-semibold text-blue-600",children:R.toString()})," ","个）代币，返回对应地址。若多份代币对应相同地址，则会合并为一个地址。"]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("h3",{className:"font-bold text-gray-900",children:"想要100%被抽中的代币数："}),(0,i.jsxs)("p",{className:"text-gray-700",children:["计算公式：总参与代币数 / 最大激励地址数。比如，当前行动目前想要 100%概率被抽中的代币数为"," ",B?(0,i.jsx)("span",{className:"text-gray-400",children:"加载中..."}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"font-mono font-semibold text-blue-600",children:(0,g.LH)(A)})," / ",(0,i.jsx)("span",{className:"font-mono font-semibold text-blue-600",children:R.toString()})," = ",(0,i.jsx)("span",{className:"font-mono font-semibold text-green-600",children:(0,g.LH)(k,4,"ceil")})]})]})]}),(0,i.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,i.jsx)("h3",{className:"font-bold text-gray-900",children:"如何铸造激励："}),(0,i.jsx)("p",{className:"text-gray-700",children:"被抽中的地址，经社群验证后，会获得行动铸币激励资格。可以点击“我的”=> “我参与的行动”=> “铸造行动激励”进行铸造。"})]})]})]})]})]})]})})]}),t.body.verificationRule&&(0,i.jsxs)("div",{className:"mt-4",children:[(0,i.jsx)("div",{className:"font-bold mb-2",children:"验证规则:"}),(0,i.jsx)("div",{className:"leading-loose bg-gray-50 p-2 rounded-md",children:(0,i.jsx)(f.L,{text:t.body.verificationRule,preserveLineBreaks:!0})})]}),t.body.verificationKeys&&t.body.verificationKeys.length>0&&(0,i.jsxs)("div",{className:"mt-6",children:[(0,i.jsx)("div",{className:"font-bold mb-2",children:"报名参加行动时，行动者要提供的信息:"}),(0,i.jsx)("ul",{className:"list-disc pl-5",children:t.body.verificationKeys.map(function(e,s){var n;return(0,i.jsxs)("li",{className:"text-gray-700",children:[(0,i.jsxs)("div",{className:"text-sm font-bold text-greyscale-900",children:[(0,i.jsx)(p.Z,{text:e,showWarning:!0})," :"]}),(0,i.jsx)("div",{children:(0,i.jsx)(p.Z,{text:null===(n=t.body.verificationInfoGuides)||void 0===n?void 0:n[s],showWarning:!0,preserveLineBreaks:!0})})]},s)})})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between mt-4 md:max-w-md",children:[(0,i.jsxs)("span",{className:"font-bold",children:[n?"扩展合约":"白名单",":"]}),(0,i.jsx)("div",{children:"0x0000000000000000000000000000000000000000"===t.body.whiteListAddress?(0,i.jsx)("span",{className:"text-gray-400 text-sm",children:"无限制"}):(0,i.jsx)(h.Z,{address:t.body.whiteListAddress,showCopyButton:!0,colorClassName:"text-sm"})})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between mt-4 md:max-w-md",children:[(0,i.jsx)("span",{className:"font-bold",children:"创建人:"}),(0,i.jsx)(h.Z,{address:t.head.author,showCopyButton:!0,colorClassName:"text-sm"})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between mt-4 md:max-w-md",children:[(0,i.jsx)("span",{className:"font-bold",children:"推举人:"}),(0,i.jsx)("div",{children:N?(0,i.jsx)("span",{className:"text-gray-400 text-sm",children:"加载中..."}):(null==m?void 0:m.submitter)&&"0x0000000000000000000000000000000000000000"!==m.submitter?(0,i.jsx)(h.Z,{address:m.submitter,showCopyButton:!0,colorClassName:"text-sm"}):(0,i.jsx)("span",{className:"text-gray-400 text-sm",children:"当前行动轮未被推举"})})]})]})}var w=s(41664),B=s.n(w),A=s(90278),R=s(90963),k=s(64777),C=s(42083);function _(e){var t=e.actionId,s=e.currentRound,o=(0,d.useRouter)(),u=((0,c.useContext)(l.M)||{}).token,x=(0,r._)((0,c.useState)(s||BigInt(1)),2),m=x[0],f=x[1],p=o.query.round;(0,c.useEffect)(function(){p&&!isNaN(Number(p))?f(BigInt(p)):s&&f(s+BigInt(1))},[p,s]);var j=(0,A.pA)((null==u?void 0:u.address)||"0x0000000000000000000000000000000000000000",m,t),v=j.actionVoters,N=j.isPending,y=j.error;if(!u)return(0,i.jsx)("div",{children:"Token信息加载中..."});var b=(null==v?void 0:v.reduce(function(e,t){return e+t.voteCount},BigInt(0)))||BigInt(0),I=v?(0,a._)(v).sort(function(e,t){return e.voteCount>t.voteCount?-1:e.voteCount<t.voteCount?1:0}):[];return(0,i.jsxs)("div",{className:"relative pb-4",children:[m===BigInt(0)&&(0,i.jsx)("div",{className:"flex items-center justify-center",children:(0,i.jsx)("div",{className:"text-center text-sm text-greyscale-500",children:"暂无投票数据"})}),(0,i.jsx)("div",{className:"flex items-center",children:m>0&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(k.Z,{title:"第 ".concat(m.toString()," 轮投票详情")}),(0,i.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"("}),(0,i.jsx)(R.Z,{currentRound:s?(0,g.cK)(s+BigInt(1),u):BigInt(0),handleChangedRound:function(e){var t=BigInt(e);f(t);var s=(0,n._)({},o.query);s.round=t.toString(),o.push({pathname:o.pathname,query:s},void 0,{shallow:!0})}}),(0,i.jsx)("span",{className:"text-sm text-greyscale-500",children:")"})]})}),m>0&&v&&(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-0 mt-4 mb-4",children:[(0,i.jsxs)("div",{className:"",children:[(0,i.jsx)("span",{className:"text-gray-500 mr-1",children:"投票地址数:"}),(0,i.jsx)("span",{className:"font-mono text-secondary",children:v.length})]}),(0,i.jsxs)("div",{className:"",children:[(0,i.jsx)("span",{className:"text-gray-500 mr-1",children:"票数:"}),(0,i.jsx)("span",{className:"font-mono text-secondary",children:(0,g.LH)(b)})]})]}),N&&(0,i.jsx)("div",{className:"flex justify-center py-8",children:(0,i.jsx)(C.Z,{})}),y&&(0,i.jsxs)("div",{className:"alert alert-error",children:[(0,i.jsx)("svg",{className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,i.jsxs)("span",{children:["加载投票数据失败: ",y.message]})]}),!N&&!y&&v&&m>0&&(0===I.length?(0,i.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"该轮次暂无投票记录"}):(0,i.jsxs)("table",{className:"table w-full",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("th",{className:"px-1 text-left",children:"排名"}),(0,i.jsx)("th",{className:"px-1 text-left",children:"投票地址"}),(0,i.jsx)("th",{className:"px-1 text-right",children:"投票数"}),(0,i.jsx)("th",{className:"px-1 text-right",children:"占比"})]})}),(0,i.jsx)("tbody",{children:I.map(function(e,t){var s;return(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("td",{className:"px-1 text-greyscale-400",children:t+1}),(0,i.jsx)("td",{className:"px-1",children:(0,i.jsx)(B(),{href:"/vote/records?account=".concat(e.account),children:(0,i.jsxs)("div",{className:"inline-flex items-center bg-gray-50 hover:bg-gray-100 rounded-md px-2 py-1 transition-colors duration-150 active:bg-gray-200",children:[(0,i.jsx)(h.Z,{address:e.account,showCopyButton:!0}),(0,i.jsx)("svg",{className:"h-3 w-3 text-gray-400 ml-2 opacity-60 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})}),(0,i.jsx)("td",{className:"px-1 text-right font-mono text-secondary",children:(0,g.LH)(e.voteCount)}),(0,i.jsx)("td",{className:"px-1 text-right text-greyscale-500",children:(s=e.voteCount,b===BigInt(0)?"0.00":(0,g.rl)(Number(s)/Number(b)*100))})]},e.account)})})]}))]})}var S=s(34680),M=s(21774),P=s(27245),L=s(94193),Z=(0,N.Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),E=s(68655),H=s(92429),T=s(17301);function V(e){var t=e.actionId,s=((0,c.useContext)(l.M)||{}).token,n=(0,r._)((0,c.useState)(""),2),a=n[0],d=n[1],o=(0,r._)((0,c.useState)(null),2),u=o[0],x=o[1],m=(0,r._)((0,c.useState)(null),2),h=m[0],f=m[1],p=(0,v.X9)(null==s?void 0:s.address,t,u),j=p.joinedAmountByActionIdByAccount,N=p.isPending,y=p.error,b=function(e){d(e),f((0,H.Hw)(e))},I=function(){if(a.trim()){var e=(0,H.hq)(a);if(!e){f("请输入有效的地址格式（支持 0x 或 TH 格式）");return}x(e),f(null)}},w=!h;return(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)(S.Zb,{className:"border-0 md:border shadow-none md:shadow-sm",children:[(0,i.jsx)(S.Ol,{children:(0,i.jsxs)(S.ll,{className:"flex items-center gap-2 text-lg",children:[(0,i.jsx)(Z,{className:"h-5 w-5"}),"查询地址参与情况"]})}),(0,i.jsxs)(S.aY,{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(M.I,{id:"address",placeholder:"请输入要查询的钱包地址 (支持 0x 或 TH 格式)",value:a,onChange:function(e){return b(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&I()},className:h?"border-red-500":""}),h&&(0,i.jsxs)("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[(0,i.jsx)(E.Z,{className:"h-4 w-4"}),h]})]}),(0,i.jsx)("div",{className:"flex justify-center",children:(0,i.jsx)(P.z,{onClick:I,disabled:!a.trim()||!w||!!u&&N,className:"px-8",children:u&&N?(0,i.jsx)(C.Z,{}):"查询"})})]})]}),u&&(0,i.jsxs)(S.Zb,{className:"border-0 md:border shadow-none md:shadow-sm",children:[(0,i.jsx)(S.Ol,{children:(0,i.jsx)(S.ll,{className:"text-lg",children:"查询结果"})}),(0,i.jsx)(S.aY,{children:N?(0,i.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,i.jsx)(C.Z,{}),(0,i.jsx)("span",{className:"ml-2",children:"查询中..."})]}):y?(0,i.jsx)(T.Z,{type:"error",message:"查询失败：".concat(y.message)}):(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(L._,{className:"text-sm text-gray-600",children:"查询地址"}),(0,i.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg",children:(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("code",{className:"text-sm font-mono break-all",children:u}),a!==u&&(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:["原始输入：",a]})]})})]}),void 0!==j&&j>BigInt(0)?(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(L._,{className:"text-sm text-gray-600",children:"参与代币数量"}),(0,i.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg",children:(0,i.jsxs)("div",{className:"text-lg font-semibold",children:[(0,g.LH)(j)," ",(null==s?void 0:s.symbol)||""]})})]}):(0,i.jsxs)("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 text-yellow-800",children:[(0,i.jsx)(E.Z,{className:"h-5 w-5"}),(0,i.jsx)("span",{className:"font-medium",children:"该地址未参与此行动"})]}),(0,i.jsx)("p",{className:"text-sm text-yellow-700 mt-1",children:"参与代币数量为 0"})]})]})})]}),(0,i.jsxs)(S.Zb,{className:"border-0 md:border shadow-none md:shadow-sm",children:[(0,i.jsx)(S.Ol,{children:(0,i.jsx)(S.ll,{className:"text-base",children:"使用说明"})}),(0,i.jsxs)(S.aY,{className:"text-sm text-gray-600 space-y-2",children:[(0,i.jsx)("p",{children:"• 支持两种地址格式：0x 开头的以太坊地址 或 TH 开头的 TKM 地址"}),(0,i.jsx)("p",{children:"• 查询结果显示该地址参与此行动质押的代币总数量"}),(0,i.jsx)("p",{children:"• 如果显示 0，表示该地址未参与此行动"})]})]})]})}var D=s(42171),q=s(4307),F=s(73591),O=s(59271),G=s(72260),z=s(44746),J=function(e){var t=e.currentJoinRound,s=e.actionId,u=e.actionInfo,x=e.isExtensionAction,m=(0,d.useRouter)(),p=((0,c.useContext)(l.M)||{}).token,j=(0,o.m)().address,v=(0,r._)((0,c.useState)(BigInt(0)),2),N=v[0],y=v[1],b=(0,r._)((0,c.useState)(new Set),2),I=b[0],w=b[1],B=t-BigInt(1),_=m.query.round;(0,c.useEffect)(function(){_&&!isNaN(Number(_))?y(BigInt(_)):p&&t-BigInt(p.initialStakeRound)>=BigInt(1)&&y(t-BigInt(1))},[_,t,p]);var S=(0,A.pK)(null==p?void 0:p.address,p&&N?N:BigInt(0),s),M=S.verifiedAddresses,P=S.isPending,L=S.error,Z=(0,A.X5)(null==p?void 0:p.address,p&&N?N:BigInt(0),s),E=Z.verificationInfos,H=Z.isPending,T=Z.error,V=(0,O.LW)(null==p?void 0:p.address,N,s,"0x0000000000000000000000000000000000000000"),J=V.scoreByActionIdByAccount,K=V.isPending,W=V.error,U=(0,G.wD)(null==p?void 0:p.address,N,s),$=U.votesNumByActionId,X=(U.isPending,U.error),Y=(0,r._)((0,c.useState)([]),2),Q=Y[0],ee=Y[1];(0,c.useEffect)(function(){M&&ee(M)},[M]);var et=(0,F.S)().handleContractError;(0,c.useEffect)(function(){L&&et(L,"dataViewer"),T&&et(T,"dataViewer"),W&&et(W,"verify"),X&&et(X,"vote")},[L,T,W,X]),(0,c.useEffect)(function(){Q.length>0&&0===I.size&&w(new Set([(0,a._)(Q).sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:0})[0].account]))},[Q]);var es=(0,a._)(Q).sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:0}),en=es.reduce(function(e,t){return e+(t.reward||BigInt(0))},BigInt(0)),er=function(e){var t=new Set(I);t.has(e)?t.delete(e):t.add(e),w(t)},ea=Q.reduce(function(e,t){return e+t.score},BigInt(0))+(J||BigInt(0)),ei=Number(ea)/Number($||BigInt(0))*100,ec=!(void 0!==x&&x)&&(null==u?void 0:u.body.verificationKeys.length)>0;return(0,i.jsxs)("div",{className:"relative pb-4",children:[N===BigInt(0)&&(0,i.jsx)("div",{className:"flex items-center justify-center",children:(0,i.jsx)("div",{className:"text-center text-sm text-greyscale-500",children:"暂无验证结果"})}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("div",{className:"flex items-center",children:N>0&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(k.Z,{title:"第 ".concat(N.toString()," 轮验证")}),(0,i.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"("}),(0,i.jsx)(R.Z,{currentRound:p&&t?(0,g.cK)(t-BigInt(1),p):BigInt(0),handleChangedRound:function(e){var t=BigInt(e);y(t);var s=(0,n._)({},m.query);s.round=t.toString(),m.push({pathname:m.pathname,query:s},void 0,{shallow:!0})}}),(0,i.jsx)("span",{className:"text-sm text-greyscale-500",children:")"})]})}),N>0&&E&&E.length>0&&(0,i.jsx)("button",{onClick:function(){return m.push("/verify/detail?symbol=".concat(null==p?void 0:p.symbol,"&id=").concat(s,"&round=").concat(N))},className:"text-sm text-secondary hover:text-secondary-600",children:"查看明细 >>"})]}),(0,i.jsx)("div",{className:"flex justify-left mb-2",children:N===t-BigInt(1)&&ei>0&&(0,i.jsxs)("span",{className:"text-sm text-greyscale-500",children:["(当前验证进度：",(0,g.rl)(ei),")"]})}),P||H||K?(0,i.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,i.jsx)(C.Z,{})}):E&&0!==E.length?(0,i.jsxs)("table",{className:"table w-full",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[ec&&(0,i.jsx)("th",{}),(0,i.jsx)("th",{children:(0,i.jsxs)("div",{className:"flex items-center gap-1",children:["被抽中地址",(0,i.jsx)(z.Z,{title:"最大激励地址数说明",content:(0,i.jsxs)("p",{className:"leading-relaxed text-base",children:["每轮从所有参与行动的代币中，随机抽取",(0,i.jsx)("span",{className:"font-mono font-bold text-blue-600 mx-1 text-base",children:null==u?void 0:u.body.maxRandomAccounts.toString()}),"份代币，返回对应地址。若多份代币对应相同地址，则会合并为一个地址。"]})})]})}),(0,i.jsx)("th",{className:"px-1 text-right",children:"获得验证票"}),(0,i.jsx)("th",{className:"px-1 text-right",children:"可铸造激励"})]})}),(0,i.jsxs)("tbody",{children:[es.map(function(e){var t=null==E?void 0:E.find(function(t){return t.account===e.account}),s=I.has(e.account);return(0,i.jsxs)(c.Fragment,{children:[(0,i.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===j?"text-secondary":""),children:[ec&&(0,i.jsx)("td",{className:"px-1 w-8",children:(0,i.jsx)("button",{onClick:function(){return er(e.account)},className:"text-greyscale-400 hover:text-greyscale-600",children:s?(0,i.jsx)(D.Z,{size:16}):(0,i.jsx)(q.Z,{size:16})})}),(0,i.jsx)("td",{className:"px-1",children:(0,i.jsx)(h.Z,{address:e.account,showCopyButton:!0,word:e.account===j?"(我)":""})}),(0,i.jsxs)("td",{className:"px-1 text-right",children:[(0,g.LH)(e.score),(0,i.jsxs)("span",{className:"text-greyscale-500",children:["(",(0,g.rl)(Number(e.score)/Number(ea||BigInt(0))*100),")"]})]}),(0,i.jsx)("td",{className:"px-1 text-right",children:N===B?"-":(0,g.LH)(e.reward||BigInt(0))})]}),t&&u&&s&&ec&&(0,i.jsxs)("tr",{className:"border-b border-gray-100 bg-gray-50",children:[(0,i.jsx)("td",{}),(0,i.jsx)("td",{colSpan:3,className:"px-1 py-3",children:(0,i.jsxs)("div",{className:"text-sm text-greyscale-600",children:[(0,i.jsx)("div",{className:"text-xs text-greyscale-400 mb-2",children:"验证信息:"}),u.body.verificationKeys.map(function(e,s){return(0,i.jsxs)("div",{className:"mb-1",children:[(0,i.jsxs)("span",{className:"text-greyscale-500",children:[e,":"]})," ",(0,i.jsx)(f.L,{text:t.infos[s]})]},s)})]})})]})]},e.account)}),(0,i.jsxs)("tr",{children:[ec&&(0,i.jsx)("td",{className:"px-1"}),(0,i.jsx)("td",{className:"px-1 text-greyscale-500",children:"弃权票"}),(0,i.jsx)("td",{className:"px-1 text-right",children:(0,g.LH)(J||BigInt(0))})]}),(0,i.jsxs)("tr",{children:[ec&&(0,i.jsx)("td",{className:"px-1"}),(0,i.jsx)("td",{className:"px-1 text-greyscale-500",children:"汇总"}),(0,i.jsxs)("td",{className:"px-1 text-right",children:[(0,g.LH)(ea||BigInt(0)),(0,i.jsx)("span",{className:"text-greyscale-500",children:"(100%)"})]}),(0,i.jsx)("td",{className:"px-1 text-right",children:(0,g.LH)(en)})]})]})]}):N>BigInt(0)&&(0,i.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有验证地址"})]})},K=function(e){var t=e.actionId,s=e.currentRound,a=e.actionInfo,o=e.isExtensionAction,l=(0,d.useRouter)(),u=(0,r._)((0,c.useState)("vote"),2),x=u[0],m=u[1],h=l.query.tab2;(0,c.useEffect)(function(){h&&["vote","join","verify"].includes(h)&&m(h)},[h]);var g=[{key:"vote",label:"投票公示"},{key:"join",label:"参与公示"},{key:"verify",label:"验证公示"}].filter(function(e){return!(o&&"join"===e.key)}),f=function(e){m(e);var t=(0,n._)({},l.query);t.tab2=e,l.push({pathname:l.pathname,query:t},void 0,{shallow:!0})};return(0,i.jsxs)("div",{className:"bg-white rounded-lg",children:[(0,i.jsx)("div",{className:"flex bg-muted rounded-lg p-1 mb-4 mx-16",children:g.map(function(e){return(0,i.jsx)("button",{onClick:function(){return f(e.key)},className:"flex-1 px-2 py-1 text-sm font-medium rounded-md transition-all duration-200 ".concat(x===e.key?"bg-white text-secondary shadow-sm":"text-gray-500 hover:text-gray-800 hover:bg-gray-50"),children:e.label},e.key)})}),function(){switch(x){case"vote":return(0,i.jsx)(_,{actionId:t,currentRound:s});case"join":return(0,i.jsx)(V,{actionId:t});case"verify":return(0,i.jsx)(J,{currentJoinRound:s,actionId:t,actionInfo:a,isExtensionAction:o});default:return null}}()]})},W=s(13523),U=s(92261),$=s(14932),X=s(67516),Y=s(18790),Q=s(66889),ee=s(67959),et=s(37742),es="0xb0d291C3B036860c8D5E2C681bFa391F787b26Cb",en=BigInt(1e18),er=function(e){var t=e.extensionAddress,s=e.tokenAddress,r=e.actionId,a=(0,c.useMemo)(function(){return t&&s?[{address:"0x37Ddf561323b823144BaE33264f9C5461714846e",abi:ee.z,functionName:"accounts",args:[s,r]},{address:t,abi:Y.H,functionName:"JOIN_TOKEN_ADDRESS"},{address:t,abi:Y.H,functionName:"GOV_RATIO_MULTIPLIER"},{address:es,abi:Q.B,functionName:"govVotesNum",args:[s]},{address:t,abi:Y.H,functionName:"joinedAmount"}]:[]},[t,s]),i=(0,X.N)({contracts:a,query:{enabled:!!t&&!!s&&a.length>0}}),d=i.data,o=i.isPending,l=i.error,u=(0,c.useMemo)(function(){var e,t,s,n,r;return!d||d.length<5?{accounts:[],joinTokenAddress:void 0,govRatioMultiplier:void 0,totalGovVotes:void 0,totalJoinedAmount:void 0}:{accounts:(null===(e=d[0])||void 0===e?void 0:e.result)||[],joinTokenAddress:null===(t=d[1])||void 0===t?void 0:t.result,govRatioMultiplier:(0,et.Zu)(null===(s=d[2])||void 0===s?void 0:s.result),totalGovVotes:(0,et.Zu)(null===(n=d[3])||void 0===n?void 0:n.result),totalJoinedAmount:(0,et.Zu)(null===(r=d[4])||void 0===r?void 0:r.result)}},[d]),x=u.accounts,m=u.joinTokenAddress,h=u.govRatioMultiplier,g=u.totalGovVotes,f=u.totalJoinedAmount,p=(0,c.useMemo)(function(){if(!t||!s||!x||0===x.length||!m)return[];var e=[],n=!0,r=!1,a=void 0;try{for(var i,c=x[Symbol.iterator]();!(n=(i=c.next()).done);n=!0){var d=i.value;e.push({address:t,abi:Y.H,functionName:"joinInfo",args:[d]}),e.push({address:es,abi:Q.B,functionName:"validGovVotes",args:[s,d]})}}catch(e){r=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(r)throw a}}return e},[t,s,x,m]),j=(0,X.N)({contracts:p,query:{enabled:!!t&&!!s&&p.length>0}}),v=j.data,N=j.isPending,y=j.error,b=(0,c.useMemo)(function(){if(!v||!x||0===x.length||!h||!g||g===BigInt(0)||!f)return{participants:[],totalScore:BigInt(0),totalLp:f||BigInt(0),totalGovVotes:g||BigInt(0),govRatioMultiplier:h};if(f===BigInt(0))return{participants:[],totalScore:BigInt(0),totalLp:BigInt(0),totalGovVotes:g||BigInt(0),govRatioMultiplier:h};for(var e=[],t=BigInt(0),s=0;s<x.length;s++){var n,r,a=x[s],i=2*s,c=i+1,d=null===(n=v[i])||void 0===n?void 0:n.result,o=null===(r=v[c])||void 0===r?void 0:r.result,l=d?(0,et.Zu)(d[0]):BigInt(0),u=d?(0,et.Zu)(d[1]):BigInt(0),m=(0,et.Zu)(o);if(u&&u!==BigInt(0)){var p=u*en/f,j=m*en*h/g,N=p>j?j:p;t+=N,e.push({address:a,lpAmount:u,govVotes:m,score:N,lpRatio:Number(p)/Number(en),govVotesRatio:Number(m)/Number(g),rewardRatio:0,joinedRound:l})}}return e.forEach(function(e){e.rewardRatio=t>BigInt(0)?Number(e.score)/Number(t):0}),{participants:e,totalScore:t,totalLp:f,totalGovVotes:g,govRatioMultiplier:h}},[v,x,h,g,f]),I=x&&x.length>0;return(0,$._)((0,n._)({},b),{isPending:o||I&&N,error:l||y})},ea=function(e){var t=e.extensionAddress,s=e.tokenAddress,n=e.actionId,r=(0,o.m)().address,c=er({extensionAddress:t,tokenAddress:s,actionId:n}),d=c.participants,l=c.isPending,u=c.error;if(l)return(0,i.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,i.jsx)(C.Z,{})});if(u)return(0,i.jsx)("div",{className:"text-center text-red-500 py-8",children:(0,i.jsxs)("p",{children:["加载失败：",u.message||"获取数据失败"]})});if(0===d.length)return(0,i.jsx)("div",{className:"text-center text-gray-500 py-8",children:(0,i.jsx)("p",{children:"暂无参与者"})});var x=(0,a._)(d).sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:0});return(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"table w-full",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("th",{className:"px-2 text-left",children:"地址"}),(0,i.jsx)("th",{className:"px-2 text-right",children:"治理票/LP"}),(0,i.jsx)("th",{className:"px-2 text-right",children:"加入轮次"})]})}),(0,i.jsx)("tbody",{children:x.map(function(e){return(0,i.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.address===r?"text-secondary":""),children:[(0,i.jsx)("td",{className:"px-2",children:(0,i.jsx)(h.Z,{address:e.address,showCopyButton:!0,word:e.address===r?"(我)":""})}),(0,i.jsx)("td",{className:"px-2 text-right",children:(0,i.jsx)("div",{className:"flex flex-col",children:(0,i.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[(0,i.jsxs)("div",{children:["治理票: ",(0,g.rl)(100*e.govVotesRatio)]}),(0,i.jsxs)("div",{children:["LP: ",(0,g.rl)(100*e.lpRatio)]})]})})}),(0,i.jsx)("td",{className:"px-2 text-right",children:(0,g.uf)(e.joinedRound)})]},e.address)})})]})})},ei=s(62719),ec=function(e){var t=e.extensionAddress,s=e.tokenAddress,r=e.actionId,a=e.round,i=(0,ei.x)({tokenAddress:s,actionId:r,round:a}),d=i.accounts,o=i.isPending,l=i.error,u=(0,c.useMemo)(function(){return t&&void 0!==a&&0!==d.length?d.map(function(e){return{address:t,abi:Y.H,functionName:"rewardByAccount",args:[a,e]}}):[]},[t,a,d]),x=(0,X.N)({contracts:u,query:{enabled:u.length>0}}),m=x.data,h=x.isPending,g=x.error,f=(0,c.useMemo)(function(){return 0===d.length?{participants:[],isEmpty:!0}:{participants:d.map(function(e,t){var s,n=BigInt(0),r=BigInt(0),a=!1;if(m&&(null===(s=m[t])||void 0===s?void 0:s.result)){var i=m[t].result;n=(0,et.Zu)(i[0]);var c=(0,et.Zu)(i[1]);r=c<BigInt(1e11)?BigInt(0):c,a=i[2]}return{address:e,mintReward:n,burnReward:r,claimed:a}}),isEmpty:!1}},[d,m]);return(0,$._)((0,n._)({},f),{isPending:0===d.length?o:o||h,error:l||g})},ed=s(74598),eo=s(26986),el=s(79995),eu=s(98482),ex="0xACea4f086BE05BeA47f3A56788FA3919C7f40799",em=BigInt(1e18),eh=function(e){var t=e.extensionAddress,s=e.tokenAddress,n=e.account,r=e.round,a=e.enabled,i=void 0===a||a,d=(0,c.useMemo)(function(){return t&&s&&n&&void 0!==r&&i?[{address:t,abi:Y.H,functionName:"reward",args:[r]},{address:t,abi:Y.H,functionName:"rewardByAccount",args:[r,n]},{address:t,abi:Y.H,functionName:"joinedAmountByAccountByRound",args:[n,r]},{address:t,abi:Y.H,functionName:"joinedAmountByRound",args:[r]},{address:t,abi:Y.H,functionName:"GOV_RATIO_MULTIPLIER",args:[]},{address:ex,abi:eu.S,functionName:"phaseBlocks",args:[]},{address:ex,abi:eu.S,functionName:"originBlocks",args:[]},{address:t,abi:Y.H,functionName:"deduction",args:[r,n]},{address:t,abi:Y.H,functionName:"govRatio",args:[r,n]},{address:t,abi:Y.H,functionName:"totalDeduction",args:[r]}]:[]},[t,s,n,r,i]),o=(0,X.N)({contracts:d,query:{enabled:d.length>0}}),l=o.data,u=o.isPending,x=o.error;return{data:(0,c.useMemo)(function(){if(!l||0===l.length)return null;var e,t,s,n,a,i,c,d,o,u,x=(null===(e=l[0])||void 0===e?void 0:e.result)?(0,et.Zu)(l[0].result):BigInt(0),m=null===(t=l[1])||void 0===t?void 0:t.result,h=m?(0,et.Zu)(m[0]):BigInt(0),g=m?(0,et.Zu)(m[1]):BigInt(0),f=g<BigInt(1e11)?BigInt(0):g,p=(null===(s=l[2])||void 0===s?void 0:s.result)?(0,et.Zu)(l[2].result):BigInt(0),j=(null===(n=l[3])||void 0===n?void 0:n.result)?(0,et.Zu)(l[3].result):BigInt(0),v=(null===(a=l[4])||void 0===a?void 0:a.result)?(0,et.Zu)(l[4].result):BigInt(0),N=(null===(i=l[5])||void 0===i?void 0:i.result)?(0,et.Zu)(l[5].result):BigInt(0),y=(null===(c=l[6])||void 0===c?void 0:c.result)?(0,et.Zu)(l[6].result):BigInt(0),b=null===(d=l[7])||void 0===d?void 0:d.result,I=b?(0,et.Zu)(b[0]):BigInt(0),w=b?b[1].map(function(e){return(0,et.Zu)(e)}):[],B=b?b[2].map(function(e){return(0,et.Zu)(e)}):[],A=null===(o=l[8])||void 0===o?void 0:o.result,R=A?(0,et.Zu)(A[0]):BigInt(0),k=(null===(u=l[9])||void 0===u?void 0:u.result)?(0,et.Zu)(l[9].result):BigInt(0),C=0;j>BigInt(0)&&p>BigInt(0)&&(C=Number(p*em/j)/Number(em)*100);var _=p>I?p-I:BigInt(0),S=j>k?j-k:BigInt(0),M=0,P=BigInt(0);S>BigInt(0)&&_>BigInt(0)&&(M=Number(P=_*em/S)/Number(em)*100);var L=void 0!==r?y+r*N:BigInt(0),Z=0;R>BigInt(0)&&(Z=Number(R)/Number(em)*100);var E=!1;if(v>BigInt(0)&&x>BigInt(0)){var H=x*P/em;E=h+H/BigInt(1e3)<H}return{totalReward:x,userReward:h,userBurnReward:f,userLp:p,totalLp:j,phaseBlocks:N,originBlocks:y,govRatioMultiplier:v,totalDeduction:I,roundTotalDeduction:k,joinBlocks:w,joinAmounts:B,lpRatioPercent:C,govRatioPercent:Z,effectiveLp:_,totalEffectiveLp:S,effectiveLpRatioPercent:M,theoreticalReward:h+f,hasGovShortage:E,roundStartBlock:L}},[l,r]),isPending:u,error:x}},eg=function(e){var t=e.extensionAddress,s=e.tokenAddress,a=e.account,d=e.round,o=e.className,l=void 0===o?"":o,u=(0,r._)((0,c.useState)(!1),2),x=u[0],m=u[1],h=(0,r._)((0,c.useState)(!1),2),f=h[0],p=h[1],j=(0,el.Z)("(min-width: 768px)"),v=eh({extensionAddress:t,tokenAddress:s,account:a,round:d,enabled:x}),N=v.data,y=v.isPending,I=v.error,w=c.forwardRef(function(e,t){return(0,i.jsx)("button",(0,$._)((0,n._)({ref:t,type:"button",className:"inline-flex items-center p-1 rounded hover:bg-gray-100 transition-colors ".concat(l),"aria-label":"查看激励计算详情"},e),{children:(0,i.jsx)(ed.Z,{className:"h-4 w-4 text-gray-500 hover:text-gray-700"})}))});w.displayName="TriggerButton";var B=function(){if(y)return(0,i.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,i.jsx)(C.Z,{})});if(I)return(0,i.jsx)("div",{className:"text-center text-red-500 py-4",children:(0,i.jsxs)("p",{children:["加载失败：",I.message||"获取数据失败"]})});if(!N)return(0,i.jsx)("div",{className:"text-center text-gray-500 py-4",children:(0,i.jsx)("p",{children:"暂无数据"})});var e=N.theoreticalReward,t=N.govRatioMultiplier>BigInt(0),s=N.hasGovShortage,n=Number(N.govRatioPercent)*Number(N.govRatioMultiplier),r=s&&t;return(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("div",{className:"space-y-2 text-base",children:(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("div",{className:"font-medium",children:"锁定激励"}),(0,i.jsxs)("div",{children:["= 行动总激励 \xd7 有效 LP 代币占比",(0,i.jsx)("br",{}),"= ",(0,g.LH)(N.totalReward)," \xd7 ",(0,g.rl)(N.effectiveLpRatioPercent,6),(0,i.jsx)("br",{}),"= ",(0,g.LH)(e)]})]})}),(0,i.jsxs)("div",{className:"space-y-4 text-base",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("div",{className:"font-medium",children:"实际可铸造激励"}),(0,i.jsx)("div",{children:r?(0,i.jsxs)(i.Fragment,{children:["= 行动总激励 \xd7 MIN(有效LP代币占比, 治理票占比 \xd7 倍数)",(0,i.jsx)("br",{}),"= ",(0,g.LH)(N.totalReward)," \xd7 MIN(",(0,i.jsx)("span",{className:"text-secondary",children:(0,g.rl)(N.effectiveLpRatioPercent,6)}),","," ",(0,i.jsx)("span",{className:"text-secondary",children:(0,g.rl)(n,6)}),")",(0,i.jsx)("br",{}),"= ",(0,g.LH)(N.totalReward)," \xd7"," ",(0,i.jsx)("span",{className:"text-secondary",children:(0,g.rl)(Math.min(N.effectiveLpRatioPercent,n),6)}),(0,i.jsx)("br",{}),"= ",(0,i.jsx)("span",{className:"text-secondary",children:(0,g.LH)(N.userReward)})]}):(0,i.jsxs)(i.Fragment,{children:["= 锁定激励 = ",(0,i.jsx)("span",{className:"text-secondary",children:(0,g.LH)(N.userReward)})]})})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("div",{className:"font-medium",children:"溢出销毁激励"}),(0,i.jsx)("div",{children:r?(0,i.jsxs)(i.Fragment,{children:["= 锁定激励 - 实际可铸造激励",(0,i.jsx)("br",{}),"= ",(0,g.LH)(e)," - ",(0,g.LH)(N.userReward),(0,i.jsx)("br",{}),"= ",(0,i.jsx)("span",{className:"text-red-600",children:(0,g.LH)(e-N.userReward)})]}):(0,i.jsx)("span",{className:"text-green-600",children:"0"})})]})]}),(0,i.jsxs)("div",{className:"bg-gray-50 py-4 px-2 rounded-lg space-y-2",children:[(0,i.jsx)("div",{className:"font-semibold text-base text-gray-900",children:"有效 LP 代币占比："}),(0,i.jsxs)("div",{className:"space-y-2 text-sm text-gray-600 leading-relaxed",children:[(0,i.jsx)("div",{children:N.joinBlocks.length>0?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"mt-1",children:[(0,i.jsx)("span",{className:"text-gray-700 font-medium",children:"该账户 当轮扣除量"}),(0,i.jsx)("button",{type:"button",className:"ml-2 text-xs text-blue-500 hover:text-blue-700 underline",onClick:function(){return p(!f)},children:f?"隐藏明细":"查看明细"}),(0,i.jsx)("br",{}),"= ",(0,i.jsx)("span",{className:"text-secondary",children:(0,g.LH)(N.totalDeduction)})]}),f&&(0,i.jsxs)("div",{className:"mt-2 bg-gray-100 border border-gray-200 rounded-lg p-3 space-y-1",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,i.jsx)("span",{className:"text-gray-700 font-medium text-xs",children:"-- 本轮加入记录明细 --"}),(0,i.jsx)("button",{type:"button",className:"text-xs text-blue-500 hover:text-blue-700 underline",onClick:function(){return p(!1)},children:"隐藏明细"})]}),N.joinBlocks.map(function(e,t){var s=N.joinAmounts[t],n=e-N.roundStartBlock;return(0,i.jsxs)("div",{className:"mt-1",children:[(0,i.jsxs)("span",{className:"text-gray-700 font-medium",children:["在区块 ",e.toString()," 加入 ",(0,g.LH)(s)," 个LP 代币："]}),(0,i.jsx)("br",{}),"\xa0\xa0\xa0本次代币扣除量",(0,i.jsx)("br",{}),"= 加入代币数量 \xd7 (已过区块数 / 阶段总区块数)",(0,i.jsx)("br",{}),"= ",(0,g.LH)(s)," \xd7 (",e.toString()," -"," ",N.roundStartBlock.toString(),") / ",N.phaseBlocks.toString(),(0,i.jsx)("br",{}),"="," ",(0,i.jsx)("span",{className:"text-secondary",children:(0,g.LH)(N.phaseBlocks>BigInt(0)?s*n/N.phaseBlocks:BigInt(0))})]},t)}),(0,i.jsxs)("div",{className:"mt-2 text-xs text-gray-400",children:["备注：本轮起始区块 ",N.roundStartBlock.toString(),"；每轮总区块数 ",N.phaseBlocks.toString()]})]})]}):(0,i.jsxs)("div",{className:"mt-1",children:[(0,i.jsx)("span",{className:"text-gray-700 font-medium",children:"该账户 当轮扣除量"}),(0,i.jsx)("br",{}),"\xa0\xa0\xa0当轮没有追加代币，当轮扣除量 = 0"]})}),(0,i.jsxs)("div",{className:"mt-3",children:[(0,i.jsx)("span",{className:"text-gray-700 font-medium",children:"总有效 LP 代币数量"}),(0,i.jsx)("br",{}),"= 总参与 LP 代币数量 - 当轮总扣除量",(0,i.jsx)("br",{}),"= ",(0,g.LH)(N.totalLp)," - ",(0,g.LH)(N.roundTotalDeduction),(0,i.jsx)("br",{}),"= ",(0,i.jsx)("span",{className:"text-secondary",children:(0,g.LH)(N.totalEffectiveLp)})]}),(0,i.jsxs)("div",{className:"mt-3",children:[(0,i.jsx)("span",{className:"text-gray-700 font-medium",children:"有效 LP 代币占比"}),(0,i.jsx)("br",{}),"= (参与 LP 代币数量 - 当轮扣除量) / 总有效 LP 代币数量",(0,i.jsx)("br",{}),"= (",(0,g.LH)(N.userLp)," - ",(0,g.LH)(N.totalDeduction),") /"," ",(0,g.LH)(N.totalEffectiveLp),(0,i.jsx)("br",{}),"= ",(0,i.jsx)("span",{className:"text-secondary",children:(0,g.rl)(N.effectiveLpRatioPercent,6)})]})]})]}),t&&(0,i.jsxs)("div",{className:"bg-gray-50 py-4 px-2 rounded-lg space-y-2",children:[(0,i.jsx)("div",{className:"font-semibold text-base text-gray-900",children:(0,i.jsx)("span",{className:s?"text-red-600":"text-green-600",children:s?"治理票不足溢出：":"治理票充足，无溢出："})}),(0,i.jsxs)("div",{className:"space-y-2 text-sm text-gray-600 leading-relaxed",children:["\xa0\xa0\xa0治理票占比 \xd7 治理票占比倍数",(0,i.jsx)("br",{}),"= ",(0,g.rl)(N.govRatioPercent,6)," \xd7 ",Number(N.govRatioMultiplier),(0,i.jsx)("br",{}),"="," ",(0,i.jsx)("span",{className:"text-secondary",children:(0,g.rl)(n,6)})," ",s?"<":"≥"," 有效LP代币占比(",(0,g.rl)(N.effectiveLpRatioPercent,6),")",s&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("br",{}),(0,i.jsx)("span",{className:"inline-block text-gray-700 font-medium mt-1",children:"可铸造激励，降级为："}),(0,i.jsx)("br",{}),"\xa0\xa0\xa0行动总激励 \xd7 治理票占比 \xd7 治理票占比倍数"]})]})]})]})};return(0,i.jsxs)(i.Fragment,{children:[j&&(0,i.jsxs)(b.Vq,{open:x,onOpenChange:m,children:[(0,i.jsx)("div",{onClick:function(){return m(!0)},children:(0,i.jsx)(w,{})}),(0,i.jsxs)(b.cZ,{className:"sm:max-w-[500px]",children:[(0,i.jsx)(b.$N,{className:"text-lg font-semibold",children:"激励计算明细"}),(0,i.jsx)("div",{className:"pb-4 max-h-[70vh] overflow-y-auto",children:(0,i.jsx)(B,{})})]})]}),!j&&(0,i.jsxs)(eo.dy,{open:x,onOpenChange:m,children:[(0,i.jsx)("div",{onClick:function(){return m(!0)},children:(0,i.jsx)(w,{})}),(0,i.jsxs)(eo.sc,{className:"pb-safe",children:[(0,i.jsx)(eo.OX,{children:(0,i.jsx)(eo.iI,{className:"text-lg font-semibold",children:"激励计算明细"})}),(0,i.jsx)("div",{className:"px-3 pb-8 mb-10 max-h-[70vh] overflow-y-auto",children:(0,i.jsx)(B,{})})]})]})]})},ef=function(e){var t=e.extensionAddress,s=e.currentRound,u=e.actionId,x=(0,d.useRouter)(),m=(0,o.m)().address,f=((0,c.useContext)(l.M)||{}).token,p=x.query.round,j=p?BigInt(p):void 0,N=(0,r._)((0,c.useState)(BigInt(0)),2),y=N[0],b=N[1];(0,c.useEffect)(function(){j?b(j):s>BigInt(2)&&b(s-BigInt(2))},[j,s]);var I=ec({extensionAddress:t,tokenAddress:null==f?void 0:f.address,actionId:u,round:y}),w=I.participants,B=I.isEmpty,A=I.isPending,_=I.error,S=y===(0,v.Bk)().currentRound;if(A)return(0,i.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,i.jsx)(C.Z,{})});if(_)return(0,i.jsx)("div",{className:"text-center text-red-500 py-8",children:(0,i.jsxs)("p",{children:["加载失败：",_.message||"获取数据失败"]})});var M=(0,a._)(w).sort(function(e,t){var s=e.mintReward+e.burnReward,n=t.mintReward+t.burnReward;return s>n?-1:s<n?1:0});return(0,i.jsxs)("div",{className:"relative pb-4",children:[y===BigInt(0)&&(0,i.jsx)("div",{className:"flex items-center justify-center",children:(0,i.jsx)("div",{className:"text-center text-sm text-greyscale-500",children:"暂无激励结果"})}),(0,i.jsx)("div",{className:"flex items-center justify-between",children:(0,i.jsx)("div",{className:"flex items-center",children:y>0&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(k.Z,{title:"第 ".concat(y.toString()," 轮激励")}),(0,i.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"("}),(0,i.jsx)(R.Z,{currentRound:f&&s>BigInt(2)?(0,g.cK)(s-BigInt(2),f):BigInt(0),handleChangedRound:function(e){b(BigInt(e)),x.push({pathname:x.pathname,query:(0,$._)((0,n._)({},x.query),{round:e.toString()})},void 0,{shallow:!0})}}),(0,i.jsx)("span",{className:"text-sm text-greyscale-500",children:")"})]})})}),B?(0,i.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:S?"该轮激励结果还没生成好，请稍等":"该轮没有激励结果"}):y>BigInt(0)&&w.length>0?(0,i.jsx)("div",{className:"overflow-x-auto mt-4",children:(0,i.jsxs)("table",{className:"table w-full",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("th",{className:"px-0 text-left",children:" "}),(0,i.jsx)("th",{className:"px-1 text-left",children:"地址"}),(0,i.jsx)("th",{className:"px-1 text-right",children:"溢出销毁激励"}),(0,i.jsx)("th",{className:"px-1 text-right",children:"可铸造激励"})]})}),(0,i.jsx)("tbody",{children:M.map(function(e,s){return(0,i.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.address===m?"text-secondary":""),children:[(0,i.jsx)("td",{className:"px-0 text-sm text-left text-greyscale-500",children:s+1}),(0,i.jsx)("td",{className:"px-1",children:(0,i.jsx)(h.Z,{address:e.address,showCopyButton:!0,word:e.address===m?"(我)":""})}),(0,i.jsx)("td",{className:"px-1 text-right text-greyscale-500",children:e.burnReward!==BigInt(0)?"-".concat((0,g.LH)(e.burnReward)):(0,g.LH)(e.burnReward)}),(0,i.jsx)("td",{className:"px-1 text-right",children:(0,i.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[(0,i.jsx)("span",{children:(0,g.LH)(e.mintReward)}),(e.mintReward>BigInt(0)||e.burnReward>BigInt(0))&&(0,i.jsx)(eg,{extensionAddress:t,tokenAddress:null==f?void 0:f.address,account:e.address,round:y})]})})]},e.address)})})]})}):null]})},ep=function(e){var t=e.extensionAddress,s=e.currentRound,a=e.actionId,o=(0,d.useRouter)(),u=((0,c.useContext)(l.M)||{}).token,x=(0,r._)((0,c.useState)("current"),2),m=x[0],h=x[1],g=o.query.tab2;(0,c.useEffect)(function(){g&&["current","history"].includes(g)&&h(g)},[g]);var f=function(e){h(e);var t=(0,n._)({},o.query);t.tab2=e,o.push({pathname:o.pathname,query:t},void 0,{shallow:!0})};return(0,i.jsxs)("div",{className:"bg-white rounded-lg",children:[(0,i.jsx)("div",{className:"flex bg-muted rounded-lg p-1 mb-4 mx-16",children:[{key:"current",label:"当前参与"},{key:"history",label:"激励公示"}].map(function(e){return(0,i.jsx)("button",{onClick:function(){return f(e.key)},className:"flex-1 px-2 py-1 text-sm font-medium rounded-md transition-all duration-200 ".concat(m===e.key?"bg-white text-secondary shadow-sm":"text-gray-500 hover:text-gray-800 hover:bg-gray-50"),children:e.label},e.key)})}),"current"===m?(0,i.jsx)(ea,{extensionAddress:t,tokenAddress:null==u?void 0:u.address,actionId:a}):(0,i.jsx)(ef,{extensionAddress:t,currentRound:s,actionId:a})]})},ej=s(82022),ev=s(86501),eN=s(8945),ey=s(10221),eb="0x6c720b8a9c4803E7D78849E10fe535d862ACbfD1",eI=function(e){var t=e.actionId,s=e.extensionAddress,n=e.tokenAddress,r=e.round,a=(0,ey.rG)(s,r||BigInt(0)),i=a.groupOwners,d=a.isPending,o=a.error,l=(0,c.useMemo)(function(){if(!s||void 0===r||!i||0===i.length)return[];var e=[],t=!0,n=!1,a=void 0;try{for(var c,d=i[Symbol.iterator]();!(t=(c=d.next()).done);t=!0){var o=c.value;e.push({address:eb,abi:eN.l,functionName:"groupIdsByVerifier",args:[s,r,o]})}}catch(e){n=!0,a=e}finally{try{t||null==d.return||d.return()}finally{if(n)throw a}}return e},[s,r,i]),u=(0,X.N)({contracts:l,query:{enabled:!!s&&!!r&&!!i&&i.length>0}}),x=u.data,m=u.isPending,h=u.error,g=(0,c.useMemo)(function(){if(!i||!x)return new Map;var e=new Map;return i.forEach(function(t,s){var n,r=(null===(n=x[s])||void 0===n?void 0:n.result)||[];e.set(t.toLowerCase(),r)}),e},[i,x]),f=(0,G.wD)(n,r||BigInt(0),t),p=f.votesNumByActionId,j=f.isPending,v=f.error,N=(0,c.useMemo)(function(){if(!s||void 0===r||!i||0===i.length)return[];var e=[],t=!0,n=!1,a=void 0;try{for(var c,d=i[Symbol.iterator]();!(t=(c=d.next()).done);t=!0){var o=c.value;e.push({address:eb,abi:eN.l,functionName:"distrustVotesByGroupOwner",args:[s,r,o]})}}catch(e){n=!0,a=e}finally{try{t||null==d.return||d.return()}finally{if(n)throw a}}return e},[s,r,i]),y=(0,X.N)({contracts:N,query:{enabled:!!s&&!!r&&!!i&&i.length>0&&N.length>0}}),b=y.data,I=y.isPending,w=y.error;return{distrustVotes:(0,c.useMemo)(function(){if(!b||!i||0===i.length||void 0===p)return[];for(var e=p||BigInt(0),t=[],s=0;s<i.length;s++){var n,r=i[s],a=(0,et.Zu)(null===(n=b[s])||void 0===n?void 0:n.result),c=e>BigInt(0)?Number(a)/Number(e):0,d=g.get(r.toLowerCase())||[];t.push({groupOwner:r,groupIds:d,distrustVotes:a,totalVotes:e,distrustRatio:c})}return t},[b,i,g,p]),isPending:(0,c.useMemo)(function(){return!!d||!!i&&0!==i.length&&(!!m||!!j||I)},[d,i,m,j,I]),error:o||h||v||w}},ew=s(59250),eB=s(88308),eA=s(27966),eR=function(e){var t,s=e.actionId,n=(e.actionInfo,e.extensionAddress),a=e.onStartVote,d=((0,c.useContext)(l.M)||{}).token,u=(0,o.m)().address,x=(0,O.Bk)(),m=x.currentRound,f=x.isPending,p=x.error,j=(0,r._)((0,c.useState)(BigInt(0)),2),v=j[0],N=j[1];(0,c.useEffect)(function(){m&&m>BigInt(0)&&N(m)},[m]);var y=(0,c.useMemo)(function(){return v===m&&void 0!==m},[v,m]),I=eI({actionId:s,extensionAddress:n,tokenAddress:null==d?void 0:d.address,round:v>BigInt(0)?v:void 0}),w=I.distrustVotes,A=I.isPending,_=I.error,S=(0,O.Tl)(null==d?void 0:d.address,y&&m||BigInt(0),u,s),M=S.scoreByVerifierByActionId,L=(S.isPending,S.error),Z=null==w?void 0:null===(t=w[0])||void 0===t?void 0:t.groupOwner,E=(0,ey.OB)(n,y&&m||BigInt(0),u,y&&Z?Z:"0x0000000000000000000000000000000000000000"),H=E.votes,T=(E.isPending,E.error),V=(0,c.useMemo)(function(){if(!y||null==M||null==H)return BigInt(0);var e=M-H;return e>BigInt(0)?e:BigInt(0)},[y,M,H]),D=(0,c.useMemo)(function(){if(!w)return[];var e=new Set;return w.forEach(function(t){t.groupIds.forEach(function(t){return e.add(t)})}),Array.from(e)},[w]),F=(0,eB.h)({groupIds:D.length>0?D:void 0}).groupNameMap,G=(0,r._)((0,c.useState)(!1),2),z=G[0],J=G[1],K=(0,r._)((0,c.useState)(null),2),W=K[0],U=K[1],$=(0,ew.o)({extensionAddress:n,tokenAddress:null==d?void 0:d.address,actionId:s,round:v,groupOwner:null==W?void 0:W.address}),X=$.voterDistrusts,Y=$.isPending,Q=$.error,ee=(0,eA.b)().handleError;(0,c.useEffect)(function(){_&&ee(_),Q&&ee(Q),p&&ee(p),L&&ee(L),T&&ee(T)},[_,Q,p,L,T,ee]);var et=function(e,t){U({address:e,groupIds:t}),J(!0)};return(A||f)&&(!w||v===BigInt(0))?(0,i.jsxs)("div",{className:"flex flex-col items-center py-8",children:[(0,i.jsx)(C.Z,{}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:"加载不信任投票数据..."})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(k.Z,{title:"第 ".concat((null==v?void 0:v.toString())||"0"," 轮")}),(0,i.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"("}),(0,i.jsx)(R.Z,{currentRound:m||BigInt(0),handleChangedRound:function(e){N(BigInt(e))}}),(0,i.jsx)("span",{className:"text-sm text-greyscale-500",children:")"})]}),y&&(0,i.jsx)(B(),{href:"#",onClick:function(){if(!u){ev.Am.error("请先连接钱包");return}if(!M||M===BigInt(0)){ev.Am.error('只有投治理票给本行动，并完成"验证"的治理者才能投不信任票');return}if(V<=BigInt(1e5)&&Z){ev.Am.error("您已投完所有不信任票");return}a()},className:"text-sm text-secondary hover:text-secondary/80 ml-2",children:"投不信任票 >>"})]}),w&&0!==w.length?(0,i.jsx)("div",{className:"overflow-x-auto mt-4",children:(0,i.jsxs)("table",{className:"table w-full",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("th",{className:"px-8 text-left",children:"服务者 / 验证的链群"}),(0,i.jsx)("th",{className:"px-1 text-center",children:"不信任率"}),(0,i.jsx)("th",{className:"px-1"})]})}),(0,i.jsx)("tbody",{children:w.map(function(e,t){return(0,i.jsxs)("tr",{onClick:function(){return et(e.groupOwner,e.groupIds)},className:"border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-all",children:[(0,i.jsxs)("td",{className:"px-1",children:[(0,i.jsx)("div",{className:"",children:(0,i.jsx)(h.Z,{address:e.groupOwner,showCopyButton:!0})}),(0,i.jsx)("div",{className:"flex flex-wrap gap-x-2 gap-y-1",children:e.groupIds.length>0?e.groupIds.map(function(t,s){var n=F.get(t);return(0,i.jsxs)("span",{className:"inline-flex items-center",children:[n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"text-gray-500 text-xs",children:"#"}),(0,i.jsx)("span",{className:"text-sm font-medium ml-1",children:t.toString()}),(0,i.jsx)("span",{className:"text-sm text-gray-800 ml-2",children:n})]}):(0,i.jsxs)("span",{className:"text-xs text-gray-600",children:["#",t.toString()]}),s<e.groupIds.length-1&&(0,i.jsx)("span",{className:"text-gray-400",children:","})]},t.toString())}):(0,i.jsx)("span",{className:"text-xs text-gray-600",children:"-"})})]}),(0,i.jsx)("td",{className:"px-1 text-center",children:(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)("span",{className:"font-medium ".concat(e.distrustRatio>.5?"text-red-600":e.distrustRatio>.2?"text-orange-600":"text-gray-800"),children:(0,g.rl)(100*e.distrustRatio)}),(0,i.jsxs)("span",{className:"text-xs text-gray-400",children:["(",(0,g.LH)(e.distrustVotes),"/",(0,g.LH)(e.totalVotes),")"]})]})}),(0,i.jsx)("td",{className:"px-1",children:(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)(q.Z,{className:"w-5 h-5 text-gray-400"})})})]},"".concat(e.groupOwner,"-").concat(t))})})]})}):(0,i.jsx)("div",{className:"text-center py-12",children:(0,i.jsx)("p",{className:"text-gray-500 mb-2",children:"该验证轮，没有不信任投票"})}),(0,i.jsxs)("div",{className:"mt-6 text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded px-3 py-2",children:[(0,i.jsx)("div",{className:"font-medium text-gray-700 mb-1",children:"\uD83D\uDCA1 小贴士"}),(0,i.jsxs)("div",{className:"space-y-1 text-gray-600",children:[(0,i.jsx)("div",{children:'• “投票”给本行动、并完成"验证"的治理者，可以投不信任票；'}),(0,i.jsx)("div",{children:"• 不信任票越多，该服务者的链群获得激励越少；"})]})]})]}),(0,i.jsx)(b.Vq,{open:z,onOpenChange:J,children:(0,i.jsxs)(b.cZ,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[(0,i.jsx)(b.fK,{children:(0,i.jsxs)(b.$N,{children:["第 ",(null==v?void 0:v.toString())||"0"," 轮不信任投票明细"]})}),Y?(0,i.jsxs)("div",{className:"flex flex-col items-center py-8",children:[(0,i.jsx)(C.Z,{}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:"加载投票详情..."})]}):X&&0!==X.length?(0,i.jsxs)("div",{className:"space-y-2",children:[W&&(0,i.jsxs)("div",{className:"text-sm text-gray-600 text-center",children:["服务者：",(0,i.jsx)(h.Z,{address:W.address})]}),(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"table w-full",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("th",{className:"px-8 text-left",children:"投票来源地址"}),(0,i.jsx)("th",{className:"px-1 text-center",children:"所投不信任票"}),(0,i.jsx)("th",{className:"px-1 text-center",children:"不信任程度"})]})}),(0,i.jsx)("tbody",{children:X.map(function(e,t){return(0,i.jsxs)(c.Fragment,{children:[(0,i.jsxs)("tr",{className:"border-none pb-0",children:[(0,i.jsx)("td",{className:"px-1 pb-0",children:(0,i.jsx)(h.Z,{address:e.voter,showCopyButton:!0})}),(0,i.jsx)("td",{className:"px-1 pb-0 text-center text-sm text-gray-600",children:(0,g.LH)(e.distrustVotes)}),(0,i.jsx)("td",{className:"px-1 pb-0 text-center",children:(0,i.jsx)("span",{className:"text-sm font-medium ".concat(e.distrustRatio>.5?"text-red-600":e.distrustRatio>0?"text-orange-600":"text-gray-500"),children:(0,g.rl)(100*e.distrustRatio)})})]}),(e.reason||e.verifyVotes)&&(0,i.jsx)("tr",{className:"border-b border-gray-100",children:(0,i.jsxs)("td",{colSpan:3,className:"px-1 pt-0 pb-2",children:[e.reason&&(0,i.jsxs)("div",{className:"text-xs text-gray-600 mb-1 pl-2 border-l-2 border-gray-200",children:[(0,i.jsx)("span",{className:"font-medium",children:"原因: "}),e.reason]}),(0,i.jsxs)("div",{className:"text-xs text-gray-400",children:["总验证票: ",(0,g.LH)(e.verifyVotes)]})]})})]},"".concat(e.voter,"-").concat(t))})})]})}),(0,i.jsx)("div",{className:"flex justify-end pt-4",children:(0,i.jsx)(P.z,{variant:"outline",onClick:function(){J(!1),U(null)},children:"关闭"})})]}):(0,i.jsx)("div",{className:"text-center py-8 text-gray-500",children:"暂无投票详情"})]})})]})},ek=s(21879),eC=function(e){var t=e.extensionAddress,s=e.onSelectOwner,n=e.onCancel,r=(0,v.Bk)().currentRound,a=(0,ek.Ko)({extensionAddress:t,round:r}),d=a.groups,o=a.isPending,l=a.error,u=(0,eA.b)().handleError;(0,c.useEffect)(function(){l&&u(l)},[l,u]);var x=(0,c.useMemo)(function(){if(!d)return[];var e=new Map;return d.forEach(function(t){var s=t.owner.toLowerCase();e.has(s)||e.set(s,{owner:t.owner,groups:[]}),e.get(s).groups.push(t)}),Array.from(e.values())},[d]);return o?(0,i.jsxs)("div",{className:"flex flex-col items-center py-8",children:[(0,i.jsx)(C.Z,{}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:"加载服务者列表..."})]}):x&&0!==x.length?(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)(k.Z,{title:"选择不信任的服务者："}),(0,i.jsx)("div",{className:"space-y-3",children:x.map(function(e,t){return(0,i.jsx)("div",{onClick:function(){return s(e.owner)},className:"border border-gray-200 rounded-lg p-4 hover:border-secondary hover:bg-secondary/5 cursor-pointer transition-all",children:(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("div",{className:"w-5 h-5 rounded-full border-2 border-gray-300 flex items-center justify-center flex-shrink-0",children:(0,i.jsx)("div",{className:"w-2.5 h-2.5 rounded-full bg-transparent"})}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,i.jsx)("span",{className:"text-sm text-gray-500",children:"服务者:"}),(0,i.jsx)(h.Z,{address:e.owner,showCopyButton:!0})]}),(0,i.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,i.jsx)("span",{className:"text-gray-500",children:"链群: "}),e.groups.map(function(t,s){return(0,i.jsxs)("span",{children:["#",t.groupId.toString()," ",t.groupName,s<e.groups.length-1&&", "]},t.groupId.toString())})]})]})]})},"".concat(e.owner,"-").concat(t))})}),(0,i.jsx)("div",{className:"flex justify-center",children:(0,i.jsx)(P.z,{variant:"outline",onClick:n,className:"w-1/2",children:"取消"})}),(0,i.jsxs)("div",{className:"mt-6 text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded px-3 py-2",children:[(0,i.jsx)("div",{className:"font-medium text-gray-700 mb-1",children:"\uD83D\uDCA1 投票说明"}),(0,i.jsxs)("div",{className:"space-y-1 text-gray-600",children:[(0,i.jsx)("div",{children:"• 只有给本行动投过票的治理者才能投不信任票"}),(0,i.jsx)("div",{children:"• 不信任票不能超过您对本行动投的验证票数"}),(0,i.jsx)("div",{children:"• 投票时需要说明不信任的原因"})]})]})]}):(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)(k.Z,{title:"选择不信任的服务者："}),(0,i.jsxs)("div",{className:"text-center py-12",children:[(0,i.jsx)("p",{className:"text-gray-500 mb-4",children:"暂无可投票的服务者"}),(0,i.jsx)(P.z,{variant:"outline",onClick:n,children:"返回"})]})]})},e_=s(11010),eS=s(97582),eM=s(56312),eP=s(87536),eL=s(45901),eZ=s(74193),eE=s(88659),eH=s(76453),eT=s(44576),eV=[{label:"10% 不信任票",value:.1},{label:"20% 不信任票",value:.2},{label:"30% 不信任票",value:.3},{label:"40% 不信任票",value:.4},{label:"50% 不信任票",value:.5},{label:"60% 不信任票",value:.6},{label:"70% 不信任票",value:.7},{label:"80% 不信任票",value:.8},{label:"90% 不信任票",value:.9},{label:"100% 不信任票",value:1}],eD=function(e){var t=e.actionId,s=(e.actionInfo,e.extensionAddress),r=e.groupOwner,a=e.onCancel,d=e.onSuccess,u=((0,c.useContext)(l.M)||{}).token,x=(0,o.m)().address,m=(0,O.Bk)(),f=m.currentRound,p=m.isPending,j=m.error,v=(0,O.Tl)(null==u?void 0:u.address,f||BigInt(0),x,t),N=v.scoreByVerifierByActionId,y=v.isPending,b=v.error,I=(0,ey.OB)(s,f||BigInt(0),x,r),w=I.votes,B=I.isPending,A=I.error,R=(0,c.useMemo)(function(){if(null==N||null==w)return BigInt(0);var e=N-w;return e>BigInt(0)?e:BigInt(0)},[N,w]),_=(0,c.useMemo)(function(){return R<=BigInt(1e5)},[R]),S=(0,c.useMemo)(function(){return f?f+BigInt(1):void 0},[f]),M=(0,ek.Ko)({extensionAddress:s,round:S}),L=M.groups,Z=M.isPending,E=M.error,H=(0,c.useMemo)(function(){return L?L.filter(function(e){return e.owner.toLowerCase()===r.toLowerCase()}):[]},[L,r]),T=eL.Ry({ratio:eL.Rx().min(.1).max(1,{message:"请选择不信任比例"}),reason:eL.Z_().min(1,{message:"请输入不信任的原因"}).max(500,{message:"原因不能超过500字"})}),V=(0,eP.cI)({resolver:(0,eM.F)(T),defaultValues:{ratio:0,reason:""},mode:"onChange"}),D=V.watch("ratio"),q=(0,c.useMemo)(function(){if(!R||R===BigInt(0)||0===D)return BigInt(0);var e=R*BigInt(Math.floor(1e4*D))/BigInt(1e4);return e>R?R:e},[R,D]),F=(0,ey.Uj)(),G=F.distrustVote,z=F.isPending,J=F.isConfirming,K=F.isConfirmed,W=F.writeError;function U(){return(U=(0,e_._)(function(e){return(0,eS.Jh)(this,function(t){switch(t.label){case 0:if(!N||N===BigInt(0))return ev.Am.error("您没有验证票，无法投不信任票"),[2];if(_)return ev.Am.error("您已经投完所有不信任票"),[2];if(q===BigInt(0))return ev.Am.error("请选择不信任比例"),[2];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,G(s,r,q,e.reason)];case 2:return t.sent(),[3,4];case 3:return console.error("Distrust vote failed",t.sent()),[3,4];case 4:return[2]}})})).apply(this,arguments)}(0,c.useEffect)(function(){K&&(ev.Am.success("不信任投票提交成功"),setTimeout(function(){d()},1500))},[K,d]);var X=(0,eA.b)().handleError;return((0,c.useEffect)(function(){j&&X(j),b&&X(b),E&&X(E),A&&X(A),W&&X(W)},[j,b,E,A,W,X]),(null==u?void 0:u.address)&&x)?p||y||Z||B?(0,i.jsxs)("div",{className:"flex flex-col items-center py-8",children:[(0,i.jsx)(C.Z,{}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:"加载投票信息..."})]}):N===BigInt(0)?(console.warn("⚠️ 没有投票权限，myVerifyVotes 为 0"),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)(k.Z,{title:"对该服务者投不信任票"}),(0,i.jsxs)("div",{className:"text-center py-12",children:[(0,i.jsx)("p",{className:"text-red-500 mb-4",children:"您没有投票权限"}),(0,i.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:"只有给本行动投过验证票的治理者才能投不信任票"}),(0,i.jsxs)("div",{className:"text-xs text-gray-500 mt-4 p-3 bg-gray-50 rounded border border-gray-200",children:[(0,i.jsx)("div",{children:"调试信息："}),(0,i.jsxs)("div",{children:["Token: ",null==u?void 0:u.address]}),(0,i.jsxs)("div",{children:["Round: ",null==f?void 0:f.toString()]}),(0,i.jsxs)("div",{children:["Account: ",x]}),(0,i.jsxs)("div",{children:["ActionId: ",t.toString()]}),(0,i.jsxs)("div",{children:["MyVerifyVotes: ",null==N?void 0:N.toString()]})]}),(0,i.jsx)(P.z,{variant:"outline",onClick:a,className:"mt-4",children:"返回"})]})]})):_?(console.warn("⚠️ 已投完所有不信任票"),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)(k.Z,{title:"对该服务者投不信任票"}),(0,i.jsxs)("div",{className:"text-center py-12",children:[(0,i.jsx)("p",{className:"text-amber-600 mb-4",children:"您已投完所有不信任票"}),(0,i.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:"您对该服务者的不信任票已全部投出"}),(0,i.jsxs)("div",{className:"text-xs text-gray-500 mt-4 p-3 bg-gray-50 rounded border border-gray-200",children:[(0,i.jsxs)("div",{children:["总验证票数: ",(0,g.LH)(N)]}),(0,i.jsxs)("div",{children:["已投不信任票: ",(0,g.LH)(w||BigInt(0))]}),(0,i.jsxs)("div",{children:["剩余票数: ",(0,g.LH)(R)]})]}),(0,i.jsx)(P.z,{variant:"outline",onClick:a,className:"mt-4",children:"返回"})]})]})):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)(k.Z,{title:"对该服务者投不信任票"}),(0,i.jsxs)("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[(0,i.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:[(0,i.jsx)("span",{className:"font-medium",children:"服务者："}),(0,i.jsx)(h.Z,{address:r})]}),H.length>0&&(0,i.jsxs)("div",{className:"mt-3 text-sm text-gray-600",children:[(0,i.jsx)("span",{className:"font-medium",children:"链群："}),H.map(function(e,t){return(0,i.jsxs)("span",{children:[(0,i.jsx)("span",{className:"text-gray-500 text-xs",children:"#"}),(0,i.jsx)("span",{className:"font-semibold ",children:e.groupId.toString()})," ",(0,i.jsx)("span",{className:"font-semibold text-gray-800",children:e.groupName}),t<H.length-1&&", "]},e.groupId.toString())})]})]}),N!==R&&(0,i.jsx)("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg text-sm",children:(0,i.jsx)("div",{className:"space-y-1",children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-gray-600",children:"已投不信任票: "}),(0,i.jsx)("span",{className:"font-medium text-amber-700",children:(0,g.LH)(w||BigInt(0))})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-gray-600",children:"剩余可投票数: "}),(0,i.jsx)("span",{className:"font-medium text-green-700",children:(0,g.LH)(R)})]})]})})}),(0,i.jsx)(eZ.l0,(0,$._)((0,n._)({},V),{children:(0,i.jsxs)("form",{onSubmit:function(e){return e.preventDefault()},className:"space-y-4",children:[(0,i.jsx)(eZ.Wi,{control:V.control,name:"ratio",render:function(e){var t=e.field;return(0,i.jsxs)(eZ.xJ,{children:[(0,i.jsx)(eZ.lX,{className:"text-greyscale-500 font-normal",children:"选择不信任比例："}),(0,i.jsx)(eZ.NI,{children:(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)(eE.Ph,{value:t.value>0?t.value.toString():"",onValueChange:function(e){t.onChange(parseFloat(e))},children:[(0,i.jsx)(eE.i4,{className:"!ring-secondary-foreground",children:(0,i.jsx)(eE.ki,{placeholder:"请选择不信任比例"})}),(0,i.jsx)(eE.Bw,{children:eV.map(function(e){return(0,i.jsx)(eE.Ql,{value:e.value.toString(),children:e.label},e.value.toString())})})]}),t.value>0&&(0,i.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["将投 ",(0,g.LH)(BigInt(Number(R)*t.value))," 不信任票"]})]})}),(0,i.jsx)(eZ.zG,{})]})}}),(0,i.jsx)(eZ.Wi,{control:V.control,name:"reason",render:function(e){var t=e.field;return(0,i.jsxs)(eZ.xJ,{children:[(0,i.jsx)(eZ.lX,{className:"text-greyscale-500 font-normal",children:"不信任原因："}),(0,i.jsx)(eZ.NI,{children:(0,i.jsx)(eH.g,(0,n._)({placeholder:"请详细说明不信任该服务者的原因...",className:"!ring-secondary-foreground min-h-[120px]"},t))}),(0,i.jsx)(eZ.zG,{})]})}}),(0,i.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,i.jsx)(P.z,{variant:"outline",className:"w-1/2",onClick:a,disabled:z||J,children:"取消"}),(0,i.jsx)(P.z,{disabled:z||J||K||_,type:"button",className:"w-1/2",onClick:function(){V.handleSubmit(function(e){return function(e){return U.apply(this,arguments)}(e)})()},children:z?"提交中...":J?"确认中...":K?"已提交":"提交"})]})]})})),(0,i.jsxs)("div",{className:"mt-6 text-sm text-gray-600 bg-amber-50 border border-amber-200 rounded px-3 py-2",children:[(0,i.jsx)("div",{className:"font-medium text-amber-800 mb-1",children:"⚠️ 小贴士"}),(0,i.jsx)("div",{className:"space-y-1 text-amber-700",children:(0,i.jsx)("div",{children:"• 不信任投票会降低该服务者管理的所有链群的激励"})})]})]}),(0,i.jsx)(eT.Z,{isLoading:z||J,text:z?"提交投票...":"确认投票..."})]}):(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)(k.Z,{title:"对该服务者投不信任票"}),(0,i.jsxs)("div",{className:"text-center py-12",children:[(0,i.jsx)("p",{className:"text-red-500 mb-4",children:"请先连接钱包"}),(0,i.jsx)(P.z,{variant:"outline",onClick:a,children:"返回"})]})]})},eq=function(e){var t=e.actionId,s=e.actionInfo,n=e.extensionAddress,a=(0,r._)((0,c.useState)("list"),2),d=a[0],o=a[1],l=(0,r._)((0,c.useState)(),2),u=l[0],x=l[1],m=function(){o("list"),x(void 0)};return"submit"===d&&u?(0,i.jsx)(eD,{actionId:t,actionInfo:s,extensionAddress:n,groupOwner:u,onCancel:m,onSuccess:function(){o("list"),x(void 0)}}):"select"===d?(0,i.jsx)(eC,{extensionAddress:n,onSelectOwner:function(e){x(e),o("submit")},onCancel:m}):(0,i.jsx)(eR,{actionId:t,actionInfo:s,extensionAddress:n,onStartVote:function(){o("select")}})},eF=s(8267),eO=s(48886),eG=function(e){var t=e.actionId,s=(e.actionInfo,e.extensionAddress),n=(0,d.useRouter)(),r=((0,c.useContext)(l.M)||{}).token,u=(0,o.m)().address,x=(0,v.Bk)().currentRound,m=(0,ek.Ko)({extensionAddress:s,round:x}),f=m.groups,p=m.isPending,j=m.error,N=(0,eO.aB)(s,x||BigInt(0),u),y=N.groupId,b=N.isPending,I=N.error,w=(0,eA.b)().handleError;(0,c.useEffect)(function(){j&&w(j),I&&w(I)},[j,I,w]);var A=(0,c.useMemo)(function(){if(!f||0===f.length)return[];var e=f.filter(function(e){return u&&e.owner.toLowerCase()===u.toLowerCase()}),t=f.filter(function(e){return void 0!==y&&e.groupId===y&&!(u&&e.owner.toLowerCase()===u.toLowerCase())}),s=f.filter(function(e){return!(u&&e.owner.toLowerCase()===u.toLowerCase())&&!(void 0!==y&&e.groupId===y)}),n=(0,a._)(s).sort(function(){return Math.random()-.5});return(0,a._)(e).concat((0,a._)(t),(0,a._)(n))},[f,u,y]),R=function(e){n.push("/extension/group?groupId=".concat(e.toString(),"&actionId=").concat(t.toString(),"&symbol=").concat(null==r?void 0:r.symbol))};return p||b?(0,i.jsxs)("div",{className:"flex flex-col items-center py-8",children:[(0,i.jsx)(C.Z,{}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:"加载链群列表..."})]}):f&&0!==f.length?(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)(k.Z,{title:"链群列表 (".concat(f.length,")")}),(0,i.jsx)(B(),{href:"/extension/group_op?actionId=".concat(t.toString(),"&op=activate"),className:"text-sm text-secondary hover:text-secondary/80 ml-2",children:"激活链群 >>"})]}),(0,i.jsx)("div",{className:"space-y-3",children:A.map(function(e){var t=u&&e.owner.toLowerCase()===u.toLowerCase(),s=void 0!==y&&e.groupId===y;return(0,i.jsx)("div",{onClick:function(){return R(e.groupId)},className:"border border-gray-200 rounded-lg py-3 pl-3 pr-0 hover:border-secondary hover:bg-secondary/5 cursor-pointer transition-all",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"text-gray-800 mb-2 flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center items-baseline",children:[(0,i.jsx)("span",{className:"text-gray-500 text-xs",children:"#"}),(0,i.jsx)("span",{className:"text-secondary text-base font-semibold",children:e.groupId.toString()})," ",(0,i.jsx)("span",{className:"font-semibold ml-1",children:e.groupName}),t?(0,i.jsx)("span",{className:"text-secondary text-xs ml-1",children:"(我的)"}):s?(0,i.jsx)("span",{className:"text-secondary text-xs ml-1",children:"(我参与)"}):null]}),(0,i.jsxs)("div",{className:"text-sm text-gray-600 flex items-center gap-1",children:[(0,i.jsx)(eF.Z,{className:"text-greyscale-400 h-3 w-3"}),(0,i.jsx)("span",{className:"text-greyscale-400",children:(0,i.jsx)(h.Z,{address:e.owner,showCopyButton:!1})})]})]}),(0,i.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:[(0,i.jsx)("span",{children:"单地址代币限制: "}),(0,i.jsxs)("span",{children:[(0,g.LH)(e.actualMinJoinAmount)," ~\xa0",e.actualMaxJoinAmount>BigInt(0)?(0,g.LH)(e.actualMaxJoinAmount):"不限"," "]})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between text-xs mt-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-gray-500",children:"参与代币数:"}),function(){if(e.maxCapacity<=BigInt(0))return(0,i.jsx)("span",{className:"text-gray-500",children:(0,g.LH)(e.totalJoinedAmount)});var t=Number(e.totalJoinedAmount)/Number(e.maxCapacity)*100;return(0,i.jsxs)("span",{className:t>95?"text-red-600":t>=90?"text-yellow-600":"text-gray-500",children:[(0,g.LH)(e.totalJoinedAmount)," (",(0,g.rl)(t),")"]})}()]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-gray-500",children:"参与地址数:"}),(0,i.jsx)("span",{className:"text-gray-500",children:e.accountCount.toString()})]})]})]}),(0,i.jsx)(q.Z,{className:"w-5 h-5 text-gray-400"})]})},e.groupId.toString())})}),(0,i.jsxs)("div",{className:"mt-6 text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded px-3 py-2",children:[(0,i.jsx)("div",{className:"font-medium text-gray-700 mb-1",children:"\uD83D\uDCA1 小贴士"}),(0,i.jsxs)("div",{className:"space-y-1 text-gray-600",children:[(0,i.jsx)("div",{children:"• 每个链群，由所属服务者对成员进行验证和打分"}),(0,i.jsx)("div",{children:"• 加入链群后，您的激励将基于服务者的验证打分"})]})]})]}):(0,i.jsxs)("div",{className:"text-center py-6",children:[(0,i.jsx)("p",{className:"text-gray-500 mb-2",children:"暂无被激活的链群"}),(0,i.jsx)("div",{className:"",children:(0,i.jsx)(P.z,{asChild:!0,className:"w-1/2 text-secondary border-secondary",variant:"outline",children:(0,i.jsx)(B(),{href:"/extension/group_op?actionId=".concat(t.toString(),"&op=activate"),children:"去激活链群 >>"})})})]})},ez=s(34146),eJ=s(35611),eK=function(e){var t=e.extensionAddress,s=e.round,n=e.groupIds,r=(0,c.useMemo)(function(){if(!t||void 0===s||!n||0===n.length)return[];var e=[],r=!0,a=!1,i=void 0;try{for(var c,d=n[Symbol.iterator]();!(r=(c=d.next()).done);r=!0){var o=c.value;e.push({address:"0x6c720b8a9c4803E7D78849E10fe535d862ACbfD1",abi:eN.l,functionName:"capacityDecayRateByGroupId",args:[t,s,o]})}}catch(e){a=!0,i=e}finally{try{r||null==d.return||d.return()}finally{if(a)throw i}}return e},[t,s,n]),a=(0,X.N)({contracts:r,query:{enabled:!!t&&!!s&&!!n&&n.length>0&&r.length>0}}),i=a.data,d=a.isPending,o=a.error;return{capacityDecayRates:(0,c.useMemo)(function(){var e=new Map;return n&&i&&0!==i.length&&n.forEach(function(t,s){var n,r=null===(n=i[s])||void 0===n?void 0:n.result;null!=r&&e.set(t,(0,et.Zu)(r))}),e},[n,i]),isPending:(0,c.useMemo)(function(){return!!n&&0!==n.length&&0!==r.length&&d},[n,r.length,d]),error:o}},eW=function(e){var t,s,d,o,u,x,m,h,f,p,j,v,N,y,b,I,w,A=e.actionId,_=e.extensionAddress,S=((0,c.useContext)(l.M)||{}).token,M=(0,O.Bk)(),P=M.currentRound,L=M.isPending,Z=M.error,E=(0,r._)((0,c.useState)(BigInt(0)),2),H=E[0],T=E[1];(0,c.useEffect)(function(){P&&P>BigInt(1)&&T(P-BigInt(1))},[P]);var V=(s=(t={round:H>BigInt(0)?H:void 0,extensionAddress:_}).round,d=t.extensionAddress,u=(o=(0,ey.tI)(d||"0x0",s||BigInt(0))).verifiedGroupIds,x=o.isPending,m=o.error,h=(0,c.useMemo)(function(){return u||[]},[u]),p=(f=(0,eB.h)({groupIds:h,enabled:h.length>0})).groupNameMap,j=f.isPending,v=f.error,N=(0,c.useMemo)(function(){if(!d||void 0===s||0===h.length)return[];var e=[],t=!0,n=!1,r=void 0;try{for(var a,i=h[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var c=a.value;e.push({address:d,abi:ez.r,functionName:"generatedActionRewardByGroupId",args:[s,c]}),e.push({address:"0xd94e4Fc2108B78Aa57438BFe5E85192687f74322",abi:eJ.w,functionName:"totalJoinedAmountByGroupId",args:[d,s,c]})}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return e},[d,s,h]),b=(y=(0,X.N)({contracts:N,query:{enabled:!!d&&!!s&&N.length>0}})).data,I=y.isPending,w=y.error,{groupRewards:(0,c.useMemo)(function(){return 0!==h.length&&b?h.map(function(e,t){var s,n,r=2*t+1,a=(0,et.Zu)(null===(s=b[2*t])||void 0===s?void 0:s.result),i=(null===(n=b[r])||void 0===n?void 0:n.result)?(0,et.Zu)(b[r].result):void 0;return{groupId:e,groupName:p.get(e),reward:a,generatedReward:a,joinedAmount:i}}):[]},[h,p,b]),isPending:(0,c.useMemo)(function(){return!!x||0!==h.length&&(!!j||!!d&&void 0!==s&&I)},[x,h.length,j,d,s,I]),error:m||v||w}),D=V.groupRewards,q=V.isPending,F=V.error,G=eI({actionId:A,extensionAddress:_,tokenAddress:null==S?void 0:S.address,round:H>BigInt(0)?H:void 0}),z=G.distrustVotes,J=G.isPending,K=G.error,W=(0,c.useMemo)(function(){if(D&&0!==D.length)return D.map(function(e){return e.groupId})},[D]),U=eK({extensionAddress:_,round:H>BigInt(0)?H:void 0,groupIds:W}),Y=U.capacityDecayRates,Q=U.isPending,ee=U.error,es=(0,c.useMemo)(function(){var e=new Map;return z&&0!==z.length&&z.forEach(function(t){t.groupIds.forEach(function(s){e.set(s,{distrustVotes:t.distrustVotes,distrustRatio:t.distrustRatio})})}),e},[z]),en=(0,c.useMemo)(function(){return D&&0!==D.length?(0,a._)(D).map(function(e){var t=es.get(e.groupId),s=Y.get(e.groupId);return(0,$._)((0,n._)({},e),{distrustVotes:null==t?void 0:t.distrustVotes,distrustRatio:null==t?void 0:t.distrustRatio,capacityDecayRate:s})}).sort(function(e,t){var s,n,r=null!==(s=e.reward)&&void 0!==s?s:BigInt(0),a=null!==(n=t.reward)&&void 0!==n?n:BigInt(0);return r>a?-1:r<a?1:0}):[]},[D,es,Y]),er=(0,eA.b)().handleError;return((0,c.useEffect)(function(){F&&er(F),Z&&er(Z),K&&er(K),ee&&er(ee)},[F,Z,K,ee,er]),L&&H===BigInt(0)||H>BigInt(0)&&(q||J||Q))?(0,i.jsxs)("div",{className:"flex flex-col items-center py-8",children:[(0,i.jsx)(C.Z,{}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:"加载激励数据..."})]}):(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(k.Z,{title:"第 ".concat((null==H?void 0:H.toString())||"0"," 轮激励")}),(0,i.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"("}),(0,i.jsx)(R.Z,{currentRound:P-BigInt(1)||BigInt(0),handleChangedRound:function(e){T(BigInt(e))}}),(0,i.jsx)("span",{className:"text-sm text-greyscale-500",children:")"})]}),en&&0!==en.length?(0,i.jsx)("div",{className:"overflow-x-auto mt-4",children:(0,i.jsxs)("table",{className:"table w-full",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("th",{className:"px-1 text-left hidden md:table-cell",children:"No"}),(0,i.jsx)("th",{className:"px-1 text-left",children:(0,i.jsxs)("div",{className:"",children:[(0,i.jsx)("span",{children:"链群"}),(0,i.jsx)("span",{className:"md:hidden text-xs text-gray-500 mt-1",children:"/参与代币"})]})}),(0,i.jsx)("th",{className:"px-1 text-center hidden md:table-cell",children:"参与代币"}),(0,i.jsx)("th",{className:"px-1 text-center",children:"不信任率/容量衰减率"}),(0,i.jsx)("th",{className:"px-1 text-center",children:"激励总数"})]})}),(0,i.jsx)("tbody",{children:en.map(function(e,t){var s;return(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("td",{className:"px-1 text-greyscale-400 hidden md:table-cell",children:t+1}),(0,i.jsx)("td",{className:"px-1 text-left",children:(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"text-gray-500 text-xs",children:"#"}),(0,i.jsx)("span",{className:"text-sm font-medium",children:e.groupId.toString()}),e.groupName&&(0,i.jsx)("span",{className:"text-sm text-gray-800 ml-1",children:e.groupName})]}),(0,i.jsx)("div",{className:"md:hidden mt-1",children:(0,i.jsx)("div",{className:"font-mono text-secondary text-xs",children:void 0!==e.joinedAmount?(0,g.LH)(e.joinedAmount):"-"})})]})}),(0,i.jsx)("td",{className:"px-1 text-center hidden md:table-cell",children:(0,i.jsx)("div",{className:"font-mono text-secondary",children:void 0!==e.joinedAmount?(0,g.LH)(e.joinedAmount):"-"})}),(0,i.jsx)("td",{className:"px-1 text-center",children:(0,i.jsxs)("div",{className:"font-mono text-secondary",children:[(0,i.jsx)("span",{children:void 0!==e.distrustRatio?(0,i.jsxs)("span",{className:"text-red-500",children:["-",(0,g.rl)(100*e.distrustRatio)]}):(0,i.jsx)(i.Fragment,{children:"-"})})," ",(0,i.jsx)("span",{className:"text-gray-500",children:"/"})," ",(0,i.jsx)("span",{className:"mt-1",children:void 0!==e.capacityDecayRate?0==(s=100*parseFloat((0,g.bM)(e.capacityDecayRate)))?(0,i.jsx)(i.Fragment,{children:"-"}):(0,i.jsxs)("span",{className:"text-red-500",children:["-",(0,g.rl)(s)]}):(0,i.jsx)(i.Fragment,{children:"-"})})]})}),(0,i.jsx)("td",{className:"px-1 text-center",children:(0,i.jsx)("div",{className:"font-mono text-secondary",children:function(){var t=void 0!==e.reward?(0,g.LH)(e.reward):"-",s=null==S?void 0:S.symbol;if(!(void 0!==e.reward&&e.reward!==BigInt(0)&&"string"==typeof s&&s.length>0))return(0,i.jsx)("span",{children:t});var n="/extension/group/?groupId=".concat(e.groupId.toString(),"&actionId=").concat(A.toString(),"&symbol=").concat(null==S?void 0:S.symbol,"&tab=rewards");return(0,i.jsx)(B(),{href:n,className:"underline underline-offset-2 hover:text-secondary/80",children:t})}()})})]},e.groupId.toString())})})]})}):(0,i.jsx)("div",{className:"text-center py-12",children:(0,i.jsx)("p",{className:"text-gray-500 mb-2",children:"该轮次没有激励数据"})})]})},eU=function(e){var t=e.actionId,s=e.actionInfo,a=e.extensionAddress,o=(0,d.useRouter)(),l=(0,r._)((0,c.useState)("groups"),2),u=l[0],x=l[1],m=o.query.tab2;return(0,c.useEffect)(function(){m&&["groups","distrust","reward"].includes(m)&&x(m)},[m]),(0,i.jsx)("div",{className:"w-full",children:(0,i.jsxs)(ej.mQ,{value:u,onValueChange:function(e){x(e);var t=(0,n._)({},o.query);t.tab2=e,o.push({pathname:o.pathname,query:t},void 0,{shallow:!0})},className:"w-full",children:[(0,i.jsxs)(ej.dr,{className:"grid grid-cols-3 bg-muted rounded-lg p-1 mb-4 mx-8",children:[(0,i.jsx)(ej.SP,{value:"groups",className:"px-6",children:"链群"}),(0,i.jsx)(ej.SP,{value:"reward",className:"px-6",children:"激励公示"}),(0,i.jsx)(ej.SP,{value:"distrust",className:"px-6",children:"不信任票"})]}),(0,i.jsx)(ej.nU,{value:"groups",className:"mt-0",children:(0,i.jsx)(eG,{actionId:t,actionInfo:s,extensionAddress:a})}),(0,i.jsx)(ej.nU,{value:"distrust",className:"mt-0",children:(0,i.jsx)(eq,{actionId:t,actionInfo:s,extensionAddress:a})}),(0,i.jsx)(ej.nU,{value:"reward",className:"mt-0",children:(0,i.jsx)(eW,{actionId:t,extensionAddress:a})})]})})},e$=s(89266),eX=s(58149),eY=s(50095),eQ=s(8926),e0=s(30985),e1=s(47702),e2=s(40108),e5=c.forwardRef(function(e,t){var s=e.className,r=(0,e1._)(e,["className"]);return(0,i.jsx)("div",{className:"relative w-full overflow-auto",children:(0,i.jsx)("table",(0,n._)({ref:t,className:(0,e2.cn)("w-full caption-bottom text-sm",s)},r))})});e5.displayName="Table";var e4=c.forwardRef(function(e,t){var s=e.className,r=(0,e1._)(e,["className"]);return(0,i.jsx)("thead",(0,n._)({ref:t,className:(0,e2.cn)("[&_tr]:border-b",s)},r))});e4.displayName="TableHeader";var e8=c.forwardRef(function(e,t){var s=e.className,r=(0,e1._)(e,["className"]);return(0,i.jsx)("tbody",(0,n._)({ref:t,className:(0,e2.cn)("[&_tr:last-child]:border-0",s)},r))});e8.displayName="TableBody",c.forwardRef(function(e,t){var s=e.className,r=(0,e1._)(e,["className"]);return(0,i.jsx)("tfoot",(0,n._)({ref:t,className:(0,e2.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s)},r))}).displayName="TableFooter";var e6=c.forwardRef(function(e,t){var s=e.className,r=(0,e1._)(e,["className"]);return(0,i.jsx)("tr",(0,n._)({ref:t,className:(0,e2.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s)},r))});e6.displayName="TableRow";var e3=c.forwardRef(function(e,t){var s=e.className,r=(0,e1._)(e,["className"]);return(0,i.jsx)("th",(0,n._)({ref:t,className:(0,e2.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s)},r))});e3.displayName="TableHead";var e7=c.forwardRef(function(e,t){var s=e.className,r=(0,e1._)(e,["className"]);return(0,i.jsx)("td",(0,n._)({ref:t,className:(0,e2.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s)},r))});e7.displayName="TableCell",c.forwardRef(function(e,t){var s=e.className,r=(0,e1._)(e,["className"]);return(0,i.jsx)("caption",(0,n._)({ref:t,className:(0,e2.cn)("mt-4 text-sm text-muted-foreground",s)},r))}).displayName="TableCaption";var e9=s(19741);function te(e){var t=e.extensionAddress,s=(e.tokenAddress,e.verifier),n=e.round,r=e.actionId,a=e.actionTitle,d=e.groupId,o=e.groupName,l=e.open,u=e.onOpenChange,x=(0,e9.Vo)(t,n,s,r,d),m=x.addrs,f=x.ratios,p=x.amounts,j=x.ownerAmount,v=x.isPending,N=x.error,y=m&&p?p.reduce(function(e,t){return e+t},BigInt(0))+(j||BigInt(0)):BigInt(0),I=(0,c.useMemo)(function(){return j&&j!==BigInt(0)&&y!==BigInt(0)?Number(j)/Number(y)*100:0},[j,y]);return(0,i.jsx)(b.Vq,{open:l,onOpenChange:u,children:(0,i.jsxs)(b.cZ,{className:"max-w-3xl max-h-[80vh] overflow-y-auto py-6 px-4",children:[(0,i.jsx)(b.fK,{children:(0,i.jsx)(b.$N,{children:"二次分配明细"})}),(0,i.jsxs)("div",{className:"border rounded-lg p-3 bg-gray-50",children:[(0,i.jsxs)("div",{className:"flex items-baseline mb-2",children:[(0,i.jsx)("span",{className:"text-greyscale-400 text-sm",children:"No."}),(0,i.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(r)}),(0,i.jsx)("span",{className:"font-bold text-greyscale-800",children:a})]}),(0,i.jsxs)("div",{className:"text-gray-800",children:[(0,i.jsx)("span",{className:"text-gray-500 text-xs",children:"链群 #"}),(0,i.jsx)("span",{className:"text-secondary text-base font-semibold",children:d.toString()})," ",(0,i.jsx)("span",{children:o||"链群 #".concat(d)})]})]}),v?(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,i.jsx)(C.Z,{}),(0,i.jsx)("p",{className:"mt-4 text-sm text-gray-600",children:"加载分配明细..."})]}):N?(0,i.jsxs)("div",{className:"text-center py-8 text-red-500",children:[(0,i.jsx)("p",{className:"text-sm",children:"加载失败，请稍后重试"}),N instanceof Error&&(0,i.jsx)("p",{className:"text-xs mt-2 text-gray-500",children:N.message})]}):m&&0!==m.length?(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)(e5,{children:[(0,i.jsx)(e4,{children:(0,i.jsxs)(e6,{children:[(0,i.jsx)(e3,{className:"px-3 py-2 text-left text-xs font-medium",children:"地址"}),(0,i.jsx)(e3,{className:"px-3 py-2 text-right text-xs font-medium",children:"比例"}),(0,i.jsx)(e3,{className:"px-3 py-2 text-right text-xs font-medium",children:"激励数量"})]})}),(0,i.jsxs)(e8,{children:[m.map(function(e,t){var s=(null==f?void 0:f[t])||BigInt(0),n=(null==p?void 0:p[t])||BigInt(0),r=s?Number(s)/1e16:0;return(0,i.jsxs)(e6,{children:[(0,i.jsx)(e7,{className:"px-3 py-2",children:(0,i.jsx)(h.Z,{address:e,showCopyButton:!0})}),(0,i.jsx)(e7,{className:"px-3 py-2 text-right text-sm",children:(0,g.rl)(r)}),(0,i.jsx)(e7,{className:"px-3 py-2 text-right text-sm font-mono",children:(0,g.LH)(n)})]},"".concat(e,"_").concat(t))}),j&&j>BigInt(0)&&(0,i.jsxs)(e6,{className:"bg-gray-50 font-medium",children:[(0,i.jsx)(e7,{className:"px-3 py-2",children:(0,i.jsx)("span",{className:"text-sm text-gray-600",children:"服务者保留"})}),(0,i.jsx)(e7,{className:"px-3 py-2 text-right text-sm text-gray-600",children:(0,g.rl)(I)}),(0,i.jsx)(e7,{className:"px-3 py-2 text-right text-sm font-mono",children:(0,g.LH)(j)})]}),(0,i.jsxs)(e6,{className:"bg-gray-100 font-semibold",children:[(0,i.jsx)(e7,{className:"px-3 py-2",children:(0,i.jsx)("span",{className:"text-sm",children:"汇总"})}),(0,i.jsx)(e7,{className:"px-3 py-2 text-right text-sm",children:(0,g.rl)(m.reduce(function(e,t,s){return e+Number((null==f?void 0:f[s])||BigInt(0))/1e16},0)+I)}),(0,i.jsx)(e7,{className:"px-3 py-2 text-right text-sm font-mono",children:(0,g.LH)(y)})]})]})]})}):(0,i.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,i.jsx)("p",{className:"text-sm",children:"暂无分配明细"})})]})})}var tt=function(e){var t,s,a,o,u,x,m,f,p,j,v,N,y,b,I,w,B,A,_,S,M,L,Z,E,H,T,V,D,q,F,O,G,z,J,K,W,U,$,Y,Q,ee,et,es,en,er,ea,ei,ec,ed=e.extensionAddress,eo=e.verifier,el=e.currentJoinRound,eu=e.onBack,ex=(0,d.useRouter)(),em=((0,c.useContext)(l.M)||{}).token,eh=(0,r._)((0,c.useState)(BigInt(0)),2),eg=eh[0],ef=eh[1],ep=(0,r._)((0,c.useState)(!1),2),ej=ep[0],ev=ep[1],eb=(0,r._)((0,c.useState)(void 0),2),eI=eb[0],ew=eb[1],eB=(0,e0.l)(ed||"0x0000000000000000000000000000000000000000").groupActionTokenAddress,eR=ex.query.round;(0,c.useEffect)(function(){eR&&!isNaN(Number(eR))?ef(BigInt(eR)):em&&el-BigInt(em.initialStakeRound)>=BigInt(2)&&ef(el-BigInt(2))},[eR,el,em]);var ek=(s=(t={extensionAddress:ed,groupActionTokenAddress:eB,round:eg>BigInt(0)?eg:void 0,verifier:eo}).extensionAddress,a=t.groupActionTokenAddress,o=t.round,u=t.verifier,m=(x=(0,ey.FF)(a,o,u)).actionIds,f=x.isPending,p=x.error,v=(j=(0,eQ.W)({token:{address:a},actionIds:m||[],enabled:!!a&&!!m&&m.length>0})).extensions,N=j.isPending,y=(0,c.useMemo)(function(){var e=new Map;return v.forEach(function(t){t.isExtension&&t.extensionAddress&&e.set(t.actionId,t.extensionAddress)}),e},[v]),b=(0,c.useMemo)(function(){return o&&u&&v&&0!==v.length?v.filter(function(e){return e.isExtension&&e.extensionAddress}).map(function(e){return{address:"0x6c720b8a9c4803E7D78849E10fe535d862ACbfD1",abi:eN.l,functionName:"groupIdsByVerifier",args:[e.extensionAddress,o,u]}}):[]},[o,u,v]),w=(I=(0,X.N)({contracts:b,query:{enabled:!!o&&!!u&&b.length>0&&!f&&!N}})).data,B=I.isPending,A=I.error,S=(_=(0,c.useMemo)(function(){if(!w||!v||0===v.length)return{actionIds:[],groupIdsByAction:new Map,actionGroupPairs:[]};var e=new Set,t=new Map,s=[];return w.forEach(function(n,r){if((null==n?void 0:n.status)==="success"&&n.result){var a=v.filter(function(e){return e.isExtension&&e.extensionAddress})[r];if(a){var i=a.actionId,c=n.result;c.length>0&&(e.add(i),t.has(i)||t.set(i,[]),c.forEach(function(e){t.get(i).push(e),s.push({actionId:i,groupId:e})}))}}}),{actionIds:Array.from(e),groupIdsByAction:t,actionGroupPairs:s}},[w,v])).actionIds,M=_.groupIdsByAction,L=_.actionGroupPairs,Z=(0,c.useMemo)(function(){return s&&o&&u&&0!==L.length?L.map(function(e){var t=e.actionId,n=e.groupId;return{address:s,abi:e$.P,functionName:"rewardDistribution",args:[u,o,t,n]}}):[]},[s,o,u,L]),H=(E=(0,X.N)({contracts:Z,query:{enabled:!!s&&!!o&&!!u&&Z.length>0&&!B}})).data,T=E.isPending,V=E.error,D=(0,c.useMemo)(function(){return s&&o&&u?[{address:s,abi:e$.P,functionName:"rewardByAccount",args:[o,u]},{address:s,abi:e$.P,functionName:"reward",args:[o]},{address:s,abi:e$.P,functionName:"generatedActionRewardByVerifier",args:[u,o]},{address:s,abi:e$.P,functionName:"generatedActionReward",args:[o]},{address:s,abi:e$.P,functionName:"GOV_RATIO_MULTIPLIER",args:[]},{address:s,abi:e$.P,functionName:"govRatio",args:[o,u]}]:[]},[s,o,u]),F=(q=(0,X.N)({contracts:D,query:{enabled:!!s&&!!o&&!!u&&D.length>0}})).data,O=q.isPending,G=q.error,z=(0,c.useMemo)(function(){var e=new Map;return H&&0!==L.length&&H.forEach(function(t,s){if((null==t?void 0:t.status)==="success"&&t.result){var n=L[s],r=n.actionId,a=n.groupId,i="".concat(r.toString(),"-").concat(a.toString()),c=t.result;e.set(i,{addrs:c[0],basisPoints:c[1],amounts:c[2],ownerAmount:c[3]})}}),e},[H,L]),J=(0,c.useMemo)(function(){return o&&0!==L.length&&0!==y.size?L.map(function(e){var t=e.actionId,s=e.groupId,n=y.get(t);return n?{address:n,abi:ez.r,functionName:"generatedActionRewardByGroupId",args:[o,s]}:null}).filter(function(e){return null!==e}):[]},[o,L,y]),W=(K=(0,X.N)({contracts:J,query:{enabled:!!o&&L.length>0&&J.length>0&&!B}})).data,U=K.isPending,$=K.error,Q=(Y=(0,eX.I)({tokenAddress:a,actionIds:S,enabled:S.length>0})).actionInfos,ee=Y.isPending,en=(es=function(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],s=!!e&&e.length>0,n=s?e.map(function(e){return{address:"0xA0a5BB442214988D0c6e707d825640C026fB1d04",abi:eY.s,functionName:"groupNameOf",args:[e]}}):[],r=(0,X.N)({contracts:n,query:{enabled:s&&t}}),a=r.data,i=r.isPending,c=r.error,d=s?e.map(function(e,t){var s;return{groupId:e,groupName:null==a?void 0:null===(s=a[t])||void 0===s?void 0:s.result}}):[],o=new Map(d.map(function(e){return[e.groupId,e.groupName]}));return{groupNames:d,groupNameMap:o,isPending:!!s&&i,error:s?c:void 0}}(et=(0,c.useMemo)(function(){return 0===L.length?[]:L.map(function(e){return e.groupId})},[L]),et.length>0)).groupNameMap,er=es.isPending,ea=BigInt(1e18),ei=(0,c.useMemo)(function(){if(!F||F.length<6)return null;var e,t,s,n,r,a,i=null===(e=F[0])||void 0===e?void 0:e.result,c=i?i[0]:BigInt(0),d=i?i[1]:BigInt(0),o=d<BigInt(1e11)?BigInt(0):d,l=!!i&&i[2],u=(null===(t=F[1])||void 0===t?void 0:t.result)?F[1].result:BigInt(0),x=(null===(s=F[2])||void 0===s?void 0:s.result)?F[2].result:BigInt(0),m=(null===(n=F[3])||void 0===n?void 0:n.result)?F[3].result:BigInt(0),h=(null===(r=F[4])||void 0===r?void 0:r.result)?F[4].result:BigInt(0),g=null===(a=F[5])||void 0===a?void 0:a.result,f=g?g[0]:BigInt(0),p=0;m>BigInt(0)&&x>BigInt(0)&&(p=Number(x*ea/m)/Number(ea)*100);var j=o>BigInt(0),v=0;return f>BigInt(0)&&(v=Number(f)/Number(ea)*100),{mintReward:c,burnReward:o,claimed:l,totalReward:u,verifierGenerated:x,totalGenerated:m,govRatioMultiplier:h,generatedRatioPercent:p,govRatioPercent:v,hasOverflow:j}},[F]),ec=(0,c.useMemo)(function(){var e=new Map,t=0;return L.forEach(function(s){var n=s.actionId,r=s.groupId;if(y.has(n)){var a="".concat(n.toString(),"-").concat(r.toString());e.set(a,t),t++}}),e},[L,y]),{actionRewards:(0,c.useMemo)(function(){if(0===L.length||0===Q.length||!W||0===W.length)return[];var e=new Map(Q.map(function(e){return[e.head.id,e]})),t=[];return S.forEach(function(s){var n=e.get(s);if(n){var r=M.get(s)||[],a=[];r.forEach(function(e){var t="".concat(s.toString(),"-").concat(e.toString()),n=z.get(t),r=ec.get(t),i=void 0!==r?W[r]:void 0,c=(null==i?void 0:i.status)==="success"&&i.result?i.result:BigInt(0);if(n){var d=n.addrs,o=n.amounts,l=n.ownerAmount,u=d.length>0,x=o.reduce(function(e,t){return e+t},BigInt(0));a.push({groupId:e,groupName:en.get(e),totalGenerated:c,ownerAmount:l,distributedAmount:x,hasRecipients:u})}else a.push({groupId:e,groupName:en.get(e),totalGenerated:c,ownerAmount:c,distributedAmount:BigInt(0),hasRecipients:!1})}),t.push({actionId:s,actionTitle:n.body.title||"行动 #".concat(s.toString()),groupRewards:a})}}),t},[L,Q,W,S,M,en,z,ec]),verifierRewardSummary:ei,isPending:(0,c.useMemo)(function(){return m&&0!==m.length?!!f||!!N||!!B||!!O||0!==L.length&&(T||U||ee||er):f||O},[m,f,N,B,O,L.length,T,U,ee,er]),error:p||A||V||$||G||null}),eC=ek.actionRewards,e_=ek.verifierRewardSummary,eS=ek.isPending,eM=ek.error,eP=(0,eA.b)().handleError;(0,c.useEffect)(function(){eM&&eP(eM)},[eM,eP]);var eL=function(e,t,s,n){ew({actionId:e,actionTitle:t,groupId:s,groupName:n}),ev(!0)};return(0,i.jsxs)("div",{className:"relative pb-4",children:[eg===BigInt(0)&&(0,i.jsx)("div",{className:"flex items-center justify-center",children:(0,i.jsx)("div",{className:"text-center text-sm text-greyscale-500",children:"暂无激励结果"})}),(0,i.jsxs)("div",{className:"mb-4",children:[eg>0&&(0,i.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(k.Z,{title:"第 ".concat(eg.toString()," 轮服务者激励")}),(0,i.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"("}),(0,i.jsx)(R.Z,{currentRound:el-BigInt(2),handleChangedRound:function(e){var t=BigInt(e);ef(t);var s=(0,n._)({},ex.query);s.round=t.toString(),ex.push({pathname:ex.pathname,query:s},void 0,{shallow:!0})}}),(0,i.jsx)("span",{className:"text-sm text-greyscale-500",children:")"})]}),eu&&(0,i.jsx)("button",{onClick:eu,className:"text-sm text-secondary hover:underline cursor-pointer",children:"返回>>"})]}),(0,i.jsxs)("div",{className:"mb-4 bg-gray-50 px-3 py-2 rounded space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"text-sm text-greyscale-500 mr-2",children:"服务者:"}),(0,i.jsx)(h.Z,{address:eo,showCopyButton:!0})]}),e_&&e_.govRatioMultiplier>BigInt(0)&&(0,i.jsx)(i.Fragment,{children:e_.hasOverflow?(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center mb-1",children:[(0,i.jsx)("span",{className:"text-sm text-greyscale-500 mr-2",children:"• 锁定激励:"}),(0,i.jsx)("span",{className:"text-sm font-medium text-primary",children:(0,g.LH)(e_.mintReward+e_.burnReward)})]}),(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"text-sm text-red-500 mr-2",children:"• 溢出销毁激励:"}),(0,i.jsx)("span",{className:"text-sm font-medium text-red-600 mr-2",children:(0,g.LH)(e_.burnReward)}),(0,i.jsx)("span",{className:"text-sm text-greyscale-500",children:", 原因:"})]}),(0,i.jsxs)("div",{className:"text-xs text-greyscale-500 font-mono",children:[(0,i.jsx)("div",{children:"\xa0\xa0治理票占比 \xd7 治理票占比倍数"}),(0,i.jsxs)("div",{children:["="," ",(0,i.jsx)("span",{className:"font-medium",children:(0,g.rl)(e_.govRatioPercent,6)})," \xd7 ",(0,i.jsx)("span",{className:"font-medium",children:Number(e_.govRatioMultiplier)})]}),(0,i.jsxs)("div",{children:["="," ",(0,i.jsx)("span",{className:"font-medium",children:(0,g.rl)(e_.govRatioPercent*Number(e_.govRatioMultiplier),6)})," < 铸币量占比 (",(0,i.jsx)("span",{className:"font-medium",children:(0,g.rl)(e_.generatedRatioPercent,6)}),")"]})]})]}):(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"text-sm text-greyscale-500 mr-2",children:"锁定激励:"}),(0,i.jsx)("span",{className:"text-sm font-medium text-primary",children:(0,g.LH)(e_.mintReward+e_.burnReward)})]}),e_.mintReward+e_.burnReward>BigInt(0)&&(0,i.jsx)("div",{className:"space-y-1",children:(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsx)("span",{className:"text-sm text-greyscale-500 mr-2",children:"无溢出销毁激励"})})})]})})]})]}),eS?(0,i.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,i.jsx)(C.Z,{})}):eC&&0!==eC.length?(0,i.jsx)("div",{className:"space-y-6",children:eC.map(function(e){var t,s,n;return(0,i.jsxs)("div",{className:"",children:[(0,i.jsxs)("div",{className:"flex items-baseline mb-3",children:[(0,i.jsx)("span",{className:"text-greyscale-400 text-sm",children:"No."}),(0,i.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(e.actionId)}),(0,i.jsx)("span",{className:"font-bold text-greyscale-800",children:e.actionTitle})]}),0===e.groupRewards.length?(0,i.jsx)("div",{className:"text-sm text-gray-500 text-center py-4",children:"该行动下暂无链群激励"}):(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"table w-full",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("th",{className:"px-2 py-2 text-left text-sm",children:"链群"}),(0,i.jsx)("th",{className:"px-2 py-2 text-right text-sm",children:"链群铸币量"}),(0,i.jsxs)("th",{className:"px-2 py-2 text-right text-sm",children:["服务激励",(0,i.jsx)("br",{}),(0,i.jsx)("span",{className:"text-greyscale-400 text-xs",children:"(服务者/二次分配)"})]})]})}),(0,i.jsxs)("tbody",{children:[e.groupRewards.map(function(t){var s=t.ownerAmount+t.distributedAmount;return(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("td",{className:"px-1 py-2",children:(0,i.jsxs)("div",{className:"text-gray-800",children:[(0,i.jsx)("span",{className:"text-gray-500 text-xs",children:"#"}),(0,i.jsx)("span",{className:"text-secondary text-base font-semibold",children:t.groupId.toString()})," ",(0,i.jsx)("span",{className:"text-sm",children:t.groupName||"链群 #".concat(t.groupId)})]})}),(0,i.jsx)("td",{className:"px-1 py-2 text-right",children:(0,i.jsx)("div",{className:"font-mono text-sm",children:(0,g.LH)(t.totalGenerated)})}),(0,i.jsx)("td",{className:"px-1 py-2 text-right",children:(0,i.jsxs)("div",{className:"space-y-0.5",children:[t.hasRecipients?(0,i.jsx)(P.z,{variant:"link",className:"font-mono text-sm text-secondary p-0 h-auto underline",size:"sm",onClick:function(){return eL(e.actionId,e.actionTitle,t.groupId,t.groupName)},children:(0,g.LH)(s)}):(0,i.jsx)("div",{className:"font-mono text-sm text-secondary",children:(0,g.LH)(s)}),(0,i.jsxs)("div",{className:"text-greyscale-500 text-sm",children:["(",(0,g.LH)(t.ownerAmount),"\xa0/\xa0",(0,g.LH)(t.distributedAmount),")"]}),s>BigInt(0)&&(0,i.jsxs)("div",{className:"text-greyscale-400 text-xs",children:["(",(100*Number(t.ownerAmount)/Number(s)).toFixed(0),"%/",(100*Number(t.distributedAmount)/Number(s)).toFixed(0),"%)"]})]})})]},t.groupId.toString())}),(0,i.jsxs)("tr",{className:"bg-gray-50 font-semibold",children:[(0,i.jsx)("td",{className:"px-2 py-2 text-left",children:"汇总"}),(0,i.jsx)("td",{className:"px-2 py-2 text-right",children:(0,i.jsx)("div",{className:"font-mono text-sm",children:(0,g.LH)(e.groupRewards.reduce(function(e,t){return e+t.totalGenerated},BigInt(0)))})}),(0,i.jsx)("td",{className:"px-2 py-2 text-right",children:(n=(t=e.groupRewards.reduce(function(e,t){return e+t.ownerAmount},BigInt(0)))+(s=e.groupRewards.reduce(function(e,t){return e+t.distributedAmount},BigInt(0))),(0,i.jsxs)("div",{className:"space-y-0.5",children:[(0,i.jsx)("div",{className:"font-mono text-sm text-secondary",children:(0,g.LH)(n)}),(0,i.jsxs)("div",{className:"text-greyscale-500 text-sm",children:["(",(0,g.LH)(t),"\xa0/\xa0",(0,g.LH)(s),")"]}),n>BigInt(0)&&(0,i.jsxs)("div",{className:"text-greyscale-400 text-xs",children:["(",(100*Number(t)/Number(n)).toFixed(0),"%/",(100*Number(s)/Number(n)).toFixed(0),"%)"]})]}))})]})]})]})})]},e.actionId.toString())})}):eg>BigInt(0)&&(0,i.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-8 border rounded-lg bg-gray-50",children:"本轮暂无激励数据"}),eI&&(0,i.jsx)(te,{extensionAddress:ed,tokenAddress:eB,verifier:eo,round:eg>BigInt(0)?eg:void 0,actionId:eI.actionId,actionTitle:eI.actionTitle,groupId:eI.groupId,groupName:eI.groupName,open:ej,onOpenChange:ev})]})},ts=function(e){var t,s,u,x,m,f,p,j,v,N,y,b,I,w,B,A=e.currentJoinRound,_=e.actionId,S=(e.actionInfo,e.extensionAddress),M=(0,d.useRouter)(),P=((0,c.useContext)(l.M)||{}).token,L=(0,o.m)().address,Z=(0,r._)((0,c.useState)(BigInt(0)),2),E=Z[0],H=Z[1],T=(0,r._)((0,c.useState)(!1),2),V=T[0],D=T[1],q=(0,r._)((0,c.useState)(void 0),2),F=q[0],O=q[1],G=M.query.round;(0,c.useEffect)(function(){G&&!isNaN(Number(G))?H(BigInt(G)):P&&A-BigInt(P.initialStakeRound)>=BigInt(2)&&H(A-BigInt(2))},[G,A,P]);var z=(s=(t={extensionAddress:S,tokenAddress:null==P?void 0:P.address,actionId:_,round:E>BigInt(0)?E:void 0}).extensionAddress,u=t.tokenAddress,x=t.actionId,m=t.round,p=(f=(0,ei.x)({tokenAddress:u,actionId:x,round:m})).accounts,j=f.count,v=f.isPending,N=f.error,y=(0,c.useMemo)(function(){if(!s||!m||0===p.length)return[];var e=[],t=!0,n=!1,r=void 0;try{for(var a,i=p[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var c=a.value;e.push({address:s,abi:e$.P,functionName:"rewardByAccount",args:[m,c]}),e.push({address:s,abi:e$.P,functionName:"actionIdsWithRecipients",args:[c,m]}),e.push({address:s,abi:e$.P,functionName:"generatedActionRewardByVerifier",args:[c,m]})}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return e},[s,m,p]),I=(b=(0,X.N)({contracts:y,query:{enabled:!!s&&!!m&&p.length>0&&y.length>0}})).data,w=b.isPending,B=b.error,{accountRewards:(0,c.useMemo)(function(){if(!I||0===p.length)return[];for(var e=[],t=0;t<p.length;t++){var s=3*t,n=3*t+1,a=3*t+2,i=I[s],c=I[n],d=I[a];if((null==i?void 0:i.status)==="success"&&i.result){var o=(0,r._)(i.result,3),l=o[0],u=o[1],x=o[2],m=!1;if((null==c?void 0:c.status)==="success"&&c.result){var h=c.result;m=Array.isArray(h)&&h.length>0}var g=BigInt(0);(null==d?void 0:d.status)==="success"&&d.result&&(g=(0,et.Zu)(d.result)),e.push({account:p[t],mintReward:(0,et.Zu)(l),burnReward:(0,et.Zu)(u),claimed:x,hasRecipients:m,generatedAmount:g})}}return e},[I,p]),totalCount:j,isPending:(0,c.useMemo)(function(){return!!v||0!==p.length&&w},[v,p.length,w]),error:N||B}),J=z.accountRewards,K=z.isPending,W=z.error,U=(0,eA.b)().handleError;(0,c.useEffect)(function(){W&&U(W)},[W,U]);var $=(0,c.useMemo)(function(){if(!J||0===J.length)return{sortedRewards:[],totalReward:BigInt(0),totalGeneratedReward:BigInt(0)};var e=J.reduce(function(e,t){return e+t.mintReward+t.burnReward},BigInt(0)),t=J.reduce(function(e,t){return e+t.generatedAmount},BigInt(0));return{sortedRewards:(0,a._)(J).sort(function(e,t){var s=e.mintReward+e.burnReward,n=t.mintReward+t.burnReward;return s>n?-1:s<n?1:0}),totalReward:e,totalGeneratedReward:t}},[J]),Y=$.sortedRewards,Q=$.totalReward,ee=$.totalGeneratedReward,es=function(e){O(e),D(!0)};return V&&F?(0,i.jsx)(tt,{extensionAddress:S,verifier:F,currentJoinRound:A,onBack:function(){D(!1),O(void 0)}}):(0,i.jsxs)("div",{className:"relative pb-4",children:[E===BigInt(0)&&(0,i.jsx)("div",{className:"flex items-center justify-center",children:(0,i.jsx)("div",{className:"text-center text-sm text-greyscale-500",children:"暂无激励结果"})}),(0,i.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,i.jsx)("div",{className:"flex items-center",children:E>0&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(k.Z,{title:"第 ".concat(E.toString()," 轮激励结果")}),(0,i.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"("}),(0,i.jsx)(R.Z,{currentRound:A-BigInt(2),handleChangedRound:function(e){var t=BigInt(e);H(t);var s=(0,n._)({},M.query);s.round=t.toString(),M.push({pathname:M.pathname,query:s},void 0,{shallow:!0})}}),(0,i.jsx)("span",{className:"text-sm text-greyscale-500",children:")"})]})})}),K?(0,i.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,i.jsx)(C.Z,{})}):Y&&0!==Y.length?(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"table w-full",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("th",{className:"px-1 text-left",children:"No."}),(0,i.jsx)("th",{className:"px-1 text-center",children:"地址"}),(0,i.jsx)("th",{className:"px-1 text-center",children:"链群铸币量"}),(0,i.jsx)("th",{className:"px-1 text-center",children:"服务者激励"})]})}),(0,i.jsxs)("tbody",{children:[Y.map(function(e,t){return(0,i.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===L?"bg-blue-50/50":""),children:[(0,i.jsx)("td",{className:"px-1 text-greyscale-400",children:t+1}),(0,i.jsx)("td",{className:"px-1",children:(0,i.jsx)("div",{onClick:function(){return es(e.account)},className:"cursor-pointer hover:opacity-80",children:(0,i.jsx)(h.Z,{address:e.account,showCopyButton:!0,word:e.account===L?"(我)":""})})}),(0,i.jsx)("td",{className:"px-1 text-center",children:(0,i.jsx)("div",{className:"font-mono text-sm",children:(0,g.LH)(e.generatedAmount)})}),(0,i.jsx)("td",{className:"px-1 text-center",children:(0,i.jsx)("div",{className:"font-mono text-secondary underline cursor-pointer hover:opacity-70",onClick:function(){return es(e.account)},children:(0,g.LH)(e.mintReward+e.burnReward)})})]},e.account)}),(0,i.jsxs)("tr",{className:"text-greyscale-900",children:[(0,i.jsx)("td",{className:"px-1 text-left"}),(0,i.jsx)("td",{className:"px-1 text-left",children:"汇总"}),(0,i.jsx)("td",{className:"px-1 text-center",children:(0,i.jsx)("div",{className:"font-mono text-sm",children:(0,g.LH)(ee)})}),(0,i.jsx)("td",{className:"px-1 text-center",children:(0,i.jsx)("div",{className:"font-mono text-secondary",children:(0,g.LH)(Q)})})]})]})]})}):E>BigInt(0)&&(0,i.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-8 border rounded-lg bg-gray-50",children:"本轮暂无激励数据"})]})},tn=s(65293),tr=s(80332),ta=function(e){var t=e.extensionAddress,s=e.tokenAddress,n=e.actionId,r=(0,tr.xe)(s,n),a=r.accounts,i=r.isPending,d=r.error,o=(0,c.useMemo)(function(){return a||[]},[a]),l=(0,c.useMemo)(function(){if(!t||0===o.length)return[];var e=[],s=!0,n=!1,r=void 0;try{for(var a,i=o[Symbol.iterator]();!(s=(a=i.next()).done);s=!0){var c=a.value;e.push({address:t,abi:e$.P,functionName:"joinInfo",args:[c]}),e.push({address:"0xf2084E73bF047aF26d72CEFde25e22536a1f37C8",abi:tn.i,functionName:"activeGroupIdsByOwner",args:[t,c]})}}catch(e){n=!0,r=e}finally{try{s||null==i.return||i.return()}finally{if(n)throw r}}return e},[t,o]),u=(0,X.N)({contracts:l,query:{enabled:!!t&&!!s&&void 0!==n&&l.length>0}}),x=u.data,m=u.isPending,h=u.error,g=(0,c.useMemo)(function(){if(!x||0===o.length)return[];for(var e=new Set,t=0;t<o.length;t++){var s=x[2*t+1];(null==s?void 0:s.status)==="success"&&s.result&&s.result.forEach(function(t){return e.add(t)})}return Array.from(e)},[x,o]),f=(0,eB.h)({groupIds:g,enabled:g.length>0}),p=f.groupNameMap,j=f.isPending,v=f.error,N=(0,c.useMemo)(function(){if(!x||0===o.length||g.length>0&&j)return[];for(var e=[],t=0;t<o.length;t++){var s=o[t],n=2*t,r=x[n],a=(0,et.Zu)(null==r?void 0:r.result);if(a!==BigInt(0)){var i=x[n+1],c=(null==i?void 0:i.status)==="success"&&i.result?i.result:[],d=c.map(function(e){return p.get(e)||""});e.push({address:s,joinedRound:a,groupIds:c,groupNames:d})}}return e},[x,o,g,j,p]),y=o&&o.length>0,b=g.length>0&&j;return{participants:N,isPending:i||y&&m||b,error:d||h||v}},ti=s(20714);function tc(e){var t=e.extensionAddress,s=e.serviceProvider,n=e.open,r=e.onOpenChange,a=(0,v.Bk)().currentRound,c=(0,e0.l)(t).groupActionTokenAddress,d=(0,ti.A)({groupActionTokenAddress:c,account:n&&s?s:void 0,round:a}),o=d.actionsWithGroups,l=d.isPending,u=d.error;return(0,i.jsx)(b.Vq,{open:n,onOpenChange:r,children:(0,i.jsxs)(b.cZ,{className:"max-w-4xl max-h-[80vh] overflow-y-auto py-8 px-4",children:[(0,i.jsx)(b.fK,{children:(0,i.jsx)(b.$N,{children:"服务者行动与链群"})}),s&&(0,i.jsxs)("div",{className:"flex items-center mb-4 bg-gray-50 px-3 py-2 rounded",children:[(0,i.jsx)("span",{className:"text-sm text-greyscale-500 mr-2",children:"服务者:"}),(0,i.jsx)(h.Z,{address:s,showCopyButton:!0})]}),l?(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,i.jsx)(C.Z,{}),(0,i.jsx)("p",{className:"mt-4 text-sm text-gray-600",children:"加载数据..."})]}):u?(0,i.jsxs)("div",{className:"text-center py-8 text-red-500",children:[(0,i.jsx)("p",{className:"text-sm",children:"加载失败，请稍后重试"}),u instanceof Error&&(0,i.jsx)("p",{className:"text-xs mt-2 text-gray-500",children:u.message})]}):o&&0!==o.length?(0,i.jsx)("div",{className:"space-y-6",children:o.map(function(e){return(0,i.jsxs)("div",{className:"",children:[(0,i.jsxs)("div",{className:"flex items-baseline mb-3",children:[(0,i.jsx)("span",{className:"text-greyscale-400 text-sm",children:"No."}),(0,i.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(e.actionId)}),(0,i.jsx)("span",{className:"font-bold text-greyscale-800",children:e.actionTitle})]}),0===e.groups.length?(0,i.jsx)("div",{className:"text-sm text-gray-500 text-center py-4",children:"该行动下暂无链群"}):(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"table w-full",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("th",{className:"px-2 py-2 text-left text-sm",children:"链群"}),(0,i.jsx)("th",{className:"px-2 py-2 text-right text-sm",children:"代币参与量"})]})}),(0,i.jsxs)("tbody",{children:[e.groups.map(function(e){return(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsxs)("td",{className:"px-2 py-2",children:[(0,i.jsx)("span",{className:"text-gray-500 text-xs",children:"#"}),(0,i.jsx)("span",{className:"text-secondary text-base font-semibold",children:e.groupId.toString()}),(0,i.jsx)("span",{className:"text-sm ml-1",children:e.groupName||"链群 #".concat(e.groupId)})]}),(0,i.jsx)("td",{className:"px-2 py-2 text-right",children:(0,i.jsx)("div",{className:"font-mono text-sm",children:(0,g.LH)(e.totalJoinedAmount)})})]},e.groupId.toString())}),(0,i.jsxs)("tr",{className:"bg-gray-50 font-semibold",children:[(0,i.jsx)("td",{className:"px-2 py-2 text-left",children:"汇总"}),(0,i.jsx)("td",{className:"px-2 py-2 text-right",children:(0,i.jsx)("div",{className:"font-mono text-sm",children:(0,g.LH)(e.groups.reduce(function(e,t){return e+t.totalJoinedAmount},BigInt(0)))})})]})]})]})})]},e.actionId.toString())})}):(0,i.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,i.jsx)("p",{className:"text-sm",children:"该服务者暂无激活的行动和链群"})})]})})}var td=function(e){var t=e.extensionAddress,s=e.actionId,n=(0,o.m)().address,d=((0,c.useContext)(l.M)||{}).token,u=(0,r._)((0,c.useState)(!1),2),x=u[0],m=u[1],f=(0,r._)((0,c.useState)(void 0),2),p=f[0],j=f[1],v=ta({extensionAddress:t,tokenAddress:null==d?void 0:d.address,actionId:s}),N=v.participants,y=v.isPending,b=v.error;if(y)return(0,i.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,i.jsx)(C.Z,{})});if(b)return(0,i.jsx)("div",{className:"text-center text-red-500 py-8",children:(0,i.jsxs)("p",{children:["加载失败：",b.message||"获取数据失败"]})});if(0===N.length)return(0,i.jsx)("div",{className:"text-center text-gray-500 py-8",children:(0,i.jsx)("p",{children:"暂无参与者"})});var I=(0,a._)(N).sort(function(e,t){return e.joinedRound<t.joinedRound?-1:e.joinedRound>t.joinedRound?1:0}),w=function(e){j(e),m(!0)};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"table w-full",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("th",{className:"px-0 text-center",children:" "}),(0,i.jsx)("th",{className:"px-2 text-left",children:"链群服务者"}),(0,i.jsx)("th",{className:"px-2 text-center",children:"加入轮次"}),(0,i.jsx)("th",{})]})}),(0,i.jsx)("tbody",{children:I.map(function(e,t){return(0,i.jsxs)("tr",{onClick:function(){return w(e.address)},className:"border-b border-gray-100 cursor-pointer hover:bg-gray-50 ".concat(e.address===n?"text-secondary":""),children:[(0,i.jsx)("td",{className:"px-0 text-center",children:t+1}),(0,i.jsx)("td",{className:"px-2",children:(0,i.jsx)(h.Z,{address:e.address,showCopyButton:!0,word:e.address===n?"(我)":""})}),(0,i.jsx)("td",{className:"px-2 text-center",children:(0,g.uf)(e.joinedRound)}),(0,i.jsx)("td",{className:"px-2 text-center",children:(0,i.jsx)(q.Z,{className:"h-5 w-5 text-gray-400 inline-block"})})]},e.address)})})]})}),(0,i.jsx)(tc,{extensionAddress:t,serviceProvider:p,open:x,onOpenChange:m})]})},to=s(90713),tl=s(39332),tu=function(e){var t=e.group,s=e.actionId,n=e.token,r=(0,tl.useRouter)(),a=100*(t.maxCapacity>BigInt(0)?Number(t.totalJoinedAmount)/Number(t.maxCapacity):0);return(0,i.jsx)("div",{onClick:function(){r.push("/extension/group?groupId=".concat(t.groupId.toString(),"&actionId=").concat(s.toString(),"&symbol=").concat(null==n?void 0:n.symbol,"&tab=rewards"))},className:"border border-gray-200 rounded-lg py-3 pl-3 pr-0 hover:border-secondary hover:bg-secondary/5 cursor-pointer transition-all",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"text-gray-800 mb-2",children:[(0,i.jsx)("span",{className:"text-gray-500 text-xs",children:"#"}),(0,i.jsx)("span",{className:"text-secondary text-base font-semibold ",children:t.groupId.toString()})," ",(0,i.jsx)("span",{className:"font-semibold",children:t.groupName})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between text-xs mt-2",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-gray-500",children:"参与量: "}),t.maxCapacity<=BigInt(0)?(0,i.jsx)("span",{className:"text-gray-500",children:(0,g.LH)(t.totalJoinedAmount,2)}):(0,i.jsxs)("span",{className:a>95?"text-red-600":a>=90?"text-yellow-600":"text-gray-500",children:[(0,g.LH)(t.totalJoinedAmount,2)," / ",(0,g.LH)(t.maxCapacity,2)," (",(0,g.rl)(a),")"]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-gray-500",children:"参与地址数:"}),(0,i.jsx)("span",{className:"text-gray-500",children:t.accountCount.toString()})]})]})]}),(0,i.jsx)(q.Z,{className:"w-5 h-5 text-gray-400"})]})})},tx=function(e){var t=e.groups,s=e.actionId,n=((0,c.useContext)(l.M)||{}).token;return(0,i.jsxs)("div",{className:"mt-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)(k.Z,{title:"我的链群 (".concat(t.length,")")}),(0,i.jsx)(B(),{href:"/extension/group_op?actionId=".concat(s.toString(),"&op=activate"),className:"text-sm text-secondary hover:text-secondary/80 transition-colors",children:"激活链群 >>"})]}),t.length>0?(0,i.jsx)("div",{className:"space-y-3 mt-4",children:t.map(function(e){return(0,i.jsx)(tu,{group:e,actionId:s,token:n},e.groupId.toString())})}):(0,i.jsx)("div",{className:"text-center py-8 text-gray-500",children:"暂无链群"})]})},tm=function(e){var t=e.actionId,s=(e.actionInfo,e.extensionAddress),n=e.account,r=(0,v.Bk)().currentRound,a=(0,to.b)({extensionAddress:s,account:n,round:r}),d=a.groups,o=a.isPending,l=a.error,u=(0,eA.b)().handleError;return((0,c.useEffect)(function(){l&&u(l)},[l,u]),n)?o?(0,i.jsx)("div",{className:"flex flex-col items-center py-8",children:(0,i.jsx)(C.Z,{})}):d&&d.length>0?(0,i.jsx)("div",{children:(0,i.jsx)(tx,{groups:d,actionId:t})}):(0,i.jsxs)("div",{className:"text-center py-10",children:[(0,i.jsx)("p",{className:"text-gray-500 mb-6",children:"您还不是链群服务者"}),(0,i.jsx)(P.z,{variant:"outline",asChild:!0,className:"w-1/2 text-secondary border-secondary",children:(0,i.jsx)(B(),{href:"/extension/group_op/?actionId=".concat(t,"&op=activate"),children:"去激活链群 >>"})})]}):(0,i.jsx)("div",{className:"text-center py-12",children:(0,i.jsx)("p",{className:"text-gray-500",children:"请先连接钱包"})})},th=function(e){var t=e.extensionAddress,s=e.currentRound,n=e.actionId,r=e.actionInfo,a=e.activeTab,c=void 0===a?"public":a,d=(0,o.m)().address,l=(0,W.id)(t),u=l.factory;if(l.isPending)return(0,i.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)(C.Z,{}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:"加载扩展信息中..."})]})});var x=u?(0,U.qD)(u):null;if(!x)return(0,i.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,i.jsx)("div",{className:"text-center text-gray-500",children:(0,i.jsx)("p",{children:"该扩展类型暂不支持行动公示"})})});switch(x.type){case U.nw.LP:return(0,i.jsx)(ep,{extensionAddress:t,currentRound:s,actionId:n});case U.nw.GROUP_ACTION:if(!r)return(0,i.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,i.jsx)("div",{className:"text-center text-gray-500",children:(0,i.jsx)("p",{children:"缺少必要的行动信息"})})});if("group-manage"===c)return(0,i.jsx)(tm,{extensionAddress:t,actionId:n,actionInfo:r,account:d});return(0,i.jsx)(eU,{extensionAddress:t,actionId:n,actionInfo:r});case U.nw.GROUP_SERVICE:if(!r)return(0,i.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,i.jsx)("div",{className:"text-center text-gray-500",children:(0,i.jsx)("p",{children:"缺少必要的行动信息"})})});if("addresses"===c)return(0,i.jsx)(td,{extensionAddress:t,actionId:n});return(0,i.jsx)(ts,{extensionAddress:t,currentJoinRound:s,actionId:n,actionInfo:r});default:return(0,i.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,i.jsx)("div",{className:"text-center text-gray-500",children:(0,i.jsx)("p",{children:"该扩展类型暂不支持行动公示"})})})}},tg=s(5971),tf=s(83494);function tp(){var e=(0,d.useRouter)(),t=(0,o.m)().address,s=((0,c.useContext)(l.M)||{}).token,h=(0,r._)((0,c.useState)("basic"),2),g=h[0],f=h[1],p=e.query,j=p.symbol,v=p.id,N=p.tab,y=v?BigInt(v):void 0,b=(0,u.Q)({tokenAddress:null==s?void 0:s.address,actionId:y,account:t}),w=b.actionInfo,B=b.participantCount,A=b.totalAmount,R=b.convertedTotalAmount,k=b.joinedAmountTokenSymbol,_=b.joinedAmountTokenIsLP,S=b.isJoined,M=b.currentRound,P=b.isExtensionAction,L=b.extensionAddress,Z=b.factory,E=b.isPending,H=b.error,V=(0,x.GD)({extensionAddress:L,isExtensionAction:P,account:t}).tabs,D=[{key:"basic",label:"行动信息"},{key:"gov",label:"治理公示"}],q=(0,c.useMemo)(function(){var e=(0,a._)(D);return V.forEach(function(t){e.push({key:t.key,label:t.label})}),e},[V]),F=(0,c.useMemo)(function(){return q.map(function(e){return e.key})},[q]);if((0,c.useEffect)(function(){N&&F.includes(N)&&f(N)},[N,F]),(0,c.useEffect)(function(){j&&s&&j!==s.symbol&&e.push("/tokens")},[j,s,e]),!s)return(0,i.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)(C.Z,{}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:"加载Token信息中..."})]})});if(void 0==y)return(0,i.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,i.jsx)(T.Z,{type:"error",message:"参数错误：缺少行动ID参数"})});var O=function(e){return V.some(function(t){return t.key===e})},G=function(t){f(t);var s=(0,n._)({},e.query);s.tab=t;var r=O(t);"gov"===t||r||delete s.tab2,r||delete s.round,e.push({pathname:e.pathname,query:s},void 0,{shallow:!0})};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(tf.Z,{title:"行动详情",showBackButton:!0}),(0,i.jsx)("main",{className:"flex-grow",children:(0,i.jsxs)("div",{className:"px-4 pt-0 pb-3",children:[w&&(0,i.jsx)(m.Z,{actionInfo:w,participantCount:B,totalAmount:A,convertedTotalAmount:R,joinedAmountTokenSymbol:k,joinedAmountTokenIsLP:_,isJoined:S,isPending:E}),(0,i.jsx)("div",{className:"flex border-b border-gray-200 mb-4",children:q.map(function(e){return(0,i.jsx)("button",{onClick:function(){return G(e.key)},className:"flex-1 px-2 py-2 text-sm font-medium border-b-2 transition-colors ".concat(g===e.key?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700"),children:e.label},e.key)})}),function(){if(E)return(0,i.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)(C.Z,{}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:"加载数据中..."})]})});if(H)return(0,i.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,i.jsx)(T.Z,{type:"error",message:"加载失败：".concat(H.message||"获取行动信息失败，请稍后重试")})});if(!w)return(0,i.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,i.jsx)(T.Z,{type:"warning",message:"行动不存在：找不到指定的行动信息"})});switch(g){case"basic":return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(I,{actionInfo:w,currentRound:M,isExtensionAction:P}),P&&L&&Z&&(0,i.jsx)(tg.Z,{extensionAddress:L,factoryAddress:Z.address,actionId:y,actionInfo:w})]});case"gov":return(0,i.jsx)(K,{actionId:y,currentRound:M||BigInt(0),actionInfo:w,isExtensionAction:P});default:if(O(g)&&P&&L)return(0,i.jsx)(th,{extensionAddress:L,currentRound:M||BigInt(0),actionId:y,actionInfo:w,activeTab:g});return null}}()]})})]})}}},function(e){e.O(0,[8501,4463,721,3798,8139,5771,3494,3591,9419,8300,2112,5611,7966,6268,8945,6097,8886,5293,9330,7974,7568,1879,4018,1927,2888,9774,179],function(){return e(e.s=8286)}),_N_E=e.O()}]);