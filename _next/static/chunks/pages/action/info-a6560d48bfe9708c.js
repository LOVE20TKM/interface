try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="5c6f3430-6208-483f-9102-8b68f3df0ba2",e._sentryDebugIdIdentifier="sentry-dbid-5c6f3430-6208-483f-9102-8b68f3df0ba2")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9822],{8286:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/action/info",function(){return s(31836)}])},34680:function(e,t,s){"use strict";s.d(t,{Ol:function(){return o},SZ:function(){return u},Zb:function(){return l},aY:function(){return x},eW:function(){return m},ll:function(){return d}});var n=s(72253),r=s(47702),a=s(85893),i=s(67294),c=s(40108),l=i.forwardRef(function(e,t){var s=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:t,className:(0,c.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s)},i))});l.displayName="Card";var o=i.forwardRef(function(e,t){var s=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:t,className:(0,c.cn)("flex flex-col space-y-1.5 p-6",s)},i))});o.displayName="CardHeader";var d=i.forwardRef(function(e,t){var s=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:t,className:(0,c.cn)("text-2xl font-semibold leading-none tracking-tight",s)},i))});d.displayName="CardTitle";var u=i.forwardRef(function(e,t){var s=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:t,className:(0,c.cn)("text-sm text-muted-foreground",s)},i))});u.displayName="CardDescription";var x=i.forwardRef(function(e,t){var s=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:t,className:(0,c.cn)("p-6 pt-0",s)},i))});x.displayName="CardContent";var m=i.forwardRef(function(e,t){var s=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)("div",(0,n._)({ref:t,className:(0,c.cn)("flex items-center p-6 pt-0",s)},i))});m.displayName="CardFooter"},94193:function(e,t,s){"use strict";s.d(t,{_:function(){return u}});var n=s(72253),r=s(47702),a=s(85893),i=s(67294),c=s(49102),l=s(12003),o=s(40108),d=(0,l.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),u=i.forwardRef(function(e,t){var s=e.className,i=(0,r._)(e,["className"]);return(0,a.jsx)(c.f,(0,n._)({ref:t,className:(0,o.cn)(d(),s)},i))});u.displayName=c.f.displayName},21338:function(e,t,s){"use strict";var n=s(91309),r=s(85893),a=s(67294),i=s(88504),c=s(93778),l=s(74089),o=s(42083);t.Z=function(e){var t=e.currentRound,s=e.roundType,d=e.showCountdown,u=(0,i.O)().data,x=(0,a.useContext)(c.M),m=x?x.token:void 0,h=!u||!m||void 0===m.voteOriginBlocks,f=(0,n._)((0,a.useState)(BigInt(0)),2),j=f[0],g=f[1],v=Number("30126")||0,p=Number("2868")||0,y=m?Number(m.voteOriginBlocks):0,N=v-(Number(u)-y)%v,b=N>0?Math.ceil(N*p/1e3):0,w=(0,n._)((0,a.useState)(b),2),I=w[0],k=w[1];(0,a.useEffect)(function(){if(u){var e=v-(Number(u)-y)%v;k(e>0?Math.ceil(e*p/1e3):0)}},[u,v,p,y]),(0,a.useEffect)(function(){t>BigInt(0)&&g(t)},[t]);var _=null!=j?j.toString():"0";return j<=BigInt(0)?(0,r.jsx)(r.Fragment,{}):h||null==j||j<BigInt(0)?(null==j||BigInt(0),(0,r.jsx)(o.Z,{})):(0,r.jsx)("div",{className:"flex items-center mb-3",children:(0,r.jsxs)("span",{className:"text-sm text-greyscale-400",children:["(第",(0,r.jsx)("span",{className:"text-greyscale-400",children:_}),"轮","vote"===s?"投票":"verify"===s?"验证":"行动","阶段，",(0,r.jsx)("span",{className:"text-greyscale-400",children:"剩余"}),(0,r.jsx)("span",{className:"text-greyscale-400",children:Math.ceil(1e3*I/p)}),(0,r.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),void 0===d||d?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(l.Z,{initialTimeLeft:b,onTick:k})}):(0,r.jsx)("span",{className:"text-greyscale-400",children:I<60?"".concat(I,"秒"):I<=300?"".concat(Math.floor(I/60),"分钟").concat(I%60,"秒"):I<3600?"".concat(Math.floor(I/60),"分钟"):"".concat(Math.floor(I/3600),"小时").concat(Math.floor(I%3600/60),"分钟")}),(0,r.jsx)("span",{className:"text-greyscale-400",children:")"})]})})}},31084:function(e,t,s){"use strict";var n=s(85893);s(67294);var r=s(45655);t.Z=function(e){var t=e.text,s=e.className,a=e.maxLength,i=e.showWarning,c=e.preserveLineBreaks;if(!t)return null;var l=t;a&&t.length>a&&(l=t.substring(0,a)+"...");var o=(0,r.KL)(l,void 0!==c&&c),d=t!==l||/<[^>]*>/g.test(t)||/script|javascript|onclick|onerror|onload/gi.test(t);return(0,n.jsxs)("span",{className:void 0===s?"":s,children:[(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:o}}),void 0!==i&&i&&d&&(0,n.jsx)("span",{className:"text-yellow-500 text-xs ml-1",children:"⚠️ 内容已被安全过滤"})]})}},92429:function(e,t,s){"use strict";s.d(t,{hq:function(){return j},Hw:function(){return g}});var n=s(48564),r=s(2267),a=s(75766),i=s(45775),c=s(60480),l=s(13550),o=s.n(l),d=function(e,t){for(var s=e;s.length<2*t;)s="0"+s;return s},u=function(e){return(e=(e=e.toUpperCase()).substr(4)+e.substr(0,4)).split("").map(function(e){var t=e.charCodeAt(0);return t>=65&&t<=90?(t-65+10).toString():e}).join("")},x=function(e){for(var t,s=e;s.length>2;)s=(parseInt(t=s.slice(0,9),10)%97).toString()+s.slice(t.length);return parseInt(s,10)%97},m=function(){function e(t){(0,n._)(this,e),(0,a._)(this,"_iban",void 0),this._iban=t}return(0,r._)(e,[{key:"isValid",value:function(){return/^TH[0-9]{2}(ETH[0-9A-Z]{13}|[0-9A-Z]{30,31})$/.test(this._iban)&&1===x(u(this._iban))}},{key:"isDirect",value:function(){return 34===this._iban.length||35===this._iban.length}},{key:"isIndirect",value:function(){return 20===this._iban.length}},{key:"checksum",value:function(){return this._iban.substr(2,2)}},{key:"toAddress",value:function(){if(this.isDirect()){var e=this._iban.substr(4),t=new(o())(e,36);return(0,i.K)("0x".concat(t.toString(16).padStart(40,"0")))}return""}},{key:"toString",value:function(){return this._iban}}],[{key:"fromAddress",value:function(t){if(!(0,c.U)(t))throw Error("Provided address is not a valid address: "+t);var s=t.replace("0x","").replace("0X",""),n=d(new(o())(s,16).toString(36),15);return e.fromBban(n.toUpperCase())}},{key:"fromBban",value:function(t){return new e("TH"+("0"+(98-x(u("TH00"+t)))).slice(-2)+t)}},{key:"toIban",value:function(t){return e.fromAddress(t).toString()}},{key:"toAddress",value:function(t){var s=new e(t);if(!s.isDirect())throw Error("IBAN is indirect and can't be converted");return s.toAddress()}},{key:"isValid",value:function(t){return new e(t).isValid()}}]),e}();function h(e){return/^0[Xx][A-Fa-f0-9]{40}$/.test(e)}function f(e){try{return m.isValid(e)}catch(e){return!1}}function j(e){if(!e||""===e)return"";var t=e.trim();return h(t)?t.toLowerCase():f(t)?function(e){if(!e||""===e)return"";if("TH48000000000000000000000000001EKI"===e)return"0x0000000000000000000000000000000000010002";try{return m.toAddress(e).toLowerCase()}catch(e){return""}}(t):""}function g(e){if(!e||""===e.trim())return"请输入收款地址";var t=e.trim();return h(t)||f(t)&&j(t)?null:"请输入有效的地址格式（支持 0x、XE 或 TH 格式）"}},45655:function(e,t,s){"use strict";s.d(t,{Hg:function(){return l},KL:function(){return i},lt:function(){return c},rJ:function(){return o}});var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};function r(e){return e?e.replace(/[&<>"'/]/g,function(e){return n[e]||e}):""}function a(e){if(!e)return"";var t=e.replace(/<[^>]*>/g,"");return r(t=(t=(t=t.replace(/javascript:/gi,"")).replace(/on\w+\s*=/gi,"")).replace(/data:[^;]*;base64,/gi,""))}function i(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"";var s=/(https?:\/\/[^\s]+)/g;if(0===(e.match(s)||[]).length){var n=r(e);return t?n.replace(/\n/g,"<br>"):n}var a=e;return a=(a=(a=(a=a.replace(/<script[^>]*>.*?<\/script>/gi,"")).replace(/<[^>]*on\w+\s*=\s*[^>]*>/gi,"")).replace(/javascript:/gi,"")).split(s).map(function(e,t){return t%2==0?function(e){if(!e)return"";var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"};return e.replace(/[&<>"']/g,function(e){return t[e]||e})}(e):c(e)?e:r(e)}).join(""),t&&(a=a.replace(/\n/g,"<br>")),a}function c(e){if(!e)return!1;try{var t=new URL(e);if(!["https:","http:"].includes(t.protocol))return!1;var s=t.hostname.toLowerCase(),n=e.toLowerCase();if(n.includes("javascript:")||n.includes("data:")||n.includes("vbscript:")||n.includes("file:")||["phishing-site.com","fake-bank.com","malware-host.net"].some(function(e){return s===e||s.endsWith("."+e)})||["phishing","malware","trojan","keylogger","ransomware","exploit-kit"].some(function(e){return s.includes(e)})||/[\u0000-\u001f\u007f-\u009f]/.test(s)||!/^[a-zA-Z0-9.-]+$/.test(s))return!1;return/^\d+\.\d+\.\d+\.\d+$/.test(s),!0}catch(e){return!1}}function l(e){var t=[],s=e;if(!e||""===e.trim())return{isValid:!1,errors:["验证规则不能为空"],sanitizedRule:""};e.length>1e4&&t.push("验证规则不能超过10000字"),/<(?:script|iframe|object|embed|form|input|meta|link|style)[^>]*>/gi.test(e)&&(t.push("验证规则不能包含危险的HTML标签"),s=a(e)),RegExp("(?<!https?:\\/\\/[^\\s]*)(javascript:|onclick\\s*=|onerror\\s*=|onload\\s*=|<script)","gi").test(e)&&(t.push("验证规则不能包含可执行脚本代码"),s=a(e));var n=e.match(/(https?:\/\/[^\s]+)/g)||[];if(n.length>0){var r=n.filter(function(e){return!c(e)});r.length>0&&t.push("包含危险的链接，已被安全过滤器拦截: ".concat(r.join(", ")))}return{isValid:0===t.length,errors:t,sanitizedRule:s}}function o(e){var t=[];if(!e||""===e.trim())return{isValid:!1,errors:["验证名称不能为空"],sanitizedKey:""};var s=a(e);return s!==e&&t.push("验证名称包含不安全的内容"),{isValid:0===t.length,errors:t,sanitizedKey:s}}},72107:function(e,t,s){"use strict";s.d(t,{L:function(){return c}});var n=s(85893);s(67294);var r=s(1938),a=s(45655),i=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return e;var s=/(https?:\/\/[^\s]+)/g;if(!s.test(e)){var i=(0,a.KL)(e,t);return(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:i}})}var c=e.split(s),l=e.match(s)||[];return(0,n.jsx)(n.Fragment,{children:c.map(function(e,s){if(s%2==0){var i=(0,a.KL)(e,t);return(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:i}},s)}var c=l[(s-1)/2];return(0,a.lt)(c)?(0,n.jsx)("a",{href:c,onClick:function(e){return(e.preventDefault(),e.stopPropagation(),(0,a.lt)(c))?r.N.handleExternalLink(c):alert("链接安全检查失败: ".concat(c.substring(0,50),"...")),!1},className:"text-blue-500 underline hover:text-blue-700 break-words break-all whitespace-normal",title:"外部链接: ".concat(c),rel:"noopener noreferrer",target:"_self",children:c.length>32?"".concat(c.substring(0,29),"..."):c},s):(0,n.jsx)("span",{className:"text-red-500 font-semibold",children:"[危险链接已被拦截]"},s)})})},c=function(e){var t=e.text,s=e.preserveLineBreaks;return(0,n.jsx)(n.Fragment,{children:i(t,void 0!==s&&s)})}},31836:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Y}});var n=s(72253),r=s(91309),a=s(85893),i=s(67294),c=s(11163),l=s(42130),o=s(93778),d=s(36893),u=s(11418),x=s(27460),m=s(91529),h=s(72107),f=s(31084),j=s(44746);function g(e){var t,s=e.actionInfo;return((0,i.useContext)(o.M)||{}).token?(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between md:max-w-xs",children:[(0,a.jsx)("span",{className:"font-bold text-sm",children:"最小参与代币数:"}),(0,a.jsx)("span",{className:"font-mono text-secondary",children:(t=s.body.minStake,(0,m.LH)(t))})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between md:max-w-xs",children:[(0,a.jsx)("span",{className:"font-bold text-sm",children:"最大激励地址数:"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(j.Z,{title:"最大激励地址数说明",content:(0,a.jsxs)("p",{className:"leading-relaxed text-base",children:["每轮从所有参与行动的代币中，随机抽取",(0,a.jsx)("span",{className:"font-mono font-bold text-blue-600 mx-1 text-base",children:s.body.maxRandomAccounts.toString()}),"份代币，返回对应地址。若多份代币对应相同地址，则会合并为一个地址。"]})}),(0,a.jsx)("span",{className:"font-mono text-secondary",children:s.body.maxRandomAccounts.toString()})]})]})]})}),s.body.verificationRule&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("div",{className:"font-bold text-sm mb-2",children:"验证规则:"}),(0,a.jsx)("div",{className:"leading-loose bg-gray-50 p-2 rounded-md",children:(0,a.jsx)(h.L,{text:s.body.verificationRule,preserveLineBreaks:!0})})]}),s.body.verificationKeys&&s.body.verificationKeys.length>0&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("div",{className:"font-bold text-sm mb-2",children:"报名参加行动时，行动者要提供的信息:"}),(0,a.jsx)("ul",{className:"list-disc pl-5",children:s.body.verificationKeys.map(function(e,t){var n;return(0,a.jsxs)("li",{className:"text-gray-700",children:[(0,a.jsxs)("div",{className:"text-sm font-bold text-greyscale-900",children:[(0,a.jsx)(f.Z,{text:e,showWarning:!0})," :"]}),(0,a.jsx)("div",{children:(0,a.jsx)(f.Z,{text:null===(n=s.body.verificationInfoGuides)||void 0===n?void 0:n[t],showWarning:!0,preserveLineBreaks:!0})})]},t)})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4 md:max-w-md",children:[(0,a.jsx)("span",{className:"font-bold text-sm",children:"白名单:"}),(0,a.jsx)("div",{children:"0x0000000000000000000000000000000000000000"===s.body.whiteListAddress?(0,a.jsx)("span",{className:"text-gray-400 text-sm",children:"无限制"}):(0,a.jsx)(x.Z,{address:s.body.whiteListAddress,showCopyButton:!0,colorClassName:"text-sm"})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4 md:max-w-md",children:[(0,a.jsx)("span",{className:"font-bold text-sm",children:"创建人:"}),(0,a.jsx)(x.Z,{address:s.head.author,showCopyButton:!0,colorClassName:"text-sm"})]})]}):(0,a.jsx)("div",{children:"Token信息加载中..."})}var v=s(4586),p=s(41664),y=s.n(p),N=s(93950),b=s(90963),w=s(64777),I=s(42083);function k(e){var t=e.actionId,s=e.currentRound,l=(0,c.useRouter)(),d=((0,i.useContext)(o.M)||{}).token,u=(0,r._)((0,i.useState)(s||BigInt(1)),2),h=u[0],f=u[1],j=l.query.round;(0,i.useEffect)(function(){j&&!isNaN(Number(j))?f(BigInt(j)):s&&f(s)},[j,s]);var g=(0,N.pA)((null==d?void 0:d.address)||"0x0000000000000000000000000000000000000000",h,t),p=g.actionVoters,k=g.isPending,_=g.error;if(!d)return(0,a.jsx)("div",{children:"Token信息加载中..."});var B=(null==p?void 0:p.reduce(function(e,t){return e+t.voteCount},BigInt(0)))||BigInt(0),C=p?(0,v._)(p).sort(function(e,t){return e.voteCount>t.voteCount?-1:e.voteCount<t.voteCount?1:0}):[];return(0,a.jsxs)("div",{className:"relative pb-4",children:[h===BigInt(0)&&(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-500",children:"暂无投票数据"})}),(0,a.jsx)("div",{className:"flex items-center",children:h>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.Z,{title:"第 ".concat(h.toString()," 轮投票详情")}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"("}),(0,a.jsx)(b.Z,{currentRound:s?(0,m.cK)(s,d):BigInt(0),handleChangedRound:function(e){var t=BigInt(e);f(t);var s=(0,n._)({},l.query);s.round=t.toString(),l.push({pathname:l.pathname,query:s},void 0,{shallow:!0})}}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500",children:")"})]})}),h>0&&p&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-4 mb-4",children:[(0,a.jsxs)("div",{className:"",children:[(0,a.jsx)("span",{className:"text-gray-500 mr-3",children:"投票地址数:"}),(0,a.jsx)("span",{className:"font-mono text-secondary",children:p.length})]}),(0,a.jsxs)("div",{className:"",children:[(0,a.jsx)("span",{className:"text-gray-500 mr-3",children:"总投票数:"}),(0,a.jsx)("span",{className:"font-mono text-secondary",children:(0,m.LH)(B)})]})]}),k&&(0,a.jsx)("div",{className:"flex justify-center py-8",children:(0,a.jsx)(I.Z,{})}),_&&(0,a.jsxs)("div",{className:"alert alert-error",children:[(0,a.jsx)("svg",{className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsxs)("span",{children:["加载投票数据失败: ",_.message]})]}),!k&&!_&&p&&h>0&&(0===C.length?(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"该轮次暂无投票记录"}):(0,a.jsxs)("table",{className:"table w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,a.jsx)("th",{className:"px-1 text-left",children:"排名"}),(0,a.jsx)("th",{className:"px-1 text-left",children:"投票地址"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"投票数"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"占比"})]})}),(0,a.jsx)("tbody",{children:C.map(function(e,t){var s;return(0,a.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,a.jsx)("td",{className:"px-1 text-greyscale-400",children:t+1}),(0,a.jsx)("td",{className:"px-1",children:(0,a.jsx)(y(),{href:"/vote/history?account=".concat(e.account),children:(0,a.jsxs)("div",{className:"inline-flex items-center bg-gray-50 hover:bg-gray-100 rounded-md px-2 py-1 transition-colors duration-150 active:bg-gray-200",children:[(0,a.jsx)(x.Z,{address:e.account,showCopyButton:!0}),(0,a.jsx)("svg",{className:"h-3 w-3 text-gray-400 ml-2 opacity-60 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})}),(0,a.jsx)("td",{className:"px-1 text-right font-mono text-secondary",children:(0,m.LH)(e.voteCount)}),(0,a.jsxs)("td",{className:"px-1 text-right text-greyscale-500",children:[(s=e.voteCount,B===BigInt(0)?"0.00":(Number(s)/Number(B)*100).toFixed(2)),"%"]})]},e.account)})})]}))]})}var _=s(14932),B=s(42171),C=s(4307),Z=s(87250),S=s(7080),R=s(73591),L=s(21338),A=function(e){var t=e.currentRound,s=e.actionId,d=e.actionInfo,u=(0,c.useRouter)(),f=((0,i.useContext)(o.M)||{}).token,g=(0,l.m)().address,v=(0,r._)((0,i.useState)(new Set),2),p=v[0],y=v[1],b=(0,Z.LW)(null==f?void 0:f.address,t,s,"0x0000000000000000000000000000000000000000"),k=b.scoreByActionIdByAccount,A=b.isPending,E=b.error,T=(0,N.pK)(null==f?void 0:f.address,t,s),M=T.verifiedAddresses,H=T.isPending,K=T.error,q=(0,N.X5)(null==f?void 0:f.address,t,s),P=q.verificationInfos,D=q.isPending,V=q.error,F=(0,S.wD)(null==f?void 0:f.address,t,s),z=F.votesNumByActionId,O=(F.isPending,F.error),W=(0,R.S)().handleContractError;(0,i.useEffect)(function(){K&&W(K,"dataViewer"),V&&W(V,"dataViewer"),E&&W(E,"verify"),O&&W(O,"vote")},[K,V,E,O]);var Y=function(e){var t=new Set(p);t.has(e)?t.delete(e):t.add(e),y(t)},X=((null==M?void 0:M.reduce(function(e,t){return e+t.score},BigInt(0)))||BigInt(0))+(k||BigInt(0)),J=Number(X)/Number(z||BigInt(0))*100;return(0,a.jsxs)("div",{className:"relative pb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(w.Z,{title:"第 ".concat(t," 轮验证")}),J>0&&(0,a.jsxs)("span",{className:"text-sm text-greyscale-500 ml-2",children:["(当前进度：",(0,m.rl)(J),")"]})]}),(null==P?void 0:P.length)>0&&(0,a.jsx)("button",{onClick:function(){return u.push("/action/verify_detail?symbol=".concat(null==f?void 0:f.symbol,"&id=").concat(s,"&round=").concat(t))},className:"text-sm text-secondary hover:text-secondary-600 ",children:"查看明细 >>"})]}),(0,a.jsx)("div",{className:"flex justify-left mt-2",children:(0,a.jsx)(L.Z,{currentRound:t,roundType:"verify"})}),D||H||A?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)(I.Z,{})}):P&&0!==P.length?(0,a.jsxs)("table",{className:"table w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,a.jsx)("th",{}),(0,a.jsx)("th",{children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:["被抽中地址",(0,a.jsx)(j.Z,{title:"最大激励地址数说明",content:(0,a.jsxs)("p",{className:"leading-relaxed text-base",children:["每轮从所有参与行动的代币中，随机抽取",(0,a.jsx)("span",{className:"font-mono font-bold text-blue-600 mx-1 text-base",children:null==d?void 0:d.body.maxRandomAccounts.toString()}),"份代币，返回对应地址。若多份代币对应相同地址，则会合并为一个地址。"]})})]})}),(0,a.jsx)("th",{className:"px-1 text-right",children:"获得验证票"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"验证票占比"})]})}),(0,a.jsxs)("tbody",{children:[P.map(function(e){var t=null==M?void 0:M.find(function(t){return t.account===e.account});return(0,_._)((0,n._)({},e),{score:(null==t?void 0:t.score)||BigInt(0)})}).sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:0}).map(function(e){var t=null==M?void 0:M.find(function(t){return t.account===e.account}),s=p.has(e.account);return(0,a.jsxs)(i.Fragment,{children:[(0,a.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===g?"text-secondary":""),children:[(0,a.jsx)("td",{className:"px-1 w-8",children:(0,a.jsx)("button",{onClick:function(){return Y(e.account)},className:"text-greyscale-400 hover:text-greyscale-600",children:s?(0,a.jsx)(B.Z,{size:16}):(0,a.jsx)(C.Z,{size:16})})}),(0,a.jsx)("td",{className:"px-1",children:(0,a.jsx)(x.Z,{address:e.account,showCopyButton:!0,word:e.account===g?"(我)":""})}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.tY)((null==t?void 0:t.score)||BigInt(0))}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.rl)(Number((null==t?void 0:t.score)||BigInt(0))/Number(X||BigInt(0))*100)})]}),d&&s&&(0,a.jsxs)("tr",{className:"border-b border-gray-100 bg-gray-50",children:[(0,a.jsx)("td",{}),(0,a.jsx)("td",{colSpan:3,className:"px-1 py-3",children:(0,a.jsxs)("div",{className:"text-sm text-greyscale-600",children:[(0,a.jsx)("div",{className:"text-xs text-greyscale-400 mb-2",children:"验证信息:"}),d.body.verificationKeys.map(function(t,s){return(0,a.jsxs)("div",{className:"mb-1",children:[(0,a.jsxs)("span",{className:"text-greyscale-500",children:[t,":"]})," ",(0,a.jsx)(h.L,{text:e.infos[s]})]},s)})]})})]})]},e.account)}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-1"}),(0,a.jsx)("td",{className:"px-1 text-greyscale-500",children:"弃权票"}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.tY)(k||BigInt(0))}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.rl)(Number(k||BigInt(0))/Number(X||BigInt(0))*100)})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-1"}),(0,a.jsx)("td",{className:"px-1 text-greyscale-500",children:"汇总 "}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.tY)(X||BigInt(0))}),(0,a.jsx)("td",{className:"px-1 text-right",children:"100%"})]})]})]}):(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有验证地址"})]})},E=function(e){var t=e.currentJoinRound,s=e.actionId,d=e.actionInfo,u=(0,c.useRouter)(),f=((0,i.useContext)(o.M)||{}).token,j=(0,l.m)().address,g=(0,r._)((0,i.useState)(BigInt(0)),2),p=g[0],y=g[1],k=(0,r._)((0,i.useState)(new Set),2),_=k[0],Z=k[1],S=u.query.round;(0,i.useEffect)(function(){S&&!isNaN(Number(S))?y(BigInt(S)):f&&t-BigInt(f.initialStakeRound)>=BigInt(2)&&y(t-BigInt(2))},[S,t,f]);var L=(0,N.pK)(null==f?void 0:f.address,f&&p?p:BigInt(0),s),A=L.verifiedAddresses,E=L.isPending,T=L.error,M=(0,N.X5)(null==f?void 0:f.address,f&&p?p:BigInt(0),s),H=M.verificationInfos,K=M.isPending,q=M.error,P=(0,r._)((0,i.useState)([]),2),D=P[0],V=P[1];(0,i.useEffect)(function(){A&&V(A)},[A]);var F=(0,R.S)().handleContractError;(0,i.useEffect)(function(){T&&F(T,"dataViewer"),q&&F(q,"dataViewer")},[T,q]),(0,i.useEffect)(function(){D.length>0&&0===_.size&&Z(new Set([(0,v._)(D).sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:0})[0].account]))},[D]);var z=(0,v._)(D).sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:0}),O=function(e){var t=new Set(_);t.has(e)?t.delete(e):t.add(e),Z(t)};return(0,a.jsxs)("div",{className:"relative ",children:[p===BigInt(0)&&(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-500",children:"暂无验证结果"})}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center",children:p>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.Z,{title:"第 ".concat(p.toString()," 轮验证结果")}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"("}),(0,a.jsx)(b.Z,{currentRound:f&&t?(0,m.cK)(t-BigInt(2),f):BigInt(0),handleChangedRound:function(e){var t=BigInt(e);y(t);var s=(0,n._)({},u.query);s.round=t.toString(),u.push({pathname:u.pathname,query:s},void 0,{shallow:!0})}}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500",children:")"})]})}),p>0&&D.length>0&&(0,a.jsx)("button",{onClick:function(){return u.push("/action/verify_detail?symbol=".concat(null==f?void 0:f.symbol,"&id=").concat(s,"&round=").concat(p))},className:"text-sm text-secondary hover:text-secondary-600 transition-colors",children:"查看明细 >>"})]}),E||K?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)(I.Z,{})}):0===D.length?p>BigInt(0)&&(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有验证地址"}):(0,a.jsxs)("table",{className:"table w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,a.jsx)("th",{}),(0,a.jsx)("th",{children:"被抽中地址"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"获得验证票"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"可铸造激励"})]})}),(0,a.jsx)("tbody",{children:z.map(function(e){var t=null==H?void 0:H.find(function(t){return t.account===e.account}),s=_.has(e.account);return(0,a.jsxs)(i.Fragment,{children:[(0,a.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===j?"text-secondary":""),children:[(0,a.jsx)("td",{className:"px-1 w-8",children:t&&(0,a.jsx)("button",{onClick:function(){return O(e.account)},className:"text-greyscale-400 hover:text-greyscale-600",children:s?(0,a.jsx)(B.Z,{size:16}):(0,a.jsx)(C.Z,{size:16})})}),(0,a.jsx)("td",{className:"px-1 ",children:(0,a.jsx)(x.Z,{address:e.account,showCopyButton:!0,word:e.account===j?"(我)":""})}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.tY)(e.score)}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.tY)(e.reward||BigInt(0))})]}),t&&d&&s&&(0,a.jsxs)("tr",{className:"border-b border-gray-100 bg-gray-50",children:[(0,a.jsx)("td",{}),(0,a.jsx)("td",{colSpan:3,className:"px-1 py-3",children:(0,a.jsxs)("div",{className:"text-sm text-greyscale-600",children:[(0,a.jsx)("div",{className:"text-xs text-greyscale-400 mb-2",children:"验证信息:"}),d.body.verificationKeys.map(function(e,s){return(0,a.jsxs)("div",{className:"mb-1",children:[(0,a.jsxs)("span",{className:"text-greyscale-500",children:[e,":"]})," ",(0,a.jsx)(h.L,{text:t.infos[s]})]},s)})]})})]})]},e.account)})})]})]})},T=function(e){var t=e.actionId,s=e.currentRound,l=e.actionInfo,o=(0,c.useRouter)(),d=(0,r._)((0,i.useState)("current"),2),u=d[0],x=d[1],m=o.query.tab2;(0,i.useEffect)(function(){m&&["current","history"].includes(m)&&x(m)},[m]);var h=function(e){x(e);var t=(0,n._)({},o.query);t.tab2=e,o.push({pathname:o.pathname,query:t},void 0,{shallow:!0})};return(0,a.jsxs)("div",{className:"bg-white rounded-lg",children:[(0,a.jsx)("div",{className:"flex bg-muted rounded-lg p-1 mb-4 mx-16",children:[{key:"current",label:"当前验证"},{key:"history",label:"历史验证"}].map(function(e){return(0,a.jsx)("button",{onClick:function(){return h(e.key)},className:"flex-1 px-2 py-1 text-sm font-medium rounded-md transition-all duration-200 ".concat(u===e.key?"bg-white text-secondary shadow-sm":"text-gray-500 hover:text-gray-800 hover:bg-gray-50"),children:e.label},e.key)})}),function(){switch(u){case"current":return(0,a.jsx)(A,{actionId:t,currentRound:s&&s>BigInt(0)?s-BigInt(1):BigInt(0),actionInfo:l});case"history":return(0,a.jsx)(E,{currentJoinRound:s,actionId:t,actionInfo:l});default:return null}}()]})},M=s(34680),H=s(21774),K=s(27245),q=s(94193),P=(0,s(31134).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),D=s(68655),V=s(92429),F=s(20442),z=s(17301);function O(e){var t=e.actionId,s=((0,i.useContext)(o.M)||{}).token,n=(0,r._)((0,i.useState)(""),2),c=n[0],l=n[1],d=(0,r._)((0,i.useState)(null),2),u=d[0],x=d[1],h=(0,r._)((0,i.useState)(null),2),f=h[0],j=h[1],g=(0,F.X9)(null==s?void 0:s.address,t,u),v=g.joinedAmountByActionIdByAccount,p=g.isPending,y=g.error,N=function(e){l(e),j((0,V.Hw)(e))},b=function(){if(c.trim()){var e=(0,V.hq)(c);if(!e){j("请输入有效的地址格式（支持 0x 或 TH 格式）");return}x(e),j(null)}},w=!f;return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(M.Zb,{className:"border-0 md:border shadow-none md:shadow-sm",children:[(0,a.jsx)(M.Ol,{children:(0,a.jsxs)(M.ll,{className:"flex items-center gap-2 text-lg",children:[(0,a.jsx)(P,{className:"h-5 w-5"}),"查询地址参与情况"]})}),(0,a.jsxs)(M.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(H.I,{id:"address",placeholder:"请输入要查询的钱包地址 (支持 0x 或 TH 格式)",value:c,onChange:function(e){return N(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&b()},className:f?"border-red-500":""}),f&&(0,a.jsxs)("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[(0,a.jsx)(D.Z,{className:"h-4 w-4"}),f]})]}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(K.z,{onClick:b,disabled:!c.trim()||!w||!!u&&p,className:"px-8",children:u&&p?(0,a.jsx)(I.Z,{}):"查询"})})]})]}),u&&(0,a.jsxs)(M.Zb,{className:"border-0 md:border shadow-none md:shadow-sm",children:[(0,a.jsx)(M.Ol,{children:(0,a.jsx)(M.ll,{className:"text-lg",children:"查询结果"})}),(0,a.jsx)(M.aY,{children:p?(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)(I.Z,{}),(0,a.jsx)("span",{className:"ml-2",children:"查询中..."})]}):y?(0,a.jsx)(z.Z,{type:"error",message:"查询失败：".concat(y.message)}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(q._,{className:"text-sm text-gray-600",children:"查询地址"}),(0,a.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg",children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("code",{className:"text-sm font-mono break-all",children:u}),c!==u&&(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["原始输入：",c]})]})})]}),void 0!==v&&v>BigInt(0)?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(q._,{className:"text-sm text-gray-600",children:"参与代币数量"}),(0,a.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg",children:(0,a.jsxs)("div",{className:"text-lg font-semibold",children:[(0,m.LH)(v)," ",(null==s?void 0:s.symbol)||""]})})]}):(0,a.jsxs)("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-yellow-800",children:[(0,a.jsx)(D.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:"font-medium",children:"该地址未参与此行动"})]}),(0,a.jsx)("p",{className:"text-sm text-yellow-700 mt-1",children:"参与代币数量为 0"})]})]})})]}),(0,a.jsxs)(M.Zb,{className:"border-0 md:border shadow-none md:shadow-sm",children:[(0,a.jsx)(M.Ol,{children:(0,a.jsx)(M.ll,{className:"text-base",children:"使用说明"})}),(0,a.jsxs)(M.aY,{className:"text-sm text-gray-600 space-y-2",children:[(0,a.jsx)("p",{children:"• 支持两种地址格式：0x 开头的以太坊地址 或 TH 开头的 TKM 地址"}),(0,a.jsx)("p",{children:"• 查询结果显示该地址参与此行动质押的代币总数量"}),(0,a.jsx)("p",{children:"• 如果显示 0，表示该地址未参与此行动"})]})]})]})}var W=s(83494);function Y(){var e=(0,c.useRouter)(),t=(0,l.m)().address,s=((0,i.useContext)(o.M)||{}).token,x=(0,r._)((0,i.useState)("basic"),2),m=x[0],h=x[1],f=e.query,j=f.symbol,v=f.id,p=f.tab,y=v?BigInt(v):void 0,N=(0,d.r)({tokenAddress:null==s?void 0:s.address,actionId:y,account:t}),b=N.actionInfo,w=N.participantCount,_=N.totalAmount,B=N.userJoinedAmount,C=N.isJoined,Z=N.currentRound,S=N.isPending,R=N.error;if((0,i.useEffect)(function(){p&&["basic","vote","verify","join"].includes(p)&&h(p)},[p]),(0,i.useEffect)(function(){j&&s&&j!==s.symbol&&e.push("/tokens")},[j,s,e]),!s)return(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(I.Z,{}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"加载Token信息中..."})]})});if(void 0==y)return(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsx)(z.Z,{type:"error",message:"参数错误：缺少行动ID参数"})});var L=function(t){h(t);var s=(0,n._)({},e.query);s.tab=t,e.push({pathname:e.pathname,query:s},void 0,{shallow:!0})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(W.Z,{title:"行动详情",showBackButton:!0}),(0,a.jsx)("main",{className:"flex-grow",children:(0,a.jsxs)("div",{className:"px-4 pt-0 pb-3",children:[b&&(0,a.jsx)(u.Z,{actionInfo:b,participantCount:w,totalAmount:_,isJoined:C,userJoinedAmount:B,isPending:S}),(0,a.jsx)("div",{className:"flex border-b border-gray-200 mb-4",children:[{key:"basic",label:"行动详情"},{key:"vote",label:"投票公示"},{key:"join",label:"参与公示"},{key:"verify",label:"验证公示"}].map(function(e){return(0,a.jsx)("button",{onClick:function(){return L(e.key)},className:"flex-1 px-2 py-2 text-sm font-medium border-b-2 transition-colors ".concat(m===e.key?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700"),children:e.label},e.key)})}),function(){if(S)return(0,a.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(I.Z,{}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"加载数据中..."})]})});if(R)return(0,a.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,a.jsx)(z.Z,{type:"error",message:"加载失败：".concat(R.message||"获取行动信息失败，请稍后重试")})});if(!b)return(0,a.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,a.jsx)(z.Z,{type:"warning",message:"行动不存在：找不到指定的行动信息"})});switch(m){case"basic":return(0,a.jsx)(g,{actionInfo:b});case"join":return(0,a.jsx)(O,{actionId:y});case"vote":return(0,a.jsx)(k,{actionId:y,currentRound:Z});case"verify":return(0,a.jsx)(T,{actionId:y,currentRound:Z||BigInt(0),actionInfo:b});default:return null}}()]})})]})}},49102:function(e,t,s){"use strict";s.d(t,{f:function(){return c}});var n=s(67294),r=s(75320),a=s(85893),i=n.forwardRef((e,t)=>(0,a.jsx)(r.WV.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var c=i}},function(e){e.O(0,[8239,367,5249,3494,2252,3950,7724,7285,7250,5880,2888,9774,179],function(){return e(e.s=8286)}),_N_E=e.O()}]);