try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="946c8704-aa76-4820-9640-4ffd3ccc40f3",e._sentryDebugIdIdentifier="sentry-dbid-946c8704-aa76-4820-9640-4ffd3ccc40f3")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9822],{8286:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/action/info",function(){return n(73537)}])},74089:function(e,t,n){"use strict";var s=n(91309),r=n(85893),a=n(67294);t.Z=function(e){var t=e.initialTimeLeft,n=e.onTick,c=e.forceShowSeconds,i=e.fontClass,o=void 0===i?"":i,l=(0,s._)((0,a.useState)(Date.now()+1e3*t),2),d=l[0],u=l[1],x=(0,s._)((0,a.useState)(t),2),m=x[0],h=x[1];(0,a.useEffect)(function(){u(Date.now()+1e3*t)},[t]),(0,a.useEffect)(function(){var e=setInterval(function(){var t=Math.max(0,Math.floor((d-Date.now())/1e3));h(t),n&&n(t),t<=0&&(clearInterval(e),window.location.reload())},1e3);return function(){return clearInterval(e)}},[d,n]);var f=Math.floor(m/86400),g=Math.floor(m%86400/3600);return(0,r.jsxs)("span",{className:"inline-flex space-x-1 text-greyscale-400",children:[f>0&&(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"countdown font-mono ".concat(o),children:(0,r.jsx)("span",{style:{"--value":f}})}),(0,r.jsx)("span",{className:o,children:"天"})]}),(g>0||f>0)&&(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"countdown font-mono ".concat(o),children:(0,r.jsx)("span",{style:{"--value":g}})}),(0,r.jsx)("span",{className:o,children:"时"})]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"countdown font-mono ".concat(o),children:(0,r.jsx)("span",{style:{"--value":Math.floor(m%3600/60)}})}),(0,r.jsx)("span",{className:o,children:"分"})]}),(f<=0||void 0!==c&&c)&&(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"countdown font-mono ".concat(o),children:(0,r.jsx)("span",{style:{"--value":m%60}})}),(0,r.jsx)("span",{className:o,children:"秒"})]})]})}},21338:function(e,t,n){"use strict";var s=n(91309),r=n(85893),a=n(67294),c=n(88504),i=n(93778),o=n(74089),l=n(42083);t.Z=function(e){var t=e.currentRound,n=e.roundType,d=e.showCountdown,u=(0,c.O)().data,x=(0,a.useContext)(i.M),m=x?x.token:void 0,h=!u||!m||void 0===m.voteOriginBlocks,f=(0,s._)((0,a.useState)(BigInt(0)),2),g=f[0],j=f[1],v=Number("30126")||0,p=Number("2868")||0,y=m?Number(m.voteOriginBlocks):0,N=v-(Number(u)-y)%v,b=N>0?Math.ceil(N*p/1e3):0,w=(0,s._)((0,a.useState)(b),2),I=w[0],k=w[1];(0,a.useEffect)(function(){if(u){var e=v-(Number(u)-y)%v;k(e>0?Math.ceil(e*p/1e3):0)}},[u,v,p,y]),(0,a.useEffect)(function(){t>BigInt(0)&&j(t)},[t]);var B=null!=g?g.toString():"0";return g<=BigInt(0)?(0,r.jsx)(r.Fragment,{}):h||null==g||g<BigInt(0)?(null==g||BigInt(0),(0,r.jsx)(l.Z,{})):(0,r.jsx)("div",{className:"flex items-center mb-3",children:(0,r.jsxs)("span",{className:"text-sm text-greyscale-400",children:["( 第",(0,r.jsx)("span",{className:"text-greyscale-400",children:B}),"轮","vote"===n?"投票":"verify"===n?"验证":"行动","阶段，",(0,r.jsx)("span",{className:"text-greyscale-400",children:"剩余"}),(0,r.jsx)("span",{className:"text-greyscale-400",children:Math.ceil(1e3*I/p)}),(0,r.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),void 0===d||d?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(o.Z,{initialTimeLeft:b,onTick:k})}):(0,r.jsx)("span",{className:"text-greyscale-400",children:I<60?"".concat(I,"秒"):I<=300?"".concat(Math.floor(I/60),"分钟").concat(I%60,"秒"):I<3600?"".concat(Math.floor(I/60),"分钟"):"".concat(Math.floor(I/3600),"小时").concat(Math.floor(I%3600/60),"分钟")}),(0,r.jsx)("span",{className:"text-greyscale-400",children:" )"})]})})}},31084:function(e,t,n){"use strict";var s=n(85893);n(67294);var r=n(45655);t.Z=function(e){var t=e.text,n=e.className,a=e.maxLength,c=e.showWarning,i=e.preserveLineBreaks;if(!t)return null;var o=t;a&&t.length>a&&(o=t.substring(0,a)+"...");var l=(0,r.KL)(o,void 0!==i&&i),d=t!==o||/<[^>]*>/g.test(t)||/script|javascript|onclick|onerror|onload/gi.test(t);return(0,s.jsxs)("span",{className:void 0===n?"":n,children:[(0,s.jsx)("span",{dangerouslySetInnerHTML:{__html:l}}),void 0!==c&&c&&d&&(0,s.jsx)("span",{className:"text-yellow-500 text-xs ml-1",children:"⚠️ 内容已被安全过滤"})]})}},45655:function(e,t,n){"use strict";n.d(t,{Hg:function(){return o},KL:function(){return c},lt:function(){return i},rJ:function(){return l}});var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};function r(e){return e?e.replace(/[&<>"'/]/g,function(e){return s[e]||e}):""}function a(e){if(!e)return"";var t=e.replace(/<[^>]*>/g,"");return r(t=(t=(t=t.replace(/javascript:/gi,"")).replace(/on\w+\s*=/gi,"")).replace(/data:[^;]*;base64,/gi,""))}function c(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"";var n=/(https?:\/\/[^\s]+)/g;if(0===(e.match(n)||[]).length){var s=r(e);return t?s.replace(/\n/g,"<br>"):s}var a=e;return a=(a=(a=(a=a.replace(/<script[^>]*>.*?<\/script>/gi,"")).replace(/<[^>]*on\w+\s*=\s*[^>]*>/gi,"")).replace(/javascript:/gi,"")).split(n).map(function(e,t){return t%2==0?function(e){if(!e)return"";var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"};return e.replace(/[&<>"']/g,function(e){return t[e]||e})}(e):i(e)?e:r(e)}).join(""),t&&(a=a.replace(/\n/g,"<br>")),a}function i(e){if(!e)return!1;try{var t=new URL(e);if(!["https:","http:"].includes(t.protocol))return!1;var n=t.hostname.toLowerCase();if(["malicious-site.com","evil.com","phishing-site.com","bit.ly","tinyurl.com","t.co"].some(function(e){return n.includes(e)}))return!1;if(["weibo.com","twitter.com","x.com","facebook.com","instagram.com","linkedin.com","youtube.com","tiktok.com","douyin.com","github.com","gitlab.com","stackoverflow.com","medium.com","wikipedia.org","reddit.com","discord.com","telegram.org","etherscan.io","bscscan.com","coinmarketcap.com","coingecko.com"].some(function(e){return n===e||n.endsWith("."+e)}))return!0;if(/[\u0000-\u001f\u007f-\u009f]/.test(n)||["phishing","malware","virus","hack"].some(function(e){return n.includes(e)})||!/^[a-zA-Z0-9.-]+$/.test(n))return!1;return!0}catch(e){return!1}}function o(e){var t=[],n=e;if(!e||""===e.trim())return{isValid:!1,errors:["验证规则不能为空"],sanitizedRule:""};e.length>1e4&&t.push("验证规则不能超过10000字"),/<(?:script|iframe|object|embed|form|input|meta|link|style)[^>]*>/gi.test(e)&&(t.push("验证规则不能包含危险的HTML标签"),n=a(e)),RegExp("(?<!https?:\\/\\/[^\\s]*)(javascript:|onclick\\s*=|onerror\\s*=|onload\\s*=|<script)","gi").test(e)&&(t.push("验证规则不能包含可执行脚本代码"),n=a(e));var s=e.match(/(https?:\/\/[^\s]+)/g)||[];if(s.length>0){var r=s.filter(function(e){return!i(e)});r.length>0&&t.push("包含不安全的链接: ".concat(r.join(", ")))}return{isValid:0===t.length,errors:t,sanitizedRule:n}}function l(e){var t=[];if(!e||""===e.trim())return{isValid:!1,errors:["验证名称不能为空"],sanitizedKey:""};var n=a(e);return n!==e&&t.push("验证名称包含不安全的内容"),{isValid:0===t.length,errors:t,sanitizedKey:n}}},72107:function(e,t,n){"use strict";n.d(t,{L:function(){return i}});var s=n(85893);n(67294);var r=n(40330),a=n(45655),c=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return e;var n=/(https?:\/\/[^\s]+)/g;if(!n.test(e)){var c=(0,a.KL)(e,t);return(0,s.jsx)("span",{dangerouslySetInnerHTML:{__html:c}})}var i=e.split(n),o=e.match(n)||[];return(0,s.jsx)(s.Fragment,{children:i.map(function(e,n){if(n%2==0){var c=(0,a.KL)(e,t);return(0,s.jsx)("span",{dangerouslySetInnerHTML:{__html:c}},n)}var i=o[(n-1)/2];return(0,a.lt)(i)?(0,s.jsx)("a",{href:i,onClick:function(e){e.preventDefault(),(0,a.lt)(i)?r.N.handleExternalLink(i):alert("此链接已被识别为不安全链接，无法打开")},className:"text-blue-500 underline hover:text-blue-700 break-words break-all whitespace-normal",target:"_blank",rel:"noopener noreferrer",title:"外部链接: ".concat(i),children:i},n):(0,s.jsx)("span",{className:"text-red-500",children:"[不安全的链接已被屏蔽]"},n)})})},i=function(e){var t=e.text,n=e.preserveLineBreaks;return(0,s.jsx)(s.Fragment,{children:c(t,void 0!==n&&n)})}},73537:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return T}});var s=n(72253),r=n(91309),a=n(85893),c=n(67294),i=n(11163),o=n(42130),l=n(93778),d=n(36893),u=n(11418),x=n(27460),m=n(91529),h=n(72107),f=n(31084);function g(e){var t,n=e.actionInfo;return((0,c.useContext)(l.M)||{}).token?(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between md:max-w-xs",children:[(0,a.jsx)("span",{className:"font-bold text-sm",children:"最小参与代币数:"}),(0,a.jsx)("span",{className:"font-mono text-secondary",children:(t=n.body.minStake,(0,m.LH)(t))})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between md:max-w-xs",children:[(0,a.jsx)("span",{className:"font-bold text-sm",children:"最大激励地址数:"}),(0,a.jsx)("span",{className:"font-mono text-secondary",children:n.body.maxRandomAccounts.toString()})]})]})}),n.body.verificationRule&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("div",{className:"font-bold text-sm mb-2",children:"验证规则:"}),(0,a.jsx)("div",{className:"leading-loose bg-gray-50 p-2 rounded-md",children:(0,a.jsx)(h.L,{text:n.body.verificationRule,preserveLineBreaks:!0})})]}),n.body.verificationKeys&&n.body.verificationKeys.length>0&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("div",{className:"font-bold text-sm mb-2",children:"报名参加行动时，行动者要提供的信息:"}),(0,a.jsx)("ul",{className:"list-disc pl-5",children:n.body.verificationKeys.map(function(e,t){var s;return(0,a.jsxs)("li",{className:"text-gray-700",children:[(0,a.jsxs)("div",{className:"text-sm font-bold text-greyscale-900",children:[(0,a.jsx)(f.Z,{text:e,showWarning:!0})," :"]}),(0,a.jsx)("div",{children:(0,a.jsx)(f.Z,{text:null===(s=n.body.verificationInfoGuides)||void 0===s?void 0:s[t],showWarning:!0,preserveLineBreaks:!0})})]},t)})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4 md:max-w-md",children:[(0,a.jsx)("span",{className:"font-bold text-sm",children:"白名单:"}),(0,a.jsx)("div",{children:"0x0000000000000000000000000000000000000000"===n.body.whiteListAddress?(0,a.jsx)("span",{className:"text-gray-400 text-sm",children:"无限制"}):(0,a.jsx)(x.Z,{address:n.body.whiteListAddress,showCopyButton:!0,colorClassName:"text-sm"})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4 md:max-w-md",children:[(0,a.jsx)("span",{className:"font-bold text-sm",children:"创建人:"}),(0,a.jsx)(x.Z,{address:n.head.author,showCopyButton:!0,colorClassName:"text-sm"})]})]}):(0,a.jsx)("div",{children:"Token信息加载中..."})}var j=n(4586),v=n(41664),p=n.n(v),y=n(93950),N=n(90963),b=n(64777),w=n(42083);function I(e){var t=e.actionId,n=e.currentRound,o=(0,i.useRouter)(),d=((0,c.useContext)(l.M)||{}).token,u=(0,r._)((0,c.useState)(n||BigInt(1)),2),h=u[0],f=u[1],g=o.query.round;(0,c.useEffect)(function(){g&&!isNaN(Number(g))?f(BigInt(g)):n&&f(n)},[g,n]);var v=(0,y.pA)((null==d?void 0:d.address)||"0x0000000000000000000000000000000000000000",h,t),I=v.actionVoters,k=v.isPending,B=v.error;if(!d)return(0,a.jsx)("div",{children:"Token信息加载中..."});var _=(null==I?void 0:I.reduce(function(e,t){return e+t.voteCount},BigInt(0)))||BigInt(0),C=I?(0,j._)(I).sort(function(e,t){return e.voteCount>t.voteCount?-1:e.voteCount<t.voteCount?1:0}):[];return(0,a.jsxs)("div",{className:"relative pb-4",children:[h===BigInt(0)&&(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-500",children:"暂无投票数据"})}),(0,a.jsx)("div",{className:"flex items-center",children:h>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(b.Z,{title:"第 ".concat(h.toString()," 轮投票详情")}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"("}),(0,a.jsx)(N.Z,{currentRound:n?(0,m.cK)(n,d):BigInt(0),handleChangedRound:function(e){var t=BigInt(e);f(t);var n=(0,s._)({},o.query);n.round=t.toString(),o.push({pathname:o.pathname,query:n},void 0,{shallow:!0})}}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500",children:")"})]})}),h>0&&I&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-4 mb-4",children:[(0,a.jsxs)("div",{className:"",children:[(0,a.jsx)("span",{className:"text-gray-500 mr-3",children:"投票地址数:"}),(0,a.jsx)("span",{className:"font-mono text-secondary",children:I.length})]}),(0,a.jsxs)("div",{className:"",children:[(0,a.jsx)("span",{className:"text-gray-500 mr-3",children:"总投票数:"}),(0,a.jsx)("span",{className:"font-mono text-secondary",children:(0,m.LH)(_)})]})]}),k&&(0,a.jsx)("div",{className:"flex justify-center py-8",children:(0,a.jsx)(w.Z,{})}),B&&(0,a.jsxs)("div",{className:"alert alert-error",children:[(0,a.jsx)("svg",{className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsxs)("span",{children:["加载投票数据失败: ",B.message]})]}),!k&&!B&&I&&h>0&&(0===C.length?(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"该轮次暂无投票记录"}):(0,a.jsxs)("table",{className:"table w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,a.jsx)("th",{className:"px-1 text-left",children:"排名"}),(0,a.jsx)("th",{className:"px-1 text-left",children:"投票地址"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"投票数"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"占比"})]})}),(0,a.jsx)("tbody",{children:C.map(function(e,t){var n;return(0,a.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,a.jsx)("td",{className:"px-1 text-greyscale-400",children:t+1}),(0,a.jsx)("td",{className:"px-1",children:(0,a.jsx)(p(),{href:"/vote/history?account=".concat(e.account),children:(0,a.jsxs)("div",{className:"inline-flex items-center bg-gray-50 hover:bg-gray-100 rounded-md px-2 py-1 transition-colors duration-150 active:bg-gray-200",children:[(0,a.jsx)(x.Z,{address:e.account,showCopyButton:!0}),(0,a.jsx)("svg",{className:"h-3 w-3 text-gray-400 ml-2 opacity-60 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})}),(0,a.jsx)("td",{className:"px-1 text-right font-mono text-secondary",children:(0,m.LH)(e.voteCount)}),(0,a.jsxs)("td",{className:"px-1 text-right text-greyscale-500",children:[(n=e.voteCount,_===BigInt(0)?"0.00":(Number(n)/Number(_)*100).toFixed(2)),"%"]})]},e.account)})})]}))]})}var k=n(14932),B=n(42171),_=n(4307),C=n(87250),Z=n(7080),L=n(73591),S=n(21338),R=function(e){var t=e.currentRound,n=e.actionId,d=e.actionInfo,u=(0,i.useRouter)(),f=((0,c.useContext)(l.M)||{}).token,g=(0,o.m)().address,j=(0,r._)((0,c.useState)(new Set),2),v=j[0],p=j[1],N=(0,C.LW)(null==f?void 0:f.address,t,n,"0x0000000000000000000000000000000000000000"),I=N.scoreByActionIdByAccount,R=N.isPending,M=N.error,E=(0,y.pK)(null==f?void 0:f.address,t,n),q=E.verifiedAddresses,K=E.isPending,T=E.error,A=(0,y.X5)(null==f?void 0:f.address,t,n),z=A.verificationInfos,F=A.isPending,P=A.error,D=(0,Z.wD)(null==f?void 0:f.address,t,n),V=D.votesNumByActionId,H=(D.isPending,D.error),O=(0,L.S)().handleContractError;(0,c.useEffect)(function(){T&&O(T,"dataViewer"),P&&O(P,"dataViewer"),M&&O(M,"verify"),H&&O(H,"vote")},[T,P,M,H]);var J=function(e){var t=new Set(v);t.has(e)?t.delete(e):t.add(e),p(t)},W=(null==q?void 0:q.reduce(function(e,t){return e+t.score},BigInt(0)))||BigInt(0),Y=(Number(W)+Number(I||BigInt(0)))/Number(V||BigInt(0))*100;return(0,a.jsxs)("div",{className:"relative pb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(b.Z,{title:"第 ".concat(t," 轮验证")}),Y>0&&(0,a.jsxs)("span",{className:"text-sm text-greyscale-500 ml-2",children:["(当前进度：",(0,m.rl)(Y),")"]})]}),(null==z?void 0:z.length)>0&&(0,a.jsx)("button",{onClick:function(){return u.push("/action/verify_detail?symbol=".concat(null==f?void 0:f.symbol,"&id=").concat(n,"&round=").concat(t))},className:"text-sm text-secondary hover:text-secondary-600 ",children:"查看明细 >>"})]}),(0,a.jsx)("div",{className:"flex justify-left mt-2",children:(0,a.jsx)(S.Z,{currentRound:t,roundType:"verify"})}),F||K||R?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)(w.Z,{})}):z&&0!==z.length?(0,a.jsxs)("table",{className:"table w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,a.jsx)("th",{}),(0,a.jsx)("th",{children:"被抽中地址"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"获得验证票"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"验证票占比"})]})}),(0,a.jsxs)("tbody",{children:[z.map(function(e){var t=null==q?void 0:q.find(function(t){return t.account===e.account});return(0,k._)((0,s._)({},e),{score:(null==t?void 0:t.score)||BigInt(0)})}).sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:0}).map(function(e){var t=null==q?void 0:q.find(function(t){return t.account===e.account}),n=v.has(e.account);return(0,a.jsxs)(c.Fragment,{children:[(0,a.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===g?"text-secondary":""),children:[(0,a.jsx)("td",{className:"px-1 w-8",children:(0,a.jsx)("button",{onClick:function(){return J(e.account)},className:"text-greyscale-400 hover:text-greyscale-600",children:n?(0,a.jsx)(B.Z,{size:16}):(0,a.jsx)(_.Z,{size:16})})}),(0,a.jsx)("td",{className:"px-1",children:(0,a.jsx)(x.Z,{address:e.account,showCopyButton:!0,word:e.account===g?"(我)":""})}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.tY)((null==t?void 0:t.score)||BigInt(0))}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.rl)(Number((null==t?void 0:t.score)||BigInt(0))/Number(W||BigInt(0))*100)})]}),d&&n&&(0,a.jsxs)("tr",{className:"border-b border-gray-100 bg-gray-50",children:[(0,a.jsx)("td",{}),(0,a.jsx)("td",{colSpan:3,className:"px-1 py-3",children:(0,a.jsxs)("div",{className:"text-sm text-greyscale-600",children:[(0,a.jsx)("div",{className:"text-xs text-greyscale-400 mb-2",children:"验证信息:"}),d.body.verificationKeys.map(function(t,n){return(0,a.jsxs)("div",{className:"mb-1",children:[(0,a.jsxs)("span",{className:"text-greyscale-500",children:[t,":"]})," ",(0,a.jsx)(h.L,{text:e.infos[n]})]},n)})]})})]})]},e.account)}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-1"}),(0,a.jsx)("td",{className:"px-1 text-greyscale-500",children:"弃权票"}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.tY)(I||BigInt(0))}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.rl)(Number(I||BigInt(0))/Number(W||BigInt(0))*100)})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-1"}),(0,a.jsx)("td",{className:"px-1 text-greyscale-500",children:"汇总 "}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.tY)(W||BigInt(0))}),(0,a.jsx)("td",{className:"px-1 text-right",children:"100%"})]})]})]}):(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有验证地址"})]})},M=function(e){var t=e.currentJoinRound,n=e.actionId,d=e.actionInfo,u=(0,i.useRouter)(),f=((0,c.useContext)(l.M)||{}).token,g=(0,o.m)().address,v=(0,r._)((0,c.useState)(BigInt(0)),2),p=v[0],I=v[1],k=(0,r._)((0,c.useState)(new Set),2),C=k[0],Z=k[1],S=u.query.round;(0,c.useEffect)(function(){S&&!isNaN(Number(S))?I(BigInt(S)):f&&t-BigInt(f.initialStakeRound)>=BigInt(2)&&I(t-BigInt(2))},[S,t,f]);var R=(0,y.pK)(null==f?void 0:f.address,f&&p?p:BigInt(0),n),M=R.verifiedAddresses,E=R.isPending,q=R.error,K=(0,y.X5)(null==f?void 0:f.address,f&&p?p:BigInt(0),n),T=K.verificationInfos,A=K.isPending,z=K.error,F=(0,r._)((0,c.useState)([]),2),P=F[0],D=F[1];(0,c.useEffect)(function(){M&&D(M)},[M]);var V=(0,L.S)().handleContractError;(0,c.useEffect)(function(){q&&V(q,"dataViewer"),z&&V(z,"dataViewer")},[q,z]),(0,c.useEffect)(function(){P.length>0&&0===C.size&&Z(new Set([(0,j._)(P).sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:0})[0].account]))},[P]);var H=(0,j._)(P).sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:0}),O=function(e){var t=new Set(C);t.has(e)?t.delete(e):t.add(e),Z(t)};return(0,a.jsxs)("div",{className:"relative ",children:[p===BigInt(0)&&(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-500",children:"暂无验证结果"})}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center",children:p>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(b.Z,{title:"第 ".concat(p.toString()," 轮验证结果")}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"("}),(0,a.jsx)(N.Z,{currentRound:f&&t?(0,m.cK)(t-BigInt(2),f):BigInt(0),handleChangedRound:function(e){var t=BigInt(e);I(t);var n=(0,s._)({},u.query);n.round=t.toString(),u.push({pathname:u.pathname,query:n},void 0,{shallow:!0})}}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500",children:")"})]})}),p>0&&P.length>0&&(0,a.jsx)("button",{onClick:function(){return u.push("/action/verify_detail?symbol=".concat(null==f?void 0:f.symbol,"&id=").concat(n,"&round=").concat(p))},className:"text-sm text-secondary hover:text-secondary-600 transition-colors",children:"查看明细 >>"})]}),E||A?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)(w.Z,{})}):0===P.length?p>BigInt(0)&&(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有验证地址"}):(0,a.jsxs)("table",{className:"table w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,a.jsx)("th",{}),(0,a.jsx)("th",{children:"被抽中地址"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"获得验证票"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"可铸造激励"})]})}),(0,a.jsx)("tbody",{children:H.map(function(e){var t=null==T?void 0:T.find(function(t){return t.account===e.account}),n=C.has(e.account);return(0,a.jsxs)(c.Fragment,{children:[(0,a.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===g?"text-secondary":""),children:[(0,a.jsx)("td",{className:"px-1 w-8",children:t&&(0,a.jsx)("button",{onClick:function(){return O(e.account)},className:"text-greyscale-400 hover:text-greyscale-600",children:n?(0,a.jsx)(B.Z,{size:16}):(0,a.jsx)(_.Z,{size:16})})}),(0,a.jsx)("td",{className:"px-1 ",children:(0,a.jsx)(x.Z,{address:e.account,showCopyButton:!0,word:e.account===g?"(我)":""})}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.tY)(e.score)}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,m.tY)(e.reward||BigInt(0))})]}),t&&d&&n&&(0,a.jsxs)("tr",{className:"border-b border-gray-100 bg-gray-50",children:[(0,a.jsx)("td",{}),(0,a.jsx)("td",{colSpan:3,className:"px-1 py-3",children:(0,a.jsxs)("div",{className:"text-sm text-greyscale-600",children:[(0,a.jsx)("div",{className:"text-xs text-greyscale-400 mb-2",children:"验证信息:"}),d.body.verificationKeys.map(function(e,n){return(0,a.jsxs)("div",{className:"mb-1",children:[(0,a.jsxs)("span",{className:"text-greyscale-500",children:[e,":"]})," ",(0,a.jsx)(h.L,{text:t.infos[n]})]},n)})]})})]})]},e.account)})})]})]})},E=function(e){var t=e.actionId,n=e.currentRound,o=e.actionInfo,l=(0,i.useRouter)(),d=(0,r._)((0,c.useState)("current"),2),u=d[0],x=d[1],m=l.query.tab2;(0,c.useEffect)(function(){m&&["current","history"].includes(m)&&x(m)},[m]);var h=function(e){x(e);var t=(0,s._)({},l.query);t.tab2=e,l.push({pathname:l.pathname,query:t},void 0,{shallow:!0})};return(0,a.jsxs)("div",{className:"bg-white rounded-lg",children:[(0,a.jsx)("div",{className:"flex bg-muted rounded-lg p-1 mb-4 mx-16",children:[{key:"current",label:"当前验证"},{key:"history",label:"历史验证"}].map(function(e){return(0,a.jsx)("button",{onClick:function(){return h(e.key)},className:"flex-1 px-2 py-1 text-sm font-medium rounded-md transition-all duration-200 ".concat(u===e.key?"bg-white text-secondary shadow-sm":"text-gray-500 hover:text-gray-800 hover:bg-gray-50"),children:e.label},e.key)})}),function(){switch(u){case"current":return(0,a.jsx)(R,{actionId:t,currentRound:n&&n>BigInt(0)?n-BigInt(1):BigInt(0),actionInfo:o});case"history":return(0,a.jsx)(M,{currentJoinRound:n,actionId:t,actionInfo:o});default:return null}}()]})},q=n(17301),K=n(83494);function T(){var e=(0,i.useRouter)(),t=(0,o.m)().address,n=((0,c.useContext)(l.M)||{}).token,x=(0,r._)((0,c.useState)("basic"),2),m=x[0],h=x[1],f=e.query,j=f.symbol,v=f.id,p=f.tab,y=v?BigInt(v):void 0,N=(0,d.r)({tokenAddress:null==n?void 0:n.address,actionId:y,account:t}),b=N.actionInfo,k=N.participantCount,B=N.totalAmount,_=N.userJoinedAmount,C=N.isJoined,Z=N.currentRound,L=N.isPending,S=N.error;if((0,c.useEffect)(function(){p&&["basic","vote","verify"].includes(p)&&h(p)},[p]),(0,c.useEffect)(function(){j&&n&&j!==n.symbol&&e.push("/tokens")},[j,n,e]),!n)return(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(w.Z,{}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"加载Token信息中..."})]})});if(void 0==y)return(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsx)(q.Z,{type:"error",message:"参数错误：缺少行动ID参数"})});var R=function(t){h(t);var n=(0,s._)({},e.query);n.tab=t,e.push({pathname:e.pathname,query:n},void 0,{shallow:!0})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(K.Z,{title:"行动详情",showBackButton:!0}),(0,a.jsx)("main",{className:"flex-grow",children:(0,a.jsxs)("div",{className:"px-4 pt-0 pb-3",children:[b&&(0,a.jsx)(u.Z,{actionInfo:b,participantCount:k,totalAmount:B,isJoined:C,userJoinedAmount:_,isPending:L}),(0,a.jsx)("div",{className:"flex border-b border-gray-200 mb-4",children:[{key:"basic",label:"行动详情"},{key:"vote",label:"投票公示"},{key:"verify",label:"验证公示"}].map(function(e){return(0,a.jsx)("button",{onClick:function(){return R(e.key)},className:"flex-1 px-4 py-2 text-sm font-medium border-b-2 transition-colors ".concat(m===e.key?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700"),children:e.label},e.key)})}),function(){if(L)return(0,a.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(w.Z,{}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"加载数据中..."})]})});if(S)return(0,a.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,a.jsx)(q.Z,{type:"error",message:"加载失败：".concat(S.message||"获取行动信息失败，请稍后重试")})});if(!b)return(0,a.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,a.jsx)(q.Z,{type:"warning",message:"行动不存在：找不到指定的行动信息"})});switch(m){case"basic":return(0,a.jsx)(g,{actionInfo:b});case"vote":return(0,a.jsx)(I,{actionId:y,currentRound:Z});case"verify":return(0,a.jsx)(E,{actionId:y,currentRound:Z||BigInt(0),actionInfo:b});default:return null}}()]})})]})}},88504:function(e,t,n){"use strict";n.d(t,{O:function(){return m}});var s=n(72253),r=n(14932),a=n(3628),c=n(97712),i=n(81946),o=n(36100),l=n(95159),d=n(39360),u=n(78942),x=n(63973);function m(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},m=n.query,h=void 0===m?{}:m,f=n.watch,g=(0,u.Z)(n),j=(0,a.NL)(),v=(0,d.x)({config:g}),p=null!==(e=n.chainId)&&void 0!==e?e:v,y=function(e,t={}){return{gcTime:0,async queryFn({queryKey:t}){let{scopeKey:n,...s}=t[1];return await function(e,t={}){let{chainId:n,...s}=t,r=e.getClient({chainId:n});return(0,i.s)(r,c.z,"getBlockNumber")(s)}(e,s)??null},queryKey:function(e={}){return["blockNumber",(0,o.OP)(e)]}(t)}}(g,(0,r._)((0,s._)({},n),{chainId:p}));return(0,x.x)((0,r._)((0,s._)({},(0,s._)({config:n.config,chainId:n.chainId},"object"==typeof f?f:{})),{enabled:!!((null===(t=h.enabled)||void 0===t||t)&&("object"==typeof f?f.enabled:f)),onBlockNumber:function(e){j.setQueryData(y.queryKey,e)}})),(0,l.aM)((0,s._)({},h,y))}},63973:function(e,t,n){"use strict";n.d(t,{x:function(){return u}});var s=n(72253),r=n(14932),a=n(47702),c=n(65185),i=n(81946),o=n(67294),l=n(39360),d=n(78942);function u(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.enabled,u=void 0===n||n,x=t.onBlockNumber,m=(t.config,(0,a._)(t,["enabled","onBlockNumber","config"])),h=(0,d.Z)(t),f=(0,l.x)({config:h}),g=null!==(e=t.chainId)&&void 0!==e?e:f;(0,o.useEffect)(function(){if(u&&x)return function(e,t){let n,s;let{syncConnectedChain:r=e._internal.syncConnectedChain,...a}=t,o=t=>{n&&n();let s=e.getClient({chainId:t});return n=(0,i.s)(s,c.q,"watchBlockNumber")(a)},l=o(t.chainId);return r&&!t.chainId&&(s=e.subscribe(({chainId:e})=>e,async e=>o(e))),()=>{l?.(),s?.()}}(h,(0,r._)((0,s._)({},m),{chainId:g,onBlockNumber:x}))},[g,h,u,x,m.onError,m.emitMissed,m.emitOnBegin,m.poll,m.pollingInterval,m.syncConnectedChain])}}},function(e){e.O(0,[8239,367,6143,3494,2252,3950,7724,7250,4139,2888,9774,179],function(){return e(e.s=8286)}),_N_E=e.O()}]);