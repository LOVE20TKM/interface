(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7260],{1709:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(37876);let a=e=>{var t=e.title;return(0,n.jsx)("div",{className:"flex justify-between items-center",children:(0,n.jsx)("h1",{className:"text-lg font-bold",children:t})})}},7446:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var n=(0,r(11713).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},12293:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(37876),a=r(7446);let o=()=>(0,n.jsx)(a.A,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})},18449:(e,t,r)=>{"use strict";r.d(t,{X:()=>o});var n=r(76200);class a extends n.C{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function o(e,t){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new a({value:e});let[r,n="0"]=e.split("."),o=r.startsWith("-");if(o&&(r=r.slice(1)),n=n.replace(/(0+)$/,""),0===t)1===Math.round(Number(`.${n}`))&&(r=`${BigInt(r)+1n}`),n="";else if(n.length>t){let[e,a,o]=[n.slice(0,t-1),n.slice(t-1,t),n.slice(t)],s=Math.round(Number(`${a}.${o}`));(n=s>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${s}`).length>t&&(n=n.slice(1),r=`${BigInt(r)+1n}`),n=n.slice(0,t)}else n=n.padEnd(t,"0");return BigInt(`${o?"-":""}${r}${n}`)}},20442:(e,t,r)=>{"use strict";r.d(t,{Js:()=>l,LP:()=>u,NJ:()=>s,W_:()=>o,XS:()=>c,lM:()=>d,mW:()=>i});var n=r(18449),a=r(32602),o=e=>e?"".concat(e.substring(0,6),"...").concat(e.substring(e.length-4)):"",s=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=Number(l(e));if(e<10n)return"0";if(t>=1e5)return new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(t);if(t>=1e3)return new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(t);if(t>=1||t>=.001)return new Intl.NumberFormat("en-US",{maximumFractionDigits:4}).format(t);if(0===t)return"0";var r=t.toFixed(14),n=r.split(".");if(n.length<2)return r;var a=n[1],o=0,s=!0,c=!1,i=void 0;try{for(var u,d=a[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var f=u.value;if("0"===f)o++;else break}}catch(e){c=!0,i=e}finally{try{s||null==d.return||d.return()}finally{if(c)throw i}}var p=a.slice(o,o+4);return"0.0{".concat(o,"}").concat(p)},c=e=>{var t=parseInt("18",10);try{var r=e.replace(/,/g,"");return(0,n.X)(r,t)}catch(e){return console.error("parseUnits error:",e),0n}},l=e=>{var t=parseInt("18",10);return(0,a.J)(e,t)},i=e=>e.includes(".")?parseFloat(e.replace(/,/g,"")).toString():e,u=(e,t)=>e&&t?e-BigInt(t.initialStakeRound)+1n:0n,d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=Number(e);if(n>=1)return new Intl.NumberFormat("en-US",{maximumFractionDigits:t}).format(n);if(n>=.001)return new Intl.NumberFormat("en-US",{maximumFractionDigits:r+1}).format(n);if(0===n)return"0";var a=n.toFixed(r+10),o=a.split(".");if(o.length<2)return a;var s=o[1],c=0,l=!0,i=!1,u=void 0;try{for(var d,f=s[Symbol.iterator]();!(l=(d=f.next()).done);l=!0){var p=d.value;if("0"===p)c++;else break}}catch(e){i=!0,u=e}finally{try{l||null==f.return||f.return()}finally{if(i)throw u}}var m=s.slice(c);return"0.0{".concat(c,"}").concat(m)}},21099:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote",function(){return r(82763)}])},26269:(e,t,r)=>{"use strict";var n=r(99680),a={"text/plain":"Text","text/html":"Url",default:"Text"};e.exports=function(e,t){var r,o,s,c,l,i,u,d,f=!1;t||(t={}),s=t.debug||!1;try{if(l=n(),i=document.createRange(),u=document.getSelection(),(d=document.createElement("span")).textContent=e,d.ariaHidden="true",d.style.all="unset",d.style.position="fixed",d.style.top=0,d.style.clip="rect(0, 0, 0, 0)",d.style.whiteSpace="pre",d.style.webkitUserSelect="text",d.style.MozUserSelect="text",d.style.msUserSelect="text",d.style.userSelect="text",d.addEventListener("copy",function(r){if(r.stopPropagation(),t.format)if(r.preventDefault(),void 0===r.clipboardData){s&&console.warn("unable to use e.clipboardData"),s&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var n=a[t.format]||a.default;window.clipboardData.setData(n,e)}else r.clipboardData.clearData(),r.clipboardData.setData(t.format,e);t.onCopy&&(r.preventDefault(),t.onCopy(r.clipboardData))}),document.body.appendChild(d),i.selectNodeContents(d),u.addRange(i),!document.execCommand("copy"))throw Error("copy command was unsuccessful");f=!0}catch(n){s&&console.error("unable to copy using execCommand: ",n),s&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(t.format||"text",e),t.onCopy&&t.onCopy(window.clipboardData),f=!0}catch(n){s&&console.error("unable to copy using clipboardData: ",n),s&&console.error("falling back to prompt"),r="message"in t?t.message:"Copy to clipboard: #{key}, Enter",o=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C",c=r.replace(/#{\s*key\s*}/g,o),window.prompt(c,e)}}finally{u&&("function"==typeof u.removeRange?u.removeRange(i):u.removeAllRanges()),d&&document.body.removeChild(d),l()}return f}},28638:(e,t,r)=>{"use strict";r.d(t,{BT:()=>d,Wu:()=>f,ZB:()=>u,Zp:()=>l,aR:()=>i,wL:()=>p});var n=r(3576),a=r(65699),o=r(37876),s=r(14232),c=r(30684),l=s.forwardRef((e,t)=>{var r=e.className,s=(0,a._)(e,["className"]);return(0,o.jsx)("div",(0,n._)({ref:t,className:(0,c.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r)},s))});l.displayName="Card";var i=s.forwardRef((e,t)=>{var r=e.className,s=(0,a._)(e,["className"]);return(0,o.jsx)("div",(0,n._)({ref:t,className:(0,c.cn)("flex flex-col space-y-1.5 p-6",r)},s))});i.displayName="CardHeader";var u=s.forwardRef((e,t)=>{var r=e.className,s=(0,a._)(e,["className"]);return(0,o.jsx)("div",(0,n._)({ref:t,className:(0,c.cn)("text-2xl font-semibold leading-none tracking-tight",r)},s))});u.displayName="CardTitle";var d=s.forwardRef((e,t)=>{var r=e.className,s=(0,a._)(e,["className"]);return(0,o.jsx)("div",(0,n._)({ref:t,className:(0,c.cn)("text-sm text-muted-foreground",r)},s))});d.displayName="CardDescription";var f=s.forwardRef((e,t)=>{var r=e.className,s=(0,a._)(e,["className"]);return(0,o.jsx)("div",(0,n._)({ref:t,className:(0,c.cn)("p-6 pt-0",r)},s))});f.displayName="CardContent";var p=s.forwardRef((e,t)=>{var r=e.className,s=(0,a._)(e,["className"]);return(0,o.jsx)("div",(0,n._)({ref:t,className:(0,c.cn)("flex items-center p-6 pt-0",r)},s))});p.displayName="CardFooter"},33276:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var n=(0,r(11713).A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},46852:(e,t,r)=>{"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.CopyToClipboard=void 0;var a=c(r(14232)),o=c(r(26269)),s=["text","onCopy","options","children"];function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach(function(t){p(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var m=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");l.prototype=Object.create(e&&e.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),Object.defineProperty(l,"prototype",{writable:!1}),e&&u(l,e);var t,r,c=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=f(l);return e=t?Reflect.construct(r,arguments,f(this).constructor):r.apply(this,arguments),function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return d(e)}(this,e)});function l(){var e;if(!(this instanceof l))throw TypeError("Cannot call a class as a function");for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return p(d(e=c.call.apply(c,[this].concat(r))),"onClick",function(t){var r=e.props,n=r.text,s=r.onCopy,c=r.children,l=r.options,i=a.default.Children.only(c),u=(0,o.default)(n,l);s&&s(n,u),i&&i.props&&"function"==typeof i.props.onClick&&i.props.onClick(t)}),e}return r=[{key:"render",value:function(){var e=this.props,t=(e.text,e.onCopy,e.options,e.children),r=function(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}(e,s),n=a.default.Children.only(t);return a.default.cloneElement(n,i(i({},r),{},{onClick:this.onClick}))}}],function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(l.prototype,r),Object.defineProperty(l,"prototype",{writable:!1}),l}(a.default.PureComponent);t.CopyToClipboard=m,p(m,"defaultProps",{onCopy:void 0,options:void 0})},48447:(e,t,r)=>{"use strict";var n=r(46852).CopyToClipboard;n.CopyToClipboard=n,e.exports=n},70801:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var n=(0,r(11713).A)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]])},77328:(e,t,r)=>{e.exports=r(89836)},82763:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>j});var n=r(37876),a=r(14232),o=r(98684),s=r(20451),c=r(66663),l=r(40854),i=r(89099),u=r(97685),d=r(6960),f=r(28638),p=r(48230),m=r.n(p),y=r(64115),x=r(83416),v=r(87577),h=r(1709),b=r(12293);let g=e=>{var t=e.currentRound,r=((0,a.useContext)(x.N)||{}).token,c=(0,i.useRouter)(),p=(0,o.ch)((null==r?void 0:r.address)||"",t),g=p.votes,j=p.isPending,N=p.error,w=(0,y.VD)((null==r?void 0:r.address)||"",t),C=w.actionSubmits,O=w.isPending;w.error;var _=Array.from(new Set((null==C?void 0:C.map(e=>BigInt(e.actionId)))||[])).sort((e,t)=>Number(e)-Number(t)),k=(0,y.ui)((null==r?void 0:r.address)||"",_),S=k.actionInfos,A=k.isPending,P=k.error,D=(0,l._)((0,a.useState)(new Set),2),R=D[0],E=D[1],I=e=>{E(t=>{var r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},B=(null==g?void 0:g.reduce((e,t)=>e+t,0n))||0n,F=(0,s.g)().handleContractError;return((0,a.useEffect)(()=>{N&&F(N,"vote"),P&&F(P,"submit")},[N,P]),j||O||_&&_.length>0&&A)?(0,n.jsx)("div",{className:"p-4 flex justify-center items-center",children:(0,n.jsx)(b.A,{})}):r?(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)(h.A,{title:"投票中的行动"}),r&&(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsx)(d.$,{variant:"outline",size:"sm",className:"text-secondary border-secondary",asChild:!0,children:(0,n.jsx)(m(),{href:"/action/new/?symbol=".concat(null==r?void 0:r.symbol),children:"推举新行动"})}),(0,n.jsx)(d.$,{variant:"outline",size:"sm",className:"text-secondary border-secondary",asChild:!0,children:(0,n.jsx)(m(),{href:"/vote/actions4submit?symbol=".concat(null==r?void 0:r.symbol),children:"推举历史行动"})})]})]}),(0,n.jsx)("div",{className:"space-y-4",children:_.length>0?(0,n.jsxs)(n.Fragment,{children:[null==S?void 0:S.map((e,t)=>{var a,o=null==C||null==(a=C.find(t=>BigInt(t.actionId)===BigInt(e.head.id)))?void 0:a.submitter;return(0,n.jsxs)(f.Zp,{className:"shadow-none flex items-center",children:[(0,n.jsx)("input",{type:"checkbox",className:"checkbox accent-secondary ml-2",checked:R.has(BigInt(e.head.id)),onChange:()=>I(BigInt(e.head.id))}),(0,n.jsxs)(m(),{href:"/action/".concat(e.head.id,"?type=vote&symbol=").concat(null==r?void 0:r.symbol),className:"w-full",children:[(0,n.jsxs)(f.aR,{className:"px-3 pt-2 pb-1 flex-row justify-start items-baseline",children:[(0,n.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No.".concat(e.head.id)}),(0,n.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(e.body.action)})]}),(0,n.jsxs)(f.Wu,{className:"px-3 pt-1 pb-2",children:[(0,n.jsx)("div",{className:"text-greyscale-500",children:e.body.consensus}),(0,n.jsxs)("div",{className:"flex justify-between mt-1 text-sm",children:[(0,n.jsxs)("span",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"text-greyscale-400 mr-1",children:"推举人"}),(0,n.jsx)("span",{className:"text-secondary",children:(0,n.jsx)(v.A,{address:o,showCopyButton:!1})})]}),(0,n.jsxs)("span",{children:[(0,n.jsx)("span",{className:"text-greyscale-400 mr-1",children:"投票占比"}),(0,n.jsxs)("span",{className:"text-secondary",children:[0===Number((null==g?void 0:g[t])||0n)?"0":(100*Number((null==g?void 0:g[t])||0n)/Number(B)).toFixed(1),"%"]})]})]})]})]},e.head.id)]},e.head.id)}),(0,n.jsx)("div",{className:"flex justify-center mt-4",children:(0,n.jsx)(d.$,{variant:"outline",className:"w-1/2 text-secondary border-secondary",onClick:()=>{var e=Array.from(R).join(",");if(0===e.length)return void u.oR.error("请选择行动");c.push("/vote/vote?ids=".concat(e,"&symbol=").concat(null==r?void 0:r.symbol))},children:"给选中的行动投票"})}),(0,n.jsx)("div",{className:"mt-2 text-sm text-greyscale-500 text-center",children:"提示: 每轮最大可投票数，等于您的治理票数"})]}):(0,n.jsx)("div",{className:"text-sm text-greyscale-500 text-center mt-8",children:"还没推举行动，请先推举"})})]}):(0,n.jsx)(b.A,{})},j=()=>{var e=(0,o.vC)(),t=e.currentRound,r=e.isPending,l=e.error,i=(0,s.g)().handleContractError;return(0,a.useEffect)(()=>{l&&i(l,"vote")},[l]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.A,{title:"投票首页"}),(0,n.jsx)("main",{className:"flex-grow",children:r?(0,n.jsx)(b.A,{}):(0,n.jsx)(g,{currentRound:t})})]})}},86739:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var n=(0,r(11713).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},87577:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var n=r(40854),a=r(37876),o=r(14232),s=r(48447),c=r(33276),l=r(70801),i=r(97685),u=r(20442);let d=e=>{var t=e.address,r=e.word,d=e.showCopyButton,f=e.showAddress,p=e.colorClassName,m=void 0===p?"":p,y=(0,n._)((0,o.useState)(!1),2),x=y[0],v=y[1];return(0,a.jsxs)("span",{className:"flex items-center space-x-2",children:[r&&(0,a.jsx)("span",{className:"text-xs",children:r}),(void 0===f||f)&&(0,a.jsx)("span",{className:"text-xs ".concat(null!=m?m:"text-greyscale-500"),children:(0,u.W_)(t)}),(void 0===d||d)&&(0,a.jsx)(s.CopyToClipboard,{text:t,onCopy:(e,t)=>{t?v(!0):i.Ay.error("复制失败")},children:(0,a.jsx)("button",{className:"flex items-center justify-center p-1 rounded hover:bg-gray-200 focus:outline-none",onClick:e=>{e.preventDefault(),e.stopPropagation()},"aria-label":"复制地址",children:x?(0,a.jsx)(c.A,{className:"h-4 w-4 ".concat(null!=m?m:"text-greyscale-500")}):(0,a.jsx)(l.A,{className:"h-4 w-4 ".concat(null!=m?m:"text-greyscale-500")})})})]})}},99680:e=>{e.exports=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var t=document.activeElement,r=[],n=0;n<e.rangeCount;n++)r.push(e.getRangeAt(n));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||r.forEach(function(t){e.addRange(t)}),t&&t.focus()}}}},e=>{var t=t=>e(e.s=t);e.O(0,[2569,4115,636,6593,8792],()=>t(21099)),_N_E=e.O()}]);