(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2884],{2293:(e,n,s)=>{"use strict";s.r(n),s.d(n,{default:()=>B});var t=s(37876),a=s(14232),r=s(8047),c=s(6960),l=s(48230),i=s.n(l),o=s(12293),d=s(83416),u=s(20451),m=s(9215),x=s(62288),h=s(20442),v=s(4066);let N=e=>{var n=e.currentRound,s=((0,a.useContext)(d.N)||{}).token,r=(0,x.CZ)((null==s?void 0:s.address)||""),c=r.rewardAvailable,l=r.isPending,i=r.error,N=(0,m.lW)((null==s?void 0:s.address)||"","0xDe5256A1cf6022ef6af832181CCE617Aee585Dc9"),f=N.balance,j=N.isPending,g=N.error,p=(0,u.g)().handleContractError;(0,a.useEffect)(()=>{g&&p(g,"join"),i&&p(i,"mint")},[g,i]);var y=s?n-BigInt(s.initialStakeRound)+1n:0n,b=BigInt(0);if(c){var w=100n-(BigInt("5")+BigInt("5"))/10n;b=y<=1n?c*BigInt("5")/1000n:c*w*BigInt("5")/100000n}return(0,t.jsx)("div",{className:"px-4",children:(0,t.jsxs)("div",{className:"w-full border rounded-lg p-0",children:[(0,t.jsxs)("div",{className:"stats w-full grid grid-cols-2 divide-x-0",children:[(0,t.jsxs)("div",{className:"stat place-items-center pb-2",children:[(0,t.jsx)("div",{className:"stat-title text-sm pb-1",children:"参与行动代币"}),(0,t.jsx)("div",{className:"stat-value text-xl text-secondary",children:j?(0,t.jsx)(o.A,{}):(0,h.NJ)(f||BigInt(0),0)})]}),(0,t.jsxs)("div",{className:"stat place-items-center pb-2",children:[(0,t.jsx)("div",{className:"stat-title text-sm pb-1",children:"预计新增铸币"}),(0,t.jsx)("div",{className:"stat-value text-xl text-secondary",children:l||void 0===c?(0,t.jsx)(o.A,{}):(0,h.NJ)(b,2)})]})]}),(0,t.jsxs)("div",{className:"text-center text-xs mb-2 text-greyscale-500",children:["预估年化收益率（APY）：",(0,v.BN)(b,f)]})]})})};var f=s(66663),j=s(96108),g=s(28638),p=s(52372),y=s(18651),b=s(1709);let w=e=>{var n=e.currentRound,s=((0,a.useContext)(d.N)||{}).token,c=(0,r.F)().address,l=(0,p.pX)((null==s?void 0:s.address)||"",n||0n,c),m=l.joinableActionDetails,x=l.joinedActions,v=l.isPending,N=l.error;null==m||m.sort((e,n)=>Number(e.action.head.id)-Number(n.action.head.id));var f=(null==m?void 0:m.reduce((e,n)=>e+n.votesNum,0n))||0n,w=(0,u.g)().handleContractError;return(0,a.useEffect)(()=>{N&&w(N,"dataViewer")},[N]),(0,t.jsxs)("div",{className:"px-4 py-6",children:[(0,t.jsx)(b.A,{title:"本轮可参与的行动："}),(0,t.jsx)(y.A,{currentRound:n,roundType:"act",showCountdown:!1}),!c&&(0,t.jsx)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:"请先连接钱包"}),c&&v&&(0,t.jsx)("div",{className:"p-4 flex justify-center items-center",children:(0,t.jsx)(o.A,{})}),c&&!v&&!(null==m?void 0:m.length)&&(0,t.jsx)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:"本轮暂无行动"}),!v&&m&&m.length>0&&(0,t.jsx)("div",{className:"mt-2 space-y-4",children:m.map((e,n)=>{var a=(null==x?void 0:x.some(n=>n.action.head.id===e.action.head.id))?"/action/".concat(e.action.head.id,"?type=join&symbol=").concat(null==s?void 0:s.symbol):"/acting/join?id=".concat(e.action.head.id,"&symbol=").concat(null==s?void 0:s.symbol);return(0,t.jsx)(g.Zp,{className:"shadow-none",children:(0,t.jsxs)(i(),{href:a,className:"relative block",children:[(0,t.jsxs)(g.aR,{className:"px-3 pt-2 pb-1 flex-row items-baseline",children:[(0,t.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No.".concat(e.action.head.id)}),(0,t.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(e.action.body.action)})]}),(0,t.jsxs)(g.Wu,{className:"px-3 pt-1 pb-2",children:[(0,t.jsx)("div",{className:"text-greyscale-500",children:e.action.body.consensus}),(0,t.jsxs)("div",{className:"flex justify-between mt-1 text-sm",children:[(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-greyscale-400 mr-1",children:"投票占比"}),(0,t.jsx)("span",{className:"text-secondary",children:(0,h.Ee)(100*Number(m[n].votesNum||0n)/Number(f))})]}),(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-greyscale-400 mr-1",children:"参与代币数"}),(0,t.jsx)("span",{className:"text-secondary",children:(0,h.NJ)(m[n].joinedAmount||0n,0)})]})]})]}),(0,t.jsx)(j.A,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-greyscale-400 pointer-events-none"})]})},e.action.head.id)})})]})};var C=s(19593),_=s(17660);let B=()=>{var e=(0,r.F)().isConnected,n=((0,a.useContext)(d.N)||{}).token,s=e&&(null==n?void 0:n.hasEnded)===!0,l=(0,_.vC)(s),m=l.currentRound,x=l.error,h=l.isPending,v=(0,u.g)().handleContractError;return((0,a.useEffect)(()=>{x&&v(x,"join")},[x]),s&&h)?(0,t.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,t.jsx)(o.A,{})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.A,{title:"社区首页"}),(0,t.jsx)("main",{className:"flex-grow",children:e?n?n&&!n.hasEnded?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C.A,{}),(0,t.jsxs)("div",{className:"flex flex-col items-center p-4 mt-4",children:[(0,t.jsx)("div",{className:"text-center mb-4 text-greyscale-500",children:"公平发射未结束，还不能参与社区行动"}),(0,t.jsx)(c.$,{className:"w-1/2",asChild:!0,children:(0,t.jsx)(i(),{href:"/launch?symbol=".concat(n.symbol),children:"查看公平发射"})})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C.A,{}),(0,t.jsx)(N,{currentRound:m}),(0,t.jsx)(w,{currentRound:m})]}):(0,t.jsx)(o.A,{}):(0,t.jsx)("div",{className:"flex flex-col items-center p-4 mt-4",children:(0,t.jsx)("div",{className:"text-center mb-4 text-greyscale-500",children:"没有链接钱包，请先连接钱包"})})})]})}},4066:(e,n,s)=>{"use strict";s.d(n,{BN:()=>r,bD:()=>a,u$:()=>c});var t=s(20442),a=(e,n,s)=>{if(!e||!n)return"0%";var a=31536e5/Number("255"),r=BigInt("33784");if(0===a||0n===r)return console.error("配置错误: NEXT_PUBLIC_BLOCK_TIME 或 NEXT_PUBLIC_PHASE_BLOCKS 未设置"),"0%";var c=e?99n*e*99n/2000000n:BigInt(0),l=(2n*n||BigInt(0))+(s||BigInt(0));if(l===BigInt(0))return"0%";var i=Number(c)/Number(l)/(Number(r)/a)*100;return(0,t.Ee)(i)},r=(e,n)=>{if(!e||!n||0n===n)return"0%";var s=31536e5/Number("255"),a=BigInt("33784");if(0===s||0n===a)return console.error("配置错误: BLOCK_TIME 或 PHASE_BLOCKS 未设置或为0"),"0%";var r=Number(e)/Number(n)/(Number(a)/s)*100;return(0,t.Ee)(r)},c=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=Number("33784")||0,t=Number("255")||0,a=e*s,r=Math.ceil(Math.ceil(a*t/100)/86400),c="".concat(a.toLocaleString(),"区块，约").concat(r,"天");return n||(c="".concat(e,"个阶段（").concat(c,")")),c}},18651:(e,n,s)=>{"use strict";s.d(n,{A:()=>d});var t=s(40854),a=s(37876),r=s(14232),c=s(63934),l=s(83416);let i=e=>{var n=e.initialTimeLeft,s=e.onTick,c=(0,t._)((0,r.useState)(Date.now()+1e3*n),2),l=c[0],i=c[1],o=(0,t._)((0,r.useState)(n),2),d=o[0],u=o[1];(0,r.useEffect)(()=>{i(Date.now()+1e3*n)},[n]),(0,r.useEffect)(()=>{var e=setInterval(()=>{var n=Math.max(0,Math.floor((l-Date.now())/1e3));u(n),s&&s(n),n<=0&&(clearInterval(e),window.location.reload())},1e3);return()=>clearInterval(e)},[l,s]);var m=Math.floor(d/86400),x=Math.floor(d%86400/3600),h=Math.floor(d%3600/60);return(0,a.jsxs)("div",{className:"inline-flex gap-1 text-greyscale-400",children:[m>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"countdown font-mono",children:(0,a.jsx)("span",{style:{"--value":m}})}),"天"]}),(x>0||m>0)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"countdown font-mono",children:(0,a.jsx)("span",{style:{"--value":x}})}),"时"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"countdown font-mono",children:(0,a.jsx)("span",{style:{"--value":h}})}),"分"]}),m<=0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"countdown font-mono",children:(0,a.jsx)("span",{style:{"--value":d%60}})}),"秒"]})]})};var o=s(12293);let d=e=>{var n=e.currentRound,s=e.roundType,d=e.showCountdown,u=(0,c.y)().data,m=(0,r.useContext)(l.N),x=m?m.token:void 0,h=!u||!x||void 0===x.voteOriginBlocks,v=(0,t._)((0,r.useState)(0n),2),N=v[0],f=v[1],j=Number("33784")||0,g=Number("255")||0,p=x?Number(x.voteOriginBlocks):0,y=j-(Number(u)-p)%j,b=y>0?Math.ceil(y*g/100):0,w=(0,t._)((0,r.useState)(b),2),C=w[0],_=w[1];(0,r.useEffect)(()=>{if(u){var e=j-(Number(u)-p)%j;_(e>0?Math.ceil(e*g/100):0)}},[u,j,g,p]),(0,r.useEffect)(()=>{x&&n>0n&&f(n-BigInt(x.initialStakeRound)+1n)},[n,x]);var B=null!=N?N.toString():"0";return(null==x?void 0:x.initialStakeRound)&&!(N<=0n)?h||null==N||N<0n?((null==N||N<0n)&&(console.log("currentTokenRound",N),console.log("currentRound",n),console.log("token.initialStakeRound",null==x?void 0:x.initialStakeRound),console.log("token",x)),(0,a.jsx)(o.A,{})):(0,a.jsx)("div",{className:"flex items-center mb-3",children:(0,a.jsxs)("span",{className:"text-sm text-greyscale-400",children:["( 第",(0,a.jsx)("span",{className:"text-greyscale-400",children:B}),"轮","vote"===s?"投票":"verify"===s?"验证":"行动","阶段，",(0,a.jsx)("span",{className:"text-greyscale-400",children:"剩余"}),(0,a.jsx)("span",{className:"text-greyscale-400",children:Math.ceil(100*C/g)}),(0,a.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),void 0===d||d?(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(i,{initialTimeLeft:b,onTick:_})}):(0,a.jsx)("span",{className:"text-greyscale-400",children:C<60?"".concat(C,"秒"):C<=300?"".concat(Math.floor(C/60),"分钟").concat(C%60,"秒"):C<3600?"".concat(Math.floor(C/60),"分钟"):"".concat(Math.floor(C/3600),"小时").concat(Math.floor(C%3600/60),"分钟")}),(0,a.jsx)("span",{className:"text-greyscale-400",children:" )"})]})}):(0,a.jsx)(a.Fragment,{})}},28638:(e,n,s)=>{"use strict";s.d(n,{BT:()=>u,Wu:()=>m,ZB:()=>d,Zp:()=>i,aR:()=>o,wL:()=>x});var t=s(3576),a=s(65699),r=s(37876),c=s(14232),l=s(30684),i=c.forwardRef((e,n)=>{var s=e.className,c=(0,a._)(e,["className"]);return(0,r.jsx)("div",(0,t._)({ref:n,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s)},c))});i.displayName="Card";var o=c.forwardRef((e,n)=>{var s=e.className,c=(0,a._)(e,["className"]);return(0,r.jsx)("div",(0,t._)({ref:n,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s)},c))});o.displayName="CardHeader";var d=c.forwardRef((e,n)=>{var s=e.className,c=(0,a._)(e,["className"]);return(0,r.jsx)("div",(0,t._)({ref:n,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s)},c))});d.displayName="CardTitle";var u=c.forwardRef((e,n)=>{var s=e.className,c=(0,a._)(e,["className"]);return(0,r.jsx)("div",(0,t._)({ref:n,className:(0,l.cn)("text-sm text-muted-foreground",s)},c))});u.displayName="CardDescription";var m=c.forwardRef((e,n)=>{var s=e.className,c=(0,a._)(e,["className"]);return(0,r.jsx)("div",(0,t._)({ref:n,className:(0,l.cn)("p-6 pt-0",s)},c))});m.displayName="CardContent";var x=c.forwardRef((e,n)=>{var s=e.className,c=(0,a._)(e,["className"]);return(0,r.jsx)("div",(0,t._)({ref:n,className:(0,l.cn)("flex items-center p-6 pt-0",s)},c))});x.displayName="CardFooter"},45839:(e,n,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/acting",function(){return s(2293)}])},63934:(e,n,s)=>{"use strict";s.d(n,{y:()=>u});var t=s(63127),a=s(77434),r=s(629),c=s(24751),l=s(57742),i=s(1081),o=s(43387),d=s(79056);function u(e={}){let{query:n={},watch:s}=e,m=(0,o.U)(e),x=(0,t.jE)(),h=(0,i.i)({config:m}),v=e.chainId??h,N=function(e,n={}){return{gcTime:0,async queryFn({queryKey:n}){let{scopeKey:s,...t}=n[1];return await function(e,n={}){let{chainId:s,...t}=n,c=e.getClient({chainId:s});return(0,r.T)(c,a.G,"getBlockNumber")(t)}(e,t)??null},queryKey:function(e={}){return["blockNumber",(0,c.xO)(e)]}(n)}}(m,{...e,chainId:v});return(0,d.r)({...{config:e.config,chainId:e.chainId,..."object"==typeof s?s:{}},enabled:!!((n.enabled??!0)&&("object"==typeof s?s.enabled:s)),onBlockNumber(e){x.setQueryData(N.queryKey,e)}}),(0,l.IT)({...n,...N})}},79056:(e,n,s)=>{"use strict";s.d(n,{r:()=>i});var t=s(84194),a=s(629),r=s(14232),c=s(1081),l=s(43387);function i(e={}){let{enabled:n=!0,onBlockNumber:s,config:o,...d}=e,u=(0,l.U)(e),m=(0,c.i)({config:u}),x=e.chainId??m;(0,r.useEffect)(()=>{if(n&&s)return function(e,n){let s,r,{syncConnectedChain:c=e._internal.syncConnectedChain,...l}=n,i=n=>{s&&s();let r=e.getClient({chainId:n});return s=(0,a.T)(r,t.q,"watchBlockNumber")(l)},o=i(n.chainId);return c&&!n.chainId&&(r=e.subscribe(({chainId:e})=>e,async e=>i(e))),()=>{o?.(),r?.()}}(u,{...d,chainId:x,onBlockNumber:s})},[x,u,n,s,d.onError,d.emitMissed,d.emitOnBegin,d.poll,d.pollingInterval,d.syncConnectedChain])}},96108:(e,n,s)=>{"use strict";s.d(n,{A:()=>t});var t=(0,s(11713).A)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])}},e=>{var n=n=>e(e.s=n);e.O(0,[4571,4112,5752,2569,5139,7432,9593,5389,636,6593,8792],()=>n(45839)),_N_E=e.O()}]);