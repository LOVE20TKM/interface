try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="3e1e1d5f-60a3-4858-b723-4004589a4fe2",e._sentryDebugIdIdentifier="sentry-dbid-3e1e1d5f-60a3-4858-b723-4004589a4fe2")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3487],{66030:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/acting/join",function(){return t(14826)}])},34680:function(e,n,t){"use strict";t.d(n,{Ol:function(){return l},SZ:function(){return u},Zb:function(){return c},aY:function(){return f},eW:function(){return m},ll:function(){return d}});var s=t(72253),r=t(47702),i=t(85893),o=t(67294),a=t(40108),c=o.forwardRef(function(e,n){var t=e.className,o=(0,r._)(e,["className"]);return(0,i.jsx)("div",(0,s._)({ref:n,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t)},o))});c.displayName="Card";var l=o.forwardRef(function(e,n){var t=e.className,o=(0,r._)(e,["className"]);return(0,i.jsx)("div",(0,s._)({ref:n,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",t)},o))});l.displayName="CardHeader";var d=o.forwardRef(function(e,n){var t=e.className,o=(0,r._)(e,["className"]);return(0,i.jsx)("div",(0,s._)({ref:n,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",t)},o))});d.displayName="CardTitle";var u=o.forwardRef(function(e,n){var t=e.className,o=(0,r._)(e,["className"]);return(0,i.jsx)("div",(0,s._)({ref:n,className:(0,a.cn)("text-sm text-muted-foreground",t)},o))});u.displayName="CardDescription";var f=o.forwardRef(function(e,n){var t=e.className,o=(0,r._)(e,["className"]);return(0,i.jsx)("div",(0,s._)({ref:n,className:(0,a.cn)("p-6 pt-0",t)},o))});f.displayName="CardContent";var m=o.forwardRef(function(e,n){var t=e.className,o=(0,r._)(e,["className"]);return(0,i.jsx)("div",(0,s._)({ref:n,className:(0,a.cn)("flex items-center p-6 pt-0",t)},o))});m.displayName="CardFooter"},76453:function(e,n,t){"use strict";t.d(n,{g:function(){return c}});var s=t(72253),r=t(47702),i=t(85893),o=t(67294),a=t(40108),c=o.forwardRef(function(e,n){var t=e.className,o=(0,r._)(e,["className"]);return(0,i.jsx)("textarea",(0,s._)({className:(0,a.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:n},o))});c.displayName="Textarea"},55976:function(e,n,t){"use strict";t.d(n,{k:function(){return o}});var s=t(48564),r=t(2267),i=t(88421),o=function(){function e(){(0,s._)(this,e)}return(0,r._)(e,null,[{key:"isClient",value:function(){return!0}},{key:"serialize",value:function(e){return JSON.stringify(e,function(e,n){return(void 0===n?"undefined":(0,i._)(n))==="bigint"?n.toString():n})}},{key:"deserialize",value:function(e){return JSON.parse(e,function(e,n){return n})}},{key:"get",value:function(e){if(!this.isClient())return null;try{var n=localStorage.getItem(e);if(!n)return null;var t=this.deserialize(n);if(t.expiresAt&&Date.now()>t.expiresAt)return localStorage.removeItem(e),null;return t.data}catch(n){return console.error("读取缓存失败 [".concat(e,"]:"),n),null}}},{key:"set",value:function(e,n,t){if(this.isClient())try{var s={data:n,timestamp:Date.now()};(null==t?void 0:t.expiresIn)&&(s.expiresAt=Date.now()+t.expiresIn),localStorage.setItem(e,this.serialize(s))}catch(n){console.error("保存缓存失败 [".concat(e,"]:"),n)}}},{key:"remove",value:function(e){if(this.isClient())try{localStorage.removeItem(e)}catch(n){console.error("删除缓存失败 [".concat(e,"]:"),n)}}},{key:"has",value:function(e){if(!this.isClient())return!1;try{var n=localStorage.getItem(e);if(!n)return!1;var t=this.deserialize(n);if(t.expiresAt&&Date.now()>t.expiresAt)return localStorage.removeItem(e),!1;return!0}catch(n){return console.error("检查缓存失败 [".concat(e,"]:"),n),!1}}},{key:"clear",value:function(){if(this.isClient())try{localStorage.clear()}catch(e){console.error("清除所有缓存失败:",e)}}}]),e}()},14826:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return eB}});var s=t(91309),r=t(85893),i=t(67294),o=t(11163),a=t(93566),c=t(36268),l=t(73591),d=t(93778),u=t(42130),f=t(48886),m=(0,i.createContext)(void 0),x=function(e){var n=e.children,t=e.extensionAddress,s=e.groupId,a=(0,o.useRouter)(),c=(0,u.m)().address,l=a.query.provider,d=(0,i.useMemo)(function(){if(l&&"string"==typeof l&&/^0x[a-fA-F0-9]{40}$/.test(l))return l},[l]),x=(0,f.ij)(t||"0x0",s||BigInt(0),d||"0x0"),g=x.waitingList,v=x.isPending,h=x.error,p=(0,i.useMemo)(function(){if(!c||!g||0===g.length)return{isInTrialList:!1,trialAmount:BigInt(0)};var e=g.find(function(e){return e.account.toLowerCase()===c.toLowerCase()});return{isInTrialList:!!e,trialAmount:(null==e?void 0:e.amount)||BigInt(0)}},[c,g]),j=p.isInTrialList,y=p.trialAmount,b=!!d&&j&&y>BigInt(0),N=(0,i.useMemo)(function(){return{isTrialMode:b,provider:d,trialAmount:y,isPending:v,error:h}},[b,d,y,v,h]);return(0,r.jsx)(m.Provider,{value:N,children:n})},g=function(){var e=(0,i.useContext)(m);if(void 0===e)throw Error("useTrialMode 必须在 TrialModeProvider 内部使用");return e},v=t(83494),h=t(42083),p=t(31729),j=t(11010),y=t(72253),b=t(14932),N=t(97582),I=t(56312),A=t(87536),k=t(45901),w=t(86501),B=t(67997),C=t(27245),_=t(23432),E=t(21774),S=t(76453),P=t(74193),z=t(91529),Z=t(85794),M=t(20442),R=t(90278),L=t(26952),D=t(64777),V=t(44576),F=function(e){var n,t=e.actionInfo,a=e.stakedAmount,c=(0,o.useRouter)(),f=((0,i.useContext)(d.M)||{}).token,m=(0,u.m)().address,x=(0,Z.hS)(null==f?void 0:f.address,m),g=x.balance,v=x.error,p=(0,Z.yG)(null==f?void 0:f.address,m,"0xACea4f086BE05BeA47f3A56788FA3919C7f40799"),F=p.allowance,J=p.isPending,T=p.error,G=p.refetch,H=(0,R.Cv)((null==f?void 0:f.address)||"",BigInt(t.head.id),m),O=H.verificationKeys,K=H.verificationInfos,W=H.isPending,X=H.error,q=(0,M.PL)((null==f?void 0:f.address)||"",BigInt(t.head.id)),U=q.joinedAmountByActionId,$=q.error,Y=(0,s._)((0,i.useState)(!1),2),Q=Y[0],ee=Y[1],en=U&&U>BigInt(0)?(0,L.h3)(U,Number(t.body.maxRandomAccounts||0)):BigInt(0),et=k.Ry({additionalStakeAmount:k.Z_().refine(function(e){return""===e.trim()||/^[0-9]+(?:,[0-9]{3})*(?:\.[0-9]+)?$/.test(e.trim())},{message:"请输入合法的数字格式"}).transform(function(e){return""===e.trim()?"0":e.trim().replace(/,/g,"")}).refine(function(e){return"0"!==e},{message:"参与代币数不能为 0"}).refine(function(e){var n=(0,z.vz)(e);return a&&a>BigInt(0)?null!==n&&n>BigInt(0):null!==n&&n>=BigInt(t.body.minStake)},{message:"参与代币数不能小于最小参与限制"}).refine(function(e){var n=(0,z.vz)(e);return null!==n&&void 0!==g&&n<=g},{message:"您的代币余额不足"}),verificationInfos:k.IX(k.Z_().min(1,{message:"验证信息不能为空"}))}),es=t.body.verificationKeys.map(function(){return""}),er=(0,A.cI)({resolver:(0,I.F)(et),defaultValues:{additionalStakeAmount:"",verificationInfos:es},mode:"onChange"});(0,i.useEffect)(function(){if(K&&K.length>0&&O){var e={};O.forEach(function(n,t){e[n]=K[t]});var n=t.body.verificationKeys.map(function(n){var t;return null!==(t=e[n])&&void 0!==t?t:""});er.setValue("verificationInfos",n)}},[K,O,er,t.body.verificationKeys]);var ei=(0,Z.yA)(null==f?void 0:f.address),eo=ei.approve,ea=ei.isPending,ec=ei.isConfirming,el=ei.isConfirmed,ed=ei.writeError,eu=(0,i.useRef)(null),ef=(0,i.useRef)(J);function em(){return(em=(0,j._)(function(e){var n,t;return(0,N.Jh)(this,function(s){switch(s.label){case 0:if((t=null!==(n=(0,z.vz)(e.additionalStakeAmount))&&void 0!==n?n:BigInt(0))===BigInt(0)&&a&&a>BigInt(0))return w.Am.error("当前无需授权。"),[2];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,eo("0xACea4f086BE05BeA47f3A56788FA3919C7f40799",t)];case 2:return s.sent(),[3,4];case 3:return console.error("Approve failed",s.sent()),[3,4];case 4:return[2]}})})).apply(this,arguments)}(0,i.useEffect)(function(){ef.current&&!J&&eu.current&&eu.current.blur(),ef.current=J},[J]),(0,i.useEffect)(function(){el&&(ee(!0),w.Am.success("授权".concat(null==f?void 0:f.symbol,"成功")),G())},[el,null==f?void 0:f.symbol,G]);var ex=er.watch("additionalStakeAmount"),eg=null!==(n=(0,z.vz)(ex||"0"))&&void 0!==n?n:BigInt(0);(0,i.useEffect)(function(){eg>BigInt(0)&&F&&F>BigInt(0)&&F>=eg?ee(!0):ee(!1)},[eg,J,F]);var ev=(0,M.z7)(),eh=ev.join,ep=ev.isPending,ej=ev.isConfirming,ey=ev.isConfirmed,eb=ev.writeError;function eN(){return(eN=(0,j._)(function(e){var n,s,r;return(0,N.Jh)(this,function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),n=!K||K.every(function(e){return!e||""===e.trim()}),s=e.verificationInfos,!n&&K&&O)O.length===e.verificationInfos.length&&O.every(function(n,t){var s=O.indexOf(n);return s>=0&&K[s]===e.verificationInfos[t]})&&(s=[]);else if(n&&e.verificationInfos.some(function(e){return!e||""===e.trim()}))return w.Am.error("首次提交需要填写所有验证信息"),[2];return[4,eh(null==f?void 0:f.address,BigInt(t.head.id),null!==(r=(0,z.vz)(e.additionalStakeAmount))&&void 0!==r?r:BigInt(0),s)];case 1:return i.sent(),[3,3];case 2:return console.error("Join failed",i.sent()),[3,3];case 3:return[2]}})})).apply(this,arguments)}(0,i.useEffect)(function(){ey&&(w.Am.success("加入成功"),er.reset(),setTimeout(function(){c.push("/my/myaction?id=".concat(t.head.id,"&symbol=").concat(null==f?void 0:f.symbol))},2e3))},[ey]);var eI=(0,l.S)().handleContractError;return((0,i.useEffect)(function(){v&&eI(v,"token"),X&&eI(X,"join"),ed&&eI(ed,"token"),eb&&eI(eb,"join"),T&&eI(T,"token"),$&&eI($,"join")},[v,X,ed,eb,T,$]),W)?(0,r.jsx)(h.Z,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"px-6 pt-6 pb-2",children:[(0,r.jsx)("div",{className:"flex items-center gap-1 mb-4",children:(0,r.jsx)(D.Z,{title:a?"增加参与代币":"参与行动"})}),(0,r.jsx)(P.l0,(0,b._)((0,y._)({},er),{children:(0,r.jsxs)("form",{onSubmit:function(e){return e.preventDefault()},className:"space-y-4",children:[(0,r.jsx)(P.Wi,{control:er.control,name:"additionalStakeAmount",render:function(e){var n=e.field;return(0,r.jsxs)(P.xJ,{children:[(0,r.jsxs)(P.lX,{className:"text-greyscale-500 font-normal",children:[a?"":"参与代币数:"," ",en>BigInt(0)&&!a&&(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:["(100%概率抽中，至少需"," ",(0,r.jsx)("span",{className:"text-secondary",children:(0,z.LH)(en,4,"ceil")}),"代币)"]})]}),(0,r.jsx)(P.NI,{children:(0,r.jsx)(E.I,(0,y._)({placeholder:a?"最大可追加 ".concat((0,z.LH)(g||BigInt(0))):"最小参与代币数 ".concat((0,z.LH)(BigInt(t.body.minStake))),type:"number",disabled:!g||g<=BigInt(0),className:"!ring-secondary-foreground"},n))}),(0,r.jsx)(P.zG,{}),(0,r.jsxs)(P.pf,{className:"flex items-center",children:[(0,r.jsxs)("span",{children:["共有 ",(0,r.jsx)("span",{className:"text-secondary",children:(0,z.LH)(g||BigInt(0))})," ",null==f?void 0:f.symbol]}),(0,r.jsx)(C.z,{type:"button",variant:"link",size:"sm",onClick:function(){g&&g>BigInt(0)&&er.setValue("additionalStakeAmount",(0,z.bM)(g))},className:"text-secondary p-0 ml-6",disabled:!g||g<=BigInt(0),children:"全部"})]})]})}}),t.body.verificationKeys.map(function(e,n){return(0,r.jsx)(P.Wi,{control:er.control,name:"verificationInfos.".concat(n),render:function(s){var i=s.field;return(0,r.jsxs)(P.xJ,{children:[(0,r.jsx)(P.lX,{className:"text-greyscale-500 font-normal",children:e}),(0,r.jsx)(P.NI,{children:(0,r.jsx)(S.g,(0,y._)({placeholder:t.body.verificationInfoGuides[n]||"",className:"!ring-secondary-foreground"},i))}),(0,r.jsx)(P.zG,{})]})}},e+n)}),(0,r.jsxs)("div",{className:"flex justify-center space-x-4 pt-2",children:[(0,r.jsx)(C.z,{ref:eu,className:"w-1/2",disabled:J||ea||ec||Q,type:"button",onClick:function(){er.handleSubmit(function(e){return function(e){return em.apply(this,arguments)}(e)})()},children:J?(0,r.jsx)(_.Z,{className:"animate-spin"}):ea?"1.提交中...":ec?"1.确认中...":Q?"1.".concat(null==f?void 0:f.symbol,"已授权"):"1.授权".concat(null==f?void 0:f.symbol)}),(0,r.jsx)(C.z,{className:"w-1/2",disabled:!Q||ep||ej||ey,type:"button",onClick:function(){er.handleSubmit(function(e){return function(e){return eN.apply(this,arguments)}(e)})()},children:ep?"2.提交中...":ej?"2.确认中...":ey?"2.已加入":"2.加入"})]})]})}))]}),(0,r.jsx)("div",{className:"px-6 pt-0 pb-4",children:(0,r.jsx)("div",{className:"text-greyscale-500 text-sm",children:"提示：加入行动后，可以随时取回参与代币，无等待期"})}),(0,r.jsx)("div",{className:"flex flex-col w-full p-4",children:(0,r.jsxs)("div",{className:"bg-blue-50/30 border-l-4 border-l-blue-50 rounded-r-lg p-4 mb-8 text-sm",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-base font-bold text-blue-800 pb-2",children:[(0,r.jsx)(B.Z,{className:"w-4 h-4"}),"小贴士"]}),(0,r.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"行动激励："}),(0,r.jsx)("div",{className:"text-sm text-blue-700",children:"1、验证阶段会随机抽取地址验证打分，然后按得分比例给这些地址分配代币激励"}),(0,r.jsxs)("div",{className:"text-sm text-blue-700",children:["2、只有当1个行动获得的投票数，达到该轮总投票数",(0,z.rl)(Number("30")/10),"时，参与该行动才有激励"]}),(0,r.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"参与代币："}),(0,r.jsx)("div",{className:"text-sm text-blue-700",children:"1、参与代币越多，被选中验证并获得激励的概率越大"}),(0,r.jsx)("div",{className:"text-sm text-blue-700",children:"2、参与的代币可随时取回，如不取回则自动参与此行动的后续轮次"}),(0,r.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"加入限制："}),(0,r.jsxs)("div",{className:"text-sm text-blue-700",children:["每个行动阶段，最后","105","个区块（约",(0,z.ZC)(Number("105")*Number("2868")/1e3),"），无法参与行动报名"]})]})}),(0,r.jsx)(V.Z,{isLoading:ea||ec||ep||ej,text:ea||ep?"提交交易...":"确认交易..."})]})},J=t(92261),T=t(27966),G=t(72260),H=t(7855),O=t(95752),K=t(38442),W=t(95049),X=t(30333),q=function(e){var n,t=e.actionId,a=e.actionInfo,c=e.extensionAddress,l=(0,o.useRouter)(),f=((0,i.useContext)(d.M)||{}).token,m=(0,u.m)().address,x=(0,W.V)().setError,g=(0,M.Bk)(),v=g.currentRound,p=g.isPending,B=g.error,S=(0,G.Dn)(null==f?void 0:f.address,v||BigInt(0),t),R=S.isActionIdVoted,L=S.isPending,D=S.error,F=(0,H.g)({extensionAddress:c,tokenAddress:null==f?void 0:f.address,account:m}),J=F.joinedAmount,q=F.waitingBlocks,U=F.joinTokenAddress,$=F.rewardRatio,Y=F.userGovVotes,Q=F.totalGovVotes,ee=F.minGovRatio,en=F.userGovRatio,et=F.lpRatio,es=F.isPending,er=F.error,ei=J>BigInt(0),eo=(0,z.rl)(et),ea=void 0!==en&&void 0!==ee&&en<ee,ec=(0,i.useMemo)(function(){return!!p||!!L||!0===R},[p,L,R]),el=(0,Z.hS)(U,m,!!U),ed=el.balance,eu=el.error,ef=(0,K.r)({tokenAddress:U,tokenSymbol:void 0,enabled:!!U}).formattedSymbol,em=(0,Z.yG)(U,m,c,!!U),ex=em.allowance,eg=em.isPending,ev=em.error,eh=em.refetch,ep=(0,s._)((0,i.useState)(!1),2),ej=ep[0],ey=ep[1],eb=(0,s._)((0,i.useState)(!1),2),eN=eb[0],eI=eb[1],eA=k.Ry({joinAmount:k.Z_().refine(function(e){return""===e.trim()||/^[0-9]+(?:,[0-9]{3})*(?:\.[0-9]+)?$/.test(e.trim())},{message:"请输入合法的数字格式"}).transform(function(e){return""===e.trim()?"0":e.trim().replace(/,/g,"")}).refine(function(e){return"0"!==e},{message:"LP加入数不能为 0"}).refine(function(e){var n=(0,z.vz)(e);return null!==n&&void 0!==ed&&n<=ed},{message:"您的LP余额不足"})}),ek=(0,A.cI)({resolver:(0,I.F)(eA),defaultValues:{joinAmount:""},mode:"onChange"}),ew=(0,Z.yA)(U),eB=ew.approve,eC=ew.isPending,e_=ew.isConfirming,eE=ew.isConfirmed,eS=ew.writeError,eP=(0,i.useRef)(null),ez=(0,i.useRef)(eg);function eZ(){return(eZ=(0,j._)(function(e){var n,t;return(0,N.Jh)(this,function(s){switch(s.label){case 0:if(ea)return w.Am.error("治理票占比不足，无法参与行动。"),[2];if((t=null!==(n=(0,z.vz)(e.joinAmount))&&void 0!==n?n:BigInt(0))===BigInt(0))return w.Am.error("当前无需授权。"),[2];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,eB(c,t)];case 2:return s.sent(),[3,4];case 3:return console.error("Approve failed",s.sent()),[3,4];case 4:return[2]}})})).apply(this,arguments)}(0,i.useEffect)(function(){ez.current&&!eg&&eP.current&&eP.current.blur(),ez.current=eg},[eg]),(0,i.useEffect)(function(){eE&&(ey(!0),w.Am.success("授权LP成功"),eh())},[eE,eh]);var eM=ek.watch("joinAmount"),eR=null!==(n=(0,z.vz)(eM||"0"))&&void 0!==n?n:BigInt(0);(0,i.useEffect)(function(){eR>BigInt(0)&&ex&&ex>BigInt(0)&&ex>=eR?ey(!0):ey(!1)},[eR,eg,ex]);var eL=(0,O.z7)(c),eD=eL.join,eV=eL.isPending,eF=eL.isConfirming,eJ=eL.isConfirmed,eT=eL.writeError;function eG(){return(eG=(0,j._)(function(e){var n;return(0,N.Jh)(this,function(t){switch(t.label){case 0:if(ea)return w.Am.error("治理票占比不足，无法参与行动。"),[2];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,eD(null!==(n=(0,z.vz)(e.joinAmount))&&void 0!==n?n:BigInt(0),[])];case 2:return t.sent(),[3,4];case 3:return console.error("Join failed",t.sent()),[3,4];case 4:return[2]}})})).apply(this,arguments)}(0,i.useEffect)(function(){eJ&&(w.Am.success("加入LP成功"),ek.reset(),eI(!0),setTimeout(function(){l.push("/my/myaction?id=".concat(a.head.id,"&symbol=").concat(null==f?void 0:f.symbol))},2e3))},[eJ]);var eH=(0,T.b)().handleError;return((0,i.useEffect)(function(){eu&&eH(eu),eS&&eH(eS),eT&&eH(eT),ev&&eH(ev),er&&eH(er),B&&eH(B),D&&eH(D)},[eu,eS,eT,ev,er,B,D,eH]),(0,i.useEffect)(function(){p||L||!1!==R||x({name:"无法参加",message:"当前行动未投票，不能参加"})},[p,L,R,x]),es)?(0,r.jsx)(h.Z,{}):(0,r.jsxs)(r.Fragment,{children:[ei&&!eN&&(0,r.jsx)("div",{className:"flex flex-col items-center px-4 pt-1",children:(0,r.jsx)(X.Z,{stakedAmount:J||BigInt(0),lpRatioStr:eo,rewardRatio:$,userGovVotes:Y,totalGovVotes:Q})}),ea&&(0,r.jsx)("div",{className:"px-6 py-0",children:(0,r.jsxs)("div",{className:"text-sm text-red-700 bg-red-50 border border-red-200 rounded px-3 py-2 mt-3 w-full",children:[(0,r.jsx)("div",{className:"font-medium",children:"⚠️ 治理票占比不足"}),(0,r.jsxs)("div",{className:"mt-1",children:["你的治理票占比"," ",(0,r.jsx)("span",{className:"font-semibold",children:(0,z.rl)(Number(en)/1e18*100)})," ","低于最小限制 ",(0,r.jsx)("span",{className:"font-semibold",children:(0,z.rl)(Number(ee)/1e18*100)}),"，无法参与行动。"]}),(0,r.jsx)("div",{className:"text-xs text-red-600 mt-1",children:"您可以增加治理票数，再重新参与行动。"})]})}),(0,r.jsxs)("div",{className:"px-6 pt-6 pb-2",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsx)("h1",{className:"text-lg font-bold",children:ei&&!eN?"追加LP":"加入行动"}),(0,r.jsx)("button",{type:"button",onClick:function(){l.push("/dex/?tab=liquidity")},className:"text-secondary text-sm hover:underline",children:"获取LP代币 >>"})]}),(0,r.jsx)(P.l0,(0,b._)((0,y._)({},ek),{children:(0,r.jsxs)("form",{onSubmit:function(e){return e.preventDefault()},className:"space-y-4 pt-2",children:[(0,r.jsx)(P.Wi,{control:ek.control,name:"joinAmount",render:function(e){var n=e.field;return(0,r.jsxs)(P.xJ,{children:[(0,r.jsx)(P.lX,{className:"text-greyscale-500 font-normal",children:ei&&!eN?"":"质押LP数量："}),(0,r.jsx)(P.NI,{children:(0,r.jsx)(E.I,(0,y._)({placeholder:ei&&!eN?"最大可追加 ".concat((0,z.LH)(ed||BigInt(0),4)):"请输入LP数量",type:"number",disabled:!ed||ed<=BigInt(0)||ea,className:"!ring-secondary-foreground"},n))}),(0,r.jsx)(P.zG,{}),(0,r.jsxs)(P.pf,{className:"flex items-center justify-between",children:[(0,r.jsxs)("span",{children:["共有 ",(0,r.jsx)("span",{className:"text-secondary",children:(0,z.LH)(ed||BigInt(0),4)})," ",ef]}),(0,r.jsx)(C.z,{type:"button",variant:"link",size:"sm",onClick:function(){ed&&ed>BigInt(0)&&ek.setValue("joinAmount",(0,z.bM)(ed))},className:"text-secondary p-0",disabled:!ed||ed<=BigInt(0)||ea,children:"全部"})]})]})}}),(0,r.jsxs)("div",{className:"flex justify-center space-x-4 pt-2",children:[(0,r.jsx)(C.z,{ref:eP,className:"w-1/2",disabled:eg||eC||e_||ej||ea||!ec,type:"button",onClick:function(){ek.handleSubmit(function(e){return function(e){return eZ.apply(this,arguments)}(e)})()},children:eg?(0,r.jsx)(_.Z,{className:"animate-spin"}):eC?"1.提交中...":e_?"1.确认中...":ej?"1.LP已授权":"1.授权LP"}),(0,r.jsx)(C.z,{className:"w-1/2",disabled:!ej||eV||eF||eJ||ea||!ec,type:"button",onClick:function(){ek.handleSubmit(function(e){return function(e){return eG.apply(this,arguments)}(e)})()},children:eV?"2.提交中...":eF?"2.确认中...":eJ?"2.已加入":"2.加入"})]})]})}))]}),(0,r.jsx)("div",{className:"px-6 pt-0 pb-4",children:(0,r.jsxs)("div",{className:"text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded px-3 py-2",children:[(0,r.jsx)("div",{className:"font-medium text-gray-700 mb-1",children:"\uD83D\uDCA1 小贴士"}),(0,r.jsxs)("div",{className:"space-y-1 text-gray-600",children:[(0,r.jsxs)("div",{children:["• 加入代币为 ",ef]}),(0,r.jsxs)("div",{children:["• 加入行动后，等待 ",q.toString()," 区块数后可以取回LP"]})]})]})}),(0,r.jsx)(V.Z,{isLoading:eC||e_||eV||eF,text:eC||eV?"提交交易...":"确认交易..."})]})},U=t(41664),$=t.n(U),Y=t(8300),Q=t(21879),ee=t(55976),en=k.Ry({groupName:k.Z_().min(1,{message:"请输入链群名称"})}),et=(0,I.F)(en),es=function(e){var n=e.actionId,t=(e.actionInfo,e.extensionAddress),a=(0,o.useRouter)(),c=((0,i.useContext)(d.M)||{}).token,l=(0,M.Bk)().currentRound,u=(0,Q.Ko)({extensionAddress:t,round:l}),f=u.groups,m=u.isPending,x=u.error,g=ee.k.get("joined_group_id"),v=g?BigInt(g):null,p=(0,Y.nS)(v||BigInt(0)),j=p.groupName,N=p.isPending,I=(0,s._)((0,i.useState)(""),2),k=I[0],w=I[1],B=k&&k!==j,_=(0,Y.ru)(B?k:""),S=_.tokenId,z=_.isPending,Z=_.error,R=k===j&&v?v:S,L=!!B&&z,V=(0,A.cI)({resolver:et,defaultValues:{groupName:""},mode:"onChange"});(0,i.useEffect)(function(){j&&!N&&(V.reset({groupName:j}),w(j))},[j,N,V]);var F=V.watch("groupName");(0,i.useEffect)(function(){var e=setTimeout(function(){w(F.trim())},500);return function(){return clearTimeout(e)}},[F]);var J=(0,s._)((0,i.useState)(""),2),G=J[0],H=J[1];(0,i.useEffect)(function(){if(!k||L){H("");return}if(Z){H("查询链群信息失败");return}if(!R||R===BigInt(0)){H("链群名称不存在或未激活");return}if(!(null==f?void 0:f.some(function(e){return e.groupId===R}))){H("该链群不在此行动的可用链群列表中");return}H("")},[k,R,L,Z,f]);var O=(0,T.b)().handleError;return((0,i.useEffect)(function(){x&&O(x)},[x,O]),m)?(0,r.jsxs)("div",{className:"flex flex-col items-center px-4 pt-6",children:[(0,r.jsx)(h.Z,{}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"加载链群列表..."})]}):f&&0!==f.length?(0,r.jsxs)("div",{className:"px-6 pt-6 pb-2",children:[(0,r.jsx)(D.Z,{title:"输入要加入的链群"}),(0,r.jsx)(P.l0,(0,b._)((0,y._)({},V),{children:(0,r.jsxs)("form",{onSubmit:V.handleSubmit(function(e){R&&R!==BigInt(0)&&a.push("/acting/join?tab=join&groupId=".concat(R.toString(),"&id=").concat(n.toString(),"&symbol=").concat(null==c?void 0:c.symbol))}),className:"space-y-4 pt-4",children:[(0,r.jsx)(P.Wi,{control:V.control,name:"groupName",render:function(e){var n=e.field;return(0,r.jsxs)(P.xJ,{children:[(0,r.jsx)(P.NI,{children:(0,r.jsx)(E.I,(0,y._)({placeholder:"请输入链群名称",className:"!ring-secondary-foreground"},n))}),(0,r.jsx)(P.zG,{}),L&&k&&(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"验证链群中..."}),G&&!L&&(0,r.jsx)("div",{className:"text-xs text-red-500",children:G}),!L&&!G&&R&&R>BigInt(0)&&(0,r.jsx)("div",{className:"text-xs text-green-600",children:"✓ 链群验证通过"})]})}}),(0,r.jsx)("div",{className:"flex justify-center pt-2",children:(0,r.jsx)(C.z,{type:"submit",className:"w-full",disabled:!V.formState.isValid||L||!!G||!R||R===BigInt(0),children:"下一步"})})]})})),(0,r.jsxs)("div",{className:"mt-6 text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded px-3 py-2",children:[(0,r.jsx)("div",{className:"font-medium text-gray-700 mb-1",children:"\uD83D\uDCA1 小贴士"}),(0,r.jsx)("div",{className:"space-y-1 text-gray-600",children:(0,r.jsx)("div",{children:"如不知道链群名称，可询问链群服务者或周围朋友"})})]})]}):(0,r.jsxs)("div",{className:"flex flex-col items-center px-6 pt-6",children:[(0,r.jsx)(D.Z,{title:"还没有已激活的链群"}),(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("p",{children:"链群行动，需要先激活链群，才能加入行动"}),(0,r.jsx)("div",{className:"mt-4 flex justify-center",children:(0,r.jsx)($(),{href:"/extension/group_op?actionId=".concat(n.toString(),"&op=activate"),children:(0,r.jsx)(C.z,{className:"text-secondary border-secondary",variant:"outline",children:"去激活链群 >>"})})})]})]})},er=t(8926),ei=t(47714),eo=t(71104),ea=t(67516),ec=t(98482),el=t(30558),ed=t(35611),eu=t(37541),ef=t(67959),em=t(37742),ex=t(39241),eg=t(27460),ev=t(44746),eh=t(80302),ep="0xd94e4Fc2108B78Aa57438BFe5E85192687f74322",ej=function(e){var n,t,a,c,l,m,x,v,p,B,S,M,R,L,D,F,J,G,H,O,K,X,q,U,Y,Q,en,et,es,ej,ey,eb,eN=e.actionId,eI=e.actionInfo,eA=e.extensionAddress,ek=e.groupId,ew=(0,o.useRouter)(),eB=((0,i.useContext)(d.M)||{}).token,eC=(0,u.m)().address,e_=(0,W.V)().setError,eE=g(),eS=eE.isTrialMode,eP=eE.provider,ez=eE.trialAmount,eZ=(0,s._)((0,i.useState)(!1),2),eM=eZ[0],eR=eZ[1];(0,i.useEffect)(function(){eS&&eR(!0)},[eS]);var eL=eS||eM,eD=(0,er.W)({token:eB||{address:"0x0000000000000000000000000000000000000000"},actionIds:[eN],enabled:!!eB&&void 0!==eN}),eV=eD.extensions,eF=eD.isPending,eJ=eD.error,eT=null===(et=eV[0])||void 0===et?void 0:et.joinedAmountTokenAddress,eG=null===(es=eV[0])||void 0===es?void 0:es.joinedAmountTokenSymbol,eH=null===(ej=eV[0])||void 0===ej?void 0:ej.joinedAmountTokenIsLP,eO=null==eI?void 0:null===(ey=eI.body)||void 0===ey?void 0:ey.verificationKeys,eK=(t=(n={tokenAddress:null==eB?void 0:eB.address,extensionAddress:eA,account:eC,actionId:eN,joinTokenAddress:eT,verificationKeys:eO,groupJoinContractAddress:ep}).tokenAddress,a=n.extensionAddress,c=n.account,l=n.actionId,m=n.joinTokenAddress,x=n.verificationKeys,v=n.groupJoinContractAddress,B=(p=(0,eo.u)({address:"0xACea4f086BE05BeA47f3A56788FA3919C7f40799",abi:ec.S,functionName:"currentRound",query:{enabled:!0}})).data,S=p.isPending,M=p.error,R=(0,i.useMemo)(function(){return B?(0,em.Z)(B):void 0},[B]),D=(L=(0,eo.u)({address:m,abi:eu.O,functionName:"allowance",args:[c,v],query:{enabled:!!m&&!!c}})).data,F=L.isPending,J=L.error,G=L.refetch,H=(0,i.useMemo)(function(){return D?(0,em.Z)(D):void 0},[D]),O=(0,i.useMemo)(function(){var e=[];return a&&c?(t&&void 0!==R&&void 0!==l&&e.push({address:"0x4623f58Ed1Ad367fa4F47fC1969CbB3a22893435",abi:el.X,functionName:"isActionIdVoted",args:[t,R,l]}),e.push({address:v,abi:ed.w,functionName:"joinInfo",args:[a,R,c]}),m&&e.push({address:m,abi:eu.O,functionName:"balanceOf",args:[c]}),x&&x.length>0&&t&&void 0!==l&&x.forEach(function(n){e.push({address:"0x37Ddf561323b823144BaE33264f9C5461714846e",abi:ef.z,functionName:"verificationInfo",args:[t,l,c,n]})}),e):[]},[a,c,t,R,l,m,x,v]),X=(K=(0,ea.N)({contracts:O,query:{enabled:O.length>0&&void 0!==a&&void 0!==c}})).data,q=K.isPending,U=K.error,Y=(0,i.useMemo)(function(){var e=0;return{isActionIdVotedIndex:t&&void 0!==R&&void 0!==l?e++:-1,joinInfoIndex:e++,balanceIndex:m?e++:-1,verificationInfosStartIndex:e}},[t,R,l,m]),Q=(0,i.useMemo)(function(){if(!(Y.isActionIdVotedIndex<0)&&X&&!(Y.isActionIdVotedIndex>=X.length)){var e=X[Y.isActionIdVotedIndex];return(null==e?void 0:e.status)==="success"?e.result:void 0}},[X,Y.isActionIdVotedIndex]),en=(0,i.useMemo)(function(){if(X&&!(Y.joinInfoIndex>=X.length)){var e=X[Y.joinInfoIndex];return(null==e?void 0:e.status)==="success"?e.result:void 0}},[X,Y.joinInfoIndex]),{currentRound:R,isActionIdVoted:Q,joinedAmount:(0,i.useMemo)(function(){return en?(0,em.Z)(en[1]):void 0},[en]),balance:(0,i.useMemo)(function(){if(m&&!(Y.balanceIndex<0)&&X&&!(Y.balanceIndex>=X.length)){var e=X[Y.balanceIndex];return(null==e?void 0:e.status)==="success"?(0,em.Z)(e.result):void 0}},[X,Y.balanceIndex,m]),allowance:H,verificationInfos:(0,i.useMemo)(function(){return x&&0!==x.length?!X||Y.verificationInfosStartIndex<0?Array(x.length).fill(void 0):x.map(function(e,n){var t=Y.verificationInfosStartIndex+n;if(!(t>=X.length)){var s=X[t];return(null==s?void 0:s.status)==="success"?s.result:void 0}}):[]},[X,Y.verificationInfosStartIndex,x]),isPending:S||q||F,isPendingAllowance:F,error:M||U||J||null,refetchAllowance:G||function(){}}),eW=eK.currentRound,eX=eK.isActionIdVoted,eq=eK.joinedAmount,eU=eK.balance,e$=eK.allowance,eY=eK.verificationInfos,eQ=eK.isPending,e0=eK.isPendingAllowance,e1=eK.error,e2=eK.refetchAllowance,e4=(0,i.useMemo)(function(){return void 0!==eq&&eq>BigInt(0)},[eq]),e3=(0,ei.A)({extensionAddress:eA,groupId:ek,round:eW}),e6=e3.groupDetail,e7=e3.isPending,e5=e3.error,e8=(0,i.useMemo)(function(){return e6?(0,ex.A)(e6):{amount:BigInt(0),reason:""}},[e6]),e9=(0,i.useMemo)(function(){return e4&&e6&&eq?(0,ex.g)(e6,eq):{amount:BigInt(0),reason:""}},[e4,e6,eq]),ne=e4?e9.amount:e8.amount,nn=(0,i.useMemo)(function(){return!e4&&!eQ&&!!e6&&e6.maxAccounts!==BigInt(0)&&e6.accountCount>=e6.maxAccounts},[e4,eQ,e6]),nt=(0,i.useMemo)(function(){return e4||!e6?{blocked:!1,reason:""}:nn?{blocked:!0,reason:"链群地址数已达到上限"}:e8.amount<=BigInt(0)?{blocked:!0,reason:e8.reason}:{blocked:!1,reason:""}},[e4,e6,nn,e8]),ns=(0,i.useMemo)(function(){return e4&&e6&&e9.amount<=BigInt(0)?{blocked:!0,reason:e9.reason||"无法追加代币"}:{blocked:!1,reason:""}},[e4,e6,e9]),nr=(0,i.useMemo)(function(){return!!eQ||!0===eX},[eQ,eX]),ni=(0,s._)((0,i.useState)(!1),2),no=ni[0],na=ni[1],nc=k.Ry({joinAmount:k.Z_().refine(function(e){return""===e.trim()||/^[0-9]+(?:,[0-9]{3})*(?:\.[0-9]+)?$/.test(e.trim())},{message:"请输入合法的数字格式"}).transform(function(e){return""===e.trim()?"0":e.trim().replace(/,/g,"")}).refine(function(e){return"0"!==e},{message:"参与代币数不能为 0"}).refine(function(e){if(eL)return!0;var n=(0,z.vz)(e);return null!==n&&void 0!==eU&&n<=eU},{message:"您的代币余额不足"}).refine(function(e){if(e4||!e6)return!0;var n=(0,z.vz)(e);return null!==n&&n>=e6.actualMinJoinAmount},{message:"参与代币数不能小于最小值 ".concat(e6?(0,z.LH)(e6.actualMinJoinAmount):"0")}).refine(function(e){if(!e6)return!0;var n=(0,z.vz)(e);return null!==n&&n<=ne},{message:"参与代币数不能大于最大值 ".concat(ne>BigInt(0)?(0,z.LH)(ne):"不限")}),verificationInfos:k.IX(k.Z_().min(1,{message:"验证信息不能为空"}))}),nl=eO?eO.map(function(){return""}):[],nd=(0,A.cI)({resolver:(0,I.F)(nc),defaultValues:{joinAmount:eL?(0,z.bM)(ez):"",verificationInfos:nl},mode:"onChange"});(0,i.useEffect)(function(){eL&&ez>BigInt(0)&&nd.setValue("joinAmount",(0,z.bM)(ez))},[eL,ez,nd]),(0,i.useEffect)(function(){if(!eQ&&eY&&eO){var e=eO.map(function(e,n){return eY[n]||""});nd.setValue("verificationInfos",e)}},[eQ,eY,eO,nd]);var nu=(0,Z.yA)(eT),nf=nu.approve,nm=nu.isPending,nx=nu.isConfirming,ng=nu.isConfirmed,nv=nu.writeError,nh=(0,i.useRef)(null),np=(0,i.useRef)(e0);function nj(){return(nj=(0,j._)(function(e){var n,t;return(0,N.Jh)(this,function(s){switch(s.label){case 0:if((t=null!==(n=(0,z.vz)(e.joinAmount))&&void 0!==n?n:BigInt(0))===BigInt(0))return w.Am.error("当前无需授权"),[2];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,nf(ep,t)];case 2:return s.sent(),[3,4];case 3:return console.error("Approve failed",s.sent()),[3,4];case 4:return[2]}})})).apply(this,arguments)}(0,i.useEffect)(function(){np.current&&!e0&&nh.current&&nh.current.blur(),np.current=e0},[e0]),(0,i.useEffect)(function(){ng&&(na(!0),w.Am.success("授权代币成功"),e2())},[ng,e2]);var ny=nd.watch("joinAmount"),nb=null!==(eb=(0,z.vz)(ny||"0"))&&void 0!==eb?eb:BigInt(0);(0,i.useEffect)(function(){nb>BigInt(0)&&e$&&e$>BigInt(0)&&e$>=nb?na(!0):na(!1)},[nb,e0,e$]);var nN=(0,f.z7)(),nI=nN.join,nA=nN.isPending,nk=nN.isConfirming,nw=nN.isConfirmed,nB=nN.writeError,nC=(0,f.WU)(),n_=nC.trialJoin,nE=nC.isPending,nS=nC.isConfirming,nP=nC.isConfirmed,nz=nC.writeError,nZ=(0,s._)((0,i.useState)(!1),2),nM=nZ[0],nR=nZ[1];(0,i.useEffect)(function(){(nw||nP)&&nR(!0)},[nw,nP]);var nL=!nM&&e4;function nD(){return(nD=(0,j._)(function(e){var n;return(0,N.Jh)(this,function(t){switch(t.label){case 0:if(t.trys.push([0,5,,6]),!(eS&&eP))return[3,2];return eR(!0),[4,n_(eA,ek,eP,e.verificationInfos||[])];case 1:return t.sent(),[3,4];case 2:return[4,nI(eA,ek,null!==(n=(0,z.vz)(e.joinAmount))&&void 0!==n?n:BigInt(0),e.verificationInfos||[])];case 3:t.sent(),t.label=4;case 4:return[3,6];case 5:return console.error("Join failed",t.sent()),[3,6];case 6:return[2]}})})).apply(this,arguments)}var nV=function(){!(!eU||eU<=BigInt(0))&&e6&&nd.setValue("joinAmount",(0,z.bM)(eU<ne?eU:ne))};(0,i.useEffect)(function(){(nw||nP)&&(w.Am.success(eL?"体验加入成功":"加入链群成功"),ee.k.set("joined_group_id",ek.toString()),setTimeout(function(){ew.push("/my/myaction?id=".concat(eN.toString(),"&symbol=").concat((null==eB?void 0:eB.symbol)||""))},1e3))},[nw,nP,eL,ew,eN,null==eB?void 0:eB.symbol,ek]);var nF=(0,T.b)().handleError;return((0,i.useEffect)(function(){e5&&nF(e5),e1&&nF(e1),nv&&nF(nv),nB&&nF(nB),nz&&nF(nz),eJ&&nF(eJ)},[e5,e1,nv,nB,nz,eJ,nF]),(0,i.useEffect)(function(){eQ||!1!==eX||e_({name:"无法参加",message:"当前行动未投票，不能参加"})},[eQ,eX,e_]),e7||eQ||eF)?(0,r.jsxs)("div",{className:"flex flex-col items-center px-4 pt-6",children:[(0,r.jsx)(h.Z,{}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"加载链群信息..."})]}):e6?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"px-4 pt-0 pb-2",children:[nL&&(0,r.jsx)("div",{className:"my-4",children:(0,r.jsx)(eh.Z,{actionId:eN,extensionAddress:eA,groupId:ek})}),!nL&&(0,r.jsx)(r.Fragment,{children:eS&&(0,r.jsxs)("div",{className:"mt-4 mb-6 px-4 py-2 bg-orange-50 border border-orange-200 rounded-lg",children:[(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)("span",{className:"text-orange-600 font-semibold",children:"\uD83C\uDF89 恭喜您获得体验资格"})}),(0,r.jsx)("div",{className:"text-sm text-orange-600 mt-1",children:"每天记得来铸造你的行动激励！"})]})}),(0,r.jsxs)("div",{className:"flex items-baseline mt-4",children:[(0,r.jsx)("span",{className:"text-gray-400 text-xs mr-1",children:"No."}),(0,r.jsx)("span",{className:"text-secondary text-xl font-bold mr-2 leading-none",children:eI.head.id.toString()}),(0,r.jsx)("span",{className:"font-bold text-gray-800 text-lg leading-tight",children:eI.body.title})]}),(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)("div",{className:"flex min-h-10 w-full items-center justify-between gap-3 rounded-md bg-gray-50/60 px-3 py-2 text-sm",children:(0,r.jsxs)("div",{className:"flex items-baseline min-w-0",children:[(0,r.jsx)("span",{className:"text-greyscale-500 font-normal text-sm shrink-0",children:"链群"}),(0,r.jsx)("span",{className:"text-gray-400 text-xs",children:"#"}),(0,r.jsx)("span",{className:"text-gray-700 text-sm mr-2 leading-none",children:e6.groupId.toString()}),(0,r.jsx)("span",{className:"font-semibold text-gray-700 text-sm truncate",children:e6.groupName})]})})}),(0,r.jsx)(P.l0,(0,b._)((0,y._)({},nd),{children:(0,r.jsxs)("form",{onSubmit:function(e){return e.preventDefault()},className:"space-y-6 pt-6",children:[(0,r.jsx)(P.Wi,{control:nd.control,name:"joinAmount",render:function(e){var n=e.field;return(0,r.jsxs)(P.xJ,{children:[(0,r.jsxs)(P.lX,{className:"text-greyscale-500 font-normal flex items-center justify-between",children:[(0,r.jsx)("span",{children:nL?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"font-bold text-gray-900",children:"追加代币数："})," ",nr&&(ns.blocked?(0,r.jsx)("span",{className:"text-red-600 text-sm",children:ns.reason}):(0,r.jsxs)("span",{className:"text-xs text-gray-500 inline-flex items-center gap-1",children:["最大 ",(0,z.LH)(e9.amount),(0,r.jsx)(ev.Z,{title:"追加上限说明",content:e9.reason})]}))]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"font-bold text-gray-900",children:eS?"体验代币数：":"参与代币数："})," ",nr&&(nt.blocked?(0,r.jsx)("span",{className:"text-red-600 text-sm",children:nt.reason}):(0,r.jsxs)("span",{className:"text-xs text-gray-500 inline-flex items-center gap-1",children:["限 ",(0,z.LH)(e6.actualMinJoinAmount,4,"ceil")," ~"," ",(0,z.LH)(e8.amount),(0,r.jsx)(ev.Z,{title:"参与上限说明",content:e8.reason})]}))]})}),eH&&!eL&&(0,r.jsx)($(),{href:"/dex/?tab=liquidity",className:"text-sm text-secondary hover:text-secondary/80 hover:underline ml-2",children:"获取LP代币 >>"})]}),(0,r.jsx)(P.NI,{children:(0,r.jsx)(E.I,(0,y._)({placeholder:"请输入参与代币数量",type:"number",disabled:eS||!eU||eU<=BigInt(0)||nt.blocked||ns.blocked,className:"!ring-secondary-foreground ".concat(eS?"bg-gray-100 text-gray-600":"")},n))}),(0,r.jsx)(P.zG,{}),eS&&(0,r.jsxs)(P.pf,{className:"text-xs text-gray-600",children:["体验模式，由 ",(0,r.jsx)(eg.Z,{address:e6.owner,showCopyButton:!0})," ","代为提供参与代币"]}),!eS&&(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[(0,r.jsxs)("span",{className:"flex items-center gap-1",children:["我的余额：",(0,r.jsx)("span",{className:"text-secondary",children:(0,z.LH)(eU||BigInt(0),4)})," ",eG]}),(0,r.jsx)(C.z,{type:"button",variant:"link",size:"sm",onClick:nV,className:"text-secondary p-0 h-auto",disabled:!eU||eU<=BigInt(0)||nt.blocked||ns.blocked,children:"最高"})]})]})}}),eO&&eO.length>0&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{children:eQ?(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"加载已有验证信息..."}):(0,r.jsx)(r.Fragment,{children:eO.map(function(e,n){var t,s=(null===(t=eI.body.verificationInfoGuides)||void 0===t?void 0:t[n])||"";return(0,r.jsx)(P.Wi,{control:nd.control,name:"verificationInfos.".concat(n),render:function(n){var t=n.field;return(0,r.jsxs)(P.xJ,{className:"mb-4",children:[(0,r.jsx)(P.lX,{className:"text-greyscale-500 font-normal",children:(0,r.jsxs)("span",{className:"font-bold text-gray-900",children:[e,"："]})}),(0,r.jsx)(P.NI,{children:(0,r.jsx)(E.I,(0,y._)({placeholder:"请输入".concat(e),className:"!ring-secondary-foreground"},t))}),s&&(0,r.jsxs)(P.pf,{className:"text-xs text-gray-600",children:["提示：",s]}),(0,r.jsx)(P.zG,{})]})}},e+n)})})})}),(0,r.jsxs)("div",{className:"flex justify-center space-x-4 pt-2",children:[!eL&&(0,r.jsx)(C.z,{ref:nh,className:"w-1/2",disabled:e0||nm||nx||no||nt.blocked||ns.blocked||!nr,type:"button",onClick:function(){nd.handleSubmit(function(e){return function(e){return nj.apply(this,arguments)}(e)})()},children:e0?(0,r.jsx)(_.Z,{className:"animate-spin"}):nm?"1.提交中...":nx?"1.确认中...":no?"1.代币已授权":"1.授权代币"}),(0,r.jsx)(C.z,{className:eL?"w-full":"w-1/2",disabled:!eL&&!no||nA||nk||nw||nE||nS||nP||nt.blocked||ns.blocked||!nr,type:"button",onClick:function(){nd.handleSubmit(function(e){return function(e){return nD.apply(this,arguments)}(e)})()},children:nA||nE?eL?"提交中...":"2.提交中...":nk||nS?eL?"确认中...":"2.确认中...":nw||nP?eL?"已加入":"2.已加入":eL?"加入行动":nL?"2.追加代币":"2.加入行动"})]})]})})),(0,r.jsxs)("div",{className:"mt-6 text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded px-3 py-2",children:[(0,r.jsx)("div",{className:"font-medium text-gray-700 mb-2",children:"\uD83D\uDCA1 小贴士"}),(0,r.jsx)("div",{className:"space-y-0 text-gray-600",children:eL?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{children:"• 体验结束，可自行退出行动"}),(0,r.jsxs)("div",{children:["• 也可由"," ",(0,r.jsx)(eg.Z,{address:e6.owner,showCopyButton:!0})," 代为退出行动"]}),(0,r.jsxs)("div",{children:["• 参与代币返还给 ",(0,r.jsx)(eg.Z,{address:e6.owner,showCopyButton:!0})]})]}):(0,r.jsxs)(r.Fragment,{children:[eO&&eO.length>0&&(0,r.jsx)("div",{children:"• 验证信息用于链群服务者验证您的行动完成情况"}),(0,r.jsx)("div",{children:"• 可以随时取回参与的代币"}),eO&&eO.length>0&&(0,r.jsx)("div",{children:"• 加入后可以随时修改验证信息"})]})})]})]}),(0,r.jsx)(V.Z,{isLoading:nm||nx||nA||nk||nE||nS||nw||nP,text:nw||nP?"加入成功，即将跳转...":nm||nA||nE?"提交交易...":"确认交易..."})]}):(0,r.jsx)("div",{className:"flex flex-col items-center px-6 pt-6",children:(0,r.jsx)("p",{className:"text-red-500",children:"链群信息加载失败"})})},ey=t(80332),eb=function(e){var n=e.actionId,t=e.actionInfo,s=e.extensionAddress,l=e.groupId,m=(0,o.useRouter)(),x=((0,i.useContext)(d.M)||{}).token,g=(0,u.m)().address,v=(0,M.Bk)().currentRound,p=(0,Q.Av)({extensionAddress:s,groupId:l,round:v}),B=p.groupDetail,_=p.isPending,Z=p.error,R=(0,f.aB)(s,v||BigInt(0),g),L=R.amount,F=R.error,J=(0,a.dI)(null==x?void 0:x.address,n),G=J.actionInfo,H=J.isPending,O=J.error,K=(0,i.useMemo)(function(){if(!(null==G?void 0:null===(e=G.body)||void 0===e?void 0:e.verificationKeys))return[];var e,n=G.body.verificationKeys,t=G.body.verificationInfoGuides||[];return n.map(function(e,n){return{key:e,guide:t[n]||""}})},[G]),W=(0,i.useMemo)(function(){return K.map(function(e){return e.key})},[K]),X=(0,c.dB)({tokenAddress:null==x?void 0:x.address,actionId:n,account:g,verificationKeys:W.length>0?W:void 0}),q=X.verificationInfos,U=X.isPending,$=X.error,Y=(0,i.useMemo)(function(){var e={};return K.forEach(function(n){e[n.key]=k.Z_().min(1,{message:"".concat(n.key,"不能为空")})}),k.Ry(e)},[K]),ee=(0,A.cI)({resolver:(0,I.F)(Y),defaultValues:K.reduce(function(e,n){return e[n.key]="",e},{}),mode:"onChange"});(0,i.useEffect)(function(){!U&&q&&K.length>0&&K.forEach(function(e,n){var t=q[n];t&&ee.setValue(e.key,t)})},[U,q,K,ee]);var en=(0,ey.kW)(),et=en.updateVerificationInfo,es=en.isPending,er=en.isConfirming,ei=en.isConfirmed,eo=en.writeError;function ea(){return(ea=(0,j._)(function(e){var t;return(0,N.Jh)(this,function(s){switch(s.label){case 0:if(!(null==x?void 0:x.address)||!g)return console.error("Missing required parameters"),[2];s.label=1;case 1:return s.trys.push([1,3,,4]),t=K.map(function(n){return e[n.key]||""}),[4,et(x.address,n,g,t)];case 2:return s.sent(),[3,4];case 3:return console.error("Update verification info failed",s.sent()),[3,4];case 4:return[2]}})})).apply(this,arguments)}(0,i.useEffect)(function(){ei&&(w.Am.success("验证信息提交成功"),setTimeout(function(){m.push("/my/myaction?id=".concat(n,"&symbol=").concat(null==x?void 0:x.symbol))},2e3))},[ei,m,n,null==x?void 0:x.symbol]);var ec=(0,T.b)().handleError;return((0,i.useEffect)(function(){Z&&ec(Z),F&&ec(F),O&&ec(O),eo&&ec(eo),$&&ec($)},[Z,F,O,eo,$,ec]),_||H||U)?(0,r.jsxs)("div",{className:"flex flex-col items-center px-4 pt-6",children:[(0,r.jsx)(h.Z,{}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"加载验证信息..."})]}):B?0===K.length?(0,r.jsxs)("div",{className:"flex flex-col items-center px-6 pt-6",children:[(0,r.jsx)(D.Z,{title:"完成加入"}),(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("div",{className:"text-green-600 text-lg font-medium mb-4",children:"✓ 加入链群成功"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"本行动无需填写验证信息"}),(0,r.jsx)(C.z,{onClick:function(){return m.push("/my/myaction?id=".concat(n,"&symbol=").concat(null==x?void 0:x.symbol))},children:"查看我的参与"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"px-6 pt-6 pb-2",children:[(0,r.jsx)(D.Z,{title:"更新验证信息"}),(0,r.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:[(0,r.jsx)("span",{className:"font-medium",children:"行动："}),(0,r.jsxs)("span",{className:"text-gray-800",children:["#",n.toString()," ",t.body.title]})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:[(0,r.jsx)("span",{className:"font-medium",children:"链群："}),(0,r.jsxs)("span",{className:"text-gray-800",children:["#",B.groupId.toString()," ",B.groupName]})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"font-medium",children:"服务者："}),(0,r.jsx)(eg.Z,{address:B.owner,showCopyButton:!0})]}),L&&L>BigInt(0)&&(0,r.jsxs)("div",{className:"text-sm text-gray-600 mt-2",children:[(0,r.jsx)("span",{className:"font-medium",children:"参与代币数："}),(0,r.jsxs)("span",{className:"text-secondary font-medium",children:[(0,z.LH)(L,2)," ",null==x?void 0:x.symbol]})]})]}),(0,r.jsx)(P.l0,(0,b._)((0,y._)({},ee),{children:(0,r.jsxs)("form",{onSubmit:function(e){return e.preventDefault()},className:"space-y-4 pt-4",children:[K.map(function(e){return(0,r.jsx)(P.Wi,{control:ee.control,name:e.key,render:function(n){var t=n.field;return(0,r.jsxs)(P.xJ,{children:[(0,r.jsxs)(P.lX,{className:"text-greyscale-500 font-normal",children:[e.key,"："]}),(0,r.jsx)(P.NI,{children:e.guide.length>50?(0,r.jsx)(S.g,(0,y._)({placeholder:e.guide||"请输入".concat(e.key),className:"!ring-secondary-foreground min-h-[100px]"},t)):(0,r.jsx)(E.I,(0,y._)({placeholder:e.guide||"请输入".concat(e.key),className:"!ring-secondary-foreground"},t))}),e.guide&&(0,r.jsxs)(P.pf,{className:"text-xs",children:["提示信息：",e.guide]}),(0,r.jsx)(P.zG,{})]})}},e.key)}),(0,r.jsx)("div",{className:"flex justify-center pt-4",children:(0,r.jsx)(C.z,{className:"w-full max-w-xs",disabled:es||er||ei,type:"button",onClick:function(){ee.handleSubmit(function(e){return function(e){return ea.apply(this,arguments)}(e)})()},children:es?"提交中...":er?"确认中...":ei?"已提交":"提交"})})]})})),(0,r.jsxs)("div",{className:"mt-6 text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded px-3 py-2",children:[(0,r.jsx)("div",{className:"font-medium text-gray-700 mb-1",children:"\uD83D\uDCA1 关于验证信息"}),(0,r.jsxs)("div",{className:"space-y-1 text-gray-600",children:[(0,r.jsx)("div",{children:"• 验证信息用于链群服务者验证您的行动完成情况"}),(0,r.jsx)("div",{children:"• 填写准确的信息有助于获得更高的验证分数"}),(0,r.jsx)("div",{children:"• 您可以随时修改验证信息"})]})]})]}),(0,r.jsx)(V.Z,{isLoading:es||er,text:es?"提交交易...":"确认交易..."})]}):(0,r.jsx)("div",{className:"flex flex-col items-center px-6 pt-6",children:(0,r.jsx)("p",{className:"text-red-500",children:"链群信息加载失败"})})},eN=function(e){var n=e.actionId,t=e.actionInfo,s=e.extensionAddress,a=(0,o.useRouter)(),c=((0,i.useContext)(d.M)||{}).token,l=a.query,u=l.tab,f=l.groupId,m=f&&"string"==typeof f?BigInt(f):void 0;return c?(0,r.jsx)(x,{extensionAddress:s,groupId:m,children:"join"===u&&f?(0,r.jsx)(ej,{actionId:n,actionInfo:t,extensionAddress:s,groupId:BigInt(f)}):"update_verification_info"===u&&f?(0,r.jsx)(eb,{actionId:n,actionInfo:t,extensionAddress:s,groupId:BigInt(f)}):(0,r.jsx)(es,{actionId:n,actionInfo:t,extensionAddress:s})}):(0,r.jsx)(h.Z,{})},eI=t(34680),eA=t(19741),ek=function(e){var n=e.actionId,t=e.actionInfo,s=e.extensionAddress,a=(0,o.useRouter)(),c=((0,i.useContext)(d.M)||{}).token,l=(0,u.m)().address,f=(0,W.V)().setError,m=(0,M.Bk)(),x=m.currentRound,g=m.isPending,v=m.error,p=(0,G.Dn)(null==c?void 0:c.address,x||BigInt(0),n),y=p.isActionIdVoted,b=p.isPending,I=p.error,A=(0,eA.aB)(s,l),k=A.joinedRound,_=A.isPending,E=A.error,S=(0,eA.f8)(s,l),P=S.hasActiveGroups,z=S.isPending,Z=S.error,R=k&&k>BigInt(0),L=(0,i.useMemo)(function(){return!1===P},[P]),F=(0,i.useMemo)(function(){var e=(null==c?void 0:c.symbol)?encodeURIComponent(c.symbol):"";return"/stake/stakelp/?symbol=".concat(e)},[null==c?void 0:c.symbol]),J=(0,i.useMemo)(function(){return!!g||!!b||!0===y},[g,b,y]),H=(0,eA.z7)(s),O=H.join,K=H.isPending,X=H.isConfirming,q=H.isConfirmed,U=H.writeError;function Y(){return(Y=(0,j._)(function(){return(0,N.Jh)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,O([])];case 1:return e.sent(),[3,3];case 2:return console.error("Join failed",e.sent()),[3,3];case 3:return[2]}})})).apply(this,arguments)}(0,i.useEffect)(function(){q&&(w.Am.success("加入链群服务行动成功"),setTimeout(function(){a.push("/my/myaction?id=".concat(n.toString(),"&symbol=").concat(null==c?void 0:c.symbol))},1e3))},[q,a,n,null==c?void 0:c.symbol]);var Q=(0,T.b)().handleError;return((0,i.useEffect)(function(){E&&Q(E),U&&Q(U),v&&Q(v),I&&Q(I),Z&&Q(Z)},[E,U,v,I,Z,Q]),(0,i.useEffect)(function(){g||b||!1!==y||f({name:"无法参加",message:"当前行动未投票，不能参加"})},[g,b,y,f]),_)?(0,r.jsxs)("div",{className:"flex flex-col items-center px-4 pt-6",children:[(0,r.jsx)(h.Z,{}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"加载行动信息..."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"px-6 pt-6 pb-2",children:[(0,r.jsx)(D.Z,{title:"加入链群服务行动："}),(0,r.jsx)(eI.Ol,{className:"mt-4 px-3 pt-2 pb-1 flex-row justify-between items-baseline",children:(0,r.jsxs)("div",{className:"flex items-baseline",children:[(0,r.jsx)("span",{className:"text-greyscale-400 text-sm",children:"No."}),(0,r.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(n)}),(0,r.jsx)("span",{className:"font-bold text-greyscale-800",children:t.body.title})]})}),R&&(0,r.jsxs)("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,r.jsx)("div",{className:"text-sm text-blue-700",children:(0,r.jsx)("span",{className:"font-medium",children:"✓ 您已加入此链群服务行动"})}),(0,r.jsxs)("div",{className:"text-xs text-blue-600 mt-1",children:["加入轮次：#",null==k?void 0:k.toString()]})]}),(0,r.jsx)("div",{className:"flex justify-center pt-6",children:(0,r.jsx)(C.z,{className:"w-full max-w-md",disabled:R||K||X||q||!J||L&&!z,type:"button",onClick:function(){return Y.apply(this,arguments)},children:K?"提交中...":X?"确认中...":q?"已加入":R?"已加入此行动":L&&!z?"没有激活链群，无法加入":"确认加入"})}),L&&!z?(0,r.jsxs)("div",{className:"mt-6 text-sm text-red-700 bg-red-50 border border-red-200 rounded px-3 py-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 font-medium text-red-700 mb-1",children:[(0,r.jsx)(B.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"如何激活链群："})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{children:["1. 铸造链群NFT"," ",(0,r.jsx)($(),{href:"/group/groupids/",className:"underline font-medium",children:"去铸造 >"})]}),(0,r.jsxs)("div",{children:["2. 成为治理者"," ",(0,r.jsx)($(),{href:F,className:"underline font-medium",children:"去质押获取治理票 >"})]}),(0,r.jsx)("div",{children:"3. 选择对应行动，在行动下激活链群"})]})]}):(0,r.jsxs)("div",{className:"mt-6 text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded px-3 py-2",children:[(0,r.jsx)("div",{className:"font-medium text-gray-700 mb-1",children:"\uD83D\uDCA1 小贴士"}),(0,r.jsxs)("div",{className:"space-y-1 text-gray-600",children:[(0,r.jsx)("div",{children:"• 有激活链群的地址，才可参加本行动"}),(0,r.jsx)("div",{children:"• 可在验证阶段设置激励分配地址和比例"})]})]})]}),(0,r.jsx)(V.Z,{isLoading:K||X,text:K?"提交交易...":"确认交易..."})]})},ew=function(e){var n=e.actionId,t=e.actionInfo,s=e.extensionAddress,i=e.factory,o=i?(0,J.qD)(i):null;if(!o)return(0,r.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,r.jsx)("div",{className:"text-center text-gray-500",children:(0,r.jsx)("p",{children:"该扩展类型暂不支持行动加入"})})});switch(o.type){case J.nw.LP:return(0,r.jsx)(q,{actionId:n,actionInfo:t,extensionAddress:s});case J.nw.GROUP_ACTION:return(0,r.jsx)(eN,{actionId:n,actionInfo:t,extensionAddress:s});case J.nw.GROUP_SERVICE:return(0,r.jsx)(ek,{actionId:n,actionInfo:t,extensionAddress:s});default:return(0,r.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,r.jsx)("div",{className:"text-center text-gray-500",children:(0,r.jsx)("p",{children:"该扩展类型暂不支持行动加入"})})})}},eB=function(){var e=(0,o.useRouter)().query,n=e.id,t=e.groupId,u=(0,s._)((0,i.useState)(void 0),2),f=u[0],m=u[1],g=((0,i.useContext)(d.M)||{}).token,j=(0,a.dI)(null==g?void 0:g.address,void 0===n?void 0:BigInt(n)),y=j.actionInfo,b=j.isPending,N=j.error,I=(0,c.kz)({tokenAddress:null==g?void 0:g.address,actionInfo:y}),A=I.contractInfo,k=I.isPending,w=I.error,B=(0,l.S)().handleContractError;(0,i.useEffect)(function(){N&&B(N,"submit"),w&&B(w,"extension")},[N,w]);var C=t&&"string"==typeof t?BigInt(t):void 0;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(v.Z,{title:"加入行动",showBackButton:!0}),(0,r.jsx)("main",{className:"flex-grow",children:!n||Array.isArray(n)||b||k?(0,r.jsx)(h.Z,{}):(0,r.jsx)(x,{extensionAddress:null==A?void 0:A.extension,groupId:C,children:(null==A?void 0:A.isExtension)&&(null==A?void 0:A.extension)&&(null==A?void 0:A.factory)?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(ew,{actionId:BigInt(n),actionInfo:y,extensionAddress:A.extension,factory:A.factory.address})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.Z,{actionId:BigInt(n),actionInfo:y,onStakedAmountChange:function(e){m(e)},showJoinButton:!1}),(0,r.jsx)(F,{actionInfo:y,stakedAmount:f})]})})})]})}}},function(e){e.O(0,[8501,4463,721,3798,8139,3494,3591,9419,8300,2112,5611,7966,6268,8945,6097,8886,5293,9330,7974,7568,1879,1927,3439,2888,9774,179],function(){return e(e.s=66030)}),_N_E=e.O()}]);