(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9063],{18449:(e,r,t)=>{"use strict";t.d(r,{X:()=>a});var s=t(76200);class n extends s.C{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function a(e,r){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new n({value:e});let[t,s="0"]=e.split("."),a=t.startsWith("-");if(a&&(t=t.slice(1)),s=s.replace(/(0+)$/,""),0===r)1===Math.round(Number(`.${s}`))&&(t=`${BigInt(t)+1n}`),s="";else if(s.length>r){let[e,n,a]=[s.slice(0,r-1),s.slice(r-1,r),s.slice(r)],i=Math.round(Number(`${n}.${a}`));(s=i>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${i}`).length>r&&(s=s.slice(1),t=`${BigInt(t)+1n}`),s=s.slice(0,r)}else s=s.padEnd(r,"0");return BigInt(`${a?"-":""}${t}${s}`)}},28529:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>J});var s=t(40854),n=t(37876),a=t(14232),i=t(89099),o=t(62212),l=t(64115),c=t(17660),d=t(20451),u=t(83416),m=t(92101),f=t(60154),x=t(12293),v=t(22605),h=t(16927),b=t(3576),p=t(62701),g=t(4902),j=t(13810),N=t(88992),y=t(22442),I=t(8047),w=t(97685),_=t(6960),C=t(7446),k=t(77932),A=t(40150),S=t(92659),E=t(42038),R=t(20442),B=t(9215),F=t(44769),$=t(1709),M=t(99574);let D=e=>{var r,t=e.actionInfo,o=e.stakedAmount,l=(0,i.useRouter)(),m=((0,a.useContext)(u.N)||{}).token,f=(0,I.F)(),v=f.address,D=f.chain,J=(0,B.lW)(null==m?void 0:m.address,v),P=J.balance,X=J.error,T=(0,B.Gp)(null==m?void 0:m.address,v,"0x5b31D8A0676Ae756BF9CF5591bB2a9E8aB65F925"),z=T.allowance,Y=T.isPending,K=T.error,O=(0,F.IJ)((null==m?void 0:m.address)||"",BigInt(t.head.id),v),V=O.verificationKeys,H=O.verificationInfos,L=O.isPending,W=O.error,G=(0,s._)((0,a.useState)(!1),2),q=G[0],Q=G[1],U=y.Ik({additionalStakeAmount:y.Yj().refine(e=>""===e.trim()||/^[0-9]+(?:,[0-9]{3})*(?:\.[0-9]+)?$/.test(e.trim()),{message:"请输入合法的数字格式"}).transform(e=>""===e.trim()?"0":e.trim().replace(/,/g,"")).refine(e=>"0"!==e,{message:"参与代币数不能为 0"}).refine(e=>{var r=(0,R.XS)(e);return o&&o>0n?null!==r&&r>0n:null!==r&&r>=BigInt(t.body.minStake)},{message:"参与代币数不能小于最小参与限制"}).refine(e=>{var r=(0,R.XS)(e);return null!==r&&void 0!==P&&r<=P},{message:"您的代币余额不足"}),verificationInfos:y.YO(y.Yj().min(1,{message:"验证信息不能为空"}))}),Z=t.body.verificationKeys.map(()=>""),ee=(0,N.mN)({resolver:(0,j.u)(U),defaultValues:{additionalStakeAmount:"",verificationInfos:Z},mode:"onChange"});(0,a.useEffect)(()=>{if(H&&H.length>0&&V){var e={};V.forEach((r,t)=>{e[r]=H[t]});var r=t.body.verificationKeys.map(r=>{var t;return null!=(t=e[r])?t:""});ee.setValue("verificationInfos",r)}},[H,V,ee,t.body.verificationKeys]);var er=(0,B.zH)(null==m?void 0:m.address),et=er.approve,es=er.isPending,en=er.isConfirming,ea=er.isConfirmed,ei=er.writeError,eo=(0,a.useRef)(null),el=(0,a.useRef)(Y);(0,a.useEffect)(()=>{el.current&&!Y&&eo.current&&eo.current.blur(),el.current=Y},[Y]),(0,a.useEffect)(()=>{ea&&(Q(!0),w.oR.success("授权".concat(null==m?void 0:m.symbol,"成功")))},[ea,null==m?void 0:m.symbol]);var ec=ee.watch("additionalStakeAmount"),ed=null!=(r=(0,R.XS)(ec||"0"))?r:0n;(0,a.useEffect)(()=>{ed>0n&&z&&z>0n&&z>=ed?Q(!0):Q(!1)},[ed,Y,z]);var eu=(0,c.o9)(),em=eu.join,ef=eu.isPending,ex=eu.isConfirming,ev=eu.isConfirmed,eh=eu.writeError;(0,a.useEffect)(()=>{ev&&(w.oR.success("加入成功"),ee.reset(),setTimeout(()=>{l.push("/action/detail?id=".concat(t.head.id,"&type=join&symbol=").concat(null==m?void 0:m.symbol))},2e3))},[ev]);var eb=(0,d.g)().handleContractError;return((0,a.useEffect)(()=>{X&&eb(X,"token"),W&&eb(W,"join"),ei&&eb(ei,"token"),eh&&eb(eh,"join"),K&&eb(K,"token")},[X,W,ei,eh,K]),L)?(0,n.jsx)(x.A,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"px-6 pt-0 pb-2",children:[(0,n.jsx)($.A,{title:o?"增加参与代币":"参与行动"}),(0,n.jsx)(S.lV,(0,p._)((0,b._)({},ee),{children:(0,n.jsxs)("form",{onSubmit:e=>e.preventDefault(),className:"space-y-4",children:[(0,n.jsx)(S.zB,{control:ee.control,name:"additionalStakeAmount",render:e=>{var r=e.field;return(0,n.jsxs)(S.eI,{children:[(0,n.jsx)(S.lR,{className:"text-greyscale-500 font-normal",children:o?"":"参与代币数："}),(0,n.jsx)(S.MJ,{children:(0,n.jsx)(k.p,(0,b._)({placeholder:o?"最大可追加 ".concat((0,R.NJ)(P||0n)):"最小参与代币数 ".concat((0,R.NJ)(BigInt(t.body.minStake))),type:"number",disabled:!P||P<=0n,className:"!ring-secondary-foreground"},r))}),(0,n.jsx)(S.C5,{}),(0,n.jsxs)(S.Rr,{className:"flex items-center",children:[(0,n.jsxs)("span",{children:["共有 ",(0,n.jsx)("span",{className:"text-secondary",children:(0,R.NJ)(P||0n)})," ",null==m?void 0:m.symbol]}),(0,n.jsx)(_.$,{type:"button",variant:"link",size:"sm",onClick:()=>{P&&P>0n&&ee.setValue("additionalStakeAmount",(0,R.Js)(P))},className:"text-secondary p-0 ml-6",disabled:!P||P<=0n,children:"全部"})]})]})}}),t.body.verificationKeys.map((e,r)=>(0,n.jsx)(S.zB,{control:ee.control,name:"verificationInfos.".concat(r),render:s=>{var a=s.field;return(0,n.jsxs)(S.eI,{children:[(0,n.jsx)(S.lR,{className:"text-greyscale-500 font-normal",children:e}),(0,n.jsx)(S.MJ,{children:(0,n.jsx)(A.T,(0,b._)({placeholder:t.body.verificationInfoGuides[r]||"",className:"!ring-secondary-foreground"},a))}),(0,n.jsx)(S.C5,{})]})}},e+r)),(0,n.jsxs)("div",{className:"flex justify-center space-x-4 pt-2",children:[(0,n.jsx)(_.$,{ref:eo,className:"w-1/2",disabled:Y||es||en||q,type:"button",onClick:()=>{ee.handleSubmit(e=>(0,h._)(function(){var r,t;return(0,g.YH)(this,function(s){switch(s.label){case 0:if(!(0,E.C)(D))return[2];if(0n===(t=null!=(r=(0,R.XS)(e.additionalStakeAmount))?r:0n)&&o&&o>0n)return w.oR.error("当前无需授权。"),[2];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,et("0x5b31D8A0676Ae756BF9CF5591bB2a9E8aB65F925",t)];case 2:return s.sent(),[3,4];case 3:return console.error("Approve failed",s.sent()),[3,4];case 4:return[2]}})})())()},children:Y?(0,n.jsx)(C.A,{className:"animate-spin"}):es?"1.提交中...":en?"1.确认中...":q?"1.".concat(null==m?void 0:m.symbol,"已授权"):"1.授权".concat(null==m?void 0:m.symbol)}),(0,n.jsx)(_.$,{className:"w-1/2",disabled:!q||ef||ex||ev,type:"button",onClick:()=>{ee.handleSubmit(e=>(function(e){return(0,h._)(function(){var r,s,n;return(0,g.YH)(this,function(a){switch(a.label){case 0:if(!(0,E.C)(D))return[2];a.label=1;case 1:if(a.trys.push([1,3,,4]),r=!H||H.every(e=>!e||""===e.trim()),s=e.verificationInfos,!r&&H&&V)V.length===e.verificationInfos.length&&V.every((r,t)=>{var s=V.indexOf(r);return s>=0&&H[s]===e.verificationInfos[t]})&&(s=[]);else if(r&&e.verificationInfos.some(e=>!e||""===e.trim()))return w.oR.error("首次提交需要填写所有验证信息"),[2];return[4,em(null==m?void 0:m.address,BigInt(t.head.id),null!=(n=(0,R.XS)(e.additionalStakeAmount))?n:0n,s)];case 2:return a.sent(),[3,4];case 3:return console.error("Join failed",a.sent()),[3,4];case 4:return[2]}})})()})(e))()},children:ef?"2.提交中...":ex?"2.确认中...":ev?"2.已加入":"2.加入"})]})]})}))]}),(0,n.jsx)("div",{className:"px-6 pt-0 pb-4",children:(0,n.jsx)("div",{className:"text-greyscale-500 text-sm",children:"提示：加入行动后，可以随时取回参与代币，无等待期"})}),(0,n.jsx)(M.A,{isLoading:es||en||ef||ex,text:es||ef?"提交交易...":"确认交易..."})]})},J=()=>{var e=(0,i.useRouter)().query.id,r=(0,s._)((0,a.useState)(void 0),2),t=r[0],h=r[1],b=((0,a.useContext)(u.N)||{}).token,p=(0,c.vC)(),g=p.currentRound,j=p.isPending,N=p.error,y=(0,l.Y4)(null==b?void 0:b.address,void 0===e?void 0:BigInt(e)),I=y.actionInfo,w=y.isPending,_=y.error,C=(0,d.g)().handleContractError;return(0,a.useEffect)(()=>{N&&C(N,"join"),_&&C(_,"submit")},[N,_]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.A,{title:"加入行动"}),(0,n.jsx)("main",{className:"flex-grow",children:!e||Array.isArray(e)||w||j?(0,n.jsx)(x.A,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v.A,{actionId:BigInt(e),onRoundChange:()=>{},actionInfo:I,onStakedAmountChange:function(e){h(e)},showJoinButton:!1}),(0,n.jsx)(D,{actionInfo:I,stakedAmount:t}),(0,n.jsx)("div",{className:"flex flex-col w-full p-4",children:(0,n.jsxs)("div",{className:"bg-blue-50/30 border-l-4 border-l-blue-50 rounded-r-lg p-4 mb-8 text-sm",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 text-base font-bold text-blue-800 pb-2",children:[(0,n.jsx)(o.A,{className:"w-4 h-4"}),"提示"]}),(0,n.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"行动激励："}),(0,n.jsx)("div",{className:"text-sm text-blue-700",children:"1、验证阶段会随机抽取地址验证打分，然后按得分比例给这些地址分配代币激励"}),(0,n.jsx)("div",{className:"text-sm text-blue-700",children:"2、只有当1个行动获得的验证票数，达到该轮总投票数5%时，参与该行动才有激励"}),(0,n.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"参与代币："}),(0,n.jsx)("div",{className:"text-sm text-blue-700",children:"1、参与代币越多，被选中验证并获得奖励的概率越大"}),(0,n.jsx)("div",{className:"text-sm text-blue-700",children:"2、参与的代币可随时取回，如不取回则自动参与此行动的后续轮次"})]})}),(0,n.jsx)(m.A,{actionId:BigInt(e),round:g,showSubmitter:!1})]})})]})}},33676:(e,r,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/acting/join",function(){return t(28529)}])},40150:(e,r,t)=>{"use strict";t.d(r,{T:()=>l});var s=t(3576),n=t(65699),a=t(37876),i=t(14232),o=t(30684),l=i.forwardRef((e,r)=>{var t=e.className,i=(0,n._)(e,["className"]);return(0,a.jsx)("textarea",(0,s._)({className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r},i))});l.displayName="Textarea"},42038:(e,r,t)=>{"use strict";t.d(r,{C:()=>n});var s=t(97685),n=e=>!!e||(s.oR.error("请先将钱包链接 ".concat("thinkium70001")),!1)},62212:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});var s=(0,t(11713).A)("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},92659:(e,r,t)=>{"use strict";t.d(r,{lV:()=>h,MJ:()=>I,Rr:()=>w,zB:()=>p,eI:()=>N,lR:()=>y,C5:()=>_});var s=t(81110),n=t(40120),a=t(3576),i=t(62701),o=t(65699),l=t(37876),c=t(14232),d=t(82987),u=t(88992),m=t(30684),f=t(59773),x=(0,t(47137).F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),v=c.forwardRef((e,r)=>{var t=e.className,s=(0,o._)(e,["className"]);return(0,l.jsx)(f.b,(0,a._)({ref:r,className:(0,m.cn)(x(),t)},s))});v.displayName=f.b.displayName;var h=u.Op,b=c.createContext({}),p=e=>{var r=(0,s._)({},(0,n._)(e));return(0,l.jsx)(b.Provider,{value:{name:r.name},children:(0,l.jsx)(u.xI,(0,a._)({},r))})},g=()=>{var e=c.useContext(b),r=c.useContext(j),t=(0,u.xW)(),s=t.getFieldState,n=t.formState,i=s(e.name,n);if(!e)throw Error("useFormField should be used within <FormField>");var o=r.id;return(0,a._)({id:o,name:e.name,formItemId:"".concat(o,"-form-item"),formDescriptionId:"".concat(o,"-form-item-description"),formMessageId:"".concat(o,"-form-item-message")},i)},j=c.createContext({}),N=c.forwardRef((e,r)=>{var t=e.className,s=(0,o._)(e,["className"]),n=c.useId();return(0,l.jsx)(j.Provider,{value:{id:n},children:(0,l.jsx)("div",(0,a._)({ref:r,className:(0,m.cn)("space-y-2",t)},s))})});N.displayName="FormItem";var y=c.forwardRef((e,r)=>{var t=e.className,s=(0,o._)(e,["className"]),n=g(),i=n.error,c=n.formItemId;return(0,l.jsx)(v,(0,a._)({ref:r,className:(0,m.cn)(i&&"text-destructive",t),htmlFor:c},s))});y.displayName="FormLabel";var I=c.forwardRef((e,r)=>{var t=(0,s._)({},(0,n._)(e)),i=g(),o=i.error,c=i.formItemId,u=i.formDescriptionId,m=i.formMessageId;return(0,l.jsx)(d.DX,(0,a._)({ref:r,id:c,"aria-describedby":o?"".concat(u," ").concat(m):"".concat(u),"aria-invalid":!!o},t))});I.displayName="FormControl";var w=c.forwardRef((e,r)=>{var t=e.className,s=(0,o._)(e,["className"]),n=g().formDescriptionId;return(0,l.jsx)("p",(0,a._)({ref:r,id:n,className:(0,m.cn)("text-sm text-muted-foreground",t)},s))});w.displayName="FormDescription";var _=c.forwardRef((e,r)=>{var t=e.className,s=e.children,n=(0,o._)(e,["className","children"]),c=g(),d=c.error,u=c.formMessageId,f=d?String(null==d?void 0:d.message):s;return f?(0,l.jsx)("p",(0,i._)((0,a._)({ref:r,id:u,className:(0,m.cn)("text-sm font-medium text-destructive",t)},n),{children:f})):null});_.displayName="FormMessage"},99574:(e,r,t)=>{"use strict";t.d(r,{A:()=>i});var s=t(37876),n=t(14232),a=t(7446);let i=e=>{var r=e.isLoading,t=e.text;return((0,n.useEffect)(()=>{if(r){var e=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}}},[r]),r)?(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50 touch-none overscroll-none",onTouchMove:e=>{e.preventDefault()},onTouchStart:e=>{e.preventDefault()},style:{touchAction:"none"},children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(a.A,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,s.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:void 0===t?"Loading":t})]})}):null}}},e=>{e.O(0,[3308,6547,8230,9985,154,3096,4769,5139,4115,7432,1217,636,6593,8792],()=>e(e.s=33676)),_N_E=e.O()}]);