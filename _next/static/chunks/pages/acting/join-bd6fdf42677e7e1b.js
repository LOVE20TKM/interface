try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="7c47c4d8-8d72-4bf5-88eb-7f4c9defbc1b",e._sentryDebugIdIdentifier="sentry-dbid-7c47c4d8-8d72-4bf5-88eb-7f4c9defbc1b")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3487],{66030:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/acting/join",function(){return t(33407)}])},74193:function(e,n,t){"use strict";t.d(n,{NI:function(){return j},Wi:function(){return b},l0:function(){return x},lX:function(){return y},pf:function(){return N},xJ:function(){return p},zG:function(){return I}});var r=t(34788),i=t(12796),s=t(72253),a=t(14932),o=t(47702),c=t(85893),l=t(67294),d=t(88426),u=t(87536),f=t(40108),m=t(94193),x=u.RV,v=l.createContext({}),b=function(e){var n=(0,r._)({},(0,i._)(e));return(0,c.jsx)(v.Provider,{value:{name:n.name},children:(0,c.jsx)(u.Qr,(0,s._)({},n))})},h=function(){var e=l.useContext(v),n=l.useContext(g),t=(0,u.Gc)(),r=t.getFieldState,i=t.formState,a=r(e.name,i);if(!e)throw Error("useFormField should be used within <FormField>");var o=n.id;return(0,s._)({id:o,name:e.name,formItemId:"".concat(o,"-form-item"),formDescriptionId:"".concat(o,"-form-item-description"),formMessageId:"".concat(o,"-form-item-message")},a)},g=l.createContext({}),p=l.forwardRef(function(e,n){var t=e.className,r=(0,o._)(e,["className"]),i=l.useId();return(0,c.jsx)(g.Provider,{value:{id:i},children:(0,c.jsx)("div",(0,s._)({ref:n,className:(0,f.cn)("space-y-2",t)},r))})});p.displayName="FormItem";var y=l.forwardRef(function(e,n){var t=e.className,r=(0,o._)(e,["className"]),i=h(),a=i.error,l=i.formItemId;return(0,c.jsx)(m._,(0,s._)({ref:n,className:(0,f.cn)(a&&"text-destructive",t),htmlFor:l},r))});y.displayName="FormLabel";var j=l.forwardRef(function(e,n){var t=(0,r._)({},(0,i._)(e)),a=h(),o=a.error,l=a.formItemId,u=a.formDescriptionId,f=a.formMessageId;return(0,c.jsx)(d.g7,(0,s._)({ref:n,id:l,"aria-describedby":o?"".concat(u," ").concat(f):"".concat(u),"aria-invalid":!!o},t))});j.displayName="FormControl";var N=l.forwardRef(function(e,n){var t=e.className,r=(0,o._)(e,["className"]),i=h().formDescriptionId;return(0,c.jsx)("p",(0,s._)({ref:n,id:i,className:(0,f.cn)("text-sm text-muted-foreground",t)},r))});N.displayName="FormDescription";var I=l.forwardRef(function(e,n){var t=e.className,r=e.children,i=(0,o._)(e,["className","children"]),l=h(),d=l.error,u=l.formMessageId,m=d?String(null==d?void 0:d.message):r;return m?(0,c.jsx)("p",(0,a._)((0,s._)({ref:n,id:u,className:(0,f.cn)("text-sm font-medium text-destructive",t)},i),{children:m})):null});I.displayName="FormMessage"},94193:function(e,n,t){"use strict";t.d(n,{_:function(){return u}});var r=t(72253),i=t(47702),s=t(85893),a=t(67294),o=t(49102),c=t(12003),l=t(40108),d=(0,c.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),u=a.forwardRef(function(e,n){var t=e.className,a=(0,i._)(e,["className"]);return(0,s.jsx)(o.f,(0,r._)({ref:n,className:(0,l.cn)(d(),t)},a))});u.displayName=o.f.displayName},76453:function(e,n,t){"use strict";t.d(n,{g:function(){return c}});var r=t(72253),i=t(47702),s=t(85893),a=t(67294),o=t(40108),c=a.forwardRef(function(e,n){var t=e.className,a=(0,i._)(e,["className"]);return(0,s.jsx)("textarea",(0,r._)({className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:n},a))});c.displayName="Textarea"},67997:function(e,n,t){"use strict";t.d(n,{Z:function(){return r}});var r=(0,t(31134).Z)("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},33407:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return P}});var r=t(91309),i=t(85893),s=t(67294),a=t(11163),o=t(67997),c=t(93566),l=t(73591),d=t(26858),u=t(93778),f=t(83494),m=t(42083),x=t(31729),v=t(11010),b=t(72253),h=t(14932),g=t(97582),p=t(56312),y=t(87536),j=t(63448),N=t(42130),I=t(86501),_=t(27245),w=t(23432),k=t(21774),B=t(76453),A=t(74193),C=t(85794),E=t(20442),S=t(93950),F=t(26952),R=t(64777),z=t(44576),Z=function(e){var n,t=e.actionInfo,o=e.stakedAmount,c=(0,a.useRouter)(),f=((0,s.useContext)(u.M)||{}).token,x=(0,N.m)().address,Z=(0,C.hS)(null==f?void 0:f.address,x),P=Z.balance,D=Z.error,M=(0,C.yG)(null==f?void 0:f.address,x,"0xACea4f086BE05BeA47f3A56788FA3919C7f40799"),L=M.allowance,G=M.isPending,J=M.error,T=(0,S.Cv)((null==f?void 0:f.address)||"",BigInt(t.head.id),x),X=T.verificationKeys,H=T.verificationInfos,K=T.isPending,V=T.error,O=(0,E.PL)((null==f?void 0:f.address)||"",BigInt(t.head.id)),W=O.joinedAmountByActionId,q=O.error,Q=(0,r._)((0,s.useState)(!1),2),$=Q[0],U=Q[1],Y=W&&W>BigInt(0)?(0,F.h3)(W,Number(t.body.maxRandomAccounts||0)):BigInt(0),ee=j.Ry({additionalStakeAmount:j.Z_().refine(function(e){return""===e.trim()||/^[0-9]+(?:,[0-9]{3})*(?:\.[0-9]+)?$/.test(e.trim())},{message:"请输入合法的数字格式"}).transform(function(e){return""===e.trim()?"0":e.trim().replace(/,/g,"")}).refine(function(e){return"0"!==e},{message:"参与代币数不能为 0"}).refine(function(e){var n=(0,d.vz)(e);return o&&o>BigInt(0)?null!==n&&n>BigInt(0):null!==n&&n>=BigInt(t.body.minStake)},{message:"参与代币数不能小于最小参与限制"}).refine(function(e){var n=(0,d.vz)(e);return null!==n&&void 0!==P&&n<=P},{message:"您的代币余额不足"}),verificationInfos:j.IX(j.Z_().min(1,{message:"验证信息不能为空"}))}),en=t.body.verificationKeys.map(function(){return""}),et=(0,y.cI)({resolver:(0,p.F)(ee),defaultValues:{additionalStakeAmount:"",verificationInfos:en},mode:"onChange"});(0,s.useEffect)(function(){if(H&&H.length>0&&X){var e={};X.forEach(function(n,t){e[n]=H[t]});var n=t.body.verificationKeys.map(function(n){var t;return null!==(t=e[n])&&void 0!==t?t:""});et.setValue("verificationInfos",n)}},[H,X,et,t.body.verificationKeys]);var er=(0,C.yA)(null==f?void 0:f.address),ei=er.approve,es=er.isPending,ea=er.isConfirming,eo=er.isConfirmed,ec=er.writeError,el=(0,s.useRef)(null),ed=(0,s.useRef)(G);function eu(){return(eu=(0,v._)(function(e){var n,t;return(0,g.Jh)(this,function(r){switch(r.label){case 0:if((t=null!==(n=(0,d.vz)(e.additionalStakeAmount))&&void 0!==n?n:BigInt(0))===BigInt(0)&&o&&o>BigInt(0))return I.Am.error("当前无需授权。"),[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,ei("0xACea4f086BE05BeA47f3A56788FA3919C7f40799",t)];case 2:case 3:return r.sent(),[3,4];case 4:return[2]}})})).apply(this,arguments)}(0,s.useEffect)(function(){ed.current&&!G&&el.current&&el.current.blur(),ed.current=G},[G]),(0,s.useEffect)(function(){eo&&(U(!0),I.Am.success("授权".concat(null==f?void 0:f.symbol,"成功")))},[eo,null==f?void 0:f.symbol]);var ef=et.watch("additionalStakeAmount"),em=null!==(n=(0,d.vz)(ef||"0"))&&void 0!==n?n:BigInt(0);(0,s.useEffect)(function(){em>BigInt(0)&&L&&L>BigInt(0)&&L>=em?U(!0):U(!1)},[em,G,L]);var ex=(0,E.z7)(),ev=ex.join,eb=ex.isPending,eh=ex.isConfirming,eg=ex.isConfirmed,ep=ex.writeError;function ey(){return(ey=(0,v._)(function(e){var n,r,i;return(0,g.Jh)(this,function(s){switch(s.label){case 0:if(s.trys.push([0,2,,3]),n=!H||H.every(function(e){return!e||""===e.trim()}),r=e.verificationInfos,!n&&H&&X)X.length===e.verificationInfos.length&&X.every(function(n,t){var r=X.indexOf(n);return r>=0&&H[r]===e.verificationInfos[t]})&&(r=[]);else if(n&&e.verificationInfos.some(function(e){return!e||""===e.trim()}))return I.Am.error("首次提交需要填写所有验证信息"),[2];return[4,ev(null==f?void 0:f.address,BigInt(t.head.id),null!==(i=(0,d.vz)(e.additionalStakeAmount))&&void 0!==i?i:BigInt(0),r)];case 1:case 2:return s.sent(),[3,3];case 3:return[2]}})})).apply(this,arguments)}(0,s.useEffect)(function(){eg&&(I.Am.success("加入成功"),et.reset(),setTimeout(function(){c.push("/my/myaction?id=".concat(t.head.id,"&symbol=").concat(null==f?void 0:f.symbol))},2e3))},[eg]);var ej=(0,l.S)().handleContractError;return((0,s.useEffect)(function(){D&&ej(D,"token"),V&&ej(V,"join"),ec&&ej(ec,"token"),ep&&ej(ep,"join"),J&&ej(J,"token"),q&&ej(q,"join")},[D,V,ec,ep,J,q]),K)?(0,i.jsx)(m.Z,{}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"px-6 pt-6 pb-2",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,i.jsx)(R.Z,{title:o?"增加参与代币":"参与行动"}),Y>BigInt(0)&&!o&&(0,i.jsxs)("span",{className:"text-sm text-gray-500",children:["（要100%概率被抽中，需"," ",(0,i.jsxs)("span",{className:"text-secondary",children:[" ",(0,d.LH)(Y,4,"ceil")]})," 代币）"]})]}),(0,i.jsx)(A.l0,(0,h._)((0,b._)({},et),{children:(0,i.jsxs)("form",{onSubmit:function(e){return e.preventDefault()},className:"space-y-4",children:[(0,i.jsx)(A.Wi,{control:et.control,name:"additionalStakeAmount",render:function(e){var n=e.field;return(0,i.jsxs)(A.xJ,{children:[(0,i.jsx)(A.lX,{className:"text-greyscale-500 font-normal",children:o?"":"参与代币数："}),(0,i.jsx)(A.NI,{children:(0,i.jsx)(k.I,(0,b._)({placeholder:o?"最大可追加 ".concat((0,d.LH)(P||BigInt(0))):"最小参与代币数 ".concat((0,d.LH)(BigInt(t.body.minStake))),type:"number",disabled:!P||P<=BigInt(0),className:"!ring-secondary-foreground"},n))}),(0,i.jsx)(A.zG,{}),(0,i.jsxs)(A.pf,{className:"flex items-center",children:[(0,i.jsxs)("span",{children:["共有 ",(0,i.jsx)("span",{className:"text-secondary",children:(0,d.LH)(P||BigInt(0))})," ",null==f?void 0:f.symbol]}),(0,i.jsx)(_.z,{type:"button",variant:"link",size:"sm",onClick:function(){P&&P>BigInt(0)&&et.setValue("additionalStakeAmount",(0,d.bM)(P))},className:"text-secondary p-0 ml-6",disabled:!P||P<=BigInt(0),children:"全部"})]})]})}}),t.body.verificationKeys.map(function(e,n){return(0,i.jsx)(A.Wi,{control:et.control,name:"verificationInfos.".concat(n),render:function(r){var s=r.field;return(0,i.jsxs)(A.xJ,{children:[(0,i.jsx)(A.lX,{className:"text-greyscale-500 font-normal",children:e}),(0,i.jsx)(A.NI,{children:(0,i.jsx)(B.g,(0,b._)({placeholder:t.body.verificationInfoGuides[n]||"",className:"!ring-secondary-foreground"},s))}),(0,i.jsx)(A.zG,{})]})}},e+n)}),(0,i.jsxs)("div",{className:"flex justify-center space-x-4 pt-2",children:[(0,i.jsx)(_.z,{ref:el,className:"w-1/2",disabled:G||es||ea||$,type:"button",onClick:function(){et.handleSubmit(function(e){return function(e){return eu.apply(this,arguments)}(e)})()},children:G?(0,i.jsx)(w.Z,{className:"animate-spin"}):es?"1.提交中...":ea?"1.确认中...":$?"1.".concat(null==f?void 0:f.symbol,"已授权"):"1.授权".concat(null==f?void 0:f.symbol)}),(0,i.jsx)(_.z,{className:"w-1/2",disabled:!$||eb||eh||eg,type:"button",onClick:function(){et.handleSubmit(function(e){return function(e){return ey.apply(this,arguments)}(e)})()},children:eb?"2.提交中...":eh?"2.确认中...":eg?"2.已加入":"2.加入"})]})]})}))]}),(0,i.jsx)("div",{className:"px-6 pt-0 pb-4",children:(0,i.jsx)("div",{className:"text-greyscale-500 text-sm",children:"提示：加入行动后，可以随时取回参与代币，无等待期"})}),(0,i.jsx)(z.Z,{isLoading:es||ea||eb||eh,text:es||eb?"提交交易...":"确认交易..."})]})},P=function(){var e=(0,a.useRouter)().query.id,n=(0,r._)((0,s.useState)(void 0),2),t=n[0],v=n[1],b=((0,s.useContext)(u.M)||{}).token,h=(0,c.dI)(null==b?void 0:b.address,void 0===e?void 0:BigInt(e)),g=h.actionInfo,p=h.isPending,y=h.error,j=(0,l.S)().handleContractError;return(0,s.useEffect)(function(){y&&j(y,"submit")},[y]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f.Z,{title:"加入行动",showBackButton:!0}),(0,i.jsx)("main",{className:"flex-grow",children:!e||Array.isArray(e)||p?(0,i.jsx)(m.Z,{}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.Z,{actionId:BigInt(e),actionInfo:g,onStakedAmountChange:function(e){v(e)},showJoinButton:!1}),(0,i.jsx)(Z,{actionInfo:g,stakedAmount:t}),(0,i.jsx)("div",{className:"flex flex-col w-full p-4",children:(0,i.jsxs)("div",{className:"bg-blue-50/30 border-l-4 border-l-blue-50 rounded-r-lg p-4 mb-8 text-sm",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 text-base font-bold text-blue-800 pb-2",children:[(0,i.jsx)(o.Z,{className:"w-4 h-4"}),"小贴士"]}),(0,i.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"行动激励："}),(0,i.jsx)("div",{className:"text-sm text-blue-700",children:"1、验证阶段会随机抽取地址验证打分，然后按得分比例给这些地址分配代币激励"}),(0,i.jsxs)("div",{className:"text-sm text-blue-700",children:["2、只有当1个行动获得的投票数，达到该轮总投票数",(0,d.rl)(Number("30")/10),"时，参与该行动才有激励"]}),(0,i.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"参与代币："}),(0,i.jsx)("div",{className:"text-sm text-blue-700",children:"1、参与代币越多，被选中验证并获得激励的概率越大"}),(0,i.jsx)("div",{className:"text-sm text-blue-700",children:"2、参与的代币可随时取回，如不取回则自动参与此行动的后续轮次"}),(0,i.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"加入限制："}),(0,i.jsxs)("div",{className:"text-sm text-blue-700",children:["每个行动阶段，最后","105","个区块（约",(0,d.ZC)(Number("105")*Number("2868")/1e3),"），无法参与行动报名"]})]})})]})})]})}}},function(e){e.O(0,[8501,4463,1617,3494,3591,3950,6127,7724,1489,1729,2888,9774,179],function(){return e(e.s=66030)}),_N_E=e.O()}]);