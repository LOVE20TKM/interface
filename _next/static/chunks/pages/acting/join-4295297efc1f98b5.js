(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9063],{18449:(e,r,s)=>{"use strict";s.d(r,{X:()=>a});var t=s(76200);class n extends t.C{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function a(e,r){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new n({value:e});let[s,t="0"]=e.split("."),a=s.startsWith("-");if(a&&(s=s.slice(1)),t=t.replace(/(0+)$/,""),0===r)1===Math.round(Number(`.${t}`))&&(s=`${BigInt(s)+1n}`),t="";else if(t.length>r){let[e,n,a]=[t.slice(0,r-1),t.slice(r-1,r),t.slice(r)],i=Math.round(Number(`${n}.${a}`));(t=i>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${i}`).length>r&&(t=t.slice(1),s=`${BigInt(s)+1n}`),t=t.slice(0,r)}else t=t.padEnd(r,"0");return BigInt(`${a?"-":""}${s}${t}`)}},28529:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>J});var t=s(40854),n=s(37876),a=s(14232),i=s(89099),o=s(62212),l=s(64115),c=s(17660),d=s(20451),u=s(83416),m=s(92101),f=s(60154),x=s(12293),v=s(22605),h=s(16927),p=s(3576),b=s(62701),g=s(4902),N=s(13810),j=s(88992),y=s(60513),I=s(8047),_=s(97685),w=s(6960),A=s(7446),k=s(77932),C=s(40150),E=s(92659),S=s(42038),R=s(20442),B=s(9215),F=s(52372),$=s(1709),M=s(99574);let z=e=>{var r,s=e.actionInfo,o=e.stakedAmount,l=(0,i.useRouter)(),m=((0,a.useContext)(u.N)||{}).token,f=(0,I.F)(),v=f.address,z=f.chain,J=(0,B.lW)(null==m?void 0:m.address,v),P=J.balance,D=J.error,X=(0,B.Gp)(null==m?void 0:m.address,v,"0xcEe483E0fd5543AEBA20AD55bB54bEB6A07569F9"),T=X.allowance,K=X.isPending,V=X.error,H=(0,F.IJ)((null==m?void 0:m.address)||"",BigInt(s.head.id),v),L=H.verificationKeys,O=H.verificationInfos,W=H.isPending,Y=H.error,G=(0,t._)((0,a.useState)(!1),2),q=G[0],Q=G[1],U=y.z.object({additionalStakeAmount:y.z.string().refine(e=>""===e.trim()||/^[0-9]+(?:,[0-9]{3})*(?:\.[0-9]+)?$/.test(e.trim()),{message:"请输入合法的数字格式"}).transform(e=>""===e.trim()?"0":e.trim().replace(/,/g,"")).refine(e=>"0"!==e,{message:"参与代币数不能为 0"}).refine(e=>{var r=(0,R.XS)(e);return o&&o>0n?null!==r&&r>0n:null!==r&&r>=BigInt(s.body.minStake)},{message:"参与代币数不能小于最小参与限制"}).refine(e=>{var r=(0,R.XS)(e);return null!==r&&void 0!==P&&r<=P},{message:"您的代币余额不足"}),verificationInfos:y.z.array(y.z.string().min(1,{message:"验证信息不能为空"}))}),Z=s.body.verificationKeys.map(()=>""),ee=(0,j.mN)({resolver:(0,N.u)(U),defaultValues:{additionalStakeAmount:"",verificationInfos:Z},mode:"onChange"});(0,a.useEffect)(()=>{if(O&&O.length>0&&L){var e={};L.forEach((r,s)=>{e[r]=O[s]});var r=s.body.verificationKeys.map(r=>{var s;return null!=(s=e[r])?s:""});ee.setValue("verificationInfos",r)}},[O,L,ee,s.body.verificationKeys]);var er=(0,B.zH)(null==m?void 0:m.address),es=er.approve,et=er.isPending,en=er.isConfirming,ea=er.isConfirmed,ei=er.writeError,eo=(0,a.useRef)(null),el=(0,a.useRef)(K);function ec(){return(ec=(0,h._)(function(e){var r,s;return(0,g.YH)(this,function(t){switch(t.label){case 0:if(!(0,S.C)(z))return[2];if(0n===(s=null!=(r=(0,R.XS)(e.additionalStakeAmount))?r:0n)&&o&&o>0n)return _.oR.error("当前无需授权。"),[2];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,es("0xcEe483E0fd5543AEBA20AD55bB54bEB6A07569F9",s)];case 2:return t.sent(),[3,4];case 3:return console.error("Approve failed",t.sent()),[3,4];case 4:return[2]}})})).apply(this,arguments)}(0,a.useEffect)(()=>{el.current&&!K&&eo.current&&eo.current.blur(),el.current=K},[K]),(0,a.useEffect)(()=>{ea&&(Q(!0),_.oR.success("授权".concat(null==m?void 0:m.symbol,"成功")))},[ea,null==m?void 0:m.symbol]);var ed=ee.watch("additionalStakeAmount"),eu=null!=(r=(0,R.XS)(ed||"0"))?r:0n;(0,a.useEffect)(()=>{eu>0n&&T&&T>0n&&T>=eu?Q(!0):Q(!1)},[eu,K,T]);var em=(0,c.o9)(),ef=em.join,ex=em.isPending,ev=em.isConfirming,eh=em.isConfirmed,ep=em.writeError;function eb(){return(eb=(0,h._)(function(e){var r,t,n;return(0,g.YH)(this,function(a){switch(a.label){case 0:if(!(0,S.C)(z))return[2];a.label=1;case 1:if(a.trys.push([1,3,,4]),r=!O||O.every(e=>!e||""===e.trim()),t=e.verificationInfos,!r&&O&&L)L.length===e.verificationInfos.length&&L.every((r,s)=>{var t=L.indexOf(r);return t>=0&&O[t]===e.verificationInfos[s]})&&(t=[]);else if(r&&e.verificationInfos.some(e=>!e||""===e.trim()))return _.oR.error("首次提交需要填写所有验证信息"),[2];return[4,ef(null==m?void 0:m.address,BigInt(s.head.id),null!=(n=(0,R.XS)(e.additionalStakeAmount))?n:0n,t)];case 2:return a.sent(),[3,4];case 3:return console.error("Join failed",a.sent()),[3,4];case 4:return[2]}})})).apply(this,arguments)}(0,a.useEffect)(()=>{eh&&(_.oR.success("加入成功"),ee.reset(),setTimeout(()=>{l.push("/action/detail?id=".concat(s.head.id,"&type=join&symbol=").concat(null==m?void 0:m.symbol))},2e3))},[eh]);var eg=(0,d.g)().handleContractError;return((0,a.useEffect)(()=>{D&&eg(D,"token"),Y&&eg(Y,"join"),ei&&eg(ei,"token"),ep&&eg(ep,"join"),V&&eg(V,"token")},[D,Y,ei,ep,V]),W)?(0,n.jsx)(x.A,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"px-6 pt-0 pb-2",children:[(0,n.jsx)($.A,{title:o?"增加参与代币":"参与行动"}),(0,n.jsx)(E.lV,(0,b._)((0,p._)({},ee),{children:(0,n.jsxs)("form",{onSubmit:e=>e.preventDefault(),className:"space-y-4",children:[(0,n.jsx)(E.zB,{control:ee.control,name:"additionalStakeAmount",render:e=>{var r=e.field;return(0,n.jsxs)(E.eI,{children:[(0,n.jsx)(E.lR,{className:"text-greyscale-500 font-normal",children:o?"":"参与代币数："}),(0,n.jsx)(E.MJ,{children:(0,n.jsx)(k.p,(0,p._)({placeholder:o?"最大可追加 ".concat((0,R.NJ)(P||0n)):"最小参与代币数 ".concat((0,R.NJ)(BigInt(s.body.minStake))),type:"number",disabled:!P||P<=0n,className:"!ring-secondary-foreground"},r))}),(0,n.jsx)(E.C5,{}),(0,n.jsxs)(E.Rr,{className:"flex items-center",children:[(0,n.jsxs)("span",{children:["共有 ",(0,n.jsx)("span",{className:"text-secondary",children:(0,R.NJ)(P||0n)})," ",null==m?void 0:m.symbol]}),(0,n.jsx)(w.$,{type:"button",variant:"link",size:"sm",onClick:()=>{P&&P>0n&&ee.setValue("additionalStakeAmount",(0,R.Js)(P))},className:"text-secondary p-0 ml-6",disabled:!P||P<=0n,children:"全部"})]})]})}}),s.body.verificationKeys.map((e,r)=>(0,n.jsx)(E.zB,{control:ee.control,name:"verificationInfos.".concat(r),render:t=>{var a=t.field;return(0,n.jsxs)(E.eI,{children:[(0,n.jsx)(E.lR,{className:"text-greyscale-500 font-normal",children:e}),(0,n.jsx)(E.MJ,{children:(0,n.jsx)(C.T,(0,p._)({placeholder:s.body.verificationInfoGuides[r]||"",className:"!ring-secondary-foreground"},a))}),(0,n.jsx)(E.C5,{})]})}},e+r)),(0,n.jsxs)("div",{className:"flex justify-center space-x-4 pt-2",children:[(0,n.jsx)(w.$,{ref:eo,className:"w-1/2",disabled:K||et||en||q,type:"button",onClick:()=>{ee.handleSubmit(e=>(function(e){return ec.apply(this,arguments)})(e))()},children:K?(0,n.jsx)(A.A,{className:"animate-spin"}):et?"1.提交中...":en?"1.确认中...":q?"1.".concat(null==m?void 0:m.symbol,"已授权"):"1.授权".concat(null==m?void 0:m.symbol)}),(0,n.jsx)(w.$,{className:"w-1/2",disabled:!q||ex||ev||eh,type:"button",onClick:()=>{ee.handleSubmit(e=>(function(e){return eb.apply(this,arguments)})(e))()},children:ex?"2.提交中...":ev?"2.确认中...":eh?"2.已加入":"2.加入"})]})]})}))]}),(0,n.jsx)("div",{className:"px-6 pt-0 pb-4",children:(0,n.jsx)("div",{className:"text-greyscale-500 text-sm",children:"提示：加入行动后，可以随时取回参与代币，无等待期"})}),(0,n.jsx)(M.A,{isLoading:et||en||ex||ev,text:et||ex?"提交交易...":"确认交易..."})]})},J=()=>{var e=(0,i.useRouter)().query.id,r=(0,t._)((0,a.useState)(void 0),2),s=r[0],h=r[1],p=((0,a.useContext)(u.N)||{}).token,b=(0,c.vC)(),g=b.currentRound,N=b.isPending,j=b.error,y=(0,l.Y4)(null==p?void 0:p.address,void 0===e?void 0:BigInt(e)),I=y.actionInfo,_=y.isPending,w=y.error,A=(0,d.g)().handleContractError;return(0,a.useEffect)(()=>{j&&A(j,"join"),w&&A(w,"submit")},[j,w]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.A,{title:"加入行动"}),(0,n.jsx)("main",{className:"flex-grow",children:!e||Array.isArray(e)||_||N?(0,n.jsx)(x.A,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v.A,{actionId:BigInt(e),onRoundChange:()=>{},actionInfo:I,onStakedAmountChange:function(e){h(e)},showJoinButton:!1}),(0,n.jsx)(z,{actionInfo:I,stakedAmount:s}),(0,n.jsx)("div",{className:"flex flex-col w-full p-4",children:(0,n.jsxs)("div",{className:"bg-blue-50/30 border-l-4 border-l-blue-50 rounded-r-lg p-4 mb-8 text-sm",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 text-base font-bold text-blue-800 pb-2",children:[(0,n.jsx)(o.A,{className:"w-4 h-4"}),"提示"]}),(0,n.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"行动激励："}),(0,n.jsx)("div",{className:"text-sm text-blue-700",children:"1、验证阶段会随机抽取地址验证打分，然后按得分比例给这些地址分配代币激励"}),(0,n.jsx)("div",{className:"text-sm text-blue-700",children:"2、只有当1个行动获得的验证票数，达到该轮总投票数5%时，参与该行动才有激励"}),(0,n.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"参与代币："}),(0,n.jsx)("div",{className:"text-sm text-blue-700",children:"1、参与代币越多，被选中验证并获得奖励的概率越大"}),(0,n.jsx)("div",{className:"text-sm text-blue-700",children:"2、参与的代币可随时取回，如不取回则自动参与此行动的后续轮次"})]})}),(0,n.jsx)(m.A,{actionId:BigInt(e),round:g,showSubmitter:!1})]})})]})}},33676:(e,r,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/acting/join",function(){return s(28529)}])},40150:(e,r,s)=>{"use strict";s.d(r,{T:()=>l});var t=s(3576),n=s(65699),a=s(37876),i=s(14232),o=s(30684),l=i.forwardRef((e,r)=>{var s=e.className,i=(0,n._)(e,["className"]);return(0,a.jsx)("textarea",(0,t._)({className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r},i))});l.displayName="Textarea"},42038:(e,r,s)=>{"use strict";s.d(r,{C:()=>n});var t=s(97685),n=e=>!!e||(t.oR.error("请先将钱包链接 ".concat("thinkium70001")),!1)},62212:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});var t=(0,s(11713).A)("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},92659:(e,r,s)=>{"use strict";s.d(r,{lV:()=>h,MJ:()=>I,Rr:()=>_,zB:()=>b,eI:()=>j,lR:()=>y,C5:()=>w});var t=s(81110),n=s(40120),a=s(3576),i=s(62701),o=s(65699),l=s(37876),c=s(14232),d=s(39358),u=s(88992),m=s(30684),f=s(49794),x=(0,s(47137).F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),v=c.forwardRef((e,r)=>{var s=e.className,t=(0,o._)(e,["className"]);return(0,l.jsx)(f.b,(0,a._)({ref:r,className:(0,m.cn)(x(),s)},t))});v.displayName=f.b.displayName;var h=u.Op,p=c.createContext({}),b=e=>{var r=(0,t._)({},(0,n._)(e));return(0,l.jsx)(p.Provider,{value:{name:r.name},children:(0,l.jsx)(u.xI,(0,a._)({},r))})},g=()=>{var e=c.useContext(p),r=c.useContext(N),s=(0,u.xW)(),t=s.getFieldState,n=s.formState,i=t(e.name,n);if(!e)throw Error("useFormField should be used within <FormField>");var o=r.id;return(0,a._)({id:o,name:e.name,formItemId:"".concat(o,"-form-item"),formDescriptionId:"".concat(o,"-form-item-description"),formMessageId:"".concat(o,"-form-item-message")},i)},N=c.createContext({}),j=c.forwardRef((e,r)=>{var s=e.className,t=(0,o._)(e,["className"]),n=c.useId();return(0,l.jsx)(N.Provider,{value:{id:n},children:(0,l.jsx)("div",(0,a._)({ref:r,className:(0,m.cn)("space-y-2",s)},t))})});j.displayName="FormItem";var y=c.forwardRef((e,r)=>{var s=e.className,t=(0,o._)(e,["className"]),n=g(),i=n.error,c=n.formItemId;return(0,l.jsx)(v,(0,a._)({ref:r,className:(0,m.cn)(i&&"text-destructive",s),htmlFor:c},t))});y.displayName="FormLabel";var I=c.forwardRef((e,r)=>{var s=(0,t._)({},(0,n._)(e)),i=g(),o=i.error,c=i.formItemId,u=i.formDescriptionId,m=i.formMessageId;return(0,l.jsx)(d.DX,(0,a._)({ref:r,id:c,"aria-describedby":o?"".concat(u," ").concat(m):"".concat(u),"aria-invalid":!!o},s))});I.displayName="FormControl";var _=c.forwardRef((e,r)=>{var s=e.className,t=(0,o._)(e,["className"]),n=g().formDescriptionId;return(0,l.jsx)("p",(0,a._)({ref:r,id:n,className:(0,m.cn)("text-sm text-muted-foreground",s)},t))});_.displayName="FormDescription";var w=c.forwardRef((e,r)=>{var s=e.className,t=e.children,n=(0,o._)(e,["className","children"]),c=g(),d=c.error,u=c.formMessageId,f=d?String(null==d?void 0:d.message):t;return f?(0,l.jsx)("p",(0,i._)((0,a._)({ref:r,id:u,className:(0,m.cn)("text-sm font-medium text-destructive",s)},n),{children:f})):null});w.displayName="FormMessage"},99574:(e,r,s)=>{"use strict";s.d(r,{A:()=>a});var t=s(37876);s(14232);var n=s(7446);let a=e=>{var r=e.isLoading,s=e.text;return r?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(n.A,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,t.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:void 0===s?"Loading":s})]})}):null}}},e=>{var r=r=>e(e.s=r);e.O(0,[3308,7657,8230,6869,154,3096,5139,4115,7432,1217,636,6593,8792],()=>r(33676)),_N_E=e.O()}]);