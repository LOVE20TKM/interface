(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9063],{18449:(e,r,t)=>{"use strict";t.d(r,{X:()=>a});var n=t(76200);class s extends n.C{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function a(e,r){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new s({value:e});let[t,n="0"]=e.split("."),a=t.startsWith("-");if(a&&(t=t.slice(1)),n=n.replace(/(0+)$/,""),0===r)1===Math.round(Number(`.${n}`))&&(t=`${BigInt(t)+1n}`),n="";else if(n.length>r){let[e,s,a]=[n.slice(0,r-1),n.slice(r-1,r),n.slice(r)],i=Math.round(Number(`${s}.${a}`));(n=i>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${i}`).length>r&&(n=n.slice(1),t=`${BigInt(t)+1n}`),n=n.slice(0,r)}else n=n.padEnd(r,"0");return BigInt(`${a?"-":""}${t}${n}`)}},28529:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>z});var n=t(40854),s=t(37876),a=t(14232),i=t(89099),o=t(62212),l=t(64115),c=t(17660),d=t(20451),u=t(83416),m=t(92101),f=t(60154),x=t(12293),v=t(22605),h=t(16927),p=t(3576),b=t(62701),g=t(4902),y=t(13810),N=t(88992),j=t(60513),I=t(8047),w=t(97685),_=t(6960),A=t(7446),k=t(77932),C=t(40150),E=t(92659),S=t(42038),R=t(20442),B=t(9215),F=t(52372),$=t(1709),M=t(99574);let D=e=>{var r,t=e.actionInfo,o=e.stakedAmount,l=(0,i.useRouter)(),m=((0,a.useContext)(u.N)||{}).token,f=(0,I.F)(),v=f.address,D=f.chain,z=(0,B.lW)(null==m?void 0:m.address,v),J=z.balance,P=z.error,X=(0,B.Gp)(null==m?void 0:m.address,v,"0xcEe483E0fd5543AEBA20AD55bB54bEB6A07569F9"),T=X.allowance,K=X.isPending,V=X.error,H=(0,F.IJ)((null==m?void 0:m.address)||"",BigInt(t.head.id),v),L=H.verificationKeys,O=H.verificationInfos,W=H.isPending,Y=H.error,G=(0,n._)((0,a.useState)(!1),2),q=G[0],Q=G[1],U=j.z.object({additionalStakeAmount:j.z.string().refine(e=>""===e.trim()||/^[0-9]+(?:,[0-9]{3})*(?:\.[0-9]+)?$/.test(e.trim()),{message:"请输入合法的数字格式"}).transform(e=>""===e.trim()?"0":e.trim().replace(/,/g,"")).refine(e=>"0"!==e,{message:"参与代币数不能为 0"}).refine(e=>{var r=(0,R.XS)(e);return o&&o>0n?null!==r&&r>0n:null!==r&&r>=BigInt(t.body.minStake)},{message:"参与代币数不能小于最小参与限制"}).refine(e=>{var r=(0,R.XS)(e);return null!==r&&void 0!==J&&r<=J},{message:"您的代币余额不足"}),verificationInfos:j.z.array(j.z.string().min(1,{message:"验证信息不能为空"}))}),Z=t.body.verificationKeys.map(()=>""),ee=(0,N.mN)({resolver:(0,y.u)(U),defaultValues:{additionalStakeAmount:"",verificationInfos:Z},mode:"onChange"});(0,a.useEffect)(()=>{if(O&&O.length>0&&L){var e={};L.forEach((r,t)=>{e[r]=O[t]});var r=t.body.verificationKeys.map(r=>{var t;return null!=(t=e[r])?t:""});ee.setValue("verificationInfos",r)}},[O,L,ee,t.body.verificationKeys]);var er=(0,B.zH)(null==m?void 0:m.address),et=er.approve,en=er.isPending,es=er.isConfirming,ea=er.isConfirmed,ei=er.writeError,eo=(0,a.useRef)(null),el=(0,a.useRef)(K);function ec(){return(ec=(0,h._)(function(e){var r,t;return(0,g.YH)(this,function(n){switch(n.label){case 0:if(!(0,S.C)(D))return[2];if(0n===(t=null!=(r=(0,R.XS)(e.additionalStakeAmount))?r:0n)&&o&&o>0n)return w.oR.error("当前无需授权。"),[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,et("0xcEe483E0fd5543AEBA20AD55bB54bEB6A07569F9",t)];case 2:return n.sent(),[3,4];case 3:return console.error("Approve failed",n.sent()),[3,4];case 4:return[2]}})})).apply(this,arguments)}(0,a.useEffect)(()=>{el.current&&!K&&eo.current&&eo.current.blur(),el.current=K},[K]),(0,a.useEffect)(()=>{ea&&(Q(!0),w.oR.success("授权".concat(null==m?void 0:m.symbol,"成功")))},[ea,null==m?void 0:m.symbol]);var ed=ee.watch("additionalStakeAmount"),eu=null!=(r=(0,R.XS)(ed||"0"))?r:0n;(0,a.useEffect)(()=>{eu>0n&&T&&T>0n&&T>=eu?Q(!0):Q(!1)},[eu,K,T]);var em=(0,c.o9)(),ef=em.join,ex=em.isPending,ev=em.isConfirming,eh=em.isConfirmed,ep=em.writeError;function eb(){return(eb=(0,h._)(function(e){var r,n,s;return(0,g.YH)(this,function(a){switch(a.label){case 0:if(!(0,S.C)(D))return[2];a.label=1;case 1:if(a.trys.push([1,3,,4]),r=!O||O.every(e=>!e||""===e.trim()),n=e.verificationInfos,!r&&O&&L)L.length===e.verificationInfos.length&&L.every((r,t)=>{var n=L.indexOf(r);return n>=0&&O[n]===e.verificationInfos[t]})&&(n=[]);else if(r&&e.verificationInfos.some(e=>!e||""===e.trim()))return w.oR.error("首次提交需要填写所有验证信息"),[2];return[4,ef(null==m?void 0:m.address,BigInt(t.head.id),null!=(s=(0,R.XS)(e.additionalStakeAmount))?s:0n,n)];case 2:return a.sent(),[3,4];case 3:return console.error("Join failed",a.sent()),[3,4];case 4:return[2]}})})).apply(this,arguments)}(0,a.useEffect)(()=>{eh&&(w.oR.success("加入成功"),ee.reset(),setTimeout(()=>{l.push("/action/detail?id=".concat(t.head.id,"&type=join&symbol=").concat(null==m?void 0:m.symbol))},2e3))},[eh]);var eg=(0,d.g)().handleContractError;return((0,a.useEffect)(()=>{P&&eg(P,"token"),Y&&eg(Y,"join"),ei&&eg(ei,"token"),ep&&eg(ep,"join"),V&&eg(V,"token")},[P,Y,ei,ep,V]),W)?(0,s.jsx)(x.A,{}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"px-6 pt-0 pb-2",children:[(0,s.jsx)($.A,{title:o?"增加参与代币":"参与行动"}),(0,s.jsx)(E.lV,(0,b._)((0,p._)({},ee),{children:(0,s.jsxs)("form",{onSubmit:e=>e.preventDefault(),className:"space-y-4",children:[(0,s.jsx)(E.zB,{control:ee.control,name:"additionalStakeAmount",render:e=>{var r=e.field;return(0,s.jsxs)(E.eI,{children:[(0,s.jsx)(E.lR,{className:"text-greyscale-500 font-normal",children:o?"":"参与代币数："}),(0,s.jsx)(E.MJ,{children:(0,s.jsx)(k.p,(0,p._)({placeholder:o?"最大可追加 ".concat((0,R.NJ)(J||0n)):"最小参与代币数 ".concat((0,R.NJ)(BigInt(t.body.minStake))),type:"number",disabled:!J||J<=0n,className:"!ring-secondary-foreground"},r))}),(0,s.jsx)(E.C5,{}),(0,s.jsxs)(E.Rr,{className:"flex items-center",children:[(0,s.jsxs)("span",{children:["共有 ",(0,s.jsx)("span",{className:"text-secondary",children:(0,R.NJ)(J||0n)})," ",null==m?void 0:m.symbol]}),(0,s.jsx)(_.$,{type:"button",variant:"link",size:"sm",onClick:()=>{J&&J>0n&&ee.setValue("additionalStakeAmount",(0,R.Js)(J))},className:"text-secondary p-0 ml-6",disabled:!J||J<=0n,children:"全部"})]})]})}}),t.body.verificationKeys.map((e,r)=>(0,s.jsx)(E.zB,{control:ee.control,name:"verificationInfos.".concat(r),render:n=>{var a=n.field;return(0,s.jsxs)(E.eI,{children:[(0,s.jsx)(E.lR,{className:"text-greyscale-500 font-normal",children:e}),(0,s.jsx)(E.MJ,{children:(0,s.jsx)(C.T,(0,p._)({placeholder:t.body.verificationInfoGuides[r]||"",className:"!ring-secondary-foreground"},a))}),(0,s.jsx)(E.C5,{})]})}},e+r)),(0,s.jsxs)("div",{className:"flex justify-center space-x-4 pt-2",children:[(0,s.jsx)(_.$,{ref:eo,className:"w-1/2",disabled:K||en||es||q,type:"button",onClick:()=>{ee.handleSubmit(e=>(function(e){return ec.apply(this,arguments)})(e))()},children:K?(0,s.jsx)(A.A,{className:"animate-spin"}):en?"1.提交中...":es?"1.确认中...":q?"1.".concat(null==m?void 0:m.symbol,"已授权"):"1.授权".concat(null==m?void 0:m.symbol)}),(0,s.jsx)(_.$,{className:"w-1/2",disabled:!q||ex||ev||eh,type:"button",onClick:()=>{ee.handleSubmit(e=>(function(e){return eb.apply(this,arguments)})(e))()},children:ex?"2.提交中...":ev?"2.确认中...":eh?"2.已加入":"2.加入"})]})]})}))]}),(0,s.jsx)("div",{className:"px-6 pt-0 pb-4",children:(0,s.jsx)("div",{className:"text-greyscale-500 text-sm",children:"提示：加入行动后，可以随时取回参与代币，无等待期"})}),(0,s.jsx)(M.A,{isLoading:en||es||ex||ev,text:en||ex?"提交交易...":"确认交易..."})]})},z=()=>{var e=(0,i.useRouter)().query.id,r=(0,n._)((0,a.useState)(void 0),2),t=r[0],h=r[1],p=((0,a.useContext)(u.N)||{}).token,b=(0,c.vC)(),g=b.currentRound,y=b.isPending,N=b.error,j=(0,l.Y4)(null==p?void 0:p.address,void 0===e?void 0:BigInt(e)),I=j.actionInfo,w=j.isPending,_=j.error,A=(0,d.g)().handleContractError;return(0,a.useEffect)(()=>{N&&A(N,"join"),_&&A(_,"submit")},[N,_]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.A,{title:"加入行动"}),(0,s.jsx)("main",{className:"flex-grow",children:!e||Array.isArray(e)||w||y?(0,s.jsx)(x.A,{}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.A,{actionId:BigInt(e),onRoundChange:()=>{},actionInfo:I,onStakedAmountChange:function(e){h(e)},showJoinButton:!1}),(0,s.jsx)(D,{actionInfo:I,stakedAmount:t}),(0,s.jsx)("div",{className:"flex flex-col w-full p-4",children:(0,s.jsxs)("div",{className:"bg-blue-50/30 border-l-4 border-l-blue-50 rounded-r-lg p-4 mb-8 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-base font-bold text-blue-800 pb-2",children:[(0,s.jsx)(o.A,{className:"w-4 h-4"}),"提示"]}),(0,s.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"行动激励："}),(0,s.jsx)("div",{className:"text-sm text-blue-700",children:"1、验证阶段会随机抽取地址验证打分，然后按得分比例给这些地址分配代币激励"}),(0,s.jsx)("div",{className:"text-sm text-blue-700",children:"2、只有当1个行动获得的验证票数，达到该轮总投票数5%时，参与该行动才有激励"}),(0,s.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"参与代币："}),(0,s.jsx)("div",{className:"text-sm text-blue-700",children:"1、参与代币越多，被选中验证并获得奖励的概率越大"}),(0,s.jsx)("div",{className:"text-sm text-blue-700",children:"2、参与的代币可随时取回，如不取回则自动参与此行动的后续轮次"})]})}),(0,s.jsx)(m.A,{actionId:BigInt(e),round:g,showSubmitter:!1})]})})]})}},33676:(e,r,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/acting/join",function(){return t(28529)}])},40150:(e,r,t)=>{"use strict";t.d(r,{T:()=>l});var n=t(3576),s=t(65699),a=t(37876),i=t(14232),o=t(30684),l=i.forwardRef((e,r)=>{var t=e.className,i=(0,s._)(e,["className"]);return(0,a.jsx)("textarea",(0,n._)({className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r},i))});l.displayName="Textarea"},42038:(e,r,t)=>{"use strict";t.d(r,{C:()=>s});var n=t(97685),s=e=>!!e||(n.oR.error("请先将钱包链接 ".concat("thinkium70001")),!1)},62212:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});var n=(0,t(11713).A)("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},92659:(e,r,t)=>{"use strict";t.d(r,{lV:()=>h,MJ:()=>I,Rr:()=>w,zB:()=>b,eI:()=>N,lR:()=>j,C5:()=>_});var n=t(81110),s=t(40120),a=t(3576),i=t(62701),o=t(65699),l=t(37876),c=t(14232),d=t(39358),u=t(88992),m=t(30684),f=t(49794),x=(0,t(47137).F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),v=c.forwardRef((e,r)=>{var t=e.className,n=(0,o._)(e,["className"]);return(0,l.jsx)(f.b,(0,a._)({ref:r,className:(0,m.cn)(x(),t)},n))});v.displayName=f.b.displayName;var h=u.Op,p=c.createContext({}),b=e=>{var r=(0,n._)({},(0,s._)(e));return(0,l.jsx)(p.Provider,{value:{name:r.name},children:(0,l.jsx)(u.xI,(0,a._)({},r))})},g=()=>{var e=c.useContext(p),r=c.useContext(y),t=(0,u.xW)(),n=t.getFieldState,s=t.formState,i=n(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");var o=r.id;return(0,a._)({id:o,name:e.name,formItemId:"".concat(o,"-form-item"),formDescriptionId:"".concat(o,"-form-item-description"),formMessageId:"".concat(o,"-form-item-message")},i)},y=c.createContext({}),N=c.forwardRef((e,r)=>{var t=e.className,n=(0,o._)(e,["className"]),s=c.useId();return(0,l.jsx)(y.Provider,{value:{id:s},children:(0,l.jsx)("div",(0,a._)({ref:r,className:(0,m.cn)("space-y-2",t)},n))})});N.displayName="FormItem";var j=c.forwardRef((e,r)=>{var t=e.className,n=(0,o._)(e,["className"]),s=g(),i=s.error,c=s.formItemId;return(0,l.jsx)(v,(0,a._)({ref:r,className:(0,m.cn)(i&&"text-destructive",t),htmlFor:c},n))});j.displayName="FormLabel";var I=c.forwardRef((e,r)=>{var t=(0,n._)({},(0,s._)(e)),i=g(),o=i.error,c=i.formItemId,u=i.formDescriptionId,m=i.formMessageId;return(0,l.jsx)(d.DX,(0,a._)({ref:r,id:c,"aria-describedby":o?"".concat(u," ").concat(m):"".concat(u),"aria-invalid":!!o},t))});I.displayName="FormControl";var w=c.forwardRef((e,r)=>{var t=e.className,n=(0,o._)(e,["className"]),s=g().formDescriptionId;return(0,l.jsx)("p",(0,a._)({ref:r,id:s,className:(0,m.cn)("text-sm text-muted-foreground",t)},n))});w.displayName="FormDescription";var _=c.forwardRef((e,r)=>{var t=e.className,n=e.children,s=(0,o._)(e,["className","children"]),c=g(),d=c.error,u=c.formMessageId,f=d?String(null==d?void 0:d.message):n;return f?(0,l.jsx)("p",(0,i._)((0,a._)({ref:r,id:u,className:(0,m.cn)("text-sm font-medium text-destructive",t)},s),{children:f})):null});_.displayName="FormMessage"},99574:(e,r,t)=>{"use strict";t.d(r,{A:()=>i});var n=t(37876),s=t(14232),a=t(7446);let i=e=>{var r=e.isLoading,t=e.text;return((0,s.useEffect)(()=>{if(r){var e=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}}},[r]),r)?(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50 touch-none overscroll-none",onTouchMove:e=>{e.preventDefault()},onTouchStart:e=>{e.preventDefault()},style:{touchAction:"none"},children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(a.A,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,n.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:void 0===t?"Loading":t})]})}):null}}},e=>{var r=r=>e(e.s=r);e.O(0,[3308,9374,8230,6869,154,3096,5139,4115,7432,1217,636,6593,8792],()=>r(33676)),_N_E=e.O()}]);