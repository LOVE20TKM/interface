(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9082],{87869:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/acting",function(){return n(75959)}])},34680:function(e,t,n){"use strict";n.d(t,{Ol:function(){return c},SZ:function(){return o},Zb:function(){return l},aY:function(){return d},eW:function(){return u},ll:function(){return i}});var s=n(85893),a=n(67294),r=n(40108);let l=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",n),...a})});l.displayName="Card";let c=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",n),...a})});c.displayName="CardHeader";let i=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",n),...a})});i.displayName="CardTitle";let o=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",n),...a})});o.displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("p-6 pt-0",n),...a})});d.displayName="CardContent";let u=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("flex items-center p-6 pt-0",n),...a})});u.displayName="CardFooter"},4307:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(31134).Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},96693:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var s=n(85893),a=n(67294),r=n(42757),l=n(93778),c=e=>{let{initialTimeLeft:t,onTick:n}=e,[r,l]=(0,a.useState)(Date.now()+1e3*t),[c,i]=(0,a.useState)(t);(0,a.useEffect)(()=>{l(Date.now()+1e3*t)},[t]),(0,a.useEffect)(()=>{let e=setInterval(()=>{let t=Math.max(0,Math.floor((r-Date.now())/1e3));i(t),n&&n(t),t<=0&&(clearInterval(e),window.location.reload())},1e3);return()=>clearInterval(e)},[r,n]);let o=Math.floor(c/86400),d=Math.floor(c%86400/3600);return(0,s.jsxs)("div",{className:"inline-flex gap-1 text-secondary",children:[o>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"countdown font-mono",children:(0,s.jsx)("span",{style:{"--value":o}})}),"天"]}),(d>0||o>0)&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"countdown font-mono",children:(0,s.jsx)("span",{style:{"--value":d}})}),"时"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"countdown font-mono",children:(0,s.jsx)("span",{style:{"--value":Math.floor(c%3600/60)}})}),"分"]}),o<=0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"countdown font-mono",children:(0,s.jsx)("span",{style:{"--value":c%60}})}),"秒"]})]})},i=n(42083),o=e=>{let{currentRound:t,roundType:n}=e,{data:o}=(0,r.O)(),d=(0,a.useContext)(l.M),u=d?d.token:void 0,x=!o||!u||void 0===u.voteOriginBlocks||!u.initialStakeRound,[m,f]=(0,a.useState)(0n),h=Number("33784")||0,N=Number("255")||0,j=u?Number(u.voteOriginBlocks):0,p=h-(Number(o)-j)%h,v=p>0?Math.ceil(p*N/100):0,[b,g]=(0,a.useState)(v);(0,a.useEffect)(()=>{if(!o)return;let e=h-(Number(o)-j)%h;g(e>0?Math.ceil(e*N/100):0)},[o,h,N,j]),(0,a.useEffect)(()=>{u&&t>0n&&f(t-BigInt(u.initialStakeRound)+1n)},[t,u]);let y=null!=m?m.toString():"0";return x||null==m||m<0n?((null==m||m<0n)&&(console.log("currentTokenRound",m),console.log("currentRound",t),console.log("token.initialStakeRound",null==u?void 0:u.initialStakeRound),console.log("token",u)),(0,s.jsx)(i.Z,{})):(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsxs)("h1",{className:"text-lg font-bold",children:["第 ",(0,s.jsx)("span",{className:"text-secondary",children:y})," 轮","vote"===n?"投票":"verify"===n?"验证":"行动","阶段"]}),(0,s.jsxs)("span",{className:"text-sm mt-1 pt-0",children:[(0,s.jsx)("span",{className:"text-greyscale-400 mr-1",children:"剩余:"}),(0,s.jsx)("span",{className:"text-secondary mr-1",children:Math.ceil(100*b/N)}),(0,s.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),(0,s.jsx)(c,{initialTimeLeft:v,onTick:g})]})]})}},99958:function(e,t,n){"use strict";n.d(t,{Cn:function(){return r},IS:function(){return s},Tn:function(){return a}});let s=(e,t,n)=>{if(!e||!t)return"0%";let s=31536e5/Number("255"),a=BigInt("33784");if(0===s||0n===a)return console.error("配置错误: NEXT_PUBLIC_BLOCK_TIME 或 NEXT_PUBLIC_PHASE_BLOCKS 未设置"),"0%";let r=e?99n*e*99n/2000000n:BigInt(0),l=(2n*t||BigInt(0))+(n||BigInt(0));if(l===BigInt(0))return"0%";let c=Number(r)/Number(l)/(Number(a)/s)*100;return"".concat(c.toFixed(2).replace(/\.?0+$/,""),"%")},a=(e,t)=>{if(!e||!t||0n===t)return"0%";let n=31536e5/Number("255"),s=BigInt("33784");if(0===n||0n===s)return console.error("配置错误: BLOCK_TIME 或 PHASE_BLOCKS 未设置或为0"),"0%";let a=Number(e)/Number(t)/(Number(s)/n)*100;return"".concat(a.toFixed(2).replace(/\.?0+$/,""),"%")},r=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Number("33784")||0,s=Number("255")||0,a=e*n,r="".concat(a.toLocaleString(),"区块，约").concat(Math.ceil(Math.ceil(a*s/100)/86400),"天");return t||(r="".concat(e,"个阶段（").concat(r,")")),r}},75959:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return B}});var s=n(85893),a=n(67294),r=n(11163),l=n(42083),c=n(93778),i=n(67068),o=n(19638),d=n(7399),u=n(91529),x=n(96693),m=n(99958),f=e=>{let{currentRound:t}=e,{token:n}=(0,a.useContext)(c.M)||{},{rewardAvailable:r,isPending:f,error:h}=(0,d.CY)((null==n?void 0:n.address)||""),{balance:N,isPending:j,error:p}=(0,o.hS)((null==n?void 0:n.address)||"","0x1Fe28BFE3DD858B983757B249CFB3A0f039Dd1EF"),{handleContractError:v}=(0,i.S)();(0,a.useEffect)(()=>{p&&v(p,"join"),h&&v(h,"mint")},[p,h]);let b=99n*(r||BigInt(0))/20000n;return(0,s.jsxs)("div",{className:"px-4",children:[(0,s.jsx)(x.Z,{currentRound:t||0n,roundType:"act"}),(0,s.jsxs)("div",{className:"w-full border rounded-lg mt-4 p-0",children:[(0,s.jsxs)("div",{className:"stats w-full grid grid-cols-2 divide-x-0",children:[(0,s.jsxs)("div",{className:"stat place-items-center pb-2",children:[(0,s.jsx)("div",{className:"stat-title text-sm pb-1",children:"参与行动代币"}),(0,s.jsx)("div",{className:"stat-value text-xl text-secondary",children:j?(0,s.jsx)(l.Z,{}):(0,u.LH)(N||BigInt(0),0)})]}),(0,s.jsxs)("div",{className:"stat place-items-center pb-2",children:[(0,s.jsx)("div",{className:"stat-title text-sm pb-1",children:"预计新增铸币"}),(0,s.jsx)("div",{className:"stat-value text-xl text-secondary",children:f||void 0===r?(0,s.jsx)(l.Z,{}):(0,u.LH)(b,2)})]})]}),(0,s.jsxs)("div",{className:"text-center text-xs mb-2 text-greyscale-500",children:["预估年化收益率（APY）：",(0,m.Tn)(b,N)]})]})]})},h=n(37436),N=n(41664),j=n.n(N),p=n(92321),v=n(4307),b=n(34680),g=n(45551),y=n(64777),w=e=>{let{currentRound:t}=e,{token:n}=(0,a.useContext)(c.M)||{},{address:r}=(0,p.m)(),{joinableActionDetails:o,joinedActions:d,isPending:x,error:m}=(0,g.jA)((null==n?void 0:n.address)||"",t||0n,r);null==o||o.sort((e,t)=>Number(e.action.head.id)-Number(t.action.head.id));let f=(null==o?void 0:o.reduce((e,t)=>e+t.votesNum,0n))||0n,{handleContractError:h}=(0,i.S)();return(0,a.useEffect)(()=>{m&&h(m,"dataViewer")},[m]),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)(y.Z,{title:"进行中的行动"}),!r&&(0,s.jsx)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:"请先连接钱包"}),r&&x&&(0,s.jsx)("div",{className:"p-4 flex justify-center items-center",children:(0,s.jsx)(l.Z,{})}),r&&!x&&!(null==o?void 0:o.length)&&(0,s.jsx)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:"本轮暂无行动"}),!x&&o&&o.length>0&&(0,s.jsx)("div",{className:"mt-4 space-y-4",children:o.map((e,t)=>{let a=(null==d?void 0:d.some(t=>t.action.head.id===e.action.head.id))?"/action/".concat(e.action.head.id,"?type=join&symbol=").concat(null==n?void 0:n.symbol):"/acting/join?id=".concat(e.action.head.id,"&symbol=").concat(null==n?void 0:n.symbol);return(0,s.jsx)(b.Zb,{className:"shadow-none",children:(0,s.jsxs)(j(),{href:a,className:"relative block",children:[(0,s.jsxs)(b.Ol,{className:"px-3 pt-2 pb-1 flex-row items-baseline",children:[(0,s.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No.".concat(e.action.head.id)}),(0,s.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(e.action.body.action)})]}),(0,s.jsxs)(b.aY,{className:"px-3 pt-1 pb-2",children:[(0,s.jsx)("div",{className:"text-greyscale-500",children:e.action.body.consensus}),(0,s.jsxs)("div",{className:"flex justify-between mt-1 text-sm",children:[(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{className:"text-greyscale-400 mr-1",children:"投票占比"}),(0,s.jsxs)("span",{className:"text-secondary",children:[(100*Number(o[t].votesNum||0n)/Number(f)).toFixed(1),"%"]})]}),(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{className:"text-greyscale-400 mr-1",children:"参与代币数"}),(0,s.jsx)("span",{className:"text-secondary",children:(0,u.LH)(o[t].joinedAmount||0n,0)})]})]})]}),(0,s.jsx)(v.Z,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-greyscale-400 pointer-events-none"})]})},e.action.head.id)})})]})},C=n(4062),k=n(5028),B=()=>{let e=(0,r.useRouter)(),{currentRound:t,error:n,isPending:o}=(0,k.Bk)(),{token:d}=(0,a.useContext)(c.M)||{},{handleContractError:u}=(0,i.S)();return((0,a.useEffect)(()=>{n&&u(n,"join")},[n]),(0,a.useEffect)(()=>{d&&!d.hasEnded?e.push("/launch?symbol=".concat(d.symbol)):d&&!d.initialStakeRound&&e.push("/gov/stakelp/?symbol=".concat(d.symbol,"&first=true"))},[d]),o)?(0,s.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,s.jsx)(l.Z,{})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.Z,{title:"社区首页"}),(0,s.jsxs)("main",{className:"flex-grow",children:[(0,s.jsx)(C.Z,{}),(0,s.jsx)(f,{currentRound:t}),(0,s.jsx)(w,{currentRound:t})]})]})}}},function(e){e.O(0,[1664,2209,1335,6242,7863,7380,6697,2042,4062,2888,9774,179],function(){return e(e.s=87869)}),_N_E=e.O()}]);