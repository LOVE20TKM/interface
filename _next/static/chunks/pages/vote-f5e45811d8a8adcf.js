(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7260],{21099:(e,s,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote",function(){return n(82763)}])},82763:(e,s,n)=>{"use strict";n.r(s),n.d(s,{default:()=>I});var t=n(37876),a=n(14232),r=n(98684),l=n(20451),c=n(66663),i=n(40854),d=n(89099),o=n(97685),x=n(70641),m=n(61809),h=n(6960),u=n(28638),j=n(48230),v=n.n(j),N=n(64115),y=n(20442),f=n(83416),b=n(87577),p=n(1709),g=n(12293);let w=e=>{var s=e.currentRound,n=((0,a.useContext)(f.N)||{}).token,c=(0,d.useRouter)(),j=(0,r.ch)((null==n?void 0:n.address)||"",s),w=j.votes,I=j.actionIds,_=j.isPending,C=j.error,A=(0,N.VD)((null==n?void 0:n.address)||"",s),B=A.actionSubmits,k=A.isPending;A.error;var E=Array.from(new Set((null==B?void 0:B.map(e=>BigInt(e.actionId)))||[])).sort((e,s)=>Number(e)-Number(s)),P=(0,N.ui)((null==n?void 0:n.address)||"",E),R=P.actionInfos,S=P.isPending,F=P.error,$=e=>{if(!I||!w)return 0n;var s=I.findIndex(s=>s===e);return -1!==s?w[s]:0n},z=(0,i._)((0,a.useState)(new Set),2),O=z[0],T=z[1],X=e=>{T(s=>{var n=new Set(s);return n.has(e)?n.delete(e):n.add(e),n})},D=(null==w?void 0:w.reduce((e,s)=>e+s,0n))||0n,J=(0,l.g)().handleContractError;return((0,a.useEffect)(()=>{C&&J(C,"vote"),F&&J(F,"submit")},[C,F]),_||k||E&&E.length>0&&S)?(0,t.jsx)("div",{className:"p-4 flex justify-center items-center",children:(0,t.jsx)(g.A,{})}):n?(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)(p.A,{title:"投票中的行动"}),n&&(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)(h.$,{variant:"outline",size:"sm",className:"text-secondary border-secondary",asChild:!0,children:(0,t.jsx)(v(),{href:"/action/new/?symbol=".concat(null==n?void 0:n.symbol),children:"推举新行动"})}),(0,t.jsx)(h.$,{variant:"outline",size:"sm",className:"text-secondary border-secondary",asChild:!0,children:(0,t.jsx)(v(),{href:"/vote/actions4submit?symbol=".concat(null==n?void 0:n.symbol),children:"推举历史行动"})})]})]}),(0,t.jsx)("div",{className:"space-y-4",children:E.length>0?(0,t.jsxs)(t.Fragment,{children:[null==R?void 0:R.map((e,s)=>{var a,r=null==B||null==(a=B.find(s=>BigInt(s.actionId)===BigInt(e.head.id)))?void 0:a.submitter;return(0,t.jsxs)(u.Zp,{className:"shadow-none flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",className:"checkbox accent-secondary ml-2",checked:O.has(BigInt(e.head.id)),onChange:()=>X(BigInt(e.head.id))}),(0,t.jsxs)(v(),{href:"/action/".concat(e.head.id,"?type=vote&symbol=").concat(null==n?void 0:n.symbol),className:"w-full",children:[(0,t.jsxs)(u.aR,{className:"px-3 pt-2 pb-1 flex-row justify-start items-baseline",children:[(0,t.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No."}),(0,t.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(e.head.id)}),(0,t.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(e.body.action)})]}),(0,t.jsxs)(u.Wu,{className:"px-3 pt-1 pb-2",children:[(0,t.jsx)("div",{className:"text-greyscale-500",children:e.body.consensus}),(0,t.jsxs)("div",{className:"flex justify-between mt-1 text-sm",children:[(0,t.jsxs)("span",{className:"flex items-center",children:[(0,t.jsx)(x.A,{className:"text-greyscale-400 mr-1 h-3 w-3"}),(0,t.jsx)("span",{className:"text-greyscale-400",children:(0,t.jsx)(b.A,{address:e.head.author,showCopyButton:!1})})]}),(0,t.jsxs)("span",{className:"flex items-center",children:[(0,t.jsx)(m.A,{className:"text-greyscale-400 mr-1 h-3 w-3"}),(0,t.jsx)("span",{className:"text-greyscale-400",children:(0,t.jsx)(b.A,{address:r,showCopyButton:!1})})]}),(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-greyscale-400 mr-1",children:"票数"}),(0,t.jsxs)("span",{className:"text-secondary",children:[(0,y.NJ)($(BigInt(e.head.id)),0)," (",0===Number($(BigInt(e.head.id)))?"0":(100*Number($(BigInt(e.head.id)))/Number(D)).toFixed(1),"%)"]})]})]})]})]},e.head.id)]},e.head.id)}),(0,t.jsx)("div",{className:"flex justify-center mt-4",children:(0,t.jsx)(h.$,{variant:"outline",className:"w-1/2 text-secondary border-secondary",onClick:()=>{var e=Array.from(O).join(",");if(0===e.length)return void o.oR.error("请选择行动");c.push("/vote/vote?ids=".concat(e,"&symbol=").concat(null==n?void 0:n.symbol))},children:"给选中的行动投票"})}),(0,t.jsx)("div",{className:"mt-2 text-sm text-greyscale-500 text-center",children:"提示: 每轮最大可投票数，等于您的治理票数"})]}):(0,t.jsx)("div",{className:"text-sm text-greyscale-500 text-center mt-8",children:"还没推举行动，请先推举"})})]}):(0,t.jsx)(g.A,{})},I=()=>{var e=(0,r.vC)(),s=e.currentRound,n=e.isPending,i=e.error,d=(0,l.g)().handleContractError;return(0,a.useEffect)(()=>{i&&d(i,"vote")},[i]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.A,{title:"投票首页"}),(0,t.jsx)("main",{className:"flex-grow",children:n?(0,t.jsx)(g.A,{}):(0,t.jsx)(w,{currentRound:s})})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[2569,4115,1265,636,6593,8792],()=>s(21099)),_N_E=e.O()}]);