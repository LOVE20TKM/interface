(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9082],{87869:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/acting",function(){return n(75959)}])},34680:function(e,t,n){"use strict";n.d(t,{Ol:function(){return c},SZ:function(){return o},Zb:function(){return l},aY:function(){return d},eW:function(){return u},ll:function(){return i}});var s=n(85893),r=n(67294),a=n(40108);let l=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",n),...r})});l.displayName="Card";let c=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",n),...r})});c.displayName="CardHeader";let i=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",n),...r})});i.displayName="CardTitle";let o=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",n),...r})});o.displayName="CardDescription";let d=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",n),...r})});d.displayName="CardContent";let u=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",n),...r})});u.displayName="CardFooter"},4307:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(31134).Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},96693:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var s=n(85893),r=n(67294),a=n(42757),l=n(93778),c=e=>{let{initialTimeLeft:t,onTick:n}=e,[a,l]=(0,r.useState)(Date.now()+1e3*t),[c,i]=(0,r.useState)(t);(0,r.useEffect)(()=>{l(Date.now()+1e3*t)},[t]),(0,r.useEffect)(()=>{let e=setInterval(()=>{let t=Math.max(0,Math.floor((a-Date.now())/1e3));i(t),n&&n(t),t<=0&&(clearInterval(e),window.location.reload())},1e3);return()=>clearInterval(e)},[a,n]);let o=Math.floor(c/86400),d=Math.floor(c%86400/3600);return(0,s.jsxs)("div",{className:"inline-flex gap-1 text-secondary",children:[o>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"countdown font-mono",children:(0,s.jsx)("span",{style:{"--value":o}})}),"天"]}),(d>0||o>0)&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"countdown font-mono",children:(0,s.jsx)("span",{style:{"--value":d}})}),"时"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"countdown font-mono",children:(0,s.jsx)("span",{style:{"--value":Math.floor(c%3600/60)}})}),"分"]}),o<=0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"countdown font-mono",children:(0,s.jsx)("span",{style:{"--value":c%60}})}),"秒"]})]})},i=n(42083),o=e=>{let{currentRound:t,roundType:n}=e,{data:o}=(0,a.O)(),d=(0,r.useContext)(l.M),u=d?d.token:void 0,x=!o||!u||void 0===u.voteOriginBlocks||!u.initialStakeRound,[m,f]=(0,r.useState)(0n),h=Number("33784")||0,j=Number("255")||0,N=u?Number(u.voteOriginBlocks):0,v=h-(Number(o)-N)%h,p=v>0?Math.ceil(v*j/100):0,[b,g]=(0,r.useState)(p);(0,r.useEffect)(()=>{if(!o)return;let e=h-(Number(o)-N)%h;g(e>0?Math.ceil(e*j/100):0)},[o,h,j,N]),(0,r.useEffect)(()=>{u&&t>0n&&f(t-BigInt(u.initialStakeRound)+1n)},[t,u]);let y=null!=m?m.toString():"0";return x||null==m||m<0n?((null==m||m<0n)&&(console.log("currentTokenRound",m),console.log("currentRound",t),console.log("token.initialStakeRound",null==u?void 0:u.initialStakeRound),console.log("token",u)),(0,s.jsx)(i.Z,{})):(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsxs)("h1",{className:"text-lg font-bold",children:["第 ",(0,s.jsx)("span",{className:"text-secondary",children:y})," 轮","vote"===n?"投票":"verify"===n?"验证":"行动","阶段"]}),(0,s.jsxs)("span",{className:"text-sm mt-1 pt-0",children:[(0,s.jsx)("span",{className:"text-greyscale-400 mr-1",children:"剩余:"}),(0,s.jsx)("span",{className:"text-secondary mr-1",children:Math.ceil(100*b/j)}),(0,s.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),(0,s.jsx)(c,{initialTimeLeft:p,onTick:g})]})]})}},99958:function(e,t,n){"use strict";n.d(t,{Cn:function(){return a},IS:function(){return s},Tn:function(){return r}});let s=(e,t,n)=>{if(!e||!t)return"0%";let s=31536e5/Number("255"),r=BigInt("33784");if(0===s||0n===r)return console.error("配置错误: NEXT_PUBLIC_BLOCK_TIME 或 NEXT_PUBLIC_PHASE_BLOCKS 未设置"),"0%";let a=e?99n*e*99n/2000000n:BigInt(0),l=(2n*t||BigInt(0))+(n||BigInt(0));if(l===BigInt(0))return"0%";let c=Number(a)/Number(l)/(Number(r)/s)*100;return"".concat(c.toFixed(2).replace(/\.?0+$/,""),"%")},r=(e,t)=>{if(!e||!t||0n===t)return"0%";let n=31536e5/Number("255"),s=BigInt("33784");if(0===n||0n===s)return console.error("配置错误: BLOCK_TIME 或 PHASE_BLOCKS 未设置或为0"),"0%";let r=Number(e)/Number(t)/(Number(s)/n)*100;return"".concat(r.toFixed(2).replace(/\.?0+$/,""),"%")},a=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Number("33784")||0,s=Number("255")||0,r=e*n,a="".concat(r.toLocaleString(),"区块，约").concat(Math.ceil(Math.ceil(r*s/100)/86400),"天");return t||(a="".concat(e,"个阶段（").concat(a,")")),a}},75959:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return I}});var s=n(85893),r=n(67294),a=n(92321),l=n(27245),c=n(41664),i=n.n(c),o=n(42083),d=n(93778),u=n(67068),x=n(19638),m=n(7399),f=n(91529),h=n(96693),j=n(99958),N=e=>{let{currentRound:t}=e,{token:n}=(0,r.useContext)(d.M)||{},{rewardAvailable:a,isPending:l,error:c}=(0,m.CY)((null==n?void 0:n.address)||""),{balance:i,isPending:N,error:v}=(0,x.hS)((null==n?void 0:n.address)||"","0xDe5256A1cf6022ef6af832181CCE617Aee585Dc9"),{handleContractError:p}=(0,u.S)();(0,r.useEffect)(()=>{v&&p(v,"join"),c&&p(c,"mint")},[v,c]);let b=99n*(a||BigInt(0))/20000n;return(0,s.jsxs)("div",{className:"px-4",children:[(0,s.jsx)(h.Z,{currentRound:t||0n,roundType:"act"}),(0,s.jsxs)("div",{className:"w-full border rounded-lg mt-4 p-0",children:[(0,s.jsxs)("div",{className:"stats w-full grid grid-cols-2 divide-x-0",children:[(0,s.jsxs)("div",{className:"stat place-items-center pb-2",children:[(0,s.jsx)("div",{className:"stat-title text-sm pb-1",children:"参与行动代币"}),(0,s.jsx)("div",{className:"stat-value text-xl text-secondary",children:N?(0,s.jsx)(o.Z,{}):(0,f.LH)(i||BigInt(0),0)})]}),(0,s.jsxs)("div",{className:"stat place-items-center pb-2",children:[(0,s.jsx)("div",{className:"stat-title text-sm pb-1",children:"预计新增铸币"}),(0,s.jsx)("div",{className:"stat-value text-xl text-secondary",children:l||void 0===a?(0,s.jsx)(o.Z,{}):(0,f.LH)(b,2)})]})]}),(0,s.jsxs)("div",{className:"text-center text-xs mb-2 text-greyscale-500",children:["预估年化收益率（APY）：",(0,j.Tn)(b,i)]})]})]})},v=n(37436),p=n(4307),b=n(34680),g=n(45551),y=n(64777),w=e=>{let{currentRound:t}=e,{token:n}=(0,r.useContext)(d.M)||{},{address:l}=(0,a.m)(),{joinableActionDetails:c,joinedActions:x,isPending:m,error:h}=(0,g.jA)((null==n?void 0:n.address)||"",t||0n,l);null==c||c.sort((e,t)=>Number(e.action.head.id)-Number(t.action.head.id));let j=(null==c?void 0:c.reduce((e,t)=>e+t.votesNum,0n))||0n,{handleContractError:N}=(0,u.S)();return(0,r.useEffect)(()=>{h&&N(h,"dataViewer")},[h]),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)(y.Z,{title:"进行中的行动"}),!l&&(0,s.jsx)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:"请先连接钱包"}),l&&m&&(0,s.jsx)("div",{className:"p-4 flex justify-center items-center",children:(0,s.jsx)(o.Z,{})}),l&&!m&&!(null==c?void 0:c.length)&&(0,s.jsx)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:"本轮暂无行动"}),!m&&c&&c.length>0&&(0,s.jsx)("div",{className:"mt-4 space-y-4",children:c.map((e,t)=>{let r=(null==x?void 0:x.some(t=>t.action.head.id===e.action.head.id))?"/action/".concat(e.action.head.id,"?type=join&symbol=").concat(null==n?void 0:n.symbol):"/acting/join?id=".concat(e.action.head.id,"&symbol=").concat(null==n?void 0:n.symbol);return(0,s.jsx)(b.Zb,{className:"shadow-none",children:(0,s.jsxs)(i(),{href:r,className:"relative block",children:[(0,s.jsxs)(b.Ol,{className:"px-3 pt-2 pb-1 flex-row items-baseline",children:[(0,s.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No.".concat(e.action.head.id)}),(0,s.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(e.action.body.action)})]}),(0,s.jsxs)(b.aY,{className:"px-3 pt-1 pb-2",children:[(0,s.jsx)("div",{className:"text-greyscale-500",children:e.action.body.consensus}),(0,s.jsxs)("div",{className:"flex justify-between mt-1 text-sm",children:[(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{className:"text-greyscale-400 mr-1",children:"投票占比"}),(0,s.jsxs)("span",{className:"text-secondary",children:[(100*Number(c[t].votesNum||0n)/Number(j)).toFixed(1),"%"]})]}),(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{className:"text-greyscale-400 mr-1",children:"参与代币数"}),(0,s.jsx)("span",{className:"text-secondary",children:(0,f.LH)(c[t].joinedAmount||0n,0)})]})]})]}),(0,s.jsx)(p.Z,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-greyscale-400 pointer-events-none"})]})},e.action.head.id)})})]})},C=n(4062),k=n(5028),I=()=>{let{isConnected:e}=(0,a.m)(),{token:t}=(0,r.useContext)(d.M)||{},n=e&&(null==t?void 0:t.hasEnded)===!0,{currentRound:c,error:x,isPending:m}=(0,k.Bk)(n),{handleContractError:f}=(0,u.S)();return((0,r.useEffect)(()=>{x&&f(x,"join")},[x]),n&&m)?(0,s.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,s.jsx)(o.Z,{})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.Z,{title:"社区首页"}),(0,s.jsx)("main",{className:"flex-grow",children:e?t?t&&!t.hasEnded?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.Z,{}),(0,s.jsxs)("div",{className:"flex flex-col items-center p-4 mt-4",children:[(0,s.jsx)("div",{className:"text-center mb-4 text-greyscale-500",children:"公平发射未结束，还不能参与社区行动"}),(0,s.jsx)(l.z,{className:"w-1/2",asChild:!0,children:(0,s.jsx)(i(),{href:"/launch?symbol=".concat(t.symbol),children:"查看公平发射"})})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.Z,{}),(0,s.jsx)(N,{currentRound:c}),(0,s.jsx)(w,{currentRound:c})]}):(0,s.jsx)(o.Z,{}):(0,s.jsx)("div",{className:"flex flex-col items-center p-4 mt-4",children:(0,s.jsx)("div",{className:"text-center mb-4 text-greyscale-500",children:"没有链接钱包，请先连接钱包"})})})]})}},42757:function(e,t,n){"use strict";n.d(t,{O:function(){return u}});var s=n(30202),r=n(97712),a=n(81946),l=n(36100),c=n(45631),i=n(82002),o=n(80666),d=n(97861);function u(e={}){let{query:t={},watch:n}=e,u=(0,o.Z)(e),x=(0,s.NL)(),m=(0,i.x)({config:u}),f=e.chainId??m,h=function(e,t={}){return{gcTime:0,async queryFn({queryKey:t}){let{scopeKey:n,...s}=t[1];return await function(e,t={}){let{chainId:n,...s}=t,l=e.getClient({chainId:n});return(0,a.s)(l,r.z,"getBlockNumber")(s)}(e,s)??null},queryKey:function(e={}){return["blockNumber",(0,l.OP)(e)]}(t)}}(u,{...e,chainId:f});return(0,d.x)({...{config:e.config,chainId:e.chainId,..."object"==typeof n?n:{}},enabled:!!((t.enabled??!0)&&("object"==typeof n?n.enabled:n)),onBlockNumber(e){x.setQueryData(h.queryKey,e)}}),(0,c.aM)({...t,...h})}},97861:function(e,t,n){"use strict";n.d(t,{x:function(){return i}});var s=n(65185),r=n(81946),a=n(67294),l=n(82002),c=n(80666);function i(e={}){let{enabled:t=!0,onBlockNumber:n,config:i,...o}=e,d=(0,c.Z)(e),u=(0,l.x)({config:d}),x=e.chainId??u;(0,a.useEffect)(()=>{if(t&&n)return function(e,t){let n,a;let{syncConnectedChain:l=e._internal.syncConnectedChain,...c}=t,i=t=>{n&&n();let a=e.getClient({chainId:t});return n=(0,r.s)(a,s.q,"watchBlockNumber")(c)},o=i(t.chainId);return l&&!t.chainId&&(a=e.subscribe(({chainId:e})=>e,async e=>i(e))),()=>{o?.(),a?.()}}(d,{...o,chainId:x,onBlockNumber:n})},[x,d,t,n,o.onError,o.emitMissed,o.emitOnBegin,o.poll,o.pollingInterval,o.syncConnectedChain])}}},function(e){e.O(0,[2209,1335,2690,7863,7380,6697,4062,2042,2888,9774,179],function(){return e(e.s=87869)}),_N_E=e.O()}]);