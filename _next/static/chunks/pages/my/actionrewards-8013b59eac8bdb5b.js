try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="cfcaef57-388b-4494-9351-d23c44a485ad",e._sentryDebugIdIdentifier="sentry-dbid-cfcaef57-388b-4494-9351-d23c44a485ad")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[943],{51436:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/actionrewards",function(){return t(69534)}])},64777:function(e,n,t){"use strict";var r=t(85893);n.Z=function(e){var n=e.title;return(0,r.jsx)("div",{className:"flex justify-between items-center",children:(0,r.jsx)("h1",{className:"text-lg font-bold",children:n})})}},42083:function(e,n,t){"use strict";var r=t(85893),s=t(23432);n.Z=function(){return(0,r.jsx)(s.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},69534:function(e,n,t){"use strict";t.r(n);var r=t(11010),s=t(72253),a=t(14932),i=t(91309),d=t(97582),c=t(85893),o=t(67294),l=t(86501),u=t(42130),f=t(11163),h=t(93778),x=t(7208),m=t(93950),g=t(7399),y=t(73591),b=t(83494),v=t(64777),j=t(42083),w=t(44576),p=t(27245),N=t(91529),_=t(6743),S=BigInt(30);n.default=function(){var e,n=(0,f.useRouter)(),t=((0,o.useContext)(h.M)||{}).token,I=(0,u.m)().address,B=(0,x.N6)(null==t?void 0:t.address,I,S),E=B.rewards,k=B.isPending,M=B.error,C=(0,m.dB)(null==t?void 0:t.address,I),Z=C.joinedActions,P=C.isPending,D=C.error,T=(0,o.useMemo)(function(){if(!Z||!E)return[];var e=new Map,n=!0,t=!1,r=void 0;try{for(var s,a=E[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var i=s.value;if(!(i.reward<=BigInt(0))){var d=i.actionId.toString();e.has(d)||e.set(d,[]),e.get(d).push(i)}}}catch(e){t=!0,r=e}finally{try{n||null==a.return||a.return()}finally{if(t)throw r}}var c=[],o=!0,l=!1,u=void 0;try{for(var f,h=Z[Symbol.iterator]();!(o=(f=h.next()).done);o=!0){var x=f.value,m=String(x.action.head.id),g=e.get(m)||[];g.length>0&&g.sort(function(e,n){return e.round>n.round?-1:1}),c.push({action:x,rewards:g})}}catch(e){l=!0,u=e}finally{try{o||null==h.return||h.return()}finally{if(l)throw u}}return c.sort(function(e,n){return BigInt(e.action.action.head.id)>BigInt(n.action.action.head.id)?-1:1}),c},[Z,E]),F=(0,g.Rb)(),O=F.mintActionReward,R=F.isPending,z=F.isConfirming,A=F.isConfirmed,L=F.writeError,V=(0,i._)((0,o.useState)(null),2),X=V[0],q=V[1],H=(0,i._)((0,o.useState)(new Set),2),J=H[0],K=H[1];(0,o.useEffect)(function(){if(A){if(l.ZP.success("铸造成功"),X){var e="".concat(X.actionId.toString(),"-").concat(X.round.toString());K(function(n){var t=new Set(n);return t.add(e),t})}(null==t?void 0:t.address)&&I&&(0,_.j)(I,t.address,!1)}},[A,X,null==t?void 0:t.address,I]),(0,o.useEffect)(function(){K(new Set)},[null==t?void 0:t.address,I]),(0,o.useEffect)(function(){if((null==t?void 0:t.address)&&I&&!k&&E&&!E.some(function(e){return e.reward>BigInt(0)&&!e.isMinted})){var e=(0,_.FP)(I,t.address);if(null==e?void 0:e.needMinted){var n=(0,_.iO)(I,t.address);localStorage.removeItem(n),(0,_.j)(I,t.address,!1)}}},[null==t?void 0:t.address,I,k,E]);var G=(e=(0,r._)(function(e,n){return(0,d.Jh)(this,function(r){switch(r.label){case 0:if(!((null==t?void 0:t.address)&&I))return[3,2];return q({actionId:n,round:e}),[4,O(t.address,e,n)];case 1:r.sent(),r.label=2;case 2:return[2]}})}),function(n,t){return e.apply(this,arguments)}),Q=(0,o.useMemo)(function(){return T?T.map(function(e){return(0,a._)((0,s._)({},e),{rewards:e.rewards.map(function(n){var t="".concat(BigInt(e.action.action.head.id).toString(),"-").concat(n.round.toString());return J.has(t)||n.isMinted?(0,a._)((0,s._)({},n),{isMinted:!0}):n})})}):[]},[T,J]),U=(0,y.S)().handleContractError;return(0,o.useEffect)(function(){M&&U(M,"dataViewer"),D&&U(D,"dataViewer"),L&&U(L,"mint")},[M,D,L,U]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(b.Z,{title:"行动激励",showBackButton:!0}),(0,c.jsxs)("main",{className:"flex-grow",children:[t?(0,c.jsxs)("div",{className:"flex flex-col space-y-6 p-4",children:[(0,c.jsxs)("div",{className:"flex justify-between items-center",children:[(0,c.jsx)(v.Z,{title:"铸造行动激励"}),(0,c.jsx)("button",{onClick:function(){return n.push("/my/queryaction?symbol=".concat(null==t?void 0:t.symbol))},className:"text-secondary hover:text-secondary/80 text-sm bg-transparent border-none cursor-pointer",children:"查看已退出行动激励\xa0>>"})]}),k||P?(0,c.jsx)(j.Z,{}):Q.length>0?Q.map(function(e){return(0,c.jsxs)("div",{className:"border border-gray-100 rounded-lg p-4 shadow-sm",children:[(0,c.jsx)("div",{className:"flex items-center mb-3",children:(0,c.jsxs)("div",{className:"flex items-baseline  mr-2",children:[(0,c.jsx)("span",{className:"text-greyscale-500",children:"No."}),(0,c.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(e.action.action.head.id)}),(0,c.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(e.action.action.body.title)})]})}),e.rewards.length>0?(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)("table",{className:"table w-full table-auto",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,c.jsx)("th",{children:"轮次"}),(0,c.jsx)("th",{className:"text-center",children:"可铸造激励"}),(0,c.jsx)("th",{className:"text-center",children:"结果"})]})}),(0,c.jsx)("tbody",{children:e.rewards.map(function(n,r){return(0,c.jsxs)("tr",{className:r===e.rewards.length-1?"border-none":"border-b border-gray-100",children:[(0,c.jsx)("td",{children:(0,N.cK)(n.round,t).toString()}),(0,c.jsx)("td",{className:"text-center",children:(0,N.LH)(n.reward||BigInt(0))}),(0,c.jsx)("td",{className:"text-center",children:n.reward>BigInt(0)&&!n.isMinted?(0,c.jsx)(p.z,{variant:"outline",size:"sm",className:"text-secondary border-secondary",onClick:function(){return G(n.round,BigInt(e.action.action.head.id))},disabled:R||z,children:"铸造"}):n.isMinted?(0,c.jsx)("span",{className:"text-greyscale-500",children:"已铸造"}):(0,c.jsx)("span",{className:"text-greyscale-500",children:"-"})})]},"".concat(e.action.action.head.id,"-").concat(n.round.toString()))})})]})}):(0,c.jsxs)("div",{className:"text-center text-greyscale-500 py-4",children:["该行动最近 ",S.toString()," 轮没有获得激励"]}),(0,c.jsx)("div",{className:"text-center",children:(0,c.jsx)("button",{onClick:function(){return n.push("/my/rewardsofaction?id=".concat(e.action.action.head.id))},className:"text-secondary hover:text-secondary/80 underline text-sm bg-transparent border-none cursor-pointer",children:"查看更多激励 >>"})})]},e.action.action.head.id)}):(0,c.jsx)("div",{className:"text-center text-greyscale-500 py-8",children:"没有参与任何行动"})]}):(0,c.jsx)(j.Z,{}),(0,c.jsx)(w.Z,{isLoading:R||z,text:R?"提交交易...":"确认交易..."})]})]})}}},function(e){e.O(0,[8239,5115,3494,3591,3950,7399,2888,9774,179],function(){return e(e.s=51436)}),_N_E=e.O()}]);