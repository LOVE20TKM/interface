(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4249],{1709:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});var a=t(37876);let r=e=>{var s=e.title;return(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsx)("h1",{className:"text-lg font-bold",children:s})})}},11704:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/actrewards",function(){return t(79441)}])},19671:(e,s,t)=>{"use strict";t.d(s,{BE:()=>f,I6:()=>v,Uz:()=>x,_s:()=>o,cp:()=>u,gk:()=>N,tb:()=>g,zj:()=>j});var a=t(3576),r=t(62701),n=t(65699),c=t(37876),i=t(14232),l=t(28653),d=t(30684),o=e=>{var s=e.shouldScaleBackground,t=(0,n._)(e,["shouldScaleBackground"]);return(0,c.jsx)(l._s.Root,(0,a._)({shouldScaleBackground:void 0===s||s},t))};o.displayName="Drawer";var x=l._s.Trigger,m=l._s.Portal,u=l._s.Close,h=i.forwardRef((e,s)=>{var t=e.className,r=(0,n._)(e,["className"]);return(0,c.jsx)(l._s.Overlay,(0,a._)({ref:s,className:(0,d.cn)("fixed inset-0 z-50 bg-black/80",t)},r))});h.displayName=l._s.Overlay.displayName;var j=i.forwardRef((e,s)=>{var t=e.className,i=e.children,o=(0,n._)(e,["className","children"]);return(0,c.jsxs)(m,{children:[(0,c.jsx)(h,{}),(0,c.jsxs)(l._s.Content,(0,r._)((0,a._)({ref:s,className:(0,d.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t)},o),{children:[(0,c.jsx)("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),i]}))]})});j.displayName="DrawerContent";var f=e=>{var s=e.className,t=(0,n._)(e,["className"]);return(0,c.jsx)("div",(0,a._)({className:(0,d.cn)("grid gap-1.5 p-4 text-center sm:text-left",s)},t))};f.displayName="DrawerHeader";var g=e=>{var s=e.className,t=(0,n._)(e,["className"]);return(0,c.jsx)("div",(0,a._)({className:(0,d.cn)("mt-auto flex flex-col gap-2 p-4",s)},t))};g.displayName="DrawerFooter";var N=i.forwardRef((e,s)=>{var t=e.className,r=(0,n._)(e,["className"]);return(0,c.jsx)(l._s.Title,(0,a._)({ref:s,className:(0,d.cn)("text-lg font-semibold leading-none tracking-tight",t)},r))});N.displayName=l._s.Title.displayName;var v=i.forwardRef((e,s)=>{var t=e.className,r=(0,n._)(e,["className"]);return(0,c.jsx)(l._s.Description,(0,a._)({ref:s,className:(0,d.cn)("text-sm text-muted-foreground",t)},r))});v.displayName=l._s.Description.displayName},42038:(e,s,t)=>{"use strict";t.d(s,{C:()=>r});var a=t(97685),r=e=>!!e||(a.oR.error("请先将钱包链接 ".concat("thinkium70001")),!1)},79441:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>B});var a=t(40854),r=t(37876),n=t(14232),c=t(89099),i=t(17660),l=t(20451),d=t(92101),o=t(60154),x=t(12293),m=t(16927),u=t(3576),h=t(62701),j=t(4902),f=t(8047),g=t(6960),N=t(30822),v=t(96108),p=t(62288),y=t(52372),_=t(83416),w=t(87577),b=t(19671);let C=e=>{var s=e.currentRound,t=e.handleChangedRound,c=(0,a._)((0,n.useState)(!1),2),i=c[0],l=c[1],d=e=>{t(e),l(!1)};return"undefined"!=typeof document&&document.addEventListener("touchstart",function(){},{passive:!1}),(0,r.jsxs)(b._s,{open:i,onOpenChange:l,children:[(0,r.jsx)(b.Uz,{asChild:!0,children:(0,r.jsx)(g.$,{variant:"link",className:"text-secondary no-underline pl-2 pr-1",children:"切换轮次"})}),(0,r.jsxs)(b.zj,{className:"z-[9999] min-h-[25vh]",children:[(0,r.jsxs)(b.BE,{children:[(0,r.jsx)(b.gk,{}),(0,r.jsx)(b.I6,{})]}),(0,r.jsx)("div",{className:"px-4 flex-grow",children:(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto",children:Array.from({length:Number(s)},(e,t)=>{var a=Number(s)-t;return(0,r.jsx)(g.$,{variant:"ghost",className:"w-full p-2 text-center rounded-none hover:bg-gray-100 touch-manipulation",onClick:e=>{e.preventDefault(),e.stopPropagation(),d(a)},onTouchEnd:e=>{e.preventDefault(),e.stopPropagation(),d(a)},style:{touchAction:"manipulation"},children:(0,r.jsxs)("span",{className:"text-lg",children:["第 ",a," 轮"]})},a)})})}),(0,r.jsx)(b.tb,{children:(0,r.jsx)(b.cp,{asChild:!0,children:(0,r.jsx)(g.$,{variant:"outline",children:"关闭"})})})]})]})};var k=t(1709),A=t(99574),E=t(42038),R=t(20442),I=t(43885);let S=e=>{var s=e.currentJoinRound,t=e.actionId,c=e.actionInfo,i=((0,n.useContext)(_.N)||{}).token,d=(0,f.F)(),o=d.address,b=d.chain,S=(0,a._)((0,n.useState)(0n),2),z=S[0],B=S[1],P=(0,a._)((0,n.useState)(new Set),2),D=P[0],$=P[1];(0,n.useEffect)(()=>{i&&s-BigInt(i.initialStakeRound)>=2n&&B(s-1n)},[s,i]);var F=(0,y.p$)(null==i?void 0:i.address,i&&z?z:0n,t),T=F.verifiedAddresses,L=F.isPending,O=F.error,H=(0,y.Zp)(null==i?void 0:i.address,i&&z?z:0n,t),M=H.verificationInfos,V=H.isPending,J=H.error,U=(0,a._)((0,n.useState)([]),2),X=U[0],q=U[1];(0,n.useEffect)(()=>{T&&q(T)},[T]);var K=(0,p.b$)(),Y=K.mintActionReward,Z=K.isPending,G=K.isConfirming,Q=K.isConfirmed,W=K.writeError,ee=function(){var e=(0,m._)(function(e){return(0,j.YH)(this,function(s){switch(s.label){case 0:if(!(0,E.C)(b))return[2];if(!(o&&e.reward>0n&&!e.isMinted&&i))return[3,2];return[4,Y(null==i?void 0:i.address,z,t)];case 1:s.sent(),s.label=2;case 2:return[2]}})});return function(s){return e.apply(this,arguments)}}();(0,n.useEffect)(()=>{Q&&q(e=>e.map(e=>e.account===o?(0,h._)((0,u._)({},e),{isMinted:!0}):e))},[Q,o]);var es=(0,l.g)().handleContractError;(0,n.useEffect)(()=>{O&&es(O,"dataViewer"),J&&es(J,"dataViewer"),W&&es(W,"mint")},[O,J,W]),(0,n.useEffect)(()=>{X.length>0&&0===D.size&&$(new Set([[...X].sort((e,s)=>e.score>s.score?-1:+(e.score<s.score))[0].account]))},[X]);var et=[...X].sort((e,s)=>e.score>s.score?-1:+(e.score<s.score)),ea=e=>{var s=new Set(D);s.has(e)?s.delete(e):s.add(e),$(s)};return(0,r.jsxs)("div",{className:"relative px-4 py-4",children:[0n===z&&(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-center text-sm text-greyscale-500",children:"暂无验证结果"})}),(0,r.jsx)("div",{className:"flex items-center",children:z>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k.A,{title:"验证结果"}),(0,r.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"("}),(0,r.jsx)("span",{className:"text-sm text-greyscale-500",children:"行动轮第"}),(0,r.jsx)("span",{className:"text-sm text-secondary ml-1",children:z.toString()}),(0,r.jsx)("span",{className:"text-sm text-greyscale-500 ml-1",children:"轮"}),(0,r.jsx)(C,{currentRound:i&&s?(0,R.LP)(s-2n,i):0n,handleChangedRound:e=>{B(BigInt(e))}}),(0,r.jsx)("span",{className:"text-sm text-greyscale-500",children:")"})]})}),L||V?(0,r.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,r.jsx)(x.A,{})}):0===X.length?z>0n&&(0,r.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有可铸造激励的地址"}):(0,r.jsxs)("table",{className:"table w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,r.jsx)("th",{}),(0,r.jsx)("th",{children:"被抽中地址"}),(0,r.jsx)("th",{className:"px-1 text-right",children:"获得验证票"}),(0,r.jsx)("th",{className:"px-1 text-right",children:"可铸造激励"}),(0,r.jsx)("th",{className:"text-right"})]})}),(0,r.jsx)("tbody",{children:et.map(e=>{var s=null==M?void 0:M.find(s=>s.account===e.account),t=D.has(e.account);return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===o?"text-secondary":""),children:[(0,r.jsx)("td",{className:"px-1 w-8",children:s&&(0,r.jsx)("button",{onClick:()=>ea(e.account),className:"text-greyscale-400 hover:text-greyscale-600",children:t?(0,r.jsx)(N.A,{size:16}):(0,r.jsx)(v.A,{size:16})})}),(0,r.jsx)("td",{className:"px-1 ",children:(0,r.jsx)(w.A,{address:e.account,showCopyButton:!0,word:e.account===o?"(我)":""})}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,R.$w)(e.score)}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,R.$w)(e.reward||0n)}),(0,r.jsx)("td",{className:"px-1 text-right",children:e.account===o&&(e.reward>0n&&!e.isMinted?(0,r.jsx)(g.$,{variant:"outline",size:"sm",className:"text-secondary border-secondary",onClick:()=>ee(e),disabled:Z||G,children:"铸造"}):e.score>0?(0,r.jsx)("span",{className:"text-greyscale-500",children:"已铸造"}):null)})]}),s&&c&&t&&(0,r.jsxs)("tr",{className:"border-b border-gray-100 bg-gray-50",children:[(0,r.jsx)("td",{}),(0,r.jsx)("td",{colSpan:4,className:"px-1 py-3",children:(0,r.jsxs)("div",{className:"text-sm text-greyscale-600",children:[(0,r.jsx)("div",{className:"text-xs text-greyscale-400 mb-2",children:"验证信息:"}),c.body.verificationKeys.map((e,t)=>(0,r.jsxs)("div",{className:"mb-1",children:[(0,r.jsxs)("span",{className:"text-greyscale-500",children:[e,":"]})," ",(0,r.jsx)(I.H,{text:s.infos[t]})]},t))]})})]})]},e.account)})})]}),(0,r.jsx)(A.A,{isLoading:Z||G,text:Z?"提交交易...":"确认交易..."})]})};var z=t(22605);let B=()=>{var e=(0,c.useRouter)().query.id,s=(0,i.vC)(),t=s.currentRound,m=s.isPending,u=s.error,h=(0,a._)((0,n.useState)(void 0),2),j=h[0],f=h[1],g=(0,l.g)().handleContractError;return(0,n.useEffect)(()=>{u&&g(u,"join")},[u]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.A,{title:"行动激励"}),(0,r.jsx)("main",{className:"flex-grow",children:m?(0,r.jsx)(x.A,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(z.A,{actionId:BigInt(e||0),onRoundChange:()=>{},actionInfo:j}),(0,r.jsx)(S,{currentJoinRound:t,actionId:BigInt(e||0),actionInfo:j}),(0,r.jsx)(d.A,{actionId:BigInt(e||0),round:t,showSubmitter:!1,showVerifyHistory:!1,onActionInfo:f})]})})]})}},99574:(e,s,t)=>{"use strict";t.d(s,{A:()=>n});var a=t(37876);t(14232);var r=t(7446);let n=e=>{var s=e.isLoading,t=e.text;return s?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(r.A,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,a.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:void 0===t?"Loading":t})]})}):null}}},e=>{var s=s=>e(e.s=s);e.O(0,[3308,7657,8230,5701,154,3096,4115,2288,7432,1217,636,6593,8792],()=>s(11704)),_N_E=e.O()}]);