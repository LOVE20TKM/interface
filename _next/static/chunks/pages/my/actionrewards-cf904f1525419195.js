try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="172da158-7985-4f9b-8050-1c6ada3e3516",e._sentryDebugIdIdentifier="sentry-dbid-172da158-7985-4f9b-8050-1c6ada3e3516")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[943],{51436:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/actionrewards",function(){return n(17762)}])},35810:function(e,t,n){"use strict";n.d(t,{$N:function(){return g},Be:function(){return v},Vq:function(){return l},cN:function(){return h},cZ:function(){return f},fK:function(){return x},hg:function(){return p}});var a=n(72253),r=n(14932),s=n(47702),i=n(85893),o=n(67294),d=n(12854),c=n(62190),u=n(40108),l=d.fC,p=d.xz,y=d.h_;d.x8;var m=o.forwardRef(function(e,t){var n=e.className,r=(0,s._)(e,["className"]);return(0,i.jsx)(d.aV,(0,a._)({ref:t,className:(0,u.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n)},r))});m.displayName=d.aV.displayName;var f=o.forwardRef(function(e,t){var n=e.className,o=e.children,l=(0,s._)(e,["className","children"]);return(0,i.jsxs)(y,{children:[(0,i.jsx)(m,{}),(0,i.jsxs)(d.VY,(0,r._)((0,a._)({ref:t,className:(0,u.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n)},l),{children:[o,(0,i.jsxs)(d.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,i.jsx)(c.Z,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"sr-only",children:"Close"})]})]}))]})});f.displayName=d.VY.displayName;var x=function(e){var t=e.className,n=(0,s._)(e,["className"]);return(0,i.jsx)("div",(0,a._)({className:(0,u.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t)},n))};x.displayName="DialogHeader";var h=function(e){var t=e.className,n=(0,s._)(e,["className"]);return(0,i.jsx)("div",(0,a._)({className:(0,u.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t)},n))};h.displayName="DialogFooter";var g=o.forwardRef(function(e,t){var n=e.className,r=(0,s._)(e,["className"]);return(0,i.jsx)(d.Dx,(0,a._)({ref:t,className:(0,u.cn)("text-lg font-semibold leading-none tracking-tight",n)},r))});g.displayName=d.Dx.displayName;var v=o.forwardRef(function(e,t){var n=e.className,r=(0,s._)(e,["className"]);return(0,i.jsx)(d.dk,(0,a._)({ref:t,className:(0,u.cn)("text-sm text-muted-foreground",n)},r))});v.displayName=d.dk.displayName},26986:function(e,t,n){"use strict";n.d(t,{OX:function(){return x},Qz:function(){return l},dy:function(){return u},iI:function(){return g},sc:function(){return f},u6:function(){return v},uh:function(){return y},ze:function(){return h}});var a=n(72253),r=n(14932),s=n(47702),i=n(85893),o=n(67294),d=n(53798),c=n(40108),u=function(e){var t=e.shouldScaleBackground,n=(0,s._)(e,["shouldScaleBackground"]);return(0,i.jsx)(d.dy.Root,(0,a._)({shouldScaleBackground:void 0===t||t},n))};u.displayName="Drawer";var l=d.dy.Trigger,p=d.dy.Portal,y=d.dy.Close,m=o.forwardRef(function(e,t){var n=e.className,r=(0,s._)(e,["className"]);return(0,i.jsx)(d.dy.Overlay,(0,a._)({ref:t,className:(0,c.cn)("fixed inset-0 z-50 bg-black/80",n)},r))});m.displayName=d.dy.Overlay.displayName;var f=o.forwardRef(function(e,t){var n=e.className,o=e.children,u=(0,s._)(e,["className","children"]);return(0,i.jsxs)(p,{children:[(0,i.jsx)(m,{}),(0,i.jsxs)(d.dy.Content,(0,r._)((0,a._)({ref:t,className:(0,c.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",n)},u),{children:[(0,i.jsx)("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),o]}))]})});f.displayName="DrawerContent";var x=function(e){var t=e.className,n=(0,s._)(e,["className"]);return(0,i.jsx)("div",(0,a._)({className:(0,c.cn)("grid gap-1.5 p-4 text-center sm:text-left",t)},n))};x.displayName="DrawerHeader";var h=function(e){var t=e.className,n=(0,s._)(e,["className"]);return(0,i.jsx)("div",(0,a._)({className:(0,c.cn)("mt-auto flex flex-col gap-2 p-4",t)},n))};h.displayName="DrawerFooter";var g=o.forwardRef(function(e,t){var n=e.className,r=(0,s._)(e,["className"]);return(0,i.jsx)(d.dy.Title,(0,a._)({ref:t,className:(0,c.cn)("text-lg font-semibold leading-none tracking-tight",n)},r))});g.displayName=d.dy.Title.displayName;var v=o.forwardRef(function(e,t){var n=e.className,r=(0,s._)(e,["className"]);return(0,i.jsx)(d.dy.Description,(0,a._)({ref:t,className:(0,c.cn)("text-sm text-muted-foreground",n)},r))});v.displayName=d.dy.Description.displayName},43637:function(e,t,n){"use strict";n.d(t,{w:function(){return a}});var a=[{type:"constructor",inputs:[{name:"originBlocks",type:"uint256",internalType:"uint256"},{name:"phaseBlocks",type:"uint256",internalType:"uint256"}],stateMutability:"nonpayable"},{type:"function",name:"RANDOM_SEED_UPDATE_MIN_PER_TEN_THOUSAND",inputs:[],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"abstentionScoreWithReward",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"currentRound",inputs:[],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"firstTokenAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"hasTriggeredRandomUpdate",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"address",internalType:"address"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"initialize",inputs:[{name:"randomAddress_",type:"address",internalType:"address"},{name:"firstTokenAddress_",type:"address",internalType:"address"},{name:"stakeAddress_",type:"address",internalType:"address"},{name:"voteAddress_",type:"address",internalType:"address"},{name:"joinAddress_",type:"address",internalType:"address"},{name:"mintAddress_",type:"address",internalType:"address"},{name:"randomSeedUpdateMinPerTenThousand",type:"uint256",internalType:"uint256"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"initialized",inputs:[],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"joinAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"mintAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"originBlocks",inputs:[],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"phaseBlocks",inputs:[],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"randomAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"roundByBlockNumber",inputs:[{name:"blockNumber",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"score",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"scoreByActionId",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"scoreByActionIdByAccount",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"address",internalType:"address"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"scoreByVerifier",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"address",internalType:"address"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"scoreByVerifierByActionId",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"scoreByVerifierByActionIdByAccount",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"address",internalType:"address"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"scoreWithReward",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"stakeAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"stakedAmountOfVerifiers",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"verify",inputs:[{name:"tokenAddress",type:"address",internalType:"address"},{name:"actionId",type:"uint256",internalType:"uint256"},{name:"abstentionScore",type:"uint256",internalType:"uint256"},{name:"scores",type:"uint256[]",internalType:"uint256[]"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"voteAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"event",name:"Verify",inputs:[{name:"tokenAddress",type:"address",indexed:!0,internalType:"address"},{name:"round",type:"uint256",indexed:!1,internalType:"uint256"},{name:"verifier",type:"address",indexed:!0,internalType:"address"},{name:"actionId",type:"uint256",indexed:!0,internalType:"uint256"},{name:"abstentionScore",type:"uint256",indexed:!1,internalType:"uint256"},{name:"scores",type:"uint256[]",indexed:!1,internalType:"uint256[]"}],anonymous:!1},{type:"error",name:"AlreadyInitialized",inputs:[]},{type:"error",name:"RoundNotStarted",inputs:[]},{type:"error",name:"ScoresAndAccountsLengthMismatch",inputs:[]},{type:"error",name:"ScoresExceedVotesNum",inputs:[]},{type:"error",name:"ScoresMustIncrease",inputs:[]}]},44746:function(e,t,n){"use strict";n.d(t,{Z:function(){return p}});var a=n(72253),r=n(14932),s=n(91309),i=n(85893),o=n(67294),d=n(74598),c=n(35810),u=n(26986),l=n(79995);function p(e){var t=e.title,n=e.content,p=e.className,y=void 0===p?"":p,m=(0,s._)((0,o.useState)(!1),2),f=m[0],x=m[1],h=(0,l.Z)("(min-width: 768px)"),g=o.forwardRef(function(e,n){return(0,i.jsx)("button",(0,r._)((0,a._)({ref:n,type:"button",className:"inline-flex items-center p-1 rounded hover:bg-gray-100 transition-colors ".concat(y),"aria-label":"查看".concat(t)},e),{children:(0,i.jsx)(d.Z,{className:"h-4 w-4 text-gray-500 hover:text-gray-700"})}))});g.displayName="TriggerButton";var v=function(){return(0,i.jsx)("div",{className:"text-gray-700",children:"string"==typeof n?(0,i.jsx)("p",{className:"leading-relaxed text-sm",children:n}):n})};return(0,i.jsxs)(i.Fragment,{children:[h&&(0,i.jsxs)(c.Vq,{open:f,onOpenChange:x,children:[(0,i.jsx)(c.hg,{asChild:!0,children:(0,i.jsx)(g,{})}),(0,i.jsxs)(c.cZ,{className:"sm:max-w-[425px]",children:[(0,i.jsx)(c.$N,{className:"text-lg font-semibold",children:t}),(0,i.jsx)("div",{className:"pt-2 pb-4",children:(0,i.jsx)(v,{})})]})]}),!h&&(0,i.jsxs)(u.dy,{open:f,onOpenChange:x,children:[(0,i.jsx)(u.Qz,{asChild:!0,children:(0,i.jsx)(g,{})}),(0,i.jsxs)(u.sc,{className:"pb-safe",children:[(0,i.jsx)(u.OX,{children:(0,i.jsx)(u.iI,{className:"text-lg font-semibold",children:t})}),(0,i.jsx)("div",{className:"px-4 pb-8 mb-10",children:(0,i.jsx)(v,{})})]})]})]})}},64777:function(e,t,n){"use strict";var a=n(85893);t.Z=function(e){var t=e.title;return(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsx)("h1",{className:"text-lg font-bold",children:t})})}},42083:function(e,t,n){"use strict";var a=n(85893),r=n(23432);t.Z=function(){return(0,a.jsx)(r.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},17762:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return L}});var a=n(11010),r=n(72253),s=n(14932),i=n(91309),o=n(97582),d=n(85893),c=n(67294),u=n(86501),l=n(42130),p=n(11163),y=n(41664),m=n.n(y),f=n(93778),x=n(7208),h=n(93950),g=n(7399),v=n(4586),b=n(67516),N=n(98482),j=n(43637),w=n(97995),T=n(45631),_=function(e){var t=e.account,n=e.tokenAddress,s=e.actionRoundPairs,d=e.enabled,u=void 0===d||d,l=(0,c.useMemo)(function(){if(!u||0===s.length)return{validActionRoundPairs:[],actionRoundPairsKey:""};var e=s.map(function(e){return"".concat(e.actionId.toString(),"_").concat(e.round.toString())}).join("|");return{validActionRoundPairs:s,actionRoundPairsKey:e}},[s,u]),p=l.validActionRoundPairs,y=l.actionRoundPairsKey,m=(0,c.useMemo)(function(){return u&&0!==p.length&&n?p.map(function(e){var t=e.actionId,a=e.round;return{address:"0xACea4f086BE05BeA47f3A56788FA3919C7f40799",abi:N.S,functionName:"randomAccounts",args:[n,a,t]}}):[]},[n,p,u]),f=(0,b.N)({contracts:m,query:{enabled:u&&m.length>0}}),x=f.data,h=f.isLoading,g=f.error,_=f.isSuccess;console.log("randomAccountsData",x);var S=(0,i._)((0,c.useState)({}),2),I=S[0],B=S[1],M=(0,i._)((0,c.useState)(!1),2),A=M[0],k=M[1],E=(0,i._)((0,c.useState)(null),2),R=E[0],C=E[1],P=(0,i._)((0,c.useState)(!1),2),D=P[0],L=P[1];(0,c.useEffect)(function(){var e;u&&x&&_&&0!==p.length&&n&&t&&(e=(0,a._)(function(){var e,a,s,i;return(0,o.Jh)(this,function(d){switch(d.label){case 0:k(!0),C(null),B({}),e={},d.label=1;case 1:d.trys.push([1,6,,7]),a=function(a){var s,i,d,c,u,l,y,m,f,h;return(0,o.Jh)(this,function(o){switch(o.label){case 0:if(i=(s=p[a]).actionId,d=s.round,(null==(c=x[a])?void 0:c.status)!=="success")return[3,2];return u=c.result,(l=(0,v._)(u)).includes(t)||l.push(t),y=l.map(function(e){return{address:"0x547b4a36980Ec030fBfC0162eE4B4904d9Cc0Da9",abi:j.w,functionName:"scoreByActionIdByAccount",args:[n,d,i,e]}}),console.log("正在加载 actionId=".concat(i,", round=").concat(d," 的分数数据，共 ").concat(y.length," 个账户...")),[4,(0,w.J)(T.v,{contracts:y})];case 1:m=o.sent(),f="".concat(i.toString(),"_").concat(d.toString()),h={},m.forEach(function(e,t){if((null==e?void 0:e.status)==="success"){var n=l[t],a=e.result||BigInt(0);h[n]=a}}),e[f]={actionId:i,round:d,accountScores:h},B((0,r._)({},e)),console.log("完成加载 actionId=".concat(i,", round=").concat(d,"，进度: ").concat(a+1,"/").concat(p.length)),o.label=2;case 2:return[2]}})},s=0,d.label=2;case 2:if(!(s<p.length))return[3,5];return[5,(0,o.XA)(a(s))];case 3:d.sent(),d.label=4;case 4:return s++,[3,2];case 5:return L(!0),k(!1),[3,7];case 6:return console.error("分批加载分数时出错:",i=d.sent()),C(i),k(!1),L(!1),[3,7];case 7:return[2]}})}),function(){return e.apply(this,arguments)})()},[u,n,t,y,_]);var Z=(0,c.useMemo)(function(){if(!u||0===p.length)return{scores:{},isLoading:!1,hasError:!1,allLoaded:!0};if(g||R)return{scores:{},isLoading:!1,hasError:!0,allLoaded:!1};if(h)return{scores:{},isLoading:!0,hasError:!1,allLoaded:!1};var e={};Object.values(I).forEach(function(n){var a=n.actionId,r=n.round,s=n.accountScores,i=Object.values(s).reduce(function(e,t){return t>e?t:e},BigInt(0)),o=s[t]||BigInt(0),d="0";if(i>BigInt(0)&&o>BigInt(0)){var c=o*BigInt(100)/i;d=(o*BigInt(100)%i*BigInt(2)>=i?Number(c)+1:Number(c)).toString()}var u=a.toString(),l=r.toString();e[u]||(e[u]={}),e[u][l]=d});var n=D&&!A;return{scores:e,isLoading:A,hasError:!1,allLoaded:n}},[u,p,t,h,A,g,R,D,x,_,I]);return{scores:Z.scores,isLoading:Z.isLoading,hasError:Z.hasError,allLoaded:Z.allLoaded}},S=n(73591),I=n(83494),B=n(64777),M=n(42083),A=n(44576),k=n(44746),E=n(27245),R=n(74598),C=n(26858),P=n(6743),D=BigInt(6),L=function(){var e,t=(0,p.useRouter)(),n=((0,c.useContext)(f.M)||{}).token,y=(0,l.m)().address,v=(0,x.N6)(null==n?void 0:n.address,y,D),b=v.rewards,N=v.isPending,j=v.error,w=(0,h.dB)(null==n?void 0:n.address,y),T=w.joinedActions,L=w.isPending,Z=w.error,z=(0,c.useMemo)(function(){if(!T||!b)return[];var e=new Map,t=!0,n=!1,a=void 0;try{for(var r,s=b[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var i=r.value;if(!(i.reward<=BigInt(0))){var o=i.actionId.toString();e.has(o)||e.set(o,[]),e.get(o).push(i)}}}catch(e){n=!0,a=e}finally{try{t||null==s.return||s.return()}finally{if(n)throw a}}var d=[],c=!0,u=!1,l=void 0;try{for(var p,y=T[Symbol.iterator]();!(c=(p=y.next()).done);c=!0){var m=p.value,f=String(m.action.head.id),x=e.get(f)||[];x.length>0&&x.sort(function(e,t){return e.round>t.round?-1:1}),d.push({action:m,rewards:x})}}catch(e){u=!0,l=e}finally{try{c||null==y.return||y.return()}finally{if(u)throw l}}return d.sort(function(e,t){return BigInt(e.action.action.head.id)>BigInt(t.action.action.head.id)?-1:1}),d},[T,b]),O=(0,c.useMemo)(function(){if(!b||0===b.length)return{actionRoundPairs:[],enabled:!1};var e=b.filter(function(e){return e.reward>BigInt(0)}).map(function(e){return{actionId:e.actionId,round:e.round}}).sort(function(e,t){return e.round>t.round?-1:1});return{actionRoundPairs:e,enabled:e.length>0}},[b]),V=_({account:y,tokenAddress:null==n?void 0:n.address,actionRoundPairs:O.actionRoundPairs,enabled:O.enabled&&!!y&&!!(null==n?void 0:n.address)}),F=V.scores,q=V.isLoading;V.hasError;var K=(0,g.Rb)(),J=K.mintActionReward,X=K.isPending,H=K.isConfirming,U=K.isConfirmed,Q=K.writeError,W=(0,i._)((0,c.useState)(null),2),Y=W[0],$=W[1],G=(0,i._)((0,c.useState)(new Set),2),ee=G[0],et=G[1];(0,c.useEffect)(function(){if(U){if(u.ZP.success("铸造成功"),Y){var e="".concat(Y.actionId.toString(),"-").concat(Y.round.toString());et(function(t){var n=new Set(t);return n.add(e),n})}(null==n?void 0:n.address)&&y&&(0,P.j)(y,n.address,!1)}},[U,Y,null==n?void 0:n.address,y]),(0,c.useEffect)(function(){et(new Set)},[null==n?void 0:n.address,y]),(0,c.useEffect)(function(){if((null==n?void 0:n.address)&&y&&!N&&b&&!b.some(function(e){return e.reward>BigInt(0)&&!e.isMinted})){var e=(0,P.FP)(y,n.address);if(null==e?void 0:e.needMinted){var t=(0,P.iO)(y,n.address);localStorage.removeItem(t),(0,P.j)(y,n.address,!1)}}},[null==n?void 0:n.address,y,N,b]);var en=(e=(0,a._)(function(e,t){return(0,o.Jh)(this,function(a){switch(a.label){case 0:if(!((null==n?void 0:n.address)&&y))return[3,2];return $({actionId:t,round:e}),[4,J(n.address,e,t)];case 1:a.sent(),a.label=2;case 2:return[2]}})}),function(t,n){return e.apply(this,arguments)}),ea=(0,c.useMemo)(function(){return z?z.map(function(e){return(0,s._)((0,r._)({},e),{rewards:e.rewards.map(function(t){var n,a="".concat(BigInt(e.action.action.head.id).toString(),"-").concat(t.round.toString()),i=e.action.action.head.id.toString(),o=t.round.toString(),d=null==F?void 0:null===(n=F[i])||void 0===n?void 0:n[o],c=q&&!d;return(0,s._)((0,r._)({},t),{isMinted:ee.has(a)||t.isMinted,score:d||"0.0",isScoreLoading:c})})})}):[]},[z,ee,F,q]),er=(0,S.S)().handleContractError;return(0,c.useEffect)(function(){j&&er(j,"dataViewer"),Z&&er(Z,"dataViewer"),Q&&er(Q,"mint")},[j,Z,Q,er]),(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(I.Z,{title:"行动激励",showBackButton:!0}),(0,d.jsxs)("main",{className:"flex-grow",children:[n?(0,d.jsxs)("div",{className:"flex flex-col space-y-6 p-4",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)(B.Z,{title:"铸造行动激励"}),(0,d.jsx)("button",{onClick:function(){return t.push("/my/queryaction?symbol=".concat(null==n?void 0:n.symbol))},className:"text-secondary hover:text-secondary/80 text-sm bg-transparent border-none cursor-pointer",children:"查看已退出行动激励\xa0>>"})]}),(0,d.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-red-500 text-sm",children:(0,d.jsxs)("div",{className:"flex items-start gap-2",children:[(0,d.jsx)(R.Z,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"font-medium",children:"小贴士："}),(0,d.jsx)("br",{}),"如果对激励打分有疑问，可以",(0,d.jsx)("br",{}),"1. 仔细阅读行动打分规则，检查是否按要求打卡；",(0,d.jsx)("br",{}),"2. 请教周围的治理者或志愿者；"]})]})}),N||L?(0,d.jsx)(M.Z,{}):ea.length>0?ea.map(function(e){return(0,d.jsxs)("div",{className:"border border-gray-100 rounded-lg p-4 shadow-sm",children:[(0,d.jsx)("div",{className:"flex items-center mb-3",children:(0,d.jsxs)("div",{className:"flex items-baseline  mr-2",children:[(0,d.jsx)("span",{className:"text-greyscale-500",children:"No."}),(0,d.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(e.action.action.head.id)}),(0,d.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(e.action.action.body.title)})]})}),e.rewards.length>0?(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)("table",{className:"table w-full table-auto",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,d.jsx)("th",{className:"text-left px-0",children:"轮次"}),(0,d.jsx)("th",{className:"text-center",children:"可铸造激励"}),(0,d.jsx)("th",{className:"text-center",children:(0,d.jsxs)("div",{className:"flex items-center justify-center gap-1",children:["得分",(0,d.jsx)(k.Z,{title:"得分说明",content:"这个得分，是用最终激励估算的平均分得分"})]})}),(0,d.jsx)("th",{className:"text-center",children:"结果"})]})}),(0,d.jsx)("tbody",{children:e.rewards.map(function(t,a){return(0,d.jsxs)("tr",{className:a===e.rewards.length-1?"border-none":"border-b border-gray-100",children:[(0,d.jsx)("td",{className:"px-1",children:(0,C.cK)(t.round,n).toString()}),(0,d.jsx)("td",{className:"text-center px-1",children:(0,C.LH)(t.reward||BigInt(0))}),(0,d.jsx)("td",{className:"text-center px-1",children:t.isScoreLoading?(0,d.jsx)("div",{className:"flex justify-center items-center",children:(0,d.jsx)(M.Z,{})}):t.score&&parseFloat(t.score)>0?(0,d.jsx)(m(),{href:"/verify/detail?symbol=".concat(null==n?void 0:n.symbol,"&id=").concat(e.action.action.head.id.toString(),"&round=").concat(t.round.toString()),target:"_blank",rel:"noopener noreferrer",className:"text-secondary hover:text-secondary/80 underline text-sm",children:t.score}):(0,d.jsx)("span",{className:"text-greyscale-500",children:"-"})}),(0,d.jsx)("td",{className:"text-center px-1",children:t.reward>BigInt(0)&&!t.isMinted?(0,d.jsx)(E.z,{variant:"outline",size:"sm",className:"text-secondary border-secondary",onClick:function(){return en(t.round,BigInt(e.action.action.head.id))},disabled:X||H,children:"铸造"}):t.isMinted?(0,d.jsx)("span",{className:"text-greyscale-500",children:"已铸造"}):(0,d.jsx)("span",{className:"text-greyscale-500",children:"-"})})]},"".concat(e.action.action.head.id,"-").concat(t.round.toString()))})})]})}):(0,d.jsxs)("div",{className:"text-center text-greyscale-500 py-4",children:["该行动最近 ",D.toString()," 轮没有获得激励"]}),(0,d.jsx)("div",{className:"text-center",children:(0,d.jsx)("button",{onClick:function(){return t.push("/my/rewardsofaction?id=".concat(e.action.action.head.id))},className:"text-secondary hover:text-secondary/80 underline text-sm bg-transparent border-none cursor-pointer",children:"查看更多激励 >>"})})]},e.action.action.head.id)}):(0,d.jsx)("div",{className:"text-center text-greyscale-500 py-8",children:"没有参与任何行动"})]}):(0,d.jsx)(M.Z,{}),(0,d.jsx)(A.Z,{isLoading:X||H,text:X?"提交交易...":"确认交易..."})]})]})}},67516:function(e,t,n){"use strict";n.d(t,{N:function(){return l}});var a=n(72253),r=n(14932),s=n(97995),i=n(36100),o=n(67294),d=n(95159),c=n(39360),u=n(78942);function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.contracts,l=void 0===n?[]:n,p=t.query,y=void 0===p?{}:p,m=(0,u.Z)(t),f=(0,c.x)({config:m}),x=function(e,t={}){return{async queryFn({queryKey:n}){let a=[],r=n[1].contracts.length;for(let e=0;e<r;e++){let r=n[1].contracts[e],s=(t.contracts?.[e]).abi;a.push({...r,abi:s})}let{scopeKey:i,...o}=n[1];return(0,s.J)(e,{...o,contracts:a})},queryKey:function(e={}){let t=[];for(let n of e.contracts??[]){let{abi:a,...r}=n;t.push({...r,chainId:r.chainId??e.chainId})}return["readContracts",(0,i.OP)({...e,contracts:t})]}(t)}}(m,(0,r._)((0,a._)({},t),{chainId:f})),h=(0,o.useMemo)(function(){var e,t=!1,n=!0,a=!1,r=void 0;try{for(var s,i=l[Symbol.iterator]();!(n=(s=i.next()).done);n=!0){var o=s.value,d=o.abi,c=o.address,u=o.functionName;if(!d||!c||!u){t=!1;break}t=!0}}catch(e){a=!0,r=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw r}}return!!(t&&(null===(e=y.enabled)||void 0===e||e))},[l,y.enabled]);return(0,d.aM)((0,r._)((0,a._)({},x,y),{enabled:h,structuralSharing:null!==(e=y.structuralSharing)&&void 0!==e?e:i.if}))}}},function(e){e.O(0,[8501,4463,1390,3494,3591,3950,7399,2888,9774,179],function(){return e(e.s=51436)}),_N_E=e.O()}]);