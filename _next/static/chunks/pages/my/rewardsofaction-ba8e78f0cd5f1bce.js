try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="5acbaa64-0629-480d-b1c0-aa54523b87f5",e._sentryDebugIdIdentifier="sentry-dbid-5acbaa64-0629-480d-b1c0-aa54523b87f5")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2479],{34541:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/rewardsofaction",function(){return t(98461)}])},64777:function(e,n,t){"use strict";var r=t(85893);n.Z=function(e){var n=e.title;return(0,r.jsx)("div",{className:"flex justify-between items-center",children:(0,r.jsx)("h1",{className:"text-lg font-bold",children:n})})}},42083:function(e,n,t){"use strict";var r=t(85893),s=t(23432);n.Z=function(){return(0,r.jsx)(s.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},93566:function(e,n,t){"use strict";t.d(n,{$A:function(){return m},Bk:function(){return x},Xo:function(){return b},dI:function(){return f},qd:function(){return g},sK:function(){return h}});var r=t(11010),s=t(97582),i=t(67294),o=t(71104),a=t(7724),c=t(37742),d=t(84689),u=t(37474),l="0xeBB295af1D4ee9ed92e55EFF4ca5Eb8D4AB81aCE",f=function(e,n){var t=(0,o.u)({address:l,abi:a.d,functionName:"actionInfo",args:[e,n||BigInt(0)],query:{enabled:!!e&&void 0!==n}});return{actionInfo:t.data,isPending:t.isPending,error:t.error}},x=function(){var e=(0,o.u)({address:l,abi:a.d,functionName:"currentRound",args:[]}),n=e.data,t=e.isPending,r=e.error;return{currentRound:(0,c.Zu)(n),isPending:t,error:r}},m=function(e,n,t){var r=(0,o.u)({address:l,abi:a.d,functionName:"isSubmitted",args:[e,n,t]});return{isSubmitted:r.data,isPending:r.isPending,error:r.error}},h=function(e,n,t){var r=(0,o.u)({address:l,abi:a.d,functionName:"submitInfo",args:[e,n,t],query:{enabled:!!e&&!!n}});return{submitInfo:r.data,isPending:r.isPending,error:r.error}};function g(){var e,n=(0,u.e9)(a.d,l,"submit"),t=n.execute,o=n.isPending,c=n.isConfirming,f=n.isConfirmed,x=n.error,m=n.hash,h=n.isTukeMode,g=(e=(0,r._)(function(e,n){return(0,s.Jh)(this,function(r){switch(r.label){case 0:return console.log("提交submit交易:",{tokenAddress:e,actionId:n,isTukeMode:h}),[4,t([e,n])];case 1:return[2,r.sent()]}})}),function(n,t){return e.apply(this,arguments)});return(0,i.useEffect)(function(){m&&console.log("submit tx hash:",m),x&&(console.log("提交submit交易错误:"),(0,d.Vh)(x),(0,d.H)(x)),f&&console.log("submit tx confirmed")},[m,x,f]),{submit:g,isPending:o,isConfirming:c,writeError:x,isConfirmed:f,hash:m,isTukeMode:h}}function b(){var e,n=(0,u.e9)(a.d,l,"submitNewAction"),t=n.execute,o=n.isPending,c=n.isConfirming,f=n.isConfirmed,x=n.error,m=n.hash,h=n.isTukeMode,g=(e=(0,r._)(function(e,n){return(0,s.Jh)(this,function(r){switch(r.label){case 0:return console.log("提交submitNewAction交易:",{tokenAddress:e,actionBody:n,isTukeMode:h}),[4,t([e,n])];case 1:return[2,r.sent()]}})}),function(n,t){return e.apply(this,arguments)});return(0,i.useEffect)(function(){m&&console.log("submitNewAction tx hash:",m),x&&(console.log("提交submitNewAction交易错误:"),(0,d.Vh)(x),(0,d.H)(x)),f&&console.log("submitNewAction tx confirmed")},[m,x,f]),{submitNewAction:g,isPending:o,isConfirming:c,writeError:x,isConfirmed:f,hash:m,isTukeMode:h}}},98461:function(e,n,t){"use strict";t.r(n);var r=t(11010),s=t(72253),i=t(14932),o=t(91309),a=t(4586),c=t(97582),d=t(85893),u=t(67294),l=t(42130),f=t(11163),x=t(86501),m=t(93778),h=t(7208),g=t(93566),b=t(20442),j=t(7399),N=t(73591),y=t(83494),w=t(64777),v=t(42083),I=t(44576),p=t(27245),B=t(26858),_=t(6743),E=BigInt(20);n.default=function(){var e,n=(0,f.useRouter)(),t=n.query.id,k=n.isReady&&"string"==typeof t&&""!==t.trim()?BigInt(t):void 0,P=((0,u.useContext)(m.M)||{}).token,C=(0,l.m)().address,S=(0,b.Bk)(),Z=S.currentRound,M=S.isPending,A=S.error,R=(0,o._)((0,u.useState)(BigInt(0)),2),T=R[0],D=R[1],F=(0,o._)((0,u.useState)(BigInt(0)),2),q=F[0],H=F[1],J=(0,o._)((0,u.useState)(!0),2),O=J[0],V=J[1],X=(0,o._)((0,u.useState)(!1),2),z=X[0],K=X[1],L=(0,u.useRef)(null),$=(0,g.dI)(null==P?void 0:P.address,k),G=$.actionInfo,Q=$.isPending,U=$.error,W=(0,h.B$)(z&&(null==P?void 0:P.address)?P.address:"0x0",z&&C?C:"0x0",z&&k||BigInt(0),z?T:BigInt(0),z?q:BigInt(0)),Y=W.rewards,ee=W.isPending,en=W.error,et=(0,u.useMemo)(function(){return Y||[]},[Y]),er=(0,j.Rb)(),es=er.mintActionReward,ei=er.isPending,eo=er.isConfirming,ea=er.isConfirmed,ec=er.writeError,ed=(0,o._)((0,u.useState)(null),2),eu=ed[0],el=ed[1],ef=(0,o._)((0,u.useState)([]),2),ex=ef[0],em=ef[1];(0,u.useEffect)(function(){if(G&&P&&void 0!==Z&&!z){var e=Z>2?Z-BigInt(2):BigInt(0);D(e>BigInt(20)?e-BigInt(20):BigInt(0)),H(e),K(!0)}},[G,P,Z,z]),(0,u.useEffect)(function(){P&&z&&V(T>BigInt(0))},[T,P,z]),(0,u.useEffect)(function(){z&&(et&&et.length>0?em((0,a._)(et).sort(function(e,n){return e.round<n.round?1:e.round>n.round?-1:0})):em([]))},[et,z]),(0,u.useEffect)(function(){ea&&(eu&&em(function(e){return e.map(function(e){return e.round===eu.round?(0,i._)((0,s._)({},e),{isMinted:!0}):e})}),x.ZP.success("铸造成功"),(null==P?void 0:P.address)&&C&&(0,_.j)(C,P.address,!1))},[ea,P,C,eu]);var eh=(e=(0,r._)(function(e,n){return(0,c.Jh)(this,function(t){switch(t.label){case 0:if(!((null==P?void 0:P.address)&&C))return[3,2];return el({actionId:n,round:e}),[4,es(P.address,e,n)];case 1:t.sent(),t.label=2;case 2:return[2]}})}),function(n,t){return e.apply(this,arguments)}),eg=(0,u.useCallback)(function(){if(P){var e=BigInt(0);D(function(n){return n>e?n-E>=e?n-E:e:n})}},[P]);(0,u.useEffect)(function(){if(L.current&&z){var e=L.current,n=new IntersectionObserver(function(e){e.forEach(function(e){e.isIntersecting&&!ee&&O&&eg()})},{root:null,rootMargin:"200px",threshold:0});return n.observe(e),function(){n.unobserve(e),n.disconnect()}}},[eg,ee,O,z]);var eb=(0,N.S)().handleContractError;return((0,u.useEffect)(function(){U&&eb(U,"actionInfo"),A&&eb(A,"currentRound"),en&&eb(en,"dataViewer"),ec&&eb(ec,"mint")},[U,A,en,ec,eb]),n.isReady)?void 0===k?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(y.Z,{title:"行动激励",showBackButton:!0}),(0,d.jsx)("main",{className:"flex-grow",children:(0,d.jsx)("div",{className:"flex flex-col space-y-6 p-4",children:(0,d.jsx)("div",{className:"text-center text-red-500 py-4",children:"缺少行动ID参数"})})})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(y.Z,{title:"行动激励",showBackButton:!0}),(0,d.jsxs)("main",{className:"flex-grow",children:[!P||Q||M?(0,d.jsx)(v.Z,{}):(0,d.jsxs)("div",{className:"flex flex-col space-y-6 p-4",children:[(0,d.jsx)(w.Z,{title:"铸造行动激励："}),G&&(0,d.jsx)("div",{className:"",children:(0,d.jsx)("div",{className:"flex items-center mb-3",children:(0,d.jsxs)("div",{className:"flex items-baseline mr-2",children:[(0,d.jsx)("span",{className:"text-greyscale-500",children:"No."}),(0,d.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(G.head.id)}),(0,d.jsx)("span",{className:"font-bold text-greyscale-800",children:G.body.title})]})})}),(0,d.jsxs)("table",{className:"table w-full table-auto",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,d.jsx)("th",{children:"轮次"}),(0,d.jsx)("th",{className:"text-center",children:"可铸造激励"}),(0,d.jsx)("th",{className:"text-center",children:"结果"})]})}),(0,d.jsx)("tbody",{children:0!==ex.length||ee?ex.map(function(e,n){return(0,d.jsxs)("tr",{className:n===ex.length-1?"border-none":"border-b border-gray-100",children:[(0,d.jsx)("td",{children:(0,B.cK)(e.round,P).toString()}),(0,d.jsx)("td",{className:"text-center",children:(0,B.LH)(e.reward||BigInt(0))}),(0,d.jsx)("td",{className:"text-center",children:e.reward>BigInt(0)&&!e.isMinted?(0,d.jsx)(p.z,{variant:"outline",size:"sm",className:"text-secondary border-secondary",onClick:function(){return eh(e.round,BigInt(k))},disabled:ei||eo,children:"铸造"}):e.isMinted?(0,d.jsx)("span",{className:"text-greyscale-500",children:"已铸造"}):(0,d.jsx)("span",{className:"text-greyscale-500",children:"-"})})]},"".concat(k,"-").concat(e.round.toString()))}):(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:3,className:"text-center text-sm text-gray-500 py-4",children:"该行动在指定轮次范围内没有获得激励"})})})]}),(0,d.jsx)("div",{ref:L,className:"h-12 flex justify-center items-center",children:ee?(0,d.jsx)(v.Z,{}):O?(0,d.jsx)("span",{className:"text-sm text-gray-500",children:"上滑加载更多..."}):(0,d.jsx)("span",{className:"text-sm text-gray-500",children:"没有更多激励"})})]}),(0,d.jsx)(I.Z,{isLoading:ei||eo,text:ei?"提交交易...":"确认交易..."})]})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(y.Z,{title:"行动激励",showBackButton:!0}),(0,d.jsx)("main",{className:"flex-grow",children:(0,d.jsx)(v.Z,{})})]})}}},function(e){e.O(0,[8501,4463,3494,3591,7724,7399,2888,9774,179],function(){return e(e.s=34541)}),_N_E=e.O()}]);