try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="b0ccb34d-50d3-47d9-9168-751c1b393413",e._sentryDebugIdIdentifier="sentry-dbid-b0ccb34d-50d3-47d9-9168-751c1b393413")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[943],{51436:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/actionrewards",function(){return t(69534)}])},64777:function(e,n,t){"use strict";var r=t(85893);n.Z=function(e){var n=e.title;return(0,r.jsx)("div",{className:"flex justify-between items-center",children:(0,r.jsx)("h1",{className:"text-lg font-bold",children:n})})}},42083:function(e,n,t){"use strict";var r=t(85893),s=t(23432);n.Z=function(){return(0,r.jsx)(s.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},69534:function(e,n,t){"use strict";t.r(n);var r=t(11010),s=t(72253),i=t(14932),a=t(91309),c=t(97582),d=t(85893),o=t(67294),l=t(86501),u=t(42130),f=t(11163),h=t(93778),x=t(7208),m=t(93950),g=t(7399),b=t(73591),y=t(83494),v=t(64777),j=t(42083),w=t(44576),p=t(27245),N=t(91529),I=t(6743),_=BigInt(30);n.default=function(){var e,n=(0,f.useRouter)(),t=((0,o.useContext)(h.M)||{}).token,S=(0,u.m)().address,B=(0,x.N6)(null==t?void 0:t.address,S,_),E=B.rewards,M=B.isPending,$=B.error,k=(0,m.dB)(null==t?void 0:t.address,S),C=k.joinedActions,Z=k.isPending,P=k.error,D=(0,o.useMemo)(function(){if(!C||!E)return[];var e=new Map,n=!0,t=!1,r=void 0;try{for(var s,i=E[Symbol.iterator]();!(n=(s=i.next()).done);n=!0){var a=s.value;if(!(a.reward<=BigInt(0))){var c=a.actionId.toString();e.has(c)||e.set(c,[]),e.get(c).push(a)}}}catch(e){t=!0,r=e}finally{try{n||null==i.return||i.return()}finally{if(t)throw r}}var d=[],o=!0,l=!1,u=void 0;try{for(var f,h=C[Symbol.iterator]();!(o=(f=h.next()).done);o=!0){var x=f.value,m=String(x.action.head.id),g=e.get(m)||[];g.length>0&&g.sort(function(e,n){return e.round>n.round?-1:1}),d.push({action:x,rewards:g})}}catch(e){l=!0,u=e}finally{try{o||null==h.return||h.return()}finally{if(l)throw u}}return d.sort(function(e,n){return BigInt(e.action.action.head.id)>BigInt(n.action.action.head.id)?-1:1}),d},[C,E]),T=(0,g.Rb)(),F=T.mintActionReward,O=T.isPending,R=T.isConfirming,z=T.isConfirmed,A=T.writeError,L=(0,a._)((0,o.useState)(null),2),V=L[0],X=L[1],q=(0,a._)((0,o.useState)(new Set),2),H=q[0],J=q[1];(0,o.useEffect)(function(){if(z){if(l.ZP.success("铸造成功"),V){var e="".concat(V.actionId.toString(),"-").concat(V.round.toString());J(function(n){var t=new Set(n);return t.add(e),t})}(null==t?void 0:t.address)&&S&&(0,I.j)(S,t.address,!1)}},[z,V,null==t?void 0:t.address,S]),(0,o.useEffect)(function(){J(new Set)},[null==t?void 0:t.address,S]),(0,o.useEffect)(function(){if((null==t?void 0:t.address)&&S&&!M&&E&&!E.some(function(e){return e.reward>BigInt(0)&&!e.isMinted})){var e=(0,I.FP)(S,t.address);if(null==e?void 0:e.needMinted){var n=(0,I.iO)(S,t.address);localStorage.removeItem(n),(0,I.j)(S,t.address,!1)}}},[null==t?void 0:t.address,S,M,E]);var K=(e=(0,r._)(function(e,n){return(0,c.Jh)(this,function(r){switch(r.label){case 0:if(!((null==t?void 0:t.address)&&S))return[3,2];return X({actionId:n,round:e}),[4,F(t.address,e,n)];case 1:r.sent(),r.label=2;case 2:return[2]}})}),function(n,t){return e.apply(this,arguments)}),W=(0,o.useMemo)(function(){return D?D.map(function(e){return(0,i._)((0,s._)({},e),{rewards:e.rewards.map(function(n){var t="".concat(BigInt(e.action.action.head.id).toString(),"-").concat(n.round.toString());return H.has(t)||n.isMinted?(0,i._)((0,s._)({},n),{isMinted:!0}):n})})}):[]},[D,H]),G=(0,b.S)().handleContractError;return(0,o.useEffect)(function(){$&&G($,"dataViewer"),P&&G(P,"dataViewer"),A&&G(A,"mint")},[$,P,A,G]),(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(y.Z,{title:"行动激励",showBackButton:!0}),(0,d.jsxs)("main",{className:"flex-grow",children:[t?(0,d.jsxs)("div",{className:"flex flex-col space-y-6 p-4",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)(v.Z,{title:"铸造行动激励"}),(0,d.jsx)("button",{onClick:function(){return n.push("/my/queryaction?symbol=".concat(null==t?void 0:t.symbol))},className:"text-secondary hover:text-secondary/80 text-sm bg-transparent border-none cursor-pointer",children:"查看已退出行动激励\xa0>>"})]}),M||Z?(0,d.jsx)(j.Z,{}):W.length>0?W.map(function(e){return(0,d.jsxs)("div",{className:"border border-gray-100 rounded-lg p-4 shadow-sm",children:[(0,d.jsx)("div",{className:"flex items-center mb-3",children:(0,d.jsxs)("div",{className:"flex items-baseline  mr-2",children:[(0,d.jsx)("span",{className:"text-greyscale-500",children:"No."}),(0,d.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(e.action.action.head.id)}),(0,d.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(e.action.action.body.title)})]})}),e.rewards.length>0?(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)("table",{className:"table w-full table-auto",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,d.jsx)("th",{children:"轮次"}),(0,d.jsx)("th",{className:"text-center",children:"可铸造激励"}),(0,d.jsx)("th",{className:"text-center",children:"结果"})]})}),(0,d.jsx)("tbody",{children:e.rewards.map(function(n,r){return(0,d.jsxs)("tr",{className:r===e.rewards.length-1?"border-none":"border-b border-gray-100",children:[(0,d.jsx)("td",{children:(0,N.cK)(n.round,t).toString()}),(0,d.jsx)("td",{className:"text-center",children:(0,N.LH)(n.reward||BigInt(0))}),(0,d.jsx)("td",{className:"text-center",children:n.reward>BigInt(0)&&!n.isMinted?(0,d.jsx)(p.z,{variant:"outline",size:"sm",className:"text-secondary border-secondary",onClick:function(){return K(n.round,BigInt(e.action.action.head.id))},disabled:O||R,children:"铸造"}):n.isMinted?(0,d.jsx)("span",{className:"text-greyscale-500",children:"已铸造"}):(0,d.jsx)("span",{className:"text-greyscale-500",children:"-"})})]},"".concat(e.action.action.head.id,"-").concat(n.round.toString()))})})]})}):(0,d.jsxs)("div",{className:"text-center text-greyscale-500 py-4",children:["该行动最近 ",_.toString()," 轮没有获得激励"]}),(0,d.jsx)("div",{className:"text-center",children:(0,d.jsx)("button",{onClick:function(){return n.push("/my/rewardsofaction?id=".concat(e.action.action.head.id))},className:"text-secondary hover:text-secondary/80 underline text-sm bg-transparent border-none cursor-pointer",children:"查看更多激励 >>"})})]},e.action.action.head.id)}):(0,d.jsx)("div",{className:"text-center text-greyscale-500 py-8",children:"没有参与任何行动"})]}):(0,d.jsx)(j.Z,{}),(0,d.jsx)(w.Z,{isLoading:O||R,text:O?"提交交易...":"确认交易..."})]})]})}},21803:function(e,n,t){"use strict";function r(e,n){let[t,r="0"]=e.split("."),s=t.startsWith("-");if(s&&(t=t.slice(1)),r=r.replace(/(0+)$/,""),0===n)1===Math.round(Number(`.${r}`))&&(t=`${BigInt(t)+1n}`),r="";else if(r.length>n){let[e,s,i]=[r.slice(0,n-1),r.slice(n-1,n),r.slice(n)],a=Math.round(Number(`${s}.${i}`));(r=a>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${a}`).length>n&&(r=r.slice(1),t=`${BigInt(t)+1n}`),r=r.slice(0,n)}else r=r.padEnd(n,"0");return BigInt(`${s?"-":""}${t}${r}`)}t.d(n,{v:function(){return r}})}},function(e){e.O(0,[8239,367,3494,2252,3950,7399,2888,9774,179],function(){return e(e.s=51436)}),_N_E=e.O()}]);