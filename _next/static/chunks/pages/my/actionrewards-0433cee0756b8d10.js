try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="0fecfb62-f0cf-4578-85b8-209060da4bb7",e._sentryDebugIdIdentifier="sentry-dbid-0fecfb62-f0cf-4578-85b8-209060da4bb7")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[943],{51436:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/actionrewards",function(){return n(17762)}])},35810:function(e,t,n){"use strict";n.d(t,{$N:function(){return g},Be:function(){return v},Vq:function(){return l},cN:function(){return x},cZ:function(){return f},fK:function(){return h},hg:function(){return p}});var a=n(72253),r=n(14932),s=n(47702),i=n(85893),o=n(67294),c=n(12854),d=n(62190),u=n(40108),l=c.fC,p=c.xz,y=c.h_;c.x8;var m=o.forwardRef(function(e,t){var n=e.className,r=(0,s._)(e,["className"]);return(0,i.jsx)(c.aV,(0,a._)({ref:t,className:(0,u.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n)},r))});m.displayName=c.aV.displayName;var f=o.forwardRef(function(e,t){var n=e.className,o=e.children,l=(0,s._)(e,["className","children"]);return(0,i.jsxs)(y,{children:[(0,i.jsx)(m,{}),(0,i.jsxs)(c.VY,(0,r._)((0,a._)({ref:t,className:(0,u.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n)},l),{children:[o,(0,i.jsxs)(c.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,i.jsx)(d.Z,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"sr-only",children:"Close"})]})]}))]})});f.displayName=c.VY.displayName;var h=function(e){var t=e.className,n=(0,s._)(e,["className"]);return(0,i.jsx)("div",(0,a._)({className:(0,u.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t)},n))};h.displayName="DialogHeader";var x=function(e){var t=e.className,n=(0,s._)(e,["className"]);return(0,i.jsx)("div",(0,a._)({className:(0,u.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t)},n))};x.displayName="DialogFooter";var g=o.forwardRef(function(e,t){var n=e.className,r=(0,s._)(e,["className"]);return(0,i.jsx)(c.Dx,(0,a._)({ref:t,className:(0,u.cn)("text-lg font-semibold leading-none tracking-tight",n)},r))});g.displayName=c.Dx.displayName;var v=o.forwardRef(function(e,t){var n=e.className,r=(0,s._)(e,["className"]);return(0,i.jsx)(c.dk,(0,a._)({ref:t,className:(0,u.cn)("text-sm text-muted-foreground",n)},r))});v.displayName=c.dk.displayName},26986:function(e,t,n){"use strict";n.d(t,{OX:function(){return h},Qz:function(){return l},dy:function(){return u},iI:function(){return g},sc:function(){return f},u6:function(){return v},uh:function(){return y},ze:function(){return x}});var a=n(72253),r=n(14932),s=n(47702),i=n(85893),o=n(67294),c=n(53798),d=n(40108),u=function(e){var t=e.shouldScaleBackground,n=(0,s._)(e,["shouldScaleBackground"]);return(0,i.jsx)(c.dy.Root,(0,a._)({shouldScaleBackground:void 0===t||t},n))};u.displayName="Drawer";var l=c.dy.Trigger,p=c.dy.Portal,y=c.dy.Close,m=o.forwardRef(function(e,t){var n=e.className,r=(0,s._)(e,["className"]);return(0,i.jsx)(c.dy.Overlay,(0,a._)({ref:t,className:(0,d.cn)("fixed inset-0 z-50 bg-black/80",n)},r))});m.displayName=c.dy.Overlay.displayName;var f=o.forwardRef(function(e,t){var n=e.className,o=e.children,u=(0,s._)(e,["className","children"]);return(0,i.jsxs)(p,{children:[(0,i.jsx)(m,{}),(0,i.jsxs)(c.dy.Content,(0,r._)((0,a._)({ref:t,className:(0,d.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",n)},u),{children:[(0,i.jsx)("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),o]}))]})});f.displayName="DrawerContent";var h=function(e){var t=e.className,n=(0,s._)(e,["className"]);return(0,i.jsx)("div",(0,a._)({className:(0,d.cn)("grid gap-1.5 p-4 text-center sm:text-left",t)},n))};h.displayName="DrawerHeader";var x=function(e){var t=e.className,n=(0,s._)(e,["className"]);return(0,i.jsx)("div",(0,a._)({className:(0,d.cn)("mt-auto flex flex-col gap-2 p-4",t)},n))};x.displayName="DrawerFooter";var g=o.forwardRef(function(e,t){var n=e.className,r=(0,s._)(e,["className"]);return(0,i.jsx)(c.dy.Title,(0,a._)({ref:t,className:(0,d.cn)("text-lg font-semibold leading-none tracking-tight",n)},r))});g.displayName=c.dy.Title.displayName;var v=o.forwardRef(function(e,t){var n=e.className,r=(0,s._)(e,["className"]);return(0,i.jsx)(c.dy.Description,(0,a._)({ref:t,className:(0,d.cn)("text-sm text-muted-foreground",n)},r))});v.displayName=c.dy.Description.displayName},43637:function(e,t,n){"use strict";n.d(t,{w:function(){return a}});var a=[{type:"constructor",inputs:[{name:"originBlocks",type:"uint256",internalType:"uint256"},{name:"phaseBlocks",type:"uint256",internalType:"uint256"}],stateMutability:"nonpayable"},{type:"function",name:"RANDOM_SEED_UPDATE_MIN_PER_TEN_THOUSAND",inputs:[],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"abstentionScoreWithReward",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"currentRound",inputs:[],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"firstTokenAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"hasTriggeredRandomUpdate",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"address",internalType:"address"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"initialize",inputs:[{name:"randomAddress_",type:"address",internalType:"address"},{name:"firstTokenAddress_",type:"address",internalType:"address"},{name:"stakeAddress_",type:"address",internalType:"address"},{name:"voteAddress_",type:"address",internalType:"address"},{name:"joinAddress_",type:"address",internalType:"address"},{name:"mintAddress_",type:"address",internalType:"address"},{name:"randomSeedUpdateMinPerTenThousand",type:"uint256",internalType:"uint256"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"initialized",inputs:[],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"joinAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"mintAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"originBlocks",inputs:[],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"phaseBlocks",inputs:[],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"randomAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"roundByBlockNumber",inputs:[{name:"blockNumber",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"score",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"scoreByActionId",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"scoreByActionIdByAccount",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"address",internalType:"address"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"scoreByVerifier",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"address",internalType:"address"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"scoreByVerifierByActionId",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"scoreByVerifierByActionIdByAccount",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"address",internalType:"address"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"scoreWithReward",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"stakeAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"stakedAmountOfVerifiers",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"verify",inputs:[{name:"tokenAddress",type:"address",internalType:"address"},{name:"actionId",type:"uint256",internalType:"uint256"},{name:"abstentionScore",type:"uint256",internalType:"uint256"},{name:"scores",type:"uint256[]",internalType:"uint256[]"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"voteAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"event",name:"Verify",inputs:[{name:"tokenAddress",type:"address",indexed:!0,internalType:"address"},{name:"round",type:"uint256",indexed:!1,internalType:"uint256"},{name:"verifier",type:"address",indexed:!0,internalType:"address"},{name:"actionId",type:"uint256",indexed:!0,internalType:"uint256"},{name:"abstentionScore",type:"uint256",indexed:!1,internalType:"uint256"},{name:"scores",type:"uint256[]",indexed:!1,internalType:"uint256[]"}],anonymous:!1},{type:"error",name:"AlreadyInitialized",inputs:[]},{type:"error",name:"RoundNotStarted",inputs:[]},{type:"error",name:"ScoresAndAccountsLengthMismatch",inputs:[]},{type:"error",name:"ScoresExceedVotesNum",inputs:[]},{type:"error",name:"ScoresMustIncrease",inputs:[]}]},44746:function(e,t,n){"use strict";n.d(t,{Z:function(){return p}});var a=n(72253),r=n(14932),s=n(91309),i=n(85893),o=n(67294),c=n(74598),d=n(35810),u=n(26986),l=n(79995);function p(e){var t=e.title,n=e.content,p=e.className,y=void 0===p?"":p,m=(0,s._)((0,o.useState)(!1),2),f=m[0],h=m[1],x=(0,l.Z)("(min-width: 768px)"),g=o.forwardRef(function(e,n){return(0,i.jsx)("button",(0,r._)((0,a._)({ref:n,type:"button",className:"inline-flex items-center p-1 rounded hover:bg-gray-100 transition-colors ".concat(y),"aria-label":"查看".concat(t)},e),{children:(0,i.jsx)(c.Z,{className:"h-4 w-4 text-gray-500 hover:text-gray-700"})}))});g.displayName="TriggerButton";var v=function(){return(0,i.jsx)("div",{className:"text-gray-700",children:"string"==typeof n?(0,i.jsx)("p",{className:"leading-relaxed text-sm",children:n}):n})};return(0,i.jsxs)(i.Fragment,{children:[x&&(0,i.jsxs)(d.Vq,{open:f,onOpenChange:h,children:[(0,i.jsx)(d.hg,{asChild:!0,children:(0,i.jsx)(g,{})}),(0,i.jsxs)(d.cZ,{className:"sm:max-w-[425px]",children:[(0,i.jsx)(d.$N,{className:"text-lg font-semibold",children:t}),(0,i.jsx)("div",{className:"pt-2 pb-4",children:(0,i.jsx)(v,{})})]})]}),!x&&(0,i.jsxs)(u.dy,{open:f,onOpenChange:h,children:[(0,i.jsx)(u.Qz,{asChild:!0,children:(0,i.jsx)(g,{})}),(0,i.jsxs)(u.sc,{className:"pb-safe",children:[(0,i.jsx)(u.OX,{children:(0,i.jsx)(u.iI,{className:"text-lg font-semibold",children:t})}),(0,i.jsx)("div",{className:"px-4 pb-8 mb-10",children:(0,i.jsx)(v,{})})]})]})]})}},64777:function(e,t,n){"use strict";var a=n(85893);t.Z=function(e){var t=e.title;return(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsx)("h1",{className:"text-lg font-bold",children:t})})}},42083:function(e,t,n){"use strict";var a=n(85893),r=n(23432);t.Z=function(){return(0,a.jsx)(r.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},17762:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return z}});var a=n(11010),r=n(72253),s=n(14932),i=n(91309),o=n(97582),c=n(85893),d=n(67294),u=n(86501),l=n(42130),p=n(11163),y=n(41664),m=n.n(y),f=n(93778),h=n(7208),x=n(93950),g=n(7399),v=n(4586),b=n(67516),N=n(98482),j=n(43637),w=n(97995),_=n(45631),T=function(e,t){return"love20_score_cache_".concat(e.toLowerCase(),"_").concat(t.toLowerCase())},S=function(e,t){try{var n=localStorage.getItem(T(e,t));return n?JSON.parse(n):{}}catch(e){return{}}},I=function(e,t,n){try{var a=S(e,t);Object.entries(n).forEach(function(e){var t=(0,i._)(e,2),n=t[0],r=t[1];Object.entries(r).forEach(function(e){var t=(0,i._)(e,2),r=t[0],s=t[1];a["".concat(n,"_").concat(r)]=s})}),localStorage.setItem(T(e,t),JSON.stringify(a))}catch(e){console.error("写入得分缓存失败:",e)}},B=function(e){var t=e.account,n=e.tokenAddress,s=e.actionRoundPairs,c=e.enabled,u=void 0===c||c,l=(0,d.useMemo)(function(){if(!u||0===s.length||!t||!n)return{validActionRoundPairs:[],actionRoundPairsKey:"",cachedScores:{},uncachedPairs:[]};var e=S(t,n),a={},r=[];s.forEach(function(t){var n=e["".concat(t.actionId.toString(),"_").concat(t.round.toString())];if(void 0!==n){var s=t.actionId.toString(),i=t.round.toString();a[s]||(a[s]={}),a[s][i]=n}else r.push(t)});var i=s.map(function(e){return"".concat(e.actionId.toString(),"_").concat(e.round.toString())}).join("|");return console.log("缓存命中: ".concat(Object.keys(e).length," 条, 需要请求: ").concat(r.length," 条")),{validActionRoundPairs:s,actionRoundPairsKey:i,cachedScores:a,uncachedPairs:r}},[s,u,t,n]),p=l.validActionRoundPairs,y=l.actionRoundPairsKey,m=l.cachedScores,f=l.uncachedPairs,h=(0,d.useMemo)(function(){return u&&0!==f.length&&n?f.map(function(e){var t=e.actionId,a=e.round;return{address:"0xACea4f086BE05BeA47f3A56788FA3919C7f40799",abi:N.S,functionName:"randomAccounts",args:[n,a,t]}}):[]},[n,f,u]),x=(0,b.N)({contracts:h,query:{enabled:u&&h.length>0}}),g=x.data,T=x.isLoading,B=x.error,M=x.isSuccess;console.log("randomAccountsData",g);var A=(0,i._)((0,d.useState)({}),2),k=A[0],E=A[1],R=(0,i._)((0,d.useState)(!1),2),P=R[0],C=R[1],O=(0,i._)((0,d.useState)(null),2),L=O[0],D=O[1],Z=(0,i._)((0,d.useState)(!1),2),z=Z[0],V=Z[1];(0,d.useEffect)(function(){var e;u&&g&&M&&0!==f.length&&n&&t&&(e=(0,a._)(function(){var e,a,s,i,c;return(0,o.Jh)(this,function(d){switch(d.label){case 0:C(!0),D(null),E({}),e={},a={},d.label=1;case 1:d.trys.push([1,6,,7]),s=function(s){var i,c,d,u,l,p,y,m,h,x,b,N,T,S,I,B,M,A;return(0,o.Jh)(this,function(o){switch(o.label){case 0:if(c=(i=f[s]).actionId,d=i.round,(null==(u=g[s])?void 0:u.status)!=="success")return[3,2];return l=u.result,(p=(0,v._)(l)).includes(t)||p.push(t),y=p.map(function(e){return{address:"0x547b4a36980Ec030fBfC0162eE4B4904d9Cc0Da9",abi:j.w,functionName:"scoreByActionIdByAccount",args:[n,d,c,e]}}),console.log("正在加载 actionId=".concat(c,", round=").concat(d," 的分数数据，共 ").concat(y.length," 个账户...")),[4,(0,w.J)(_.v,{contracts:y})];case 1:m=o.sent(),h="".concat(c.toString(),"_").concat(d.toString()),x={},b=!1,m.forEach(function(e,t){if((null==e?void 0:e.status)==="success"){var n=p[t],a=e.result||BigInt(0);x[n]=a}else b=!0,console.warn("获取账户 ".concat(p[t]," 的得分失败:"),null==e?void 0:e.error)}),N=void 0!==x[t],e[h]={actionId:c,round:d,accountScores:x},!b&&N?(T=Object.values(x).reduce(function(e,t){return t>e?t:e},BigInt(0)),S=x[t]||BigInt(0),I="0",T>BigInt(0)&&S>BigInt(0)&&(B=S*BigInt(100)/T,I=(S*BigInt(100)%T*BigInt(2)>=T?Number(B)+1:Number(B)).toString()),M=c.toString(),A=d.toString(),a[M]||(a[M]={}),a[M][A]=I,console.log("完成加载 actionId=".concat(c,", round=").concat(d,"，进度: ").concat(s+1,"/").concat(f.length))):console.warn("跳过缓存 actionId=".concat(c,", round=").concat(d,": ")+"hasFailedRequest=".concat(b,", hasTargetAccountScore=").concat(N)),E((0,r._)({},e)),o.label=2;case 2:return[2]}})},i=0,d.label=2;case 2:if(!(i<f.length))return[3,5];return[5,(0,o.XA)(s(i))];case 3:d.sent(),d.label=4;case 4:return i++,[3,2];case 5:return Object.keys(a).length>0&&(I(t,n,a),console.log("得分数据已写入缓存")),V(!0),C(!1),[3,7];case 6:return console.error("分批加载分数时出错:",c=d.sent()),D(c),C(!1),V(!1),[3,7];case 7:return[2]}})}),function(){return e.apply(this,arguments)})()},[u,n,t,y,M]);var F=(0,d.useMemo)(function(){if(!u||0===p.length)return{scores:{},isLoading:!1,hasError:!1,allLoaded:!0};if(B||L)return{scores:{},isLoading:!1,hasError:!0,allLoaded:!1};if(T)return{scores:m,isLoading:f.length>0,hasError:!1,allLoaded:!1};var e={};Object.values(k).forEach(function(n){var a=n.actionId,r=n.round,s=n.accountScores,i=Object.values(s).reduce(function(e,t){return t>e?t:e},BigInt(0)),o=s[t]||BigInt(0),c="0";if(i>BigInt(0)&&o>BigInt(0)){var d=o*BigInt(100)/i;c=(o*BigInt(100)%i*BigInt(2)>=i?Number(d)+1:Number(d)).toString()}var u=a.toString(),l=r.toString();e[u]||(e[u]={}),e[u][l]=c});var n=(0,r._)({},m);Object.entries(e).forEach(function(e){var t=(0,i._)(e,2),a=t[0],r=t[1];n[a]||(n[a]={}),Object.entries(r).forEach(function(e){var t=(0,i._)(e,2),r=t[0],s=t[1];n[a][r]=s})});var a=0===f.length||z&&!P;return{scores:n,isLoading:P,hasError:!1,allLoaded:a}},[u,p,t,T,P,B,L,z,g,M,k,m,f]);return{scores:F.scores,isLoading:F.isLoading,hasError:F.hasError,allLoaded:F.allLoaded}},M=n(73591),A=n(83494),k=n(64777),E=n(42083),R=n(44576),P=n(44746),C=n(27245),O=n(74598),L=n(26858),D=n(6743),Z=BigInt(6),z=function(){var e,t=(0,p.useRouter)(),n=((0,d.useContext)(f.M)||{}).token,y=(0,l.m)().address,v=(0,h.N6)(null==n?void 0:n.address,y,Z),b=v.rewards,N=v.isPending,j=v.error,w=(0,x.dB)(null==n?void 0:n.address,y),_=w.joinedActions,T=w.isPending,S=w.error,I=(0,d.useMemo)(function(){if(!_||!b)return[];var e=new Map,t=!0,n=!1,a=void 0;try{for(var r,s=b[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var i=r.value;if(!(i.reward<=BigInt(0))){var o=i.actionId.toString();e.has(o)||e.set(o,[]),e.get(o).push(i)}}}catch(e){n=!0,a=e}finally{try{t||null==s.return||s.return()}finally{if(n)throw a}}var c=[],d=!0,u=!1,l=void 0;try{for(var p,y=_[Symbol.iterator]();!(d=(p=y.next()).done);d=!0){var m=p.value,f=String(m.action.head.id),h=e.get(f)||[];h.length>0&&h.sort(function(e,t){return e.round>t.round?-1:1}),c.push({action:m,rewards:h})}}catch(e){u=!0,l=e}finally{try{d||null==y.return||y.return()}finally{if(u)throw l}}return c.sort(function(e,t){return BigInt(e.action.action.head.id)>BigInt(t.action.action.head.id)?-1:1}),c},[_,b]),z=(0,d.useMemo)(function(){if(!b||0===b.length)return{actionRoundPairs:[],enabled:!1};var e=b.filter(function(e){return e.reward>BigInt(0)}).map(function(e){return{actionId:e.actionId,round:e.round}}).sort(function(e,t){return e.round>t.round?-1:1});return{actionRoundPairs:e,enabled:e.length>0}},[b]),V=B({account:y,tokenAddress:null==n?void 0:n.address,actionRoundPairs:z.actionRoundPairs,enabled:z.enabled&&!!y&&!!(null==n?void 0:n.address)}),F=V.scores,q=V.isLoading;V.hasError;var J=(0,g.Rb)(),K=J.mintActionReward,X=J.isPending,H=J.isConfirming,U=J.isConfirmed,Q=J.writeError,W=(0,i._)((0,d.useState)(null),2),Y=W[0],$=W[1],G=(0,i._)((0,d.useState)(new Set),2),ee=G[0],et=G[1];(0,d.useEffect)(function(){if(U){if(u.ZP.success("铸造成功"),Y){var e="".concat(Y.actionId.toString(),"-").concat(Y.round.toString());et(function(t){var n=new Set(t);return n.add(e),n})}(null==n?void 0:n.address)&&y&&(0,D.j)(y,n.address,!1)}},[U,Y,null==n?void 0:n.address,y]),(0,d.useEffect)(function(){et(new Set)},[null==n?void 0:n.address,y]),(0,d.useEffect)(function(){if((null==n?void 0:n.address)&&y&&!N&&b&&!b.some(function(e){return e.reward>BigInt(0)&&!e.isMinted})){var e=(0,D.FP)(y,n.address);if(null==e?void 0:e.needMinted){var t=(0,D.iO)(y,n.address);localStorage.removeItem(t),(0,D.j)(y,n.address,!1)}}},[null==n?void 0:n.address,y,N,b]);var en=(e=(0,a._)(function(e,t){return(0,o.Jh)(this,function(a){switch(a.label){case 0:if(!((null==n?void 0:n.address)&&y))return[3,2];return $({actionId:t,round:e}),[4,K(n.address,e,t)];case 1:a.sent(),a.label=2;case 2:return[2]}})}),function(t,n){return e.apply(this,arguments)}),ea=(0,d.useMemo)(function(){return I?I.map(function(e){return(0,s._)((0,r._)({},e),{rewards:e.rewards.map(function(t){var n,a="".concat(BigInt(e.action.action.head.id).toString(),"-").concat(t.round.toString()),i=e.action.action.head.id.toString(),o=t.round.toString(),c=null==F?void 0:null===(n=F[i])||void 0===n?void 0:n[o],d=q&&!c;return(0,s._)((0,r._)({},t),{isMinted:ee.has(a)||t.isMinted,score:c||"0.0",isScoreLoading:d})})})}):[]},[I,ee,F,q]),er=(0,M.S)().handleContractError;return(0,d.useEffect)(function(){j&&er(j,"dataViewer"),S&&er(S,"dataViewer"),Q&&er(Q,"mint")},[j,S,Q,er]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(A.Z,{title:"行动激励",showBackButton:!0}),(0,c.jsxs)("main",{className:"flex-grow",children:[n?(0,c.jsxs)("div",{className:"flex flex-col space-y-6 p-4",children:[(0,c.jsxs)("div",{className:"flex justify-between items-center",children:[(0,c.jsx)(k.Z,{title:"铸造行动激励"}),(0,c.jsx)("button",{onClick:function(){return t.push("/my/queryaction?symbol=".concat(null==n?void 0:n.symbol))},className:"text-secondary hover:text-secondary/80 text-sm bg-transparent border-none cursor-pointer",children:"查看已退出行动激励\xa0>>"})]}),(0,c.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-red-500 text-sm",children:(0,c.jsxs)("div",{className:"flex items-start gap-2",children:[(0,c.jsx)(O.Z,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"font-medium",children:"小贴士："}),(0,c.jsx)("br",{}),"如果对激励打分有疑问，可以",(0,c.jsx)("br",{}),"1. 仔细阅读行动打分规则，检查是否按要求打卡；",(0,c.jsx)("br",{}),"2. 请教周围的治理者或志愿者；"]})]})}),N||T?(0,c.jsx)(E.Z,{}):ea.length>0?ea.map(function(e){return(0,c.jsxs)("div",{className:"border border-gray-100 rounded-lg p-4 shadow-sm",children:[(0,c.jsx)("div",{className:"flex items-center mb-3",children:(0,c.jsxs)("div",{className:"flex items-baseline  mr-2",children:[(0,c.jsx)("span",{className:"text-greyscale-500",children:"No."}),(0,c.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(e.action.action.head.id)}),(0,c.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(e.action.action.body.title)})]})}),e.rewards.length>0?(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)("table",{className:"table w-full table-auto",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,c.jsx)("th",{className:"text-left px-0",children:"轮次"}),(0,c.jsx)("th",{className:"text-center",children:(0,c.jsxs)("div",{className:"flex items-center justify-center gap-1",children:["验证得分",(0,c.jsx)(P.Z,{title:"验证得分说明",content:"这个得分，是根据最终激励，估算的平均得分。   （具体算法：将所有地址中实际得分最高者，作为100分，然后将你的实际得分等比例换算到0~100）"})]})}),(0,c.jsx)("th",{className:"text-center",children:"可铸造激励"}),(0,c.jsx)("th",{className:"text-center",children:"操作"})]})}),(0,c.jsx)("tbody",{children:e.rewards.map(function(t,a){return(0,c.jsxs)("tr",{className:a===e.rewards.length-1?"border-none":"border-b border-gray-100",children:[(0,c.jsx)("td",{className:"px-1",children:(0,L.cK)(t.round,n).toString()}),(0,c.jsx)("td",{className:"text-center px-1",children:t.isScoreLoading?(0,c.jsx)("div",{className:"flex justify-center items-center",children:(0,c.jsx)(E.Z,{})}):t.score&&parseFloat(t.score)>0?(0,c.jsx)(m(),{href:"/verify/detail?symbol=".concat(null==n?void 0:n.symbol,"&id=").concat(e.action.action.head.id.toString(),"&round=").concat(t.round.toString()),rel:"noopener noreferrer",className:"text-secondary hover:text-secondary/80 underline text-sm",children:t.score}):(0,c.jsx)("span",{className:"text-greyscale-500",children:"-"})}),(0,c.jsx)("td",{className:"text-center px-1",children:(0,L.LH)(t.reward||BigInt(0))}),(0,c.jsx)("td",{className:"text-center px-1",children:t.reward>BigInt(0)&&!t.isMinted?(0,c.jsx)(C.z,{variant:"outline",size:"sm",className:"text-secondary border-secondary",onClick:function(){return en(t.round,BigInt(e.action.action.head.id))},disabled:X||H,children:"铸造"}):t.isMinted?(0,c.jsx)("span",{className:"text-greyscale-500",children:"已铸造"}):(0,c.jsx)("span",{className:"text-greyscale-500",children:"-"})})]},"".concat(e.action.action.head.id,"-").concat(t.round.toString()))})})]})}):(0,c.jsxs)("div",{className:"text-center text-greyscale-500 py-4",children:["该行动最近 ",Z.toString()," 轮没有获得激励"]}),(0,c.jsx)("div",{className:"text-center",children:(0,c.jsx)("button",{onClick:function(){return t.push("/my/rewardsofaction?id=".concat(e.action.action.head.id))},className:"text-secondary hover:text-secondary/80 underline text-sm bg-transparent border-none cursor-pointer",children:"查看更多激励 >>"})})]},e.action.action.head.id)}):(0,c.jsx)("div",{className:"text-center text-greyscale-500 py-8",children:"没有参与任何行动"})]}):(0,c.jsx)(E.Z,{}),(0,c.jsx)(R.Z,{isLoading:X||H,text:X?"提交交易...":"确认交易..."})]})]})}},67516:function(e,t,n){"use strict";n.d(t,{N:function(){return l}});var a=n(72253),r=n(14932),s=n(97995),i=n(36100),o=n(67294),c=n(95159),d=n(39360),u=n(78942);function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.contracts,l=void 0===n?[]:n,p=t.query,y=void 0===p?{}:p,m=(0,u.Z)(t),f=(0,d.x)({config:m}),h=function(e,t={}){return{async queryFn({queryKey:n}){let a=[],r=n[1].contracts.length;for(let e=0;e<r;e++){let r=n[1].contracts[e],s=(t.contracts?.[e]).abi;a.push({...r,abi:s})}let{scopeKey:i,...o}=n[1];return(0,s.J)(e,{...o,contracts:a})},queryKey:function(e={}){let t=[];for(let n of e.contracts??[]){let{abi:a,...r}=n;t.push({...r,chainId:r.chainId??e.chainId})}return["readContracts",(0,i.OP)({...e,contracts:t})]}(t)}}(m,(0,r._)((0,a._)({},t),{chainId:f})),x=(0,o.useMemo)(function(){var e,t=!1,n=!0,a=!1,r=void 0;try{for(var s,i=l[Symbol.iterator]();!(n=(s=i.next()).done);n=!0){var o=s.value,c=o.abi,d=o.address,u=o.functionName;if(!c||!d||!u){t=!1;break}t=!0}}catch(e){a=!0,r=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw r}}return!!(t&&(null===(e=y.enabled)||void 0===e||e))},[l,y.enabled]);return(0,c.aM)((0,r._)((0,a._)({},h,y),{enabled:x,structuralSharing:null!==(e=y.structuralSharing)&&void 0!==e?e:i.if}))}}},function(e){e.O(0,[8501,4463,1390,3494,3591,3950,7399,2888,9774,179],function(){return e(e.s=51436)}),_N_E=e.O()}]);