try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="1c5b5e98-e66c-413d-8328-1e57df24a208",e._sentryDebugIdIdentifier="sentry-dbid-1c5b5e98-e66c-413d-8328-1e57df24a208")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1274],{84476:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/myaction",function(){return t(22774)}])},4270:function(e,n,t){"use strict";t.d(n,{Z:function(){return s}});var s=(0,t(31134).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},74442:function(e,n,t){"use strict";t.d(n,{Z:function(){return s}});var s=(0,t(31134).Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},37864:function(e,n,t){"use strict";t.d(n,{Z:function(){return s}});var s=(0,t(31134).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},99932:function(e,n,t){"use strict";t.d(n,{l:function(){return s}});var s=[{type:"constructor",inputs:[{name:"groupActionFactoryAddress_",type:"address",internalType:"address"}],stateMutability:"nonpayable"},{type:"function",name:"DEFAULT_MAX_RECIPIENTS",inputs:[],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"PRECISION",inputs:[],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"actionIdsWithRecipients",inputs:[{name:"groupOwner",type:"address",internalType:"address"},{name:"tokenAddress",type:"address",internalType:"address"},{name:"round",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"},{type:"function",name:"getDistribution",inputs:[{name:"groupOwner",type:"address",internalType:"address"},{name:"tokenAddress",type:"address",internalType:"address"},{name:"actionId",type:"uint256",internalType:"uint256"},{name:"groupId",type:"uint256",internalType:"uint256"},{name:"groupReward",type:"uint256",internalType:"uint256"},{name:"round",type:"uint256",internalType:"uint256"}],outputs:[{name:"addrs",type:"address[]",internalType:"address[]"},{name:"ratios",type:"uint256[]",internalType:"uint256[]"},{name:"amounts",type:"uint256[]",internalType:"uint256[]"},{name:"ownerAmount",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"groupIdsByActionIdWithRecipients",inputs:[{name:"groupOwner",type:"address",internalType:"address"},{name:"tokenAddress",type:"address",internalType:"address"},{name:"actionId",type:"uint256",internalType:"uint256"},{name:"round",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"},{type:"function",name:"recipients",inputs:[{name:"groupOwner",type:"address",internalType:"address"},{name:"tokenAddress",type:"address",internalType:"address"},{name:"actionId",type:"uint256",internalType:"uint256"},{name:"groupId",type:"uint256",internalType:"uint256"},{name:"round",type:"uint256",internalType:"uint256"}],outputs:[{name:"addrs",type:"address[]",internalType:"address[]"},{name:"ratios",type:"uint256[]",internalType:"uint256[]"},{name:"remarks",type:"string[]",internalType:"string[]"}],stateMutability:"view"},{type:"function",name:"setRecipients",inputs:[{name:"tokenAddress",type:"address",internalType:"address"},{name:"actionId",type:"uint256",internalType:"uint256"},{name:"groupId",type:"uint256",internalType:"uint256"},{name:"addrs",type:"address[]",internalType:"address[]"},{name:"ratios",type:"uint256[]",internalType:"uint256[]"},{name:"remarks",type:"string[]",internalType:"string[]"}],outputs:[],stateMutability:"nonpayable"},{type:"event",name:"SetRecipients",inputs:[{name:"tokenAddress",type:"address",indexed:!0,internalType:"address"},{name:"round",type:"uint256",indexed:!1,internalType:"uint256"},{name:"actionId",type:"uint256",indexed:!0,internalType:"uint256"},{name:"groupId",type:"uint256",indexed:!0,internalType:"uint256"},{name:"account",type:"address",indexed:!1,internalType:"address"},{name:"recipients",type:"address[]",indexed:!1,internalType:"address[]"},{name:"ratios",type:"uint256[]",indexed:!1,internalType:"uint256[]"},{name:"remarks",type:"string[]",indexed:!1,internalType:"string[]"}],anonymous:!1},{type:"error",name:"ArrayLengthMismatch",inputs:[]},{type:"error",name:"DuplicateAddress",inputs:[]},{type:"error",name:"InvalidRatio",inputs:[]},{type:"error",name:"InvalidRound",inputs:[]},{type:"error",name:"InvalidRound",inputs:[]},{type:"error",name:"InvalidRound",inputs:[]},{type:"error",name:"OnlyGroupOwner",inputs:[]},{type:"error",name:"RecipientCannotBeSelf",inputs:[]},{type:"error",name:"TooManyRecipients",inputs:[]},{type:"error",name:"ZeroAddress",inputs:[]},{type:"error",name:"ZeroRatio",inputs:[]}]},11418:function(e,n,t){"use strict";t.d(n,{Z:function(){return p}});var s=t(85893),r=t(67294),i=t(42130),a=t(41664),o=t.n(a),d=t(93778),c=t(91529),l=t(27245),u=t(20442),m=t(72260);function x(e){var n=e.isJoined,t=e.actionId,i=e.isPending,a=((0,r.useContext)(d.M)||{}).token,c=(0,u.Bk)(),x=c.currentRound,f=c.isPending,p=(0,m.Dn)((null==a?void 0:a.address)||"0x0000000000000000000000000000000000000000",x||BigInt(0),t),h=p.isActionIdVoted,g=p.isPending;if(!a)return null;var v="/acting/join?symbol=".concat(a.symbol,"&id=").concat(t),y="/my/myaction?symbol=".concat(a.symbol,"&id=").concat(t),b=!(null==a?void 0:a.address)||f||g||!x,j=!!(null==a?void 0:a.address)&&!!x;return void 0!==i&&i?(0,s.jsx)("div",{className:"flex justify-center mb-6",children:(0,s.jsx)("div",{className:"loading loading-spinner loading-md"})}):(0,s.jsx)("div",{className:"mt-4 flex justify-center",children:n?(0,s.jsx)(o(),{className:"text-secondary hover:text-secondary/80 text-sm cursor-pointer",href:y,children:"我的参与 >>"}):b?(0,s.jsx)(l.z,{className:"w-1/2",disabled:!0,children:"加载中..."}):j&&!1===h?(0,s.jsx)(l.z,{className:"w-1/2",disabled:!0,children:"未投票，不能加入"}):(0,s.jsx)(l.z,{className:"w-1/2",asChild:!0,children:(0,s.jsx)(o(),{href:v,children:"加入行动 >>"})})})}var f=t(44746);function p(e){var n=e.actionInfo,t=e.participantCount,a=e.totalAmount,l=e.convertedTotalAmount,u=e.joinedAmountTokenSymbol,m=e.joinedAmountTokenIsLP,p=e.isJoined,h=e.isPending,g=e.showActionButtons,v=void 0===g||g,y=((0,r.useContext)(d.M)||{}).token,b=(0,i.m)().address;if(!y)return(0,s.jsx)("div",{children:"Token信息加载中..."});var j=l&&l>BigInt(0),N=j?l:a,I=N?(0,c.LH)(N):"0",A=!!(u&&(null==y?void 0:y.symbol)&&u!==y.symbol),w=m?"LP":u,k=j?"• 实际总参与代币： ".concat(a?(0,c.LH)(a):"0"," ").concat(u||"","\n• 估算值是根据 UniswapV2 池价格实时换算。"):"";return(0,s.jsxs)("div",{className:"!bg-gray-100 rounded-lg px-2 pt-2 pb-2 text-sm my-4",children:[(0,s.jsx)("div",{className:"mb-2",children:(0,s.jsx)("h1",{className:"text-lg mb-1",children:(0,s.jsxs)("div",{className:"flex items-baseline",children:[(0,s.jsx)("span",{className:"text-gray-400 text-sm",children:"No."}),(0,s.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:n.head.id.toString()}),(0,s.jsx)("span",{className:"font-bold text-gray-800",children:n.body.title})]})})}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"text-gray-500 mr-2",children:j?"总参与代币(估):":"总参与代币:"}),(0,s.jsxs)("span",{className:"font-mono text-secondary",children:[I,a&&A&&!j&&(0,s.jsx)("span",{className:"ml-1 text-xs text-gray-500",children:w})," "]}),j&&k&&(0,s.jsx)(f.Z,{title:"参与代币数量说明",content:k,className:"ml-1"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"text-gray-500 mr-2",children:"总参与地址:"}),(0,s.jsx)("span",{className:"font-mono text-secondary",children:(null==t?void 0:t.toString())||"0"})]})]}),v&&n&&b&&(0,s.jsx)(x,{isJoined:p,actionId:n.head.id,isPending:h}),!v&&(0,s.jsx)("div",{className:"mt-4 flex justify-center",children:(0,s.jsx)(o(),{className:"text-secondary hover:text-secondary/80 text-sm cursor-pointer",href:"/action/info?symbol=".concat(null==y?void 0:y.symbol,"&id=").concat(n.head.id),children:"行动详情 >>"})})]})}},64777:function(e,n,t){"use strict";var s=t(85893);n.Z=function(e){var n=e.title;return(0,s.jsx)("div",{className:"flex justify-between items-center",children:(0,s.jsx)("h1",{className:"text-lg font-bold",children:n})})}},45231:function(e,n,t){"use strict";t.d(n,{Q:function(){return u}});var s=t(91309),r=t(67294),i=t(67516),a=t(7724),o=t(98482),d=t(37742),c=t(36268),l="0xACea4f086BE05BeA47f3A56788FA3919C7f40799",u=function(e){var n=e.tokenAddress,t=e.actionId,u=e.account,m=(0,r.useMemo)(function(){if(!n||void 0===t)return[];var e=[{address:"0xeBB295af1D4ee9ed92e55EFF4ca5Eb8D4AB81aCE",abi:a.d,functionName:"actionInfo",args:[n,t]},{address:l,abi:o.S,functionName:"amountByActionId",args:[n,t]},{address:l,abi:o.S,functionName:"numOfAccounts",args:[n,t]},{address:l,abi:o.S,functionName:"currentRound",args:[]}];return u&&e.push({address:l,abi:o.S,functionName:"amountByActionIdByAccount",args:[n,t,u]}),e},[n,t,u]),x=(0,i.N)({contracts:m,query:{enabled:!!n&&void 0!==t&&m.length>0}}),f=x.data,p=x.isPending,h=x.error,g=(0,r.useMemo)(function(){if(!f||!n||void 0===t)return{actionInfo:void 0,participantCount:void 0,totalAmount:void 0,isJoined:!1,currentRound:void 0};var e=(0,s._)(f,5),r=e[0],i=e[1],a=e[2],o=e[3],c=e[4],l=null==r?void 0:r.result,u=(null==i?void 0:i.result)?(0,d.Z)(i.result):void 0,m=(null==a?void 0:a.result)?(0,d.Z)(a.result):void 0,x=(null==o?void 0:o.result)?(0,d.Z)(o.result):void 0;return{actionInfo:l,participantCount:m,totalAmount:u,isJoined:null!=c&&!!c.result&&(0,d.Z)(c.result)>BigInt(0),currentRound:x}},[f,n,t]),v=(0,c.bX)(n,g.actionInfo,u,{participantCount:g.participantCount,totalAmount:g.totalAmount,isJoined:g.isJoined});return(0,r.useMemo)(function(){return{actionInfo:g.actionInfo,currentRound:g.currentRound,participantCount:v.participantCount,totalAmount:v.totalAmount,convertedTotalAmount:v.convertedTotalAmount,joinedAmountTokenAddress:v.joinedAmountTokenAddress,joinedAmountTokenSymbol:v.joinedAmountTokenSymbol,joinedAmountTokenIsLP:v.joinedAmountTokenIsLP,isJoined:v.isJoined,isExtensionAction:v.isExtensionAction,extensionAddress:v.extensionAddress,factory:v.factory,isPending:p||v.isPending,error:h||v.error}},[g,v,p,h])}},88308:function(e,n,t){"use strict";t.d(n,{h:function(){return o}});var s=t(67294),r=t(67516),i=t(50095);function a(e){return"".concat("group_name_").concat(e.toString())}var o=function(e){var n=e.groupIds,t=e.enabled,o=void 0===t||t,d=!!n&&n.length>0,c=(0,s.useMemo)(function(){if(!o||!d)return{cachedData:new Map,uncachedGroupIds:[]};var e=new Map,t=[];return n.forEach(function(n){var s=function(e){try{var n=a(e),t=localStorage.getItem(n);if(null===t)return null;var s=JSON.parse(t);return null===s.data?void 0:s.data}catch(e){return console.error("读取群名称缓存失败:",e),null}}(n);null!==s?e.set(n,s):t.push(n)}),{cachedData:e,uncachedGroupIds:t}},[n,o,d]),l=c.cachedData,u=c.uncachedGroupIds,m=(0,s.useMemo)(function(){return o&&d&&0!==u.length?u.map(function(e){return{address:"0xA0a5BB442214988D0c6e707d825640C026fB1d04",abi:i.s,functionName:"groupNameOf",args:[e]}}):[]},[u,o,d]),x=(0,r.N)({contracts:m,query:{enabled:o&&d&&m.length>0}}),f=x.data,p=x.isPending,h=x.error;(0,s.useEffect)(function(){f&&0!==u.length&&f.forEach(function(e,n){(null==e?void 0:e.status)==="success"&&function(e,n){try{var t=a(e);localStorage.setItem(t,JSON.stringify({data:void 0===n?null:n}))}catch(e){console.error("保存群名称缓存失败:",e)}}(u[n],e.result)})},[f,u]);var g=(0,s.useMemo)(function(){var e=new Map;return f&&u.length>0&&f.forEach(function(n,t){var s=u[t];(null==n?void 0:n.status)==="success"&&e.set(s,n.result)}),e},[f,u]);return{groupNameMap:(0,s.useMemo)(function(){var e=new Map;return o&&d&&n.forEach(function(n){l.has(n)?e.set(n,l.get(n)):g.has(n)&&e.set(n,g.get(n))}),e},[n,l,g,o,d]),isPending:(0,s.useMemo)(function(){return!!o&&!!d&&u.length>0&&p},[o,d,u.length,p]),error:h||null}}},87333:function(e,n,t){"use strict";t.d(n,{Q:function(){return d}});var s=t(67294),r=t(67516),i=t(65293),a=t(87974),o=t(8926);function d(e){var n=e.tokenAddress,t=e.account,d=(0,a.Od)(n),c=d.actionIds,l=d.isPending,u=d.error,m=(0,o.W)({token:{address:n},actionIds:c||[],enabled:!!n&&!!c&&c.length>0}),x=m.extensions,f=m.isPending,p=m.error,h=(0,s.useMemo)(function(){var e=new Map;return x.forEach(function(n){n.isExtension&&n.extensionAddress&&e.set(n.actionId,n.extensionAddress)}),e},[x]),g=(0,s.useMemo)(function(){if(!t||!c||0===c.length||0===h.size)return{groupIdsContracts:[],contractIndexToActionIdMap:new Map};var e=[],n=new Map;return c.forEach(function(s){var r=h.get(s);if(r){var a=e.length;e.push({address:"0xf2084E73bF047aF26d72CEFde25e22536a1f37C8",abi:i.i,functionName:"activeGroupIdsByOwner",args:[r,t]}),n.set(a,s)}}),{groupIdsContracts:e,contractIndexToActionIdMap:n}},[t,c,h]),v=g.groupIdsContracts,y=g.contractIndexToActionIdMap,b=(0,r.N)({contracts:v,query:{enabled:!!t&&!!c&&c.length>0&&h.size>0&&!f}}),j=b.data,N=b.isPending,I=b.error;return{actionIdsWithGroupIds:(0,s.useMemo)(function(){if(!j||0===v.length)return[];var e=[];return j.forEach(function(n,t){if((null==n?void 0:n.status)==="success"&&n.result){var s=y.get(t);if(void 0!==s){var r=n.result;r.length>0&&e.push({actionId:s,groupIds:r})}}}),e},[j,v,y]),isPending:(0,s.useMemo)(function(){return!n||!t||!!l||!!c&&0!==c.length&&(!!f||0!==h.size&&N)},[n,t,l,c,f,h.size,N]),error:u||p||I}}},30985:function(e,n,t){"use strict";t.d(n,{l:function(){return d}});var s=t(67516),r=t(89266),i=t(99932),a=t(37742),o="0x745470f219836deae285bD7E934CAD85958D1729",d=function(e){var n,t,d,c,l,u=(0,s.N)({contracts:[{address:e,abi:r.P,functionName:"TOKEN_ADDRESS"},{address:e,abi:r.P,functionName:"GROUP_ACTION_TOKEN_ADDRESS"},{address:e,abi:r.P,functionName:"GROUP_ACTION_FACTORY_ADDRESS"},{address:o,abi:i.l,functionName:"DEFAULT_MAX_RECIPIENTS"},{address:e,abi:r.P,functionName:"GOV_RATIO_MULTIPLIER"}],query:{enabled:!!e&&!!o}}),m=u.data,x=u.isPending,f=u.error;return{tokenAddress:null==m?void 0:null===(n=m[0])||void 0===n?void 0:n.result,groupActionTokenAddress:null==m?void 0:null===(t=m[1])||void 0===t?void 0:t.result,groupActionFactoryAddress:null==m?void 0:null===(d=m[2])||void 0===d?void 0:d.result,maxRecipients:(0,a.Z)(null==m?void 0:null===(c=m[3])||void 0===c?void 0:c.result),govRatioMultiplier:(0,a.Z)(null==m?void 0:null===(l=m[4])||void 0===l?void 0:l.result),isPending:x,error:f}}},47714:function(e,n,t){"use strict";t.d(n,{A:function(){return m}});var s=t(67294),r=t(67516),i=t(35611),a=t(65293),o=t(50095),d=t(37742),c="0xA0a5BB442214988D0c6e707d825640C026fB1d04",l="0xf2084E73bF047aF26d72CEFde25e22536a1f37C8",u="0xd94e4Fc2108B78Aa57438BFe5E85192687f74322",m=function(e){var n=e.extensionAddress,t=e.groupId,m=e.round,x=(0,s.useMemo)(function(){return n&&t&&m?[{address:c,abi:o.s,functionName:"groupNameOf",args:[t]},{address:c,abi:o.s,functionName:"ownerOf",args:[t]},{address:l,abi:a.i,functionName:"maxJoinAmount",args:[n]},{address:u,abi:i.w,functionName:"totalJoinedAmountByGroupId",args:[n,m,t]},{address:u,abi:i.w,functionName:"accountsByGroupIdCount",args:[n,m,t]},{address:l,abi:a.i,functionName:"groupInfo",args:[n,t]}]:[]},[n,t,m]),f=(0,r.N)({contracts:x,query:{enabled:!!n&&void 0!==t&&!!m&&x.length>0}}),p=f.data,h=f.isPending,g=f.error;return{groupDetail:(0,s.useMemo)(function(){if(p&&!(p.length<6)){var e,n,t,s,r,i,a=null===(e=p[0])||void 0===e?void 0:e.result,o=null===(n=p[1])||void 0===n?void 0:n.result,c=(0,d.Z)(null===(t=p[2])||void 0===t?void 0:t.result),l=(0,d.Z)(null===(s=p[3])||void 0===s?void 0:s.result),u=(0,d.Z)(null===(r=p[4])||void 0===r?void 0:r.result),m=null===(i=p[5])||void 0===i?void 0:i.result;if(m&&a&&o){var x=(0,d.Z)(m.groupId),f=m.description,h=(0,d.Z)(m.maxCapacity),g=(0,d.Z)(m.minJoinAmount),v=(0,d.Z)(m.maxJoinAmount),y=(0,d.Z)(m.maxAccounts),b=m.isActive,j=(0,d.Z)(m.activatedRound),N=(0,d.Z)(m.deactivatedRound),I=v>BigInt(0)&&v<c?v:c;return{groupId:x,groupName:a,description:f,owner:o,maxCapacity:h,accountCount:u,totalJoinedAmount:l,remainingCapacity:h-l,isActive:b,activatedRound:j,deactivatedRound:N,minJoinAmount:g,maxJoinAmount:v,maxAccounts:y,actionMaxJoinAmount:c,actualMinJoinAmount:g,actualMaxJoinAmount:I}}}},[p]),isPending:h,error:g}}},92429:function(e,n,t){"use strict";t.d(n,{Fw:function(){return f},hq:function(){return h},Hw:function(){return g}});var s=t(48564),r=t(2267),i=t(75766),a=t(45775),o=t(60480),d=t(13550),c=t.n(d),l=function(e,n){for(var t=e;t.length<2*n;)t="0"+t;return t},u=function(e){return(e=(e=e.toUpperCase()).substr(4)+e.substr(0,4)).split("").map(function(e){var n=e.charCodeAt(0);return n>=65&&n<=90?(n-65+10).toString():e}).join("")},m=function(e){for(var n,t=e;t.length>2;)t=(parseInt(n=t.slice(0,9),10)%97).toString()+t.slice(n.length);return parseInt(t,10)%97},x=function(){function e(n){(0,s._)(this,e),(0,i._)(this,"_iban",void 0),this._iban=n}return(0,r._)(e,[{key:"isValid",value:function(){return/^TH[0-9]{2}(ETH[0-9A-Z]{13}|[0-9A-Z]{30,31})$/.test(this._iban)&&1===m(u(this._iban))}},{key:"isDirect",value:function(){return 34===this._iban.length||35===this._iban.length}},{key:"isIndirect",value:function(){return 20===this._iban.length}},{key:"checksum",value:function(){return this._iban.substr(2,2)}},{key:"toAddress",value:function(){if(this.isDirect()){var e=this._iban.substr(4),n=new(c())(e,36);return(0,a.K)("0x".concat(n.toString(16).padStart(40,"0")))}return""}},{key:"toString",value:function(){return this._iban}}],[{key:"fromAddress",value:function(n){if(!(0,o.U)(n))throw Error("Provided address is not a valid address: "+n);var t=n.replace("0x","").replace("0X",""),s=l(new(c())(t,16).toString(36),15);return e.fromBban(s.toUpperCase())}},{key:"fromBban",value:function(n){return new e("TH"+("0"+(98-m(u("TH00"+n)))).slice(-2)+n)}},{key:"toIban",value:function(n){return e.fromAddress(n).toString()}},{key:"toAddress",value:function(n){var t=new e(n);if(!t.isDirect())throw Error("IBAN is indirect and can't be converted");return t.toAddress()}},{key:"isValid",value:function(n){return new e(n).isValid()}}]),e}();function f(e){return/^0[Xx][A-Fa-f0-9]{40}$/.test(e)}function p(e){try{return x.isValid(e)}catch(e){return!1}}function h(e){if(!e||""===e)return"";var n=e.trim();return f(n)?n.toLowerCase():p(n)?function(e){if(!e||""===e)return"";if("TH48000000000000000000000000001EKI"===e)return"0x0000000000000000000000000000000000010002";try{return x.toAddress(e).toLowerCase()}catch(e){return console.error("转换TH地址为0x失败:",e),""}}(n):""}function g(e){if(!e||""===e.trim())return"请输入收款地址";var n=e.trim();return f(n)||p(n)&&h(n)?null:"请输入有效的地址格式（支持 0x、XE 或 TH 格式）"}},22774:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return eb}});var s=t(85893),r=t(67294),i=t(11163),a=t(42130),o=t(45231),d=t(73591),c=t(83494),l=t(42083),u=t(11418),m=t(93778),x=t(92261),f=t(11010),p=t(97582),h=t(86501),g=t(27245),v=t(41664),y=t.n(v),b=t(67997),j=t(80332),N=t(7855),I=t(95752),A=t(27966),w=t(91529),k=t(44576),T=t(30333),C=function(e){var n,t=e.actionId,o=(e.actionInfo,e.extensionAddress),d=(0,a.m)().address,c=((0,r.useContext)(m.M)||{}).token,u=(0,i.useRouter)(),x=(0,N.g)({extensionAddress:o,tokenAddress:null==c?void 0:c.address,account:d}),v=x.joinedAmount,C=x.rewardRatio,E=x.userGovVotes,P=x.totalGovVotes,_=x.minGovRatio,M=x.userGovRatio,R=x.lpRatio,S=x.govRatioMultiplier,B=x.joinedBlock,Z=(x.exitableBlock,x.currentBlock),D=x.waitingBlocks,z=x.canExitNow,L=x.remainingBlocks,F=x.isPending,J=x.error,O=(0,j.s0)(null==c?void 0:c.address,t,d),G=O.isJoined,V=O.isPending,H=O.error,q=(0,w.rl)(R),U=(0,I.PQ)(o),X=U.exit,Q=U.isPending,K=U.isConfirming,W=U.isConfirmed,$=U.writeError,Y=(n=(0,f._)(function(){return(0,p.Jh)(this,function(e){switch(e.label){case 0:if(!v||v<=BigInt(0))return h.Am.error("你还没有加入LP，无需退出"),[2];if(!z)return h.Am.error("还需等待 ".concat(L," 个区块才能退出")),[2];return[4,X()];case 1:return e.sent(),[2]}})}),function(){return n.apply(this,arguments)});(0,r.useEffect)(function(){W&&(h.Am.success("退出LP成功"),u.push("/my"))},[W,u]);var ee=(0,A.b)().handleError;return((0,r.useEffect)(function(){J&&ee(J),$&&ee($),H&&ee(H)},[J,$,H,ee]),F||V)?(0,s.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(l.Z,{}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"加载数据中..."})]})}):(0,s.jsxs)("div",{className:"flex flex-col items-center pt-1",children:[G&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.Z,{stakedAmount:v||BigInt(0),lpRatioStr:q,rewardRatio:C,userGovVotes:E,totalGovVotes:P}),M<_&&(0,s.jsxs)("div",{className:"text-sm text-amber-700 bg-amber-50 border border-amber-200 rounded px-3 py-2 mt-3 w-full",children:[(0,s.jsx)("div",{className:"font-medium",children:"⚠️ 治理票占比不足"}),(0,s.jsxs)("div",{className:"mt-1",children:["你的治理票占比"," ",(0,s.jsx)("span",{className:"font-semibold",children:(0,w.rl)(Number(M)/1e18*100)})," ","低于最小门槛"," ",(0,s.jsx)("span",{className:"font-semibold",children:(0,w.rl)(Number(_)/1e18*100)}),"，无法获得得分和激励。"]}),(0,s.jsx)("div",{className:"text-xs text-amber-600 mt-1",children:"请质押更多代币以增加治理票数。"})]})]}),G?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"w-full space-y-3 mt-6",children:[(0,s.jsxs)("div",{className:"flex justify-center space-x-2 w-full",children:[!v||v<=BigInt(0)?(0,s.jsx)(g.z,{variant:"outline",className:"flex-1 text-secondary border-secondary",disabled:!0,children:"退出并取回代币"}):(0,s.jsx)(g.z,{variant:"outline",className:"flex-1 text-secondary border-secondary",onClick:Y,disabled:!z||Q||K||W,children:Q?"提交中":K?"确认中":W?"已退出":"退出并取回代币"}),(0,s.jsx)(g.z,{variant:"outline",className:"flex-1 text-secondary border-secondary",asChild:!0,children:(0,s.jsx)(y(),{href:"/acting/join?id=".concat(t,"&symbol=").concat(null==c?void 0:c.symbol),children:"增加LP"})})]}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(y(),{href:"/my/rewardsofaction?id=".concat(t,"&symbol=").concat(null==c?void 0:c.symbol),className:"text-secondary hover:underline",children:"查看行动激励 >>"})})]}),G&&!z&&(0,s.jsxs)("div",{className:"text-sm text-amber-700 bg-amber-50 border border-amber-200 rounded px-3 py-2 mt-3 w-full",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm font-bold text-amber-800 pb-2",children:[(0,s.jsx)(b.Z,{className:"w-4 h-4"}),"小贴士"]}),(0,s.jsxs)("div",{className:"mt-1",children:["加入后需要等待 ",(0,s.jsx)("span",{className:"font-semibold",children:D.toString()})," 个区块后才能退出",(0,s.jsxs)("span",{className:"text-sm text-amber-600 mt-1",children:["（你在区块 ",(0,s.jsx)("span",{className:"font-semibold",children:B.toString()})," 加入，当前区块"," ",Z.toString(),"，还需等待 ",L.toString()," 个区块，大约需要"," ",(0,w.ZC)(Number(L)*Number("2868")/1e3),"）"]})]})]}),(0,s.jsxs)("div",{className:"text-sm text-gray-700 bg-gray-50 border border-gray-200 rounded px-2 py-3 mt-6 mb-3 w-full",children:[(0,s.jsx)("div",{className:"font-medium text-gray-600 mb-2",children:"\uD83D\uDCA1 计算说明："}),(0,s.jsxs)("div",{className:"ml-4 text-gray-600 space-y-1",children:[(0,s.jsx)("div",{children:"• LP占比 = 你参与的LP数量 / 本行动的LP总量"}),(0,s.jsx)("div",{children:"• 治理票占比 = 你的治理票 / 总治理票"}),(0,s.jsxs)("div",{children:["• 激励占比 = LP占比 和 (你的治理票占比 \xd7 ",Number(S),") 中的最小值"]})]})]})]}):(0,s.jsx)(g.z,{variant:"outline",className:"w-1/2 text-secondary border-secondary",asChild:!0,children:(0,s.jsx)(y(),{href:"/acting/join?id=".concat(t,"&symbol=").concat(null==c?void 0:c.symbol),children:"加入LP参与"})}),(0,s.jsx)(k.Z,{isLoading:Q||K,text:Q?"提交退出交易...":"确认退出交易..."})]})},E=t(31729),P=t(74442),_=t(20442),M=t(36268),R=t(47714),S=t(48886),B=t(72107),Z=t(80302),D=function(e){var n,t,o=e.actionId,d=e.actionInfo,c=e.extensionAddress,u=(0,a.m)().address,x=((0,r.useContext)(m.M)||{}).token,v=(0,i.useRouter)(),b=(0,_.Bk)().currentRound,j=(0,S.aB)(c,b||BigInt(0),u),N=j.amount,I=j.provider,w=j.groupId,T=j.isPending,C=j.error,E=I&&"0x0000000000000000000000000000000000000000"!==I,D=(0,R.A)({extensionAddress:c,groupId:w||BigInt(0),round:b}),z=D.groupDetail,L=D.isPending,F=D.error,J=null==d?void 0:null===(t=d.body)||void 0===t?void 0:t.verificationKeys,O=(0,M.dB)({tokenAddress:null==x?void 0:x.address,actionId:o,account:u,verificationKeys:J}),G=O.verificationInfos,V=O.isPending,H=O.error,q=(null!=N?N:BigInt(0))>BigInt(0),U=(0,S.PQ)(),X=U.exit,Q=U.isPending,K=U.isConfirming,W=U.isConfirmed,$=U.writeError,Y=(n=(0,f._)(function(){return(0,p.Jh)(this,function(e){switch(e.label){case 0:if(!N||N<=BigInt(0))return h.Am.error("您还没有参与，无需退出"),[2];return[4,X(c)];case 1:return e.sent(),[2]}})}),function(){return n.apply(this,arguments)});(0,r.useEffect)(function(){W&&(h.Am.success("取回代币成功"),v.push("/my"))},[W,v]);var ee=(0,A.b)().handleError;return((0,r.useEffect)(function(){C&&ee(C),F&&ee(F),$&&ee($),H&&ee(H)},[C,F,$,H,ee]),T||L)?(0,s.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(l.Z,{}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"加载数据中..."})]})}):q?(0,s.jsxs)("div",{className:"flex flex-col items-center pt-1",children:[z&&!z.isActive&&(0,s.jsx)("div",{className:"w-full mb-3 rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm font-medium text-red-700",children:"当前链群已关闭！ 请及时取回代币。"}),(0,s.jsx)(Z.Z,{actionId:o,extensionAddress:c,groupId:w||BigInt(0)}),z&&(0,s.jsx)("div",{className:"w-full mb-2",children:(0,s.jsxs)("div",{className:"text-sm text-gray-600 mb-2 font-medium flex items-center justify-between",children:[(0,s.jsx)("span",{children:"所属链群："}),(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"text-gray-500 text-xs",children:"#"}),(0,s.jsxs)(y(),{href:"/extension/group?groupId=".concat(null==w?void 0:w.toString(),"&actionId=").concat(o.toString(),"&symbol=").concat(null==x?void 0:x.symbol),className:"text-secondary hover:underline flex items-center gap-1",children:[z.groupId.toString()," ",z.groupName,"\xa0>>"]})]})]})}),J&&J.length>0&&(0,s.jsxs)("div",{className:"w-full mb-6",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-600 mb-2 font-medium flex items-center justify-between",children:[(0,s.jsx)("span",{children:"我提供的验证信息："}),(0,s.jsxs)(g.z,{variant:"link",size:"sm",className:"text-secondary p-0 h-auto gap-0",onClick:function(){return v.push("/acting/join?tab=update_verification_info&groupId=".concat(null==w?void 0:w.toString(),"&id=").concat(o,"&symbol=").concat(null==x?void 0:x.symbol))},children:[(0,s.jsx)(P.Z,{className:"w-3 h-3 mr-1"}),"修改"]})]}),(0,s.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:V?(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"加载中..."}):(0,s.jsx)("div",{className:"space-y-3",children:J.map(function(e,n){return(0,s.jsxs)("div",{className:"last:mb-0",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-gray-700 mb-1",children:e}),(0,s.jsx)("div",{className:"text-base text-gray-800",children:G[n]?(0,s.jsx)(B.L,{text:G[n]||""}):(0,s.jsx)("span",{className:"text-gray-400",children:"未填写"})})]},e)})})})]}),(0,s.jsxs)("div",{className:"w-full space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-center space-x-2 w-full",children:[(0,s.jsx)(g.z,{variant:"outline",className:"flex-1 text-secondary border-secondary",onClick:Y,disabled:!N||N<=BigInt(0)||Q||K||W,children:Q?"提交中":K?"确认中":W?E?"已退出":"已取回":E?"退出体验":"退出并取回代币"}),E?(0,s.jsx)(g.z,{variant:"outline",className:"flex-1 text-secondary border-secondary",disabled:!0,children:"追加代币"}):(0,s.jsx)(g.z,{variant:"outline",className:"flex-1 text-secondary border-secondary",asChild:!0,children:(0,s.jsx)(y(),{href:"/acting/join?tab=join&groupId=".concat(null==w?void 0:w.toString(),"&id=").concat(o,"&symbol=").concat(null==x?void 0:x.symbol),children:"追加代币"})})]}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(y(),{href:"/my/rewardsofaction?id=".concat(o,"&symbol=").concat(null==x?void 0:x.symbol),className:"text-secondary hover:underline",children:"查看行动激励 >>"})})]}),(0,s.jsxs)("div",{className:"mt-6 text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded px-3 py-2 w-full",children:[(0,s.jsx)("div",{className:"font-medium text-gray-700 mb-1",children:"\uD83D\uDCA1 小贴士"}),(0,s.jsx)("div",{className:"space-y-1 text-gray-600",children:(0,s.jsx)("div",{children:"可以随时取回参与的代币，不影响已产生的激励"})})]}),(0,s.jsx)(k.Z,{isLoading:Q||K,text:Q?"提交取回交易...":"确认取回交易..."})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center pt-8",children:[(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"您还没有参与此链群行动"}),(0,s.jsx)(g.z,{variant:"outline",className:"text-secondary border-secondary",asChild:!0,children:(0,s.jsx)(y(),{href:"/acting/join?id=".concat(o,"&symbol=").concat(null==x?void 0:x.symbol),children:"加入链群参与"})})]})},z=t(91309),L=t(27460),F=t(3628),J=t(19741),O=t(67516),G=t(99932),V=t(87333),H=t(58149),q=t(88308),U="0x745470f219836deae285bD7E934CAD85958D1729",X=t(30985),Q=t(85794),K=t(59271),W=t(72253),$=t(14932),Y=t(87536),ee=t(56312),en=t(45901),et=t(37864),es=t(4270),er=t(35810),ei=t(21774),ea=t(74193),eo=t(71104),ed=t(37474),ec=t(84689),el=t(37742),eu="0x745470f219836deae285bD7E934CAD85958D1729",em=function(){var e=(0,eo.u)({address:eu,abi:G.l,functionName:"DEFAULT_MAX_RECIPIENTS"}),n=e.data,t=e.isPending,s=e.error;return{maxRecipients:(0,el.Z)(n),isPending:t,error:s}},ex=t(92429),ef=en.Ry({address:en.Z_().trim().regex(/^0x[a-fA-F0-9]{40}$/,"无效的地址格式"),basisPoints:en.oQ.number({invalid_type_error:"百分比必须是数字"}).min(0,"百分比不能为负").max(100,"百分比不能超过100"),remark:en.Z_().max(50,"备注不能超过50个字符").optional().default("")});function ep(e){e.extensionAddress;var n,t,i,a,o,d,c,l,u,m,x,v,y,b=e.groupActionTokenAddress,j=e.actionId,N=e.actionTitle,I=e.groupId,w=e.groupName,T=e.currentAddrs,C=e.currentRatios,E=e.currentRemarks,P=e.open,_=e.onOpenChange,M=e.onSuccess,R=(t=(n=(0,ed.e9)(G.l,eu,"setRecipients")).execute,i=n.isPending,a=n.isConfirming,o=n.isConfirmed,d=n.error,c=n.hash,l=n.isTukeMode,u=(0,f._)(function(e,n,s,r,i,a){return(0,p.Jh)(this,function(o){switch(o.label){case 0:return console.log("提交 setRecipients 交易:",{tokenAddress:e,actionId:n,groupId:s,addrs:r,ratios:i,remarks:a,isTukeMode:l}),[4,t([e,n,s,r,i,a])];case 1:return[2,o.sent()]}})}),m=function(e,n,t,s,r,i){return u.apply(this,arguments)},(0,r.useEffect)(function(){c&&console.log("setRecipients tx hash:",c),d&&(console.log("提交 setRecipients 交易错误:"),(0,ec.Vh)(d),(0,ec.H)(d))},[c,d]),{setRecipients:m,isPending:i,isConfirming:a,writeError:d,isConfirmed:o,hash:c,isTukeMode:l}),S=R.setRecipients,B=R.isPending,Z=R.isConfirming,D=R.isConfirmed,z=R.writeError,L=em().maxRecipients,F=(0,r.useMemo)(function(){return en.Ry({recipients:en.IX(ef)}).refine(function(e){return 100>=e.recipients.reduce(function(e,n){return e+(n.basisPoints||0)},0)},{message:"所有地址的百分比总和不能超过 ".concat(100,"%"),path:["root"]}).refine(function(e){var n=e.recipients.map(function(e){return e.address.toLowerCase()}).filter(function(e){return e&&e.match(/^0x[a-fA-F0-9]{40}$/)}),t=new Set(n);return n.length===t.size},{message:"存在重复的地址，同一链群下每个地址只能设置一次",path:["root"]})},[100]),J=(0,Y.cI)({resolver:(0,ee.F)(F),defaultValues:{recipients:[]}}),O=(0,Y.Dq)({control:J.control,name:"recipients"}),V=O.fields,H=O.append,q=O.remove,U=(0,r.useRef)(!1);(0,r.useEffect)(function(){if(P&&T&&C){var e=T.map(function(e,n){return{address:e,basisPoints:Number(C[n])/1e16,remark:(null==E?void 0:E[n])||""}});J.reset({recipients:e}),U.current=!1}else P&&(J.reset({recipients:[]}),U.current=!1)},[P,T,C,E,J]);var X=(0,A.b)().handleError;(0,r.useEffect)(function(){z&&X(z)},[z,X]),(0,r.useEffect)(function(){D&&!U.current&&(U.current=!0,null==M||M(),_(!1))},[D,M,_]);var Q=(x=(0,f._)(function(e){var n,t,s,r,i,a,o,d;return(0,p.Jh)(this,function(c){switch(c.label){case 0:if(n=[],t=[],e.recipients.forEach(function(e,s){var r=(0,ex.hq)(e.address);r&&(0,ex.Fw)(r)?n.push(r):t.push(s)}),t.length>0)return J.setError("root",{message:"存在无效的地址格式，请检查并修正所有地址（支持 0x、XE 或 TH 格式）"}),[2];if(s=n.map(function(e){return e}),r=e.recipients.map(function(e){return BigInt(Math.floor(1e16*e.basisPoints))}),(i=e.recipients.reduce(function(e,n){return e+(n.basisPoints||0)},0))>100)return J.setError("root",{message:"总比例不能超过 ".concat(100,"% (当前: ").concat(i.toFixed(2),"%)")}),[2];if(o=new Set(a=s.map(function(e){return e.toLowerCase()})),a.length!==o.size)return J.setError("root",{message:"存在重复的地址，同一链群下每个地址只能设置一次"}),[2];if(e.recipients.map(function(e,n){var t=Number(e.basisPoints);return 0===t||isNaN(t)?n:-1}).filter(function(e){return -1!==e}).length>0)return J.setError("root",{message:"每个地址的百分比不能为 0，请为所有地址设置有效的百分比"}),[2];if(d=e.recipients.map(function(e){return e.remark||""}),!b)return J.setError("root",{message:"无法获取 Group Action Token 地址，请刷新页面重试"}),[2];return[4,S(b,j,I,s,r,d)];case 1:return c.sent(),[2]}})}),function(e){return x.apply(this,arguments)}),K=J.watch("recipients"),eo=K.reduce(function(e,n){return e+(Number(n.basisPoints)||0)},0),el=eo.toFixed(2),ep=eo>100,eh=100-eo,eg=(v=new Map,K.forEach(function(e,n){if(e.address&&e.address.match(/^0x[a-fA-F0-9]{40}$/)){var t=e.address.toLowerCase();v.has(t)||v.set(t,[]),v.get(t).push(n)}}),y=new Set,v.forEach(function(e){e.length>1&&e.forEach(function(e){return y.add(e)})}),y),ev=eg.size>0,ey=(0,r.useCallback)(function(e){return function(n){var t=n.target.value,s=t.trim();s!==t&&e(s)}},[]),eb=(0,r.useCallback)(function(e,n){return function(t){var s=t.target.value,r=Number(s);""===s||"-"===s?e(""):isNaN(r)||(r<0?e(0):r>n?(e(n),h.Am.error("该地址最多可分配 ".concat(n.toFixed(2),"%"))):e(r))}},[]);return(0,s.jsx)(er.Vq,{open:P,onOpenChange:_,children:(0,s.jsxs)(er.cZ,{className:"max-w-2xl p-3 sm:p-6",children:[(0,s.jsx)(er.fK,{children:(0,s.jsx)(er.$N,{children:"编辑激励分配地址"})}),(0,s.jsx)(ea.l0,(0,$._)((0,W._)({},J),{children:(0,s.jsxs)("form",{onSubmit:J.handleSubmit(Q),className:"space-y-4",children:[(0,s.jsxs)("div",{className:"border rounded-lg p-3 bg-gray-50",children:[(0,s.jsxs)("div",{className:"flex items-baseline mb-2",children:[(0,s.jsx)("span",{className:"text-greyscale-400 text-sm",children:"No."}),(0,s.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(j)}),(0,s.jsx)("span",{className:"font-bold text-greyscale-800",children:N})]}),(0,s.jsxs)("div",{className:"text-gray-800",children:[(0,s.jsx)("span",{className:"text-gray-500 text-xs",children:"链群 #"}),(0,s.jsx)("span",{className:"text-secondary text-base font-semibold",children:I.toString()})," ",(0,s.jsx)("span",{children:w||"链群 #".concat(I)})]})]}),J.formState.errors.root&&(0,s.jsx)("div",{className:"text-red-500 text-sm p-2 bg-red-50 rounded-md border border-red-200",children:J.formState.errors.root.message}),(0,s.jsxs)("div",{className:"space-y-3 -mx-2 sm:mx-0",children:[V.map(function(e,n){var t=100-K.reduce(function(e,t,s){return s!==n?e+(Number(t.basisPoints)||0):e},0),r=eg.has(n);return(0,s.jsxs)("div",{className:"border rounded-lg p-2 sm:p-3 ".concat(r?"bg-red-50 border-red-300":"bg-white border-gray-200"),children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("span",{className:"text-xs text-greyscale-400 min-w-[20px]",children:[n+1,"."]}),(0,s.jsx)(ea.Wi,{control:J.control,name:"recipients.".concat(n,".address"),render:function(e){var n=e.field;return(0,s.jsxs)(ea.xJ,{className:"flex-1 min-w-0",children:[(0,s.jsx)(ea.NI,{children:(0,s.jsx)(ei.I,(0,$._)((0,W._)({placeholder:"0x..."},n),{onBlur:ey(n.onChange),className:"font-mono text-xs sm:text-sm h-8 px-2 ".concat(r?"border-red-500 focus-visible:ring-red-500":"")}))}),(0,s.jsx)(ea.zG,{className:"text-xs"}),r&&(0,s.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"该地址重复"})]})}})]}),(0,s.jsxs)("div",{className:"mt-1.5 ml-5 sm:ml-6 flex items-center gap-1 sm:gap-2",children:[(0,s.jsx)(ea.Wi,{control:J.control,name:"recipients.".concat(n,".remark"),render:function(e){var n=e.field;return(0,s.jsxs)(ea.xJ,{className:"flex-1 min-w-0",children:[(0,s.jsx)(ea.NI,{children:(0,s.jsx)(ei.I,(0,$._)((0,W._)({placeholder:"名称/备注"},n),{className:"h-8 px-2 text-sm"}))}),(0,s.jsx)(ea.zG,{className:"text-xs"})]})}}),(0,s.jsx)(ea.Wi,{control:J.control,name:"recipients.".concat(n,".basisPoints"),render:function(e){var n=e.field;return(0,s.jsxs)(ea.xJ,{className:"shrink-0",children:[(0,s.jsx)(ea.NI,{children:(0,s.jsxs)("div",{className:"relative inline-block",children:[(0,s.jsx)(ei.I,(0,$._)((0,W._)({type:"number",min:0,max:t,placeholder:"0-100"},n),{onChange:eb(n.onChange,t),className:"h-8 px-1 sm:px-2 pr-6 w-16"})),(0,s.jsx)("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none text-xs sm:text-sm",children:"%"})]})}),(0,s.jsx)(ea.zG,{className:"text-xs"})]})}}),(0,s.jsx)(g.z,{type:"button",variant:"ghost",size:"icon",onClick:function(){return q(n)},className:"h-8 w-8 shrink-0",children:(0,s.jsx)(et.Z,{className:"w-3 h-3 sm:w-4 sm:h-4 text-red-500"})})]})]},e.id)}),0===V.length&&(0,s.jsx)("div",{className:"text-center text-muted-foreground py-8 text-xs sm:text-sm border rounded-lg border-dashed",children:"暂无接收地址，点击下方按钮添加"})]}),V.length>0&&(0,s.jsxs)("div",{className:"text-sm p-2 rounded-md border ".concat(ep||ev?"bg-red-50 border-red-200 text-red-700":"bg-blue-50 border-blue-200 text-blue-700"),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{children:"总百分比："}),(0,s.jsxs)("span",{className:"font-semibold",children:[el,"% / ",100,"%"]})]}),!ep&&!ev&&eh>0&&(0,s.jsxs)("div",{className:"text-xs mt-1",children:["剩余可分配：",eh.toFixed(2),"%"]}),ep&&(0,s.jsx)("div",{className:"text-xs mt-1 text-red-600",children:"警告：总比例超过 100%，请调整百分比"}),ev&&(0,s.jsx)("div",{className:"text-xs mt-1 text-red-600",children:"警告：存在重复地址，请修改或删除"})]}),(0,s.jsxs)(g.z,{type:"button",variant:"outline",className:"w-full border-dashed",disabled:ep||eo>=100,onClick:function(){if(void 0!==L&&V.length>=Number(L)){h.Am.error("激励分配地址数量不能超过最大限制 ".concat(L.toString()));return}H({address:"",basisPoints:0,remark:""})},children:[(0,s.jsx)(es.Z,{className:"w-4 h-4 mr-2"})," 添加地址"]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,s.jsx)(g.z,{type:"button",variant:"ghost",onClick:function(){return _(!1)},children:"取消"}),(0,s.jsx)(g.z,{type:"submit",disabled:B||Z||ep||ev,children:B||Z?"提交中...":"提交"})]})]})})),(0,s.jsx)(k.Z,{isLoading:B||Z,text:B?"正在提交...":"正在确认..."})]})})}var eh=t(64777);function eg(e){var n,t,i,o,d,c,u,x,v,b,N,I,T,C,E,_,M,R,S,B,Z,D,W,$,Y,ee,en,et=e.extensionAddress,es=e.actionId,er=(0,a.m)().address,ei=((0,r.useContext)(m.M)||{}).token,ea=(0,F.NL)(),eo=(0,j.s0)(null==ei?void 0:ei.address,null!=es?es:BigInt(0),er),ed=eo.isJoined,ec=eo.isPending,el=eo.error,eu=(0,J.R6)(et,er),em=eu.joinedAmountByAccount,ex=eu.isPending,ef=(0,J.fP)(et).joinedAmount,eg=(0,X.l)(et).groupActionTokenAddress,ev=(0,Q.z4)(eg||"0x").symbol,ey=(t=(n={tokenAddress:eg,account:er,extensionAddress:et,round:(0,K.Bk)().currentRound}).tokenAddress,i=n.account,o=n.extensionAddress,d=n.round,u=(c=(0,V.Q)({tokenAddress:t,account:i})).actionIdsWithGroupIds,x=c.isPending,v=c.error,N=(b=(0,r.useMemo)(function(){if(0===u.length)return{allActionIds:[],allGroupIds:[]};var e=u.map(function(e){return e.actionId}),n=new Set;return u.forEach(function(e){e.groupIds.forEach(function(e){n.add(e.toString())})}),{allActionIds:e,allGroupIds:Array.from(n).map(function(e){return BigInt(e)})}},[u])).allActionIds,I=b.allGroupIds,C=(T=(0,H.I)({tokenAddress:t,actionIds:N,enabled:N.length>0&&!x})).actionInfos,E=T.isPending,_=T.error,R=(M=(0,q.h)({groupIds:I.length>0?I:void 0,enabled:I.length>0&&!x})).groupNameMap,S=M.isPending,B=M.error,Z=(0,r.useMemo)(function(){if(!U||!t||!i||void 0===d||0===u.length)return[];var e=[];return u.forEach(function(n){var s=n.actionId;n.groupIds.forEach(function(n){e.push({address:U,abi:G.l,functionName:"recipients",args:[i,t,s,n,d]})})}),e},[t,i,d,u]),W=(D=(0,O.N)({contracts:Z,query:{enabled:!!U&&!!t&&!!i&&!!d&&Z.length>0}})).data,$=D.isPending,Y=D.error,ee=(0,r.useMemo)(function(){var e=new Map;if(!W||0===u.length)return e;var n=0;return u.forEach(function(t){var s=t.actionId;t.groupIds.forEach(function(t){var r=W[n];if((null==r?void 0:r.status)==="success"&&r.result){var i=(0,z._)(r.result,3),a=i[0],o=i[1],d=i[2],c="".concat(s,"_").concat(t);e.set(c,{addrs:a,ratios:o,remarks:d})}n++})}),e},[W,u]),{actionGroupRecipientsData:(0,r.useMemo)(function(){if(0===u.length)return[];var e=new Map;C.forEach(function(n,t){t<N.length&&e.set(N[t],n)});var n=[];return u.forEach(function(t){var s=t.actionId,r=t.groupIds,i=e.get(s);if(i){var a=r.map(function(e){var n="".concat(s,"_").concat(e),t=ee.get(n);return{groupId:e,groupName:R.get(e),addrs:null==t?void 0:t.addrs,ratios:null==t?void 0:t.ratios,remarks:null==t?void 0:t.remarks}});n.push({actionId:s,actionTitle:i.body.title,groups:a})}}),n},[u,C,N,R,ee]),isPending:(0,r.useMemo)(function(){return!t||!i||!o||void 0===d||!!x||0!==u.length&&(!!E||!!S||$)},[t,i,o,d,x,u.length,E,S,$]),error:v||_||B||Y}),eb=ey.actionGroupRecipientsData,ej=ey.isPending,eN=ey.error,eI=(0,z._)((0,r.useState)(!1),2),eA=eI[0],ew=eI[1],ek=(0,z._)((0,r.useState)(null),2),eT=ek[0],eC=ek[1],eE=function(e,n){eC({actionId:e.actionId,actionTitle:e.actionTitle,groupId:n.groupId,groupName:n.groupName,addrs:n.addrs,ratios:n.ratios,remarks:n.remarks}),ew(!0)},eP=function(e){ew(e),e||setTimeout(function(){eC(null)},300)},e_=(0,J.PQ)(et),eM=e_.exit,eR=e_.isPending,eS=e_.isConfirming,eB=e_.isConfirmed,eZ=e_.writeError,eD=(0,A.b)().handleError;(0,r.useEffect)(function(){eZ&&eD(eZ)},[eZ,eD]),(0,r.useEffect)(function(){eN&&eD(eN)},[eN,eD]),(0,r.useEffect)(function(){el&&eD(el)},[el,eD]),(0,r.useEffect)(function(){eB&&h.Am.success("退出行动成功")},[eB]);var ez=em||BigInt(0),eL=ef||BigInt(1),eF=0;ez>0&&ef&&ef>0&&(eF=Number(BigInt(ez)*BigInt(1e4)/ef)/100);var eJ=(0,w.rl)(eF),eO=(en=(0,f._)(function(){return(0,p.Jh)(this,function(e){switch(e.label){case 0:if(ez<=0)return h.Am.error("您没有参与，无需退出"),[2];return[4,eM()];case 1:return e.sent(),[2]}})}),function(){return en.apply(this,arguments)});return ex||es&&ec?(0,s.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(l.Z,{}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"加载数据中..."})]})}):es&&!ed?(0,s.jsxs)("div",{className:"flex flex-col items-center pt-8",children:[(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"您还没有参与此链群服务行动"}),(0,s.jsx)(g.z,{variant:"outline",className:"text-secondary border-secondary",asChild:!0,children:(0,s.jsx)(y(),{href:"/acting/join?id=".concat(es,"&symbol=").concat((null==ei?void 0:ei.symbol)||""),children:"加入链群服务行动"})})]}):(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"stats w-full grid grid-cols-2 divide-x-0 gap-4",children:[(0,s.jsxs)("div",{className:"stat place-items-center flex flex-col justify-center",children:[(0,s.jsx)("div",{className:"stat-title",children:"我的参与"}),(0,s.jsx)("div",{className:"stat-value text-2xl text-secondary",children:(0,w.LH)(ez)}),(0,s.jsx)("div",{className:"stat-desc text-sm mt-2 whitespace-normal break-words text-center",children:ev||"-"})]}),(0,s.jsxs)("div",{className:"stat place-items-center flex flex-col justify-center",children:[(0,s.jsx)("div",{className:"stat-title",children:"占总参与量"}),(0,s.jsx)("div",{className:"stat-value text-2xl text-secondary",children:eJ}),(0,s.jsxs)("div",{className:"stat-desc text-sm mt-2 whitespace-normal break-words text-center",children:["总量 ",(0,w.LH)(eL)]})]})]}),(0,s.jsxs)("div",{className:"flex justify-center space-x-2 w-full",children:[(0,s.jsx)(g.z,{variant:"outline",className:"flex-1 text-secondary border-secondary",onClick:eO,disabled:eR||eS||eB||ez<=0,children:eR?"提交中":eS?"确认中":eB?"已退出":"退出行动"}),(0,s.jsx)(g.z,{variant:"outline",className:"flex-1 text-secondary border-secondary",asChild:!0,children:(0,s.jsx)(y(),{href:"/my/rewardsofaction?id=".concat((null==es?void 0:es.toString())||"","&symbol=").concat((null==ei?void 0:ei.symbol)||""),children:"查看激励"})})]}),(0,s.jsxs)("div",{className:"w-full mt-6",children:[(0,s.jsx)(eh.Z,{title:"我的链群"}),ej?(0,s.jsx)("div",{className:"flex justify-center p-8",children:(0,s.jsx)(l.Z,{})}):eb&&0!==eb.length?(0,s.jsx)("div",{className:"space-y-6 mt-4",children:eb.map(function(e){return(0,s.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,s.jsxs)("div",{className:"flex items-baseline mb-2",children:[(0,s.jsx)("span",{className:"text-greyscale-400 text-sm",children:"No."}),(0,s.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(e.actionId)}),(0,s.jsx)("span",{className:"font-bold text-greyscale-800",children:e.actionTitle})]}),(0,s.jsx)("div",{className:"space-y-1",children:e.groups.map(function(n){return(0,s.jsxs)("div",{className:"border-t pt-4 first:border-t-0 first:pt-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"text-gray-800",children:[(0,s.jsx)("span",{className:"text-gray-500 text-xs",children:"#"}),(0,s.jsx)("span",{className:"text-secondary text-base font-semibold ",children:n.groupId.toString()})," ",(0,s.jsx)("span",{children:n.groupName||"链群 #".concat(n.groupId)})]}),(0,s.jsxs)(g.z,{className:"gap-0 px-2 text-secondary",variant:"link",size:"sm",onClick:function(){return eE(e,n)},children:[(0,s.jsx)(P.Z,{className:"w-3 h-3 mr-1"}),"编辑分配地址 >>"]})]}),n.addrs&&n.addrs.length>0?(0,s.jsx)("div",{className:"space-y-2 mt-2",children:n.addrs.map(function(e,t){var r;return(0,s.jsxs)("div",{className:"border rounded-lg p-2 bg-gray-50/50",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1.5 min-w-0",children:[(0,s.jsxs)("span",{className:"text-xs text-greyscale-400 shrink-0",children:[t+1,"."]}),(0,s.jsx)("div",{className:"inline-flex items-center bg-white rounded-md px-2 py-0.5 min-w-0",children:(0,s.jsx)(L.Z,{address:e,showCopyButton:!0})})]}),(0,s.jsxs)("span",{className:"font-mono text-sm text-secondary shrink-0 ml-2",children:[n.ratios?(Number(n.ratios[t])/1e16).toFixed(2):"0.00","%"]})]}),(0,s.jsx)("div",{className:"ml-4",children:(0,s.jsx)("span",{className:"text-sm text-gray-600",children:(null===(r=n.remarks)||void 0===r?void 0:r[t])||(0,s.jsx)("span",{className:"text-greyscale-400 italic",children:"未命名"})})})]},"".concat(e,"-").concat(t))})}):(0,s.jsx)("div",{className:"text-sm text-greyscale-400 p-2 bg-gray-50 rounded",children:"未设置分配地址"})]},n.groupId.toString())})})]},e.actionId.toString())})}):(0,s.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4 bg-gray-50 rounded-lg mt-4",children:"暂无二次分配地址配置"})]}),eT&&(0,s.jsx)(ep,{extensionAddress:et,groupActionTokenAddress:eg,actionId:eT.actionId,actionTitle:eT.actionTitle,groupId:eT.groupId,groupName:eT.groupName,currentAddrs:eT.addrs,currentRatios:eT.ratios,currentRemarks:eT.remarks,open:eA,onOpenChange:eP,onSuccess:function(){h.Am.success("二次分配设置已更新"),eP(!1),ea.invalidateQueries({predicate:function(e){var n=e.queryKey;if(Array.isArray(n)&&"readContracts"===n[0]){var t,s=null===(t=n[1])||void 0===t?void 0:t.contracts;if(Array.isArray(s))return s.some(function(e){return(null==e?void 0:e.functionName)==="recipients"})}return!1}})}}),(0,s.jsx)(k.Z,{isLoading:eR||eS,text:eR?"提交退出...":"确认退出..."})]})}var ev=t(92112),ey=function(e){var n,t,r=e.actionId,i=e.actionInfo,a=e.tokenAddress,o=(0,ev.kz)({tokenAddress:a,actionInfo:i}),d=o.contractInfo;if(o.isPending)return(0,s.jsx)(l.Z,{});if(!(null==d?void 0:d.isExtension)||!d.extension)return(0,s.jsx)(E.Z,{actionId:r,actionInfo:i});var c=(null===(n=d.factory)||void 0===n?void 0:n.address)?(0,x.qD)(null===(t=d.factory)||void 0===t?void 0:t.address):null;if(!c)return(0,s.jsx)(E.Z,{actionId:r,actionInfo:i});switch(c.type){case x.nw.LP:return(0,s.jsx)(C,{actionId:r,actionInfo:i,extensionAddress:d.extension});case x.nw.GROUP_ACTION:return(0,s.jsx)(D,{actionId:r,actionInfo:i,extensionAddress:d.extension});case x.nw.GROUP_SERVICE:return(0,s.jsx)(eg,{actionId:r,extensionAddress:d.extension});default:return(0,s.jsx)(E.Z,{actionId:r,actionInfo:i})}},eb=function(){var e=(0,i.useRouter)().query.id,n=e?BigInt(e):void 0,t=(0,a.m)().address,x=((0,r.useContext)(m.M)||{}).token,f=(0,o.Q)({tokenAddress:null==x?void 0:x.address,actionId:n,account:t}),p=f.actionInfo,h=f.participantCount,g=f.totalAmount,v=f.convertedTotalAmount,y=f.joinedAmountTokenSymbol,b=f.joinedAmountTokenIsLP,j=f.isJoined,N=f.isExtensionAction,I=f.isPending,A=f.error,w=(0,d.S)().handleContractError;return((0,r.useEffect)(function(){A&&w(A,"submit")},[A]),void 0===n)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.Z,{title:"行动激励",showBackButton:!0}),(0,s.jsx)("main",{className:"flex-grow",children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsx)("div",{className:"text-center text-red-500",children:"参数错误：缺少行动ID参数"})})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.Z,{title:"行动激励",showBackButton:!0}),(0,s.jsx)("main",{className:"flex-grow",children:(0,s.jsxs)("div",{className:"px-4 pt-0 pb-3",children:[p&&(0,s.jsx)(u.Z,{actionInfo:p,participantCount:h,totalAmount:g,convertedTotalAmount:v,joinedAmountTokenSymbol:y,joinedAmountTokenIsLP:b,isJoined:j,isPending:I,showActionButtons:!1}),I?(0,s.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(l.Z,{}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"加载数据中..."})]})}):A?(0,s.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,s.jsxs)("div",{className:"text-center text-red-500",children:["加载失败：",A.message||"获取行动信息失败，请稍后重试"]})}):p?N?(0,s.jsx)(ey,{actionId:n,actionInfo:p,tokenAddress:null==x?void 0:x.address}):(0,s.jsx)(E.Z,{actionId:n,actionInfo:p}):(0,s.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,s.jsx)("div",{className:"text-center text-yellow-600",children:"行动不存在：找不到指定的行动信息"})})]})})]})}}},function(e){e.O(0,[8501,4463,721,3798,8139,3494,3591,5787,8300,2112,5611,7966,6268,6097,5293,8886,9330,7974,1927,3439,2888,9774,179],function(){return e(e.s=84476)}),_N_E=e.O()}]);