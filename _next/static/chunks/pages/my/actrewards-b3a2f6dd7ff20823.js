(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4249],{1709:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});var r=t(37876);let a=e=>{var s=e.title;return(0,r.jsx)("div",{className:"flex justify-between items-center",children:(0,r.jsx)("h1",{className:"text-lg font-bold",children:s})})}},11704:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/actrewards",function(){return t(82089)}])},19671:(e,s,t)=>{"use strict";t.d(s,{BE:()=>v,I6:()=>g,Uz:()=>x,_s:()=>o,cp:()=>u,gk:()=>N,tb:()=>f,zj:()=>j});var r=t(3576),a=t(62701),n=t(65699),i=t(37876),l=t(14232),c=t(28653),d=t(30684),o=e=>{var s=e.shouldScaleBackground,t=(0,n._)(e,["shouldScaleBackground"]);return(0,i.jsx)(c._s.Root,(0,r._)({shouldScaleBackground:void 0===s||s},t))};o.displayName="Drawer";var x=c._s.Trigger,m=c._s.Portal,u=c._s.Close,h=l.forwardRef((e,s)=>{var t=e.className,a=(0,n._)(e,["className"]);return(0,i.jsx)(c._s.Overlay,(0,r._)({ref:s,className:(0,d.cn)("fixed inset-0 z-50 bg-black/80",t)},a))});h.displayName=c._s.Overlay.displayName;var j=l.forwardRef((e,s)=>{var t=e.className,l=e.children,o=(0,n._)(e,["className","children"]);return(0,i.jsxs)(m,{children:[(0,i.jsx)(h,{}),(0,i.jsxs)(c._s.Content,(0,a._)((0,r._)({ref:s,className:(0,d.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t)},o),{children:[(0,i.jsx)("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),l]}))]})});j.displayName="DrawerContent";var v=e=>{var s=e.className,t=(0,n._)(e,["className"]);return(0,i.jsx)("div",(0,r._)({className:(0,d.cn)("grid gap-1.5 p-4 text-center sm:text-left",s)},t))};v.displayName="DrawerHeader";var f=e=>{var s=e.className,t=(0,n._)(e,["className"]);return(0,i.jsx)("div",(0,r._)({className:(0,d.cn)("mt-auto flex flex-col gap-2 p-4",s)},t))};f.displayName="DrawerFooter";var N=l.forwardRef((e,s)=>{var t=e.className,a=(0,n._)(e,["className"]);return(0,i.jsx)(c._s.Title,(0,r._)({ref:s,className:(0,d.cn)("text-lg font-semibold leading-none tracking-tight",t)},a))});N.displayName=c._s.Title.displayName;var g=l.forwardRef((e,s)=>{var t=e.className,a=(0,n._)(e,["className"]);return(0,i.jsx)(c._s.Description,(0,r._)({ref:s,className:(0,d.cn)("text-sm text-muted-foreground",t)},a))});g.displayName=c._s.Description.displayName},30822:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});var r=(0,t(11713).A)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},42038:(e,s,t)=>{"use strict";t.d(s,{C:()=>a});var r=t(97685),a=e=>!!e||(r.oR.error("请先将钱包链接 ".concat("thinkium801")),!1)},43885:(e,s,t)=>{"use strict";t.d(s,{H:()=>n});var r=t(37876);t(14232);var a=e=>{if(!e)return e;var s=/(https?:\/\/[^\s]+)/g;if(!s.test(e))return e;var t=e.split(s),a=e.match(s)||[];return(0,r.jsx)(r.Fragment,{children:t.map((e,s)=>{if(s%2==0)return e;var t=a[(s-1)/2];return(0,r.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline hover:text-blue-700",children:t},s)})})},n=e=>{var s=e.text;return(0,r.jsx)(r.Fragment,{children:a(s)})}},82089:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>D});var r=t(40854),a=t(37876),n=t(14232),i=t(89099),l=t(17660),c=t(20451),d=t(92101),o=t(66663),x=t(12293),m=t(16927),u=t(4902),h=t(8047),j=t(97685),v=t(6960),f=t(48230),N=t.n(f),g=t(52372),p=t(42038),y=t(20442),b=t(83416),w=t(1709),_=t(99574),A=t(43885);let C=e=>{var s=e.actionId,t=(0,h.F)(),r=t.address,i=t.chain,d=((0,n.useContext)(b.N)||{}).token,o=(0,g.IJ)((null==d?void 0:d.address)||"",s,r||""),f=o.verificationKeys,C=o.verificationInfos,k=o.isPending,I=o.error,R=(0,l.vx)((null==d?void 0:d.address)||"",s,r||""),S=R.joinedAmountByActionIdByAccount,E=R.isPending,B=R.error,P=(0,l.S1)(),z=P.withdraw,$=P.isPending,D=P.isConfirming,F=P.isConfirmed,L=P.error,H=function(){var e=(0,m._)(function(){return(0,u.__generator)(this,function(e){switch(e.label){case 0:if(!(0,p.C)(i))return[2];if(void 0!=S&&S<=2n)return j.oR.error("你还没有参与，无需取回"),[2];return[4,z((null==d?void 0:d.address)||"",s)];case 1:return e.sent(),[2]}})});return function(){return e.apply(this,arguments)}}();(0,n.useEffect)(()=>{F&&j.oR.success("取回成功")},[F]);var T=(0,c.g)().handleContractError;return((0,n.useEffect)(()=>{B&&T(B,"join"),L&&T(L,"join"),I&&T(I,"join")},[B,L,I]),E||k)?(0,a.jsxs)("div",{className:"px-4 pt-4 pb-2",children:[(0,a.jsx)(w.A,{title:"我的参与"}),(0,a.jsx)(x.A,{})]}):(0,a.jsxs)("div",{className:"px-4 pt-4 pb-2",children:[(0,a.jsx)(w.A,{title:"我的参与"}),(0,a.jsx)("div",{className:"stats mt-2 w-full flex justify-center",children:(0,a.jsxs)("div",{className:"stat place-items-center",children:[(0,a.jsx)("div",{className:"stat-title",children:"我参与的代币数"}),(0,a.jsx)("div",{className:"stat-value text-2xl text-secondary",children:(0,y.NJ)(S||BigInt(0),0)})]})}),(0,a.jsxs)("div",{className:"flex justify-center space-x-4 mt-2",children:[void 0!=S&&S<=2n?(0,a.jsx)(v.$,{variant:"outline",className:"w-1/3 text-secondary border-secondary",disabled:!0,children:"取回"}):(0,a.jsx)(v.$,{variant:"outline",className:"w-1/3 text-secondary border-secondary",onClick:H,disabled:$||D||F,children:$?"提交中":D?"确认中":F?"已取回":"取回代币"}),(0,a.jsx)(v.$,{variant:"outline",className:"w-1/3 text-secondary border-secondary",asChild:!0,children:(0,a.jsx)(N(),{href:"/acting/join?id=".concat(s,"&symbol=").concat(null==d?void 0:d.symbol),children:"增加参与代币"})})]}),(0,a.jsx)("div",{className:"flex flex-col items-center mt-2",children:(0,a.jsxs)("div",{className:"text-sm text-greyscale-600",children:[k&&"加载中...",void 0!=S&&S>2n&&f&&f.length>0&&(0,a.jsx)("div",{children:f.map((e,s)=>(0,a.jsxs)("div",{children:[e,": ",(0,a.jsx)(A.H,{text:C[s]})]},s))})]})}),(0,a.jsx)(_.A,{isLoading:$||D,text:$?"提交交易...":"确认交易..."})]})};var k=t(3576),I=t(62701),R=t(30822),S=t(96108),E=t(62288),B=t(87577),P=t(19671);let z=e=>{var s=e.currentRound,t=e.handleChangedRound,i=(0,r._)((0,n.useState)(!1),2),l=i[0],c=i[1],d=e=>{t(e),c(!1)};return"undefined"!=typeof document&&document.addEventListener("touchstart",function(){},{passive:!1}),(0,a.jsxs)(P._s,{open:l,onOpenChange:c,children:[(0,a.jsx)(P.Uz,{asChild:!0,children:(0,a.jsx)(v.$,{variant:"link",className:"text-secondary no-underline",children:"切换轮次"})}),(0,a.jsxs)(P.zj,{className:"z-[9999] min-h-[25vh]",children:[(0,a.jsxs)(P.BE,{children:[(0,a.jsx)(P.gk,{}),(0,a.jsx)(P.I6,{})]}),(0,a.jsx)("div",{className:"px-4 flex-grow",children:(0,a.jsx)("div",{className:"max-h-64 overflow-y-auto",children:Array.from({length:Number(s)},(e,t)=>{var r=Number(s)-t;return(0,a.jsx)(v.$,{variant:"ghost",className:"w-full p-2 text-center rounded-none hover:bg-gray-100 touch-manipulation",onClick:e=>{e.preventDefault(),e.stopPropagation(),d(r)},onTouchEnd:e=>{e.preventDefault(),e.stopPropagation(),d(r)},style:{touchAction:"manipulation"},children:(0,a.jsxs)("span",{className:"text-lg",children:["第 ",r," 轮"]})},r)})})}),(0,a.jsx)(P.tb,{children:(0,a.jsx)(P.cp,{asChild:!0,children:(0,a.jsx)(v.$,{variant:"outline",children:"关闭"})})})]})]})},$=e=>{var s=e.currentJoinRound,t=e.actionId,i=e.actionInfo,l=((0,n.useContext)(b.N)||{}).token,d=(0,h.F)(),o=d.address,j=d.chain,f=(0,r._)((0,n.useState)(0n),2),N=f[0],C=f[1],P=(0,r._)((0,n.useState)(new Set),2),$=P[0],D=P[1];(0,n.useEffect)(()=>{l&&s-BigInt(l.initialStakeRound)>=2n&&C(s-BigInt(l.initialStakeRound)-1n)},[s,l]);var F=(0,g.p$)(null==l?void 0:l.address,l&&N?N+BigInt(l.initialStakeRound)-1n:0n,t),L=F.verifiedAddresses,H=F.isPending,T=F.error;console.log("verifiedAddresses",L);var J=(0,g.Zp)(null==l?void 0:l.address,l&&N?N+BigInt(l.initialStakeRound)-1n:0n,t),K=J.verificationInfos,O=J.isPending,V=J.error,q=(0,r._)((0,n.useState)([]),2),U=q[0],X=q[1];(0,n.useEffect)(()=>{L&&X(L)},[L]);var G=(0,E.b$)(),W=G.mintActionReward,Y=G.isWriting,Z=G.isConfirming,M=G.isConfirmed,Q=G.writeError,ee=function(){var e=(0,m._)(function(e){return(0,u.__generator)(this,function(s){switch(s.label){case 0:if(!(0,p.C)(j))return[2];if(!(o&&e.unminted>0&&l))return[3,2];return[4,W(null==l?void 0:l.address,N+BigInt(l.initialStakeRound)-1n,t)];case 1:s.sent(),s.label=2;case 2:return[2]}})});return function(s){return e.apply(this,arguments)}}();(0,n.useEffect)(()=>{M&&X(e=>e.map(e=>e.account===o?(0,I._)((0,k._)({},e),{minted:e.unminted,unminted:0n}):e))},[M,o]);var es=(0,c.g)().handleContractError;(0,n.useEffect)(()=>{T&&es(T,"dataViewer"),V&&es(V,"dataViewer"),Q&&es(Q,"mint")},[T,V,Q]),(0,n.useEffect)(()=>{U.length>0&&0===$.size&&D(new Set([[...U].sort((e,s)=>e.score>s.score?-1:+(e.score<s.score))[0].account]))},[U]);var et=[...U].sort((e,s)=>e.score>s.score?-1:+(e.score<s.score)),er=e=>{var s=new Set($);s.has(e)?s.delete(e):s.add(e),D(s)};return(0,a.jsxs)("div",{className:"relative px-4 py-4",children:[0n===N&&(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-500",children:"暂无验证结果"})}),(0,a.jsx)("div",{className:"flex items-center",children:N>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.A,{title:"验证结果"}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"行动轮第"}),(0,a.jsx)("span",{className:"text-sm text-secondary ml-1",children:N.toString()}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500 ml-1",children:"轮"}),(0,a.jsx)(z,{currentRound:l&&s?(0,y.LP)(s-2n,l):0n,handleChangedRound:e=>{C(BigInt(e))}})]})}),H||O?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)(x.A,{})}):0===U.length?N>0n&&(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有地址参与行动"}):(0,a.jsxs)("table",{className:"table w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,a.jsx)("th",{}),(0,a.jsx)("th",{children:"被抽中地址"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"获得验证票"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"可铸造激励"}),(0,a.jsx)("th",{className:"text-right"})]})}),(0,a.jsx)("tbody",{children:et.map(e=>{var s=null==K?void 0:K.find(s=>s.account===e.account),t=$.has(e.account);return(0,a.jsxs)(n.Fragment,{children:[(0,a.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===o?"text-secondary":""),children:[(0,a.jsx)("td",{className:"px-1 w-8",children:s&&(0,a.jsx)("button",{onClick:()=>er(e.account),className:"text-greyscale-400 hover:text-greyscale-600",children:t?(0,a.jsx)(R.A,{size:16}):(0,a.jsx)(S.A,{size:16})})}),(0,a.jsx)("td",{className:"px-1 ",children:(0,a.jsx)(B.A,{address:e.account,showCopyButton:!0,word:e.account===o?"(我)":""})}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,y.$w)(e.score)}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,y.$w)(e.minted||e.unminted||0n)}),(0,a.jsx)("td",{className:"px-1 text-right",children:e.account===o&&(e.unminted>0?(0,a.jsx)(v.$,{variant:"outline",size:"sm",className:"text-secondary border-secondary",onClick:()=>ee(e),disabled:Y||Z,children:"铸造"}):e.score>0?(0,a.jsx)("span",{className:"text-greyscale-500",children:"已铸造"}):null)})]}),s&&i&&t&&(0,a.jsxs)("tr",{className:"border-b border-gray-100 bg-gray-50",children:[(0,a.jsx)("td",{}),(0,a.jsx)("td",{colSpan:4,className:"px-1 py-3",children:(0,a.jsxs)("div",{className:"text-sm text-greyscale-600",children:[(0,a.jsx)("div",{className:"text-xs text-greyscale-400 mb-2",children:"验证信息:"}),i.body.verificationKeys.map((e,t)=>(0,a.jsxs)("div",{className:"mb-1",children:[(0,a.jsxs)("span",{className:"text-greyscale-500",children:[e,":"]})," ",(0,a.jsx)(A.H,{text:s.infos[t]})]},t))]})})]})]},e.account)})})]}),(0,a.jsx)(_.A,{isLoading:Y||Z,text:Y?"提交交易...":"确认交易..."})]})},D=()=>{var e=(0,i.useRouter)().query.id,s=(0,l.vC)(),t=s.currentRound,m=s.isPending,u=s.error,h=(0,r._)((0,n.useState)(void 0),2),j=h[0],v=h[1],f=(0,c.g)().handleContractError;return(0,n.useEffect)(()=>{u&&f(u,"join")},[u]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.A,{title:"行动激励"}),(0,a.jsx)("main",{className:"flex-grow",children:m?(0,a.jsx)(x.A,{}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C,{actionId:BigInt(e||0)}),(0,a.jsx)($,{currentJoinRound:t,actionId:BigInt(e||0),actionInfo:j}),(0,a.jsx)(d.A,{actionId:BigInt(e||0),round:t,showSubmitter:!1,showVerifyHistory:!1,onActionInfo:v})]})})]})}},92101:(e,s,t)=>{"use strict";t.d(s,{A:()=>j});var r=t(37876),a=t(14232),n=t(6960),i=t(48230),l=t.n(i),c=t(64115),d=t(20451),o=t(83416),x=t(20442),m=t(87577),u=t(12293),h=t(1709);let j=e=>{var s,t=e.actionId,i=e.round,j=e.showSubmitter,v=e.showVerifyHistory,f=e.onActionInfo,N=((0,a.useContext)(o.N)||{}).token,g=(0,c.Y4)(null==N?void 0:N.address,t),p=g.actionInfo,y=g.isPending,b=g.error;(0,a.useEffect)(()=>{f&&p&&f(p)},[p]);var w=(0,c.VD)(null==N?void 0:N.address,j?i:0n),_=w.actionSubmits,A=w.isPending,C=w.error,k=(null==_||null==(s=_.find(e=>e.actionId==Number(t)))?void 0:s.submitter)||"N/A",I=(0,d.g)().handleContractError;return((0,a.useEffect)(()=>{b&&I(b,"submit"),C&&I(C,"submit")},[b,C]),y)?(0,r.jsx)(u.A,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mx-auto p-4 pb-2 border-t border-greyscale-100",children:(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsx)(h.A,{title:"行动详情"}),(void 0===v||v)&&(0,r.jsx)(n.$,{variant:"link",className:"text-secondary border-secondary",asChild:!0,children:(0,r.jsx)(l(),{href:"/my/actrewards/?id=".concat(t,"&symbol=").concat(null==N?void 0:N.symbol),children:"查看历史验证结果 >>"})})]})}),(0,r.jsxs)("div",{className:"mx-auto p-4 pb-2 ",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("span",{className:"text-sm text-greyscale-500",children:["No.",null==p?void 0:p.head.id.toString()]}),(0,r.jsx)("span",{className:"text-xl font-bold text-black",children:null==p?void 0:p.body.action})]}),(0,r.jsx)("div",{className:"mt-1",children:(0,r.jsx)("span",{className:"text-greyscale-600",children:null==p?void 0:p.body.consensus})}),(0,r.jsxs)("div",{className:"mt-0 text-xs text-greyscale-500 flex justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:["创建人 ",(0,r.jsx)(m.A,{address:null==p?void 0:p.head.author})]}),j&&(0,r.jsxs)("div",{className:"flex items-center",children:["推举人"," ",A?(0,r.jsx)(u.A,{}):(0,r.jsx)(m.A,{address:k})]})]})]}),(0,r.jsx)("div",{className:"mx-auto p-4 pb-2",children:(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("h3",{className:"text-sm font-bold",children:"最小参与代币数"}),(0,r.jsx)("p",{className:"text-greyscale-500",children:(0,x.NJ)((null==p?void 0:p.body.minStake)||BigInt(0))})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("h3",{className:"text-sm font-bold",children:"最大抽取验证地址数"}),(0,r.jsx)("p",{className:"text-greyscale-500",children:(null==p?void 0:p.body.maxRandomAccounts.toString())||"-"})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("h3",{className:"text-sm font-bold",children:"验证规则"}),(0,r.jsx)("p",{className:"text-greyscale-500 whitespace-pre-wrap",children:null==p?void 0:p.body.verificationRule})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("h3",{className:"text-sm font-bold",children:"报名参加行动时，行动者要提供的信息"}),(null==p?void 0:p.body.verificationKeys)&&(null==p?void 0:p.body.verificationKeys.length)>0?(0,r.jsx)("ul",{className:"list-disc pl-5",children:p.body.verificationKeys.map((e,s)=>(0,r.jsxs)("li",{className:"text-greyscale-500",children:[e," : ",p.body.verificationInfoGuides[s]]},s))}):(0,r.jsx)("span",{className:"text-greyscale-500",children:"无"})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("h3",{className:"text-sm font-bold",children:"白名单"}),(0,r.jsx)("p",{className:"text-greyscale-500 flex flex-wrap items-center",children:(null==p?void 0:p.body.whiteList.length)?p.body.whiteList.map((e,s)=>(0,r.jsx)("span",{className:"flex items-center mr-2",children:(0,r.jsx)(m.A,{address:e})},s)):"无限制"})]})]})})]})}},96108:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});var r=(0,t(11713).A)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},99574:(e,s,t)=>{"use strict";t.d(s,{A:()=>n});var r=t(37876);t(14232);var a=t(7446);let n=e=>{var s=e.isLoading,t=e.text;return s?(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(a.A,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,r.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:void 0===t?"Loading":t})]})}):null}}},e=>{var s=s=>e(e.s=s);e.O(0,[4112,2569,4115,7432,5389,636,6593,8792],()=>s(11704)),_N_E=e.O()}]);