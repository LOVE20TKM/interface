(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9178],{94515:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/actrewards",function(){return t(59083)}])},26986:function(e,s,t){"use strict";t.d(s,{OX:function(){return m},Qz:function(){return c},dy:function(){return l},iI:function(){return j},sc:function(){return u},u6:function(){return f},uh:function(){return o},ze:function(){return h}});var n=t(85893),r=t(67294),a=t(53798),i=t(40108);let l=e=>{let{shouldScaleBackground:s=!0,...t}=e;return(0,n.jsx)(a.dy.Root,{shouldScaleBackground:s,...t})};l.displayName="Drawer";let c=a.dy.Trigger,d=a.dy.Portal,o=a.dy.Close,x=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,n.jsx)(a.dy.Overlay,{ref:s,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80",t),...r})});x.displayName=a.dy.Overlay.displayName;let u=r.forwardRef((e,s)=>{let{className:t,children:r,...l}=e;return(0,n.jsxs)(d,{children:[(0,n.jsx)(x,{}),(0,n.jsxs)(a.dy.Content,{ref:s,className:(0,i.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t),...l,children:[(0,n.jsx)("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),r]})]})});u.displayName="DrawerContent";let m=e=>{let{className:s,...t}=e;return(0,n.jsx)("div",{className:(0,i.cn)("grid gap-1.5 p-4 text-center sm:text-left",s),...t})};m.displayName="DrawerHeader";let h=e=>{let{className:s,...t}=e;return(0,n.jsx)("div",{className:(0,i.cn)("mt-auto flex flex-col gap-2 p-4",s),...t})};h.displayName="DrawerFooter";let j=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,n.jsx)(a.dy.Title,{ref:s,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",t),...r})});j.displayName=a.dy.Title.displayName;let f=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,n.jsx)(a.dy.Description,{ref:s,className:(0,i.cn)("text-sm text-muted-foreground",t),...r})});f.displayName=a.dy.Description.displayName},42171:function(e,s,t){"use strict";t.d(s,{Z:function(){return n}});let n=(0,t(31134).Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},4307:function(e,s,t){"use strict";t.d(s,{Z:function(){return n}});let n=(0,t(31134).Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},20725:function(e,s,t){"use strict";var n=t(85893),r=t(67294),a=t(27245),i=t(41664),l=t.n(i),c=t(94782),d=t(67068),o=t(93778),x=t(91529),u=t(27460),m=t(42083),h=t(64777);s.Z=e=>{var s;let{actionId:t,round:i,showSubmitter:j,showVerifyHistory:f=!0,onActionInfo:N}=e,{token:y}=(0,r.useContext)(o.M)||{},{actionInfo:v,isPending:p,error:g}=(0,c.dI)(null==y?void 0:y.address,t);(0,r.useEffect)(()=>{N&&v&&N(v)},[v]);let{actionSubmits:b,isPending:w,error:Z}=(0,c.WZ)(null==y?void 0:y.address,j?i:0n),S=(null==b?void 0:null===(s=b.find(e=>e.actionId==Number(t)))||void 0===s?void 0:s.submitter)||"N/A",{handleContractError:k}=(0,d.S)();return((0,r.useEffect)(()=>{g&&k(g,"submit"),Z&&k(Z,"submit")},[g,Z]),p)?(0,n.jsx)(m.Z,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mx-auto p-4 pb-2 border-t border-greyscale-100",children:(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsx)(h.Z,{title:"行动详情"}),f&&(0,n.jsx)(a.z,{variant:"link",className:"text-secondary border-secondary",asChild:!0,children:(0,n.jsx)(l(),{href:"/my/actrewards/?id=".concat(t,"&symbol=").concat(null==y?void 0:y.symbol),children:"查看历史验证结果 >>"})})]})}),(0,n.jsxs)("div",{className:"mx-auto p-4 pb-2 ",children:[(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsxs)("span",{className:"text-sm text-greyscale-500",children:["No.",null==v?void 0:v.head.id.toString()]}),(0,n.jsx)("span",{className:"text-xl font-bold text-black",children:null==v?void 0:v.body.action})]}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("span",{className:"text-greyscale-600",children:null==v?void 0:v.body.consensus})}),(0,n.jsxs)("div",{className:"mt-0 text-xs text-greyscale-500 flex justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center",children:["创建人 ",(0,n.jsx)(u.Z,{address:null==v?void 0:v.head.author})]}),j&&(0,n.jsxs)("div",{className:"flex items-center",children:["推举人"," ",w?(0,n.jsx)(m.Z,{}):(0,n.jsx)(u.Z,{address:S})]})]})]}),(0,n.jsx)("div",{className:"mx-auto p-4 pb-2",children:(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"最小参与代币数"}),(0,n.jsx)("p",{className:"text-greyscale-500",children:(0,x.LH)((null==v?void 0:v.body.minStake)||BigInt(0))})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"随机奖励地址数"}),(0,n.jsx)("p",{className:"text-greyscale-500",children:(null==v?void 0:v.body.maxRandomAccounts.toString())||"-"})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"验证规则"}),(0,n.jsx)("p",{className:"text-greyscale-500 whitespace-pre-wrap",children:null==v?void 0:v.body.verificationRule})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"验证信息"}),(null==v?void 0:v.body.verificationKeys)&&(null==v?void 0:v.body.verificationKeys.length)>0?(0,n.jsx)("ul",{className:"list-disc pl-5",children:v.body.verificationKeys.map((e,s)=>(0,n.jsxs)("li",{className:"text-greyscale-500",children:[e," : ",v.body.verificationInfoGuides[s]]},s))}):(0,n.jsx)("span",{className:"text-greyscale-500",children:"无"})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"白名单"}),(0,n.jsx)("p",{className:"text-greyscale-500 flex flex-wrap items-center",children:(null==v?void 0:v.body.whiteList.length)?v.body.whiteList.map((e,s)=>(0,n.jsx)("span",{className:"flex items-center mr-2",children:(0,n.jsx)(u.Z,{address:e})},s)):"无限制"})]})]})})]})}},64777:function(e,s,t){"use strict";var n=t(85893);s.Z=e=>{let{title:s}=e;return(0,n.jsx)("div",{className:"flex justify-between items-center",children:(0,n.jsx)("h1",{className:"text-lg font-bold",children:s})})}},44576:function(e,s,t){"use strict";var n=t(85893);t(67294);var r=t(23432);s.Z=e=>{let{isLoading:s,text:t="Loading"}=e;return s?(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(r.Z,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,n.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:t})]})}):null}},72107:function(e,s,t){"use strict";t.d(s,{L:function(){return a}});var n=t(85893);t(67294);let r=e=>{if(!e)return e;let s=/(https?:\/\/[^\s]+)/g;if(!s.test(e))return e;let t=e.split(s),r=e.match(s)||[];return(0,n.jsx)(n.Fragment,{children:t.map((e,s)=>{if(s%2==0)return e;let t=r[(s-1)/2];return(0,n.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline hover:text-blue-700",children:t},s)})})},a=e=>{let{text:s}=e;return(0,n.jsx)(n.Fragment,{children:r(s)})}},48105:function(e,s,t){"use strict";t.d(s,{S:function(){return r}});var n=t(86501);let r=e=>!!e||(n.Am.error("请先将钱包链接 ".concat("thinkium801")),!1)},59083:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return E}});var n=t(85893),r=t(67294),a=t(11163),i=t(5028),l=t(67068),c=t(20725),d=t(37436),o=t(42083),x=t(92321),u=t(86501),m=t(27245),h=t(41664),j=t.n(h),f=t(45551),N=t(48105),y=t(91529),v=t(93778),p=t(64777),g=t(44576),b=t(72107),w=e=>{let{actionId:s}=e,{address:t,chain:a}=(0,x.m)(),{token:c}=(0,r.useContext)(v.M)||{},{verificationKeys:d,verificationInfos:h,isPending:w,error:Z}=(0,f.Cv)((null==c?void 0:c.address)||"",s,t||""),{joinedAmountByActionIdByAccount:S,isPending:k,error:C}=(0,i.X9)((null==c?void 0:c.address)||"",s,t||""),{withdraw:I,isPending:z,isConfirming:R,isConfirmed:E,error:B}=(0,i.Qc)(),L=async()=>{if((0,N.S)(a)){if(void 0!=S&&S<=2n){u.Am.error("你还没有参与，无需取回");return}await I((null==c?void 0:c.address)||"",s)}};(0,r.useEffect)(()=>{E&&u.Am.success("取回成功")},[E]);let{handleContractError:P}=(0,l.S)();return((0,r.useEffect)(()=>{C&&P(C,"join"),B&&P(B,"join"),Z&&P(Z,"join")},[C,B,Z]),k||w)?(0,n.jsxs)("div",{className:"px-4 pt-4 pb-2",children:[(0,n.jsx)(p.Z,{title:"我的参与"}),(0,n.jsx)(o.Z,{})]}):(0,n.jsxs)("div",{className:"px-4 pt-4 pb-2",children:[(0,n.jsx)(p.Z,{title:"我的参与"}),(0,n.jsx)("div",{className:"stats mt-2 w-full flex justify-center",children:(0,n.jsxs)("div",{className:"stat place-items-center",children:[(0,n.jsx)("div",{className:"stat-title",children:"我参与的代币数"}),(0,n.jsx)("div",{className:"stat-value text-2xl text-secondary",children:(0,y.LH)(S||BigInt(0),0)})]})}),(0,n.jsxs)("div",{className:"flex justify-center space-x-4 mt-2",children:[void 0!=S&&S<=2n?(0,n.jsx)(m.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",disabled:!0,children:"取回"}):(0,n.jsx)(m.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",onClick:L,disabled:z||R||E,children:z?"提交中":R?"确认中":E?"已取回":"取回代币"}),(0,n.jsx)(m.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",asChild:!0,children:(0,n.jsx)(j(),{href:"/acting/join?id=".concat(s,"&symbol=").concat(null==c?void 0:c.symbol),children:"增加参与代币"})})]}),(0,n.jsx)("div",{className:"flex flex-col items-center mt-2",children:(0,n.jsxs)("div",{className:"text-sm text-greyscale-600",children:[w&&"加载中...",void 0!=S&&S>2n&&d&&d.length>0&&(0,n.jsx)("div",{children:d.map((e,s)=>(0,n.jsxs)("div",{children:[e,": ",(0,n.jsx)(b.L,{text:h[s]})]},s))})]})}),(0,n.jsx)(g.Z,{isLoading:z||R,text:z?"提交交易...":"确认交易..."})]})},Z=t(42171),S=t(4307),k=t(7399),C=t(27460),I=t(26986),z=e=>{let{currentRound:s,handleChangedRound:t}=e,[a,i]=(0,r.useState)(!1),l=e=>{t(e),i(!1)};return"undefined"!=typeof document&&document.addEventListener("touchstart",function(){},{passive:!1}),(0,n.jsxs)(I.dy,{open:a,onOpenChange:i,children:[(0,n.jsx)(I.Qz,{asChild:!0,children:(0,n.jsx)(m.z,{variant:"link",className:"text-secondary no-underline",children:"切换轮次"})}),(0,n.jsxs)(I.sc,{className:"z-[9999] min-h-[25vh]",children:[(0,n.jsxs)(I.OX,{children:[(0,n.jsx)(I.iI,{}),(0,n.jsx)(I.u6,{})]}),(0,n.jsx)("div",{className:"px-4 flex-grow",children:(0,n.jsx)("div",{className:"max-h-64 overflow-y-auto",children:Array.from({length:Number(s)},(e,t)=>{let r=Number(s)-t;return(0,n.jsx)(m.z,{variant:"ghost",className:"w-full p-2 text-center rounded-none hover:bg-gray-100 touch-manipulation",onClick:e=>{e.preventDefault(),e.stopPropagation(),l(r)},onTouchEnd:e=>{e.preventDefault(),e.stopPropagation(),l(r)},style:{touchAction:"manipulation"},children:(0,n.jsxs)("span",{className:"text-lg",children:["第 ",r," 轮"]})},r)})})}),(0,n.jsx)(I.ze,{children:(0,n.jsx)(I.uh,{asChild:!0,children:(0,n.jsx)(m.z,{variant:"outline",children:"关闭"})})})]})]})},R=e=>{let{currentJoinRound:s,actionId:t,actionInfo:a}=e,{token:i}=(0,r.useContext)(v.M)||{},{address:c,chain:d}=(0,x.m)(),[u,h]=(0,r.useState)(0n),[j,w]=(0,r.useState)(new Set);(0,r.useEffect)(()=>{i&&s-BigInt(i.initialStakeRound)>=2n&&h(s-BigInt(i.initialStakeRound)-1n)},[s,i]);let{verifiedAddresses:I,isPending:R,error:E}=(0,f.pK)(null==i?void 0:i.address,i&&u?u+BigInt(i.initialStakeRound)-1n:0n,t),{verificationInfos:B,isPending:L,error:P}=(0,f.X5)(null==i?void 0:i.address,i&&u?u+BigInt(i.initialStakeRound)-1n:0n,t),[_,D]=(0,r.useState)([]);(0,r.useEffect)(()=>{I&&D(I)},[I]);let{mintActionReward:A,isWriting:F,isConfirming:O,isConfirmed:H,writeError:K}=(0,k.Rb)(),T=async e=>{(0,N.S)(d)&&c&&e.unminted>0&&i&&await A(null==i?void 0:i.address,u+BigInt(i.initialStakeRound)-1n,t)};(0,r.useEffect)(()=>{H&&D(e=>e.map(e=>e.account===c?{...e,minted:e.unminted,unminted:0n}:e))},[H,c]);let{handleContractError:X}=(0,l.S)();(0,r.useEffect)(()=>{E&&X(E,"dataViewer"),P&&X(P,"dataViewer"),K&&X(K,"mint")},[E,P,K]),(0,r.useEffect)(()=>{_.length>0&&0===j.size&&w(new Set([[..._].sort((e,s)=>e.score>s.score?-1:e.score<s.score?1:0)[0].account]))},[_]);let q=e=>{let s=new Set(j);s.has(e)?s.delete(e):s.add(e),w(s)};return(0,n.jsxs)("div",{className:"relative px-4 py-4",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(p.Z,{title:"验证结果"}),(0,n.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"行动轮第"}),(0,n.jsx)("span",{className:"text-sm text-secondary ml-1",children:u.toString()}),(0,n.jsx)("span",{className:"text-sm text-greyscale-500 ml-1",children:"轮"}),u>0&&(0,n.jsx)(z,{currentRound:i&&s?(0,y.cK)(s-2n,i):0n,handleChangedRound:e=>{h(BigInt(e))}})]}),R||L?(0,n.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,n.jsx)(o.Z,{})}):0===_.length?(0,n.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有地址参与行动"}):(0,n.jsxs)("table",{className:"table w-full",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,n.jsx)("th",{}),(0,n.jsx)("th",{children:"被抽中地址"}),(0,n.jsx)("th",{className:"px-1",children:"获得验证票"}),(0,n.jsx)("th",{className:"px-1",children:"可铸造激励"}),(0,n.jsx)("th",{className:"text-center"})]})}),(0,n.jsx)("tbody",{children:_.map(e=>{let s=null==B?void 0:B.find(s=>s.account===e.account),t=j.has(e.account);return(0,n.jsxs)(r.Fragment,{children:[(0,n.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===c?"text-secondary":""),children:[(0,n.jsx)("td",{className:"px-1 w-8",children:s&&(0,n.jsx)("button",{onClick:()=>q(e.account),className:"text-greyscale-400 hover:text-greyscale-600",children:t?(0,n.jsx)(Z.Z,{size:16}):(0,n.jsx)(S.Z,{size:16})})}),(0,n.jsx)("td",{className:"px-1",children:(0,n.jsx)(C.Z,{address:e.account,showCopyButton:!0,word:e.account===c?"(我)":""})}),(0,n.jsx)("td",{className:"px-1",children:(0,y.LH)(e.score,0)}),(0,n.jsx)("td",{className:"px-1",children:(0,y.LH)(e.minted||e.unminted||0n,0)}),(0,n.jsx)("td",{className:"px-1 text-center",children:e.account===c&&(e.unminted>0?(0,n.jsx)(m.z,{variant:"outline",size:"sm",className:"text-secondary border-secondary",onClick:()=>T(e),disabled:F||O,children:"铸造"}):e.score>0?(0,n.jsx)("span",{className:"text-greyscale-500",children:"已铸造"}):null)})]}),s&&a&&t&&(0,n.jsxs)("tr",{className:"border-b border-gray-100 bg-gray-50",children:[(0,n.jsx)("td",{}),(0,n.jsx)("td",{colSpan:4,className:"px-1 py-3",children:(0,n.jsxs)("div",{className:"text-sm text-greyscale-600",children:[(0,n.jsx)("div",{className:"text-xs text-greyscale-400 mb-2",children:"验证信息:"}),a.body.verificationKeys.map((e,t)=>(0,n.jsxs)("div",{className:"mb-1",children:[(0,n.jsxs)("span",{className:"text-greyscale-500",children:[e,":"]})," ",(0,n.jsx)(b.L,{text:s.infos[t]})]},t))]})})]})]},e.account)})})]}),(0,n.jsx)(g.Z,{isLoading:F||O,text:F?"提交交易...":"确认交易..."})]})},E=()=>{let{id:e}=(0,a.useRouter)().query,{currentRound:s,isPending:t,error:x}=(0,i.Bk)(),[u,m]=(0,r.useState)(void 0),{handleContractError:h}=(0,l.S)();return(0,r.useEffect)(()=>{x&&h(x,"join")},[x]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d.Z,{title:"行动激励"}),(0,n.jsx)("main",{className:"flex-grow",children:t?(0,n.jsx)(o.Z,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(w,{actionId:BigInt(e||0)}),(0,n.jsx)(R,{currentJoinRound:s,actionId:BigInt(e||0),actionInfo:u}),(0,n.jsx)(c.Z,{actionId:BigInt(e||0),round:s,showSubmitter:!1,showVerifyHistory:!1,onActionInfo:m})]})})]})}}},function(e){e.O(0,[1664,1335,7863,4782,6697,2042,2888,9774,179],function(){return e(e.s=94515)}),_N_E=e.O()}]);