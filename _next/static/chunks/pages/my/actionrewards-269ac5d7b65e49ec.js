try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="955fe83b-6bc8-49d8-8a02-35b2feb36544",e._sentryDebugIdIdentifier="sentry-dbid-955fe83b-6bc8-49d8-8a02-35b2feb36544")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[943],{51436:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/actionrewards",function(){return t(67711)}])},35810:function(e,n,t){"use strict";t.d(n,{$N:function(){return y},Be:function(){return b},Vq:function(){return u},cN:function(){return v},cZ:function(){return m},fK:function(){return x},hg:function(){return f}});var a=t(72253),r=t(14932),s=t(47702),o=t(85893),c=t(67294),i=t(12854),l=t(62190),d=t(40108),u=i.fC,f=i.xz,h=i.h_;i.x8;var g=c.forwardRef(function(e,n){var t=e.className,r=(0,s._)(e,["className"]);return(0,o.jsx)(i.aV,(0,a._)({ref:n,className:(0,d.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t)},r))});g.displayName=i.aV.displayName;var m=c.forwardRef(function(e,n){var t=e.className,c=e.children,u=(0,s._)(e,["className","children"]);return(0,o.jsxs)(h,{children:[(0,o.jsx)(g,{}),(0,o.jsxs)(i.VY,(0,r._)((0,a._)({ref:n,className:(0,d.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t)},u),{children:[c,(0,o.jsxs)(i.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,o.jsx)(l.Z,{className:"h-4 w-4"}),(0,o.jsx)("span",{className:"sr-only",children:"Close"})]})]}))]})});m.displayName=i.VY.displayName;var x=function(e){var n=e.className,t=(0,s._)(e,["className"]);return(0,o.jsx)("div",(0,a._)({className:(0,d.cn)("flex flex-col space-y-1.5 text-center sm:text-left",n)},t))};x.displayName="DialogHeader";var v=function(e){var n=e.className,t=(0,s._)(e,["className"]);return(0,o.jsx)("div",(0,a._)({className:(0,d.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",n)},t))};v.displayName="DialogFooter";var y=c.forwardRef(function(e,n){var t=e.className,r=(0,s._)(e,["className"]);return(0,o.jsx)(i.Dx,(0,a._)({ref:n,className:(0,d.cn)("text-lg font-semibold leading-none tracking-tight",t)},r))});y.displayName=i.Dx.displayName;var b=c.forwardRef(function(e,n){var t=e.className,r=(0,s._)(e,["className"]);return(0,o.jsx)(i.dk,(0,a._)({ref:n,className:(0,d.cn)("text-sm text-muted-foreground",t)},r))});b.displayName=i.dk.displayName},26986:function(e,n,t){"use strict";t.d(n,{OX:function(){return x},Qz:function(){return u},dy:function(){return d},iI:function(){return y},sc:function(){return m},u6:function(){return b},uh:function(){return h},ze:function(){return v}});var a=t(72253),r=t(14932),s=t(47702),o=t(85893),c=t(67294),i=t(53798),l=t(40108),d=function(e){var n=e.shouldScaleBackground,t=(0,s._)(e,["shouldScaleBackground"]);return(0,o.jsx)(i.dy.Root,(0,a._)({shouldScaleBackground:void 0===n||n},t))};d.displayName="Drawer";var u=i.dy.Trigger,f=i.dy.Portal,h=i.dy.Close,g=c.forwardRef(function(e,n){var t=e.className,r=(0,s._)(e,["className"]);return(0,o.jsx)(i.dy.Overlay,(0,a._)({ref:n,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80",t)},r))});g.displayName=i.dy.Overlay.displayName;var m=c.forwardRef(function(e,n){var t=e.className,c=e.children,d=(0,s._)(e,["className","children"]);return(0,o.jsxs)(f,{children:[(0,o.jsx)(g,{}),(0,o.jsxs)(i.dy.Content,(0,r._)((0,a._)({ref:n,className:(0,l.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t)},d),{children:[(0,o.jsx)("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),c]}))]})});m.displayName="DrawerContent";var x=function(e){var n=e.className,t=(0,s._)(e,["className"]);return(0,o.jsx)("div",(0,a._)({className:(0,l.cn)("grid gap-1.5 p-4 text-center sm:text-left",n)},t))};x.displayName="DrawerHeader";var v=function(e){var n=e.className,t=(0,s._)(e,["className"]);return(0,o.jsx)("div",(0,a._)({className:(0,l.cn)("mt-auto flex flex-col gap-2 p-4",n)},t))};v.displayName="DrawerFooter";var y=c.forwardRef(function(e,n){var t=e.className,r=(0,s._)(e,["className"]);return(0,o.jsx)(i.dy.Title,(0,a._)({ref:n,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",t)},r))});y.displayName=i.dy.Title.displayName;var b=c.forwardRef(function(e,n){var t=e.className,r=(0,s._)(e,["className"]);return(0,o.jsx)(i.dy.Description,(0,a._)({ref:n,className:(0,l.cn)("text-sm text-muted-foreground",t)},r))});b.displayName=i.dy.Description.displayName},44746:function(e,n,t){"use strict";t.d(n,{Z:function(){return f}});var a=t(72253),r=t(14932),s=t(91309),o=t(85893),c=t(67294),i=t(74598),l=t(35810),d=t(26986),u=t(79995);function f(e){var n=e.title,t=e.content,f=e.className,h=void 0===f?"":f,g=(0,s._)((0,c.useState)(!1),2),m=g[0],x=g[1],v=(0,u.Z)("(min-width: 768px)"),y=c.forwardRef(function(e,t){return(0,o.jsx)("button",(0,r._)((0,a._)({ref:t,type:"button",className:"inline-flex items-center p-1 rounded hover:bg-gray-100 transition-colors ".concat(h),"aria-label":"查看".concat(n)},e),{children:(0,o.jsx)(i.Z,{className:"h-4 w-4 text-gray-500 hover:text-gray-700"})}))});y.displayName="TriggerButton";var b=function(){return(0,o.jsx)("div",{className:"text-gray-700",children:"string"==typeof t?(0,o.jsx)("p",{className:"leading-relaxed text-sm",children:t}):t})};return(0,o.jsxs)(o.Fragment,{children:[v&&(0,o.jsxs)(l.Vq,{open:m,onOpenChange:x,children:[(0,o.jsx)(l.hg,{asChild:!0,children:(0,o.jsx)(y,{})}),(0,o.jsxs)(l.cZ,{className:"sm:max-w-[425px]",children:[(0,o.jsx)(l.$N,{className:"text-lg font-semibold",children:n}),(0,o.jsx)("div",{className:"pt-2 pb-4",children:(0,o.jsx)(b,{})})]})]}),!v&&(0,o.jsxs)(d.dy,{open:m,onOpenChange:x,children:[(0,o.jsx)(d.Qz,{asChild:!0,children:(0,o.jsx)(y,{})}),(0,o.jsxs)(d.sc,{className:"pb-safe",children:[(0,o.jsx)(d.OX,{children:(0,o.jsx)(d.iI,{className:"text-lg font-semibold",children:n})}),(0,o.jsx)("div",{className:"px-4 pb-8 mb-10",children:(0,o.jsx)(b,{})})]})]})]})}},64777:function(e,n,t){"use strict";var a=t(85893);n.Z=function(e){var n=e.title;return(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsx)("h1",{className:"text-lg font-bold",children:n})})}},42083:function(e,n,t){"use strict";var a=t(85893),r=t(23432);n.Z=function(){return(0,a.jsx)(r.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},67711:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return H}});var a=t(11010),r=t(72253),s=t(14932),o=t(91309),c=t(97582),i=t(85893),l=t(67294),d=t(86501),u=t(42130),f=t(11163),h=t(93778),g=t(7208),m=t(93950),x=t(7399),v=t(59271),y=t(75766),b=t(4586),N=t(67516),p=t(98482),j=t(43637),S=t(97995),_=t(45631),w="0xACea4f086BE05BeA47f3A56788FA3919C7f40799",I="0x547b4a36980Ec030fBfC0162eE4B4904d9Cc0Da9",B=function(e){if(0===e.length)return BigInt(0);if(e.length<20)return e.reduce(function(e,n){return n>e?n:e},BigInt(0));var n,t=(0,b._)(e).sort(function(e,n){return e>n?-1:e<n?1:0});n=e.length>=100?Math.max(1,Math.floor(.01*e.length)):1;var a=t.slice(n);return 0===a.length?t[0]:a.reduce(function(e,n){return n>e?n:e},BigInt(0))},M=function(e,n){return"love20_score_cache_".concat(e.toLowerCase(),"_").concat(n.toLowerCase())},L=function(e,n){try{var t=localStorage.getItem(M(e,n));return t?JSON.parse(t):{}}catch(e){return{}}},k=function(e,n,t){try{var a=L(e,n);Object.entries(t).forEach(function(e){var n=(0,o._)(e,2),t=n[0],r=n[1];Object.entries(r).forEach(function(e){var n=(0,o._)(e,2),r=n[0],s=n[1];a["".concat(t,"_").concat(r)]=s})}),localStorage.setItem(M(e,n),JSON.stringify(a))}catch(e){console.error("写入得分缓存失败:",e)}},E=function(e){var n=e.account,t=e.tokenAddress,s=e.actionRoundPairs,i=e.enabled,d=void 0===i||i,u=(0,l.useMemo)(function(){if(!d||0===s.length||!n||!t)return{validActionRoundPairs:[],actionRoundPairsKey:"",cachedScores:{},uncachedPairs:[]};var e=L(n,t),a={},r=[];s.forEach(function(n){var t=e["".concat(n.actionId.toString(),"_").concat(n.round.toString())];if(void 0!==t){var s=n.actionId.toString(),o=n.round.toString();a[s]||(a[s]={}),a[s][o]=t}else r.push(n)});var o=s.map(function(e){return"".concat(e.actionId.toString(),"_").concat(e.round.toString())}).join("|");return console.log("缓存命中: ".concat(Object.keys(e).length," 条, 需要请求: ").concat(r.length," 条")),{validActionRoundPairs:s,actionRoundPairsKey:o,cachedScores:a,uncachedPairs:r}},[s,d,n,t]),f=u.validActionRoundPairs,h=u.actionRoundPairsKey,g=u.cachedScores,m=u.uncachedPairs,x=(0,l.useMemo)(function(){return d&&0!==m.length&&t?m.map(function(e){var n=e.actionId,a=e.round;return{address:w,abi:p.S,functionName:"randomAccounts",args:[t,a,n]}}):[]},[t,m,d]),v=(0,N.N)({contracts:x,query:{enabled:d&&x.length>0}}),y=v.data,M=v.isLoading,E=v.error,C=v.isSuccess,R=(0,o._)((0,l.useState)({}),2),A=R[0],P=R[1],O=(0,o._)((0,l.useState)(!1),2),Z=O[0],D=O[1],z=(0,o._)((0,l.useState)(null),2),J=z[0],F=z[1],q=(0,o._)((0,l.useState)(!1),2),T=q[0],K=q[1];(0,l.useEffect)(function(){var e;d&&y&&C&&0!==m.length&&t&&n&&(e=(0,a._)(function(){var e,a,s,o,i;return(0,c.Jh)(this,function(l){switch(l.label){case 0:D(!0),F(null),P({}),e={},a={},l.label=1;case 1:l.trys.push([1,6,,7]),s=function(s){var o,i,l,d,u,f,h,g,x,v,N,p,w,M,L,k,E,C;return(0,c.Jh)(this,function(R){switch(R.label){case 0:if(i=(o=m[s]).actionId,l=o.round,(null==(d=y[s])?void 0:d.status)!=="success")return[3,5];u=function(e){var n,a,r,s;return(0,c.Jh)(this,function(o){switch(o.label){case 0:return a=(n=h.slice(e,e+100)).map(function(e){return{address:I,abi:j.w,functionName:"scoreByActionIdByAccount",args:[t,l,i,e]}}),r=e+1,s=Math.min(e+100,h.length),console.log("  批次 ".concat(Math.floor(e/100)+1,": 查询账户 ").concat(r,"-").concat(s,"/").concat(h.length,"...")),[4,(0,S.J)(_.v,{contracts:a})];case 1:return o.sent().forEach(function(e,t){if((null==e?void 0:e.status)==="success"){var a=n[t],r=e.result||BigInt(0);x[a]=r}else v=!0,console.warn("获取账户 ".concat(n[t]," 的得分失败:"),null==e?void 0:e.error)}),[2]}})},f=d.result,(h=(0,b._)(f)).includes(n)||h.push(n),g="".concat(i.toString(),"_").concat(l.toString()),x={},v=!1,console.log("正在加载 actionId=".concat(i,", round=").concat(l," 的分数数据，共 ").concat(h.length," 个账户...")),N=0,R.label=1;case 1:if(!(N<h.length))return[3,4];return[5,(0,c.XA)(u(N))];case 2:R.sent(),R.label=3;case 3:return N+=100,[3,1];case 4:p=void 0!==x[n],e[g]={actionId:i,round:l,accountScores:x},!v&&p?(w=B(Object.values(x)),M=x[n]||BigInt(0),L="0",w>BigInt(0)&&M>BigInt(0)&&(k=M*BigInt(100)/w,L=(M*BigInt(100)%w*BigInt(2)>=w?Number(k)+1:Number(k)).toString()),E=i.toString(),C=l.toString(),a[E]||(a[E]={}),a[E][C]=L,console.log("完成加载 actionId=".concat(i,", round=").concat(l,"，进度: ").concat(s+1,"/").concat(m.length))):console.warn("跳过缓存 actionId=".concat(i,", round=").concat(l,": ")+"hasFailedRequest=".concat(v,", hasTargetAccountScore=").concat(p)),P((0,r._)({},e)),R.label=5;case 5:return[2]}})},o=0,l.label=2;case 2:if(!(o<m.length))return[3,5];return[5,(0,c.XA)(s(o))];case 3:l.sent(),l.label=4;case 4:return o++,[3,2];case 5:return Object.keys(a).length>0&&(k(n,t,a),console.log("得分数据已写入缓存")),K(!0),D(!1),[3,7];case 6:return console.error("分批加载分数时出错:",i=l.sent()),F(i),D(!1),K(!1),[3,7];case 7:return[2]}})}),function(){return e.apply(this,arguments)})()},[d,t,n,h,C]);var V=(0,l.useMemo)(function(){if(!d||0===f.length)return{scores:{},isLoading:!1,hasError:!1,allLoaded:!0};if(E||J)return{scores:{},isLoading:!1,hasError:!0,allLoaded:!1};if(M)return{scores:g,isLoading:m.length>0,hasError:!1,allLoaded:!1};var e={};Object.values(A).forEach(function(t){var a=t.actionId,r=t.round,s=t.accountScores,o=B(Object.values(s)),c=s[n]||BigInt(0),i="0";if(o>BigInt(0)&&c>BigInt(0)){var l=c*BigInt(100)/o;i=(c*BigInt(100)%o*BigInt(2)>=o?Number(l)+1:Number(l)).toString()}var d=a.toString(),u=r.toString();e[d]||(e[d]={}),e[d][u]=i});var t=(0,r._)({},g);Object.entries(e).forEach(function(e){var n=(0,o._)(e,2),a=n[0],r=n[1];t[a]||(t[a]={}),Object.entries(r).forEach(function(e){var n=(0,o._)(e,2),r=n[0],s=n[1];t[a][r]=s})});var a=0===m.length||T&&!Z;return{scores:t,isLoading:Z,hasError:!1,allLoaded:a}},[d,f,n,M,Z,E,J,T,y,C,A,g,m]);return{scores:V.scores,isLoading:V.isLoading,hasError:V.hasError,allLoaded:V.allLoaded}},C=function(e){var n=e.account,t=e.tokenAddress,r=e.actionId,s=e.round,i=e.enabled,d=void 0===i||i,u=(0,o._)((0,l.useState)(null),2),f=u[0],h=u[1],g=(0,o._)((0,l.useState)(!1),2),m=g[0],x=g[1],v=(0,o._)((0,l.useState)(!1),2),M=v[0],E=v[1],C=(0,l.useMemo)(function(){var e;return d&&n&&t&&null!==(e=L(n,t)["".concat(r.toString(),"_").concat(s.toString())])&&void 0!==e?e:null},[d,n,t,r,s]),R=(0,N.N)({contracts:[{address:w,abi:p.S,functionName:"randomAccounts",args:[t,s,r]}],query:{enabled:d&&null===C&&!!n&&!!t}}),A=R.data,P=R.isSuccess;return(0,l.useEffect)(function(){var e,o;d&&null===C&&P&&(null==A?void 0:null===(o=A[0])||void 0===o?void 0:o.result)&&(e=(0,a._)(function(){var e,a,o,i,l,d,u,f,g,m,v,N;return(0,c.Jh)(this,function(p){switch(p.label){case 0:x(!0),E(!1),p.label=1;case 1:p.trys.push([1,6,,7]),e=function(e){var n,a,d,u;return(0,c.Jh)(this,function(c){switch(c.label){case 0:return a=(n=o.slice(e,e+100)).map(function(e){return{address:I,abi:j.w,functionName:"scoreByActionIdByAccount",args:[t,s,r,e]}}),d=e+1,u=Math.min(e+100,o.length),console.log("  批次 ".concat(Math.floor(e/100)+1,": 查询账户 ").concat(d,"-").concat(u,"/").concat(o.length,"...")),[4,(0,S.J)(_.v,{contracts:a})];case 1:return c.sent().forEach(function(e,t){(null==e?void 0:e.status)==="success"?i[n[t]]=e.result||BigInt(0):l=!0}),[2]}})},a=A[0].result,(o=(0,b._)(a)).includes(n)||o.push(n),i={},l=!1,console.log("正在加载单个得分 actionId=".concat(r,", round=").concat(s,"，共 ").concat(o.length," 个账户...")),d=0,p.label=2;case 2:if(!(d<o.length))return[3,5];return[5,(0,c.XA)(e(d))];case 3:p.sent(),p.label=4;case 4:return d+=100,[3,2];case 5:if(void 0===(u=i[n]))return E(!0),x(!1),[2];return f=B(Object.values(i)),g="0",f>BigInt(0)&&u>BigInt(0)&&(m=u*BigInt(100)/f,g=(u*BigInt(100)%f*BigInt(2)>=f?Number(m)+1:Number(m)).toString()),h(g),l||(v=r.toString(),N=s.toString(),k(n,t,(0,y._)({},v,(0,y._)({},N,g)))),x(!1),[3,7];case 6:return console.error("加载单个得分失败:",p.sent()),E(!0),x(!1),[3,7];case 7:return[2]}})}),function(){return e.apply(this,arguments)})()},[d,C,P,A,n,t,r,s]),{score:null!==C?C:f,isLoading:m||d&&null===C&&!P,hasError:M,isCached:null!==C}},R=t(73591),A=t(83494),P=t(64777),O=t(42083),Z=t(44576),D=t(44746),z=t(41664),J=t.n(z),F=function(e){var n=e.account,t=e.tokenAddress,a=e.actionId,r=e.round,s=e.symbol,o=e.score,c=e.isScoreLoading,l=e.needManualLoad,d=e.isManualLoading,u=e.notSelected,f=e.onManualLoad,h=C({account:n,tokenAddress:t,actionId:a,round:r,enabled:d}),g=h.score,m=h.isLoading,x=null!=o?o:g,v=c||d&&m;return u?(0,i.jsx)("span",{className:"text-greyscale-500",children:"-"}):v?(0,i.jsx)("div",{className:"flex justify-center items-center",children:(0,i.jsx)(O.Z,{})}):null!==x&&parseFloat(x)>=0?(0,i.jsx)(J(),{href:"/verify/detail?symbol=".concat(s,"&id=").concat(a.toString(),"&round=").concat(r.toString()),rel:"noopener noreferrer",className:"text-secondary hover:text-secondary/80 underline text-sm",children:x}):l&&!d?(0,i.jsx)("button",{onClick:f,className:"text-secondary hover:text-secondary/80 text-sm bg-transparent px-2 py-0.5 cursor-pointer underline",children:"估算"}):(0,i.jsx)("span",{className:"text-greyscale-500",children:"-"})},q=t(27245),T=t(74598),K=t(26858),V=t(6743),X=BigInt(6),H=function(){var e,n=(0,f.useRouter)(),t=((0,l.useContext)(h.M)||{}).token,y=(0,u.m)().address,b=(0,v.Bk)(),N=b.currentRound,p=b.isPending,j=(0,g.N6)(null==t?void 0:t.address,y,X),S=j.rewards,_=j.isPending,w=j.error,I=(0,m.dB)(null==t?void 0:t.address,y),B=I.joinedActions,M=I.isPending,k=I.error,C=(0,l.useMemo)(function(){if(!B||!S||void 0===N)return[];var e=N>X?N-X-BigInt(1):BigInt(0),n=N-BigInt(1),t=new Map,a=!0,r=!1,s=void 0;try{for(var o,c=S[Symbol.iterator]();!(a=(o=c.next()).done);a=!0){var i=o.value;if(!(i.reward<=BigInt(0))){var l=i.actionId.toString(),d=i.round.toString();t.has(l)||t.set(l,new Map),t.get(l).set(d,i)}}}catch(e){r=!0,s=e}finally{try{a||null==c.return||c.return()}finally{if(r)throw s}}var u=[],f=!0,h=!1,g=void 0;try{for(var m,x=B[Symbol.iterator]();!(f=(m=x.next()).done);f=!0){for(var v=m.value,y=v.action.head.id,b=y.toString(),p=t.get(b),j=[],_=n;_>=e;_--){var w=_.toString(),I=null==p?void 0:p.get(w);I?j.push(I):j.push({actionId:y,round:_,reward:BigInt(0),isMinted:!1,notSelected:!0})}u.push({action:v,rewards:j})}}catch(e){h=!0,g=e}finally{try{f||null==x.return||x.return()}finally{if(h)throw g}}return u.sort(function(e,n){return BigInt(e.action.action.head.id)>BigInt(n.action.action.head.id)?-1:1}),u},[B,S,N]),z=(0,l.useMemo)(function(){var e=new Map;if(!S)return e;var n=!0,t=!1,a=void 0;try{for(var r,s=S[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var o=r.value,c=o.actionId.toString(),i=e.get(c);(!i||o.round>i)&&e.set(c,o.round)}}catch(e){t=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(t)throw a}}return e},[S]),J=(0,l.useMemo)(function(){if(!S||0===S.length||0===z.size)return{actionRoundPairs:[],enabled:!1};var e=[];return z.forEach(function(n,t){e.push({actionId:BigInt(t),round:n})}),{actionRoundPairs:e,enabled:e.length>0}},[S,z]),H=E({account:y,tokenAddress:null==t?void 0:t.address,actionRoundPairs:J.actionRoundPairs,enabled:J.enabled}),Q=H.scores,Y=H.isLoading;H.hasError;var $=(0,o._)((0,l.useState)(new Set),2),G=$[0],U=$[1],W=(0,x.Rb)(),ee=W.mintActionReward,en=W.isPending,et=W.isConfirming,ea=W.isConfirmed,er=W.writeError,es=(0,o._)((0,l.useState)(null),2),eo=es[0],ec=es[1],ei=(0,o._)((0,l.useState)(new Set),2),el=ei[0],ed=ei[1];(0,l.useEffect)(function(){if(ea){if(d.ZP.success("铸造成功"),eo){var e="".concat(eo.actionId.toString(),"-").concat(eo.round.toString());ed(function(n){var t=new Set(n);return t.add(e),t})}(null==t?void 0:t.address)&&y&&(0,V.j)(y,t.address,!1)}},[ea,eo,null==t?void 0:t.address,y]),(0,l.useEffect)(function(){ed(new Set)},[null==t?void 0:t.address,y]),(0,l.useEffect)(function(){if((null==t?void 0:t.address)&&y&&!_&&S&&!S.some(function(e){return e.reward>BigInt(0)&&!e.isMinted})){var e=(0,V.FP)(y,t.address);if(null==e?void 0:e.needMinted){var n=(0,V.iO)(y,t.address);localStorage.removeItem(n),(0,V.j)(y,t.address,!1)}}},[null==t?void 0:t.address,y,_,S]);var eu=(e=(0,a._)(function(e,n){return(0,c.Jh)(this,function(a){switch(a.label){case 0:if(!((null==t?void 0:t.address)&&y))return[3,2];return ec({actionId:n,round:e}),[4,ee(t.address,e,n)];case 1:a.sent(),a.label=2;case 2:return[2]}})}),function(n,t){return e.apply(this,arguments)}),ef=(0,l.useMemo)(function(){return y&&(null==t?void 0:t.address)?L(y,t.address):{}},[y,null==t?void 0:t.address,Q]),eh=(0,l.useMemo)(function(){return C?C.map(function(e){var n=e.action.action.head.id.toString(),t=z.get(n);return(0,s._)((0,r._)({},e),{rewards:e.rewards.map(function(e){var a,o,c,i="".concat(n,"-").concat(e.round.toString()),l=e.round.toString(),d="".concat(n,"_").concat(l),u=void 0!==t&&e.round===t,f=null!==(c=null!==(o=null==Q?void 0:null===(a=Q[n])||void 0===a?void 0:a[l])&&void 0!==o?o:ef[d])&&void 0!==c?c:null,h=!!u&&Y,g=!u&&null===f&&!e.notSelected,m=G.has(d);return(0,s._)((0,r._)({},e),{isMinted:el.has(i)||e.isMinted,score:null!=f?f:null,isScoreLoading:h,isLastRound:u,needManualLoad:g,isManualLoading:m,notSelected:e.notSelected,cacheKey:d})})})}):[]},[C,el,Q,Y,z,ef,G]),eg=function(e,n){var t="".concat(e.toString(),"_").concat(n.toString());U(function(e){return new Set(e).add(t)})},em=(0,R.S)().handleContractError;return(0,l.useEffect)(function(){w&&em(w,"dataViewer"),k&&em(k,"dataViewer"),er&&em(er,"mint")},[w,k,er,em]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(A.Z,{title:"行动激励",showBackButton:!0}),(0,i.jsxs)("main",{className:"flex-grow",children:[t?(0,i.jsxs)("div",{className:"flex flex-col space-y-6 p-4",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)(P.Z,{title:"铸造行动激励"}),(0,i.jsx)("button",{onClick:function(){return n.push("/my/queryaction?symbol=".concat(null==t?void 0:t.symbol))},className:"text-secondary hover:text-secondary/80 text-sm bg-transparent border-none cursor-pointer",children:"查看已退出行动激励\xa0>>"})]}),(0,i.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-red-500 text-sm",children:(0,i.jsxs)("div",{className:"flex items-start gap-2",children:[(0,i.jsx)(T.Z,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:"小贴士："}),(0,i.jsx)("br",{}),"如果对激励打分有疑问，可以",(0,i.jsx)("br",{}),"1. 仔细阅读行动打分规则，检查是否按要求打卡；",(0,i.jsx)("br",{}),"2. 请教周围的治理者或志愿者；"]})]})}),_||M||p?(0,i.jsx)(O.Z,{}):eh.length>0?eh.map(function(e){return(0,i.jsxs)("div",{className:"border border-gray-100 rounded-lg p-4 shadow-sm",children:[(0,i.jsx)("div",{className:"flex items-center mb-3",children:(0,i.jsxs)("div",{className:"flex items-baseline  mr-2",children:[(0,i.jsx)("span",{className:"text-greyscale-500",children:"No."}),(0,i.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(e.action.action.head.id)}),(0,i.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(e.action.action.body.title)})]})}),e.rewards.length>0?(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("table",{className:"table w-full table-auto",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,i.jsx)("th",{className:"text-left px-0",children:"轮次"}),(0,i.jsx)("th",{className:"text-center",children:(0,i.jsxs)("div",{className:"flex items-center justify-center gap-1",children:["估算验证得分",(0,i.jsx)(D.Z,{title:"验证得分估算说明",content:"这是将你的验证得分标准化为0~100分的相对得分。算法：先过滤异常高分，以剩余最高分为100分基准，将你的得分按比例换算。"})]})}),(0,i.jsx)("th",{className:"text-center",children:"可铸造激励"}),(0,i.jsx)("th",{className:"text-center",children:"操作"})]})}),(0,i.jsx)("tbody",{children:e.rewards.map(function(n,a){return(0,i.jsxs)("tr",{className:a===e.rewards.length-1?"border-none":"border-b border-gray-100",children:[(0,i.jsx)("td",{className:"px-1",children:(0,K.cK)(n.round,t).toString()}),(0,i.jsx)("td",{className:"text-center px-1",children:(0,i.jsx)(F,{account:y,tokenAddress:null==t?void 0:t.address,actionId:BigInt(e.action.action.head.id),round:n.round,symbol:(null==t?void 0:t.symbol)||"",score:n.score,isScoreLoading:n.isScoreLoading,needManualLoad:n.needManualLoad,isManualLoading:n.isManualLoading,notSelected:n.notSelected||!1,onManualLoad:function(){return eg(BigInt(e.action.action.head.id),n.round)}})}),(0,i.jsx)("td",{className:"text-center px-1",children:n.notSelected?(0,i.jsx)("span",{className:"text-greyscale-500",children:"未抽中"}):(0,K.LH)(n.reward||BigInt(0))}),(0,i.jsx)("td",{className:"text-center px-1",children:n.notSelected?(0,i.jsx)("span",{className:"text-greyscale-500",children:"-"}):n.reward>BigInt(0)&&!n.isMinted?(0,i.jsx)(q.z,{variant:"outline",size:"sm",className:"text-secondary border-secondary",onClick:function(){return eu(n.round,BigInt(e.action.action.head.id))},disabled:en||et,children:"铸造"}):n.isMinted?(0,i.jsx)("span",{className:"text-greyscale-500",children:"已铸造"}):(0,i.jsx)("span",{className:"text-greyscale-500",children:"-"})})]},"".concat(e.action.action.head.id,"-").concat(n.round.toString()))})})]})}):(0,i.jsxs)("div",{className:"text-center text-greyscale-500 py-4",children:["该行动最近 ",X.toString()," 轮没有获得激励"]}),(0,i.jsx)("div",{className:"text-center",children:(0,i.jsx)("button",{onClick:function(){return n.push("/my/rewardsofaction?id=".concat(e.action.action.head.id))},className:"text-secondary hover:text-secondary/80 underline text-sm bg-transparent border-none cursor-pointer",children:"查看更多激励 >>"})})]},e.action.action.head.id)}):(0,i.jsx)("div",{className:"text-center text-greyscale-500 py-8",children:"没有参与任何行动"})]}):(0,i.jsx)(O.Z,{}),(0,i.jsx)(Z.Z,{isLoading:en||et,text:en?"提交交易...":"确认交易..."})]})]})}},67516:function(e,n,t){"use strict";t.d(n,{N:function(){return u}});var a=t(72253),r=t(14932),s=t(97995),o=t(36100),c=t(67294),i=t(95159),l=t(39360),d=t(78942);function u(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.contracts,u=void 0===t?[]:t,f=n.query,h=void 0===f?{}:f,g=(0,d.Z)(n),m=(0,l.x)({config:g}),x=function(e,n={}){return{async queryFn({queryKey:t}){let a=[],r=t[1].contracts.length;for(let e=0;e<r;e++){let r=t[1].contracts[e],s=(n.contracts?.[e]).abi;a.push({...r,abi:s})}let{scopeKey:o,...c}=t[1];return(0,s.J)(e,{...c,contracts:a})},queryKey:function(e={}){let n=[];for(let t of e.contracts??[]){let{abi:a,...r}=t;n.push({...r,chainId:r.chainId??e.chainId})}return["readContracts",(0,o.OP)({...e,contracts:n})]}(n)}}(g,(0,r._)((0,a._)({},n),{chainId:m})),v=(0,c.useMemo)(function(){var e,n=!1,t=!0,a=!1,r=void 0;try{for(var s,o=u[Symbol.iterator]();!(t=(s=o.next()).done);t=!0){var c=s.value,i=c.abi,l=c.address,d=c.functionName;if(!i||!l||!d){n=!1;break}n=!0}}catch(e){a=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(a)throw r}}return!!(n&&(null===(e=h.enabled)||void 0===e||e))},[u,h.enabled]);return(0,i.aM)((0,r._)((0,a._)({},x,h),{enabled:v,structuralSharing:null!==(e=h.structuralSharing)&&void 0!==e?e:o.if}))}}},function(e){e.O(0,[8501,4463,1390,3494,3591,3950,9271,7399,2888,9774,179],function(){return e(e.s=51436)}),_N_E=e.O()}]);