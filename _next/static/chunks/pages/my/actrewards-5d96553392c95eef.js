(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4249],{1709:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});var a=t(37876);let r=e=>{var s=e.title;return(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsx)("h1",{className:"text-lg font-bold",children:s})})}},11704:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/actrewards",function(){return t(79441)}])},19671:(e,s,t)=>{"use strict";t.d(s,{BE:()=>g,I6:()=>v,Uz:()=>x,_s:()=>o,cp:()=>m,gk:()=>N,tb:()=>f,zj:()=>j});var a=t(3576),r=t(62701),n=t(65699),c=t(37876),i=t(14232),l=t(28653),d=t(30684),o=e=>{var s=e.shouldScaleBackground,t=(0,n._)(e,["shouldScaleBackground"]);return(0,c.jsx)(l._s.Root,(0,a._)({shouldScaleBackground:void 0===s||s},t))};o.displayName="Drawer";var x=l._s.Trigger,u=l._s.Portal,m=l._s.Close,h=i.forwardRef((e,s)=>{var t=e.className,r=(0,n._)(e,["className"]);return(0,c.jsx)(l._s.Overlay,(0,a._)({ref:s,className:(0,d.cn)("fixed inset-0 z-50 bg-black/80",t)},r))});h.displayName=l._s.Overlay.displayName;var j=i.forwardRef((e,s)=>{var t=e.className,i=e.children,o=(0,n._)(e,["className","children"]);return(0,c.jsxs)(u,{children:[(0,c.jsx)(h,{}),(0,c.jsxs)(l._s.Content,(0,r._)((0,a._)({ref:s,className:(0,d.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t)},o),{children:[(0,c.jsx)("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),i]}))]})});j.displayName="DrawerContent";var g=e=>{var s=e.className,t=(0,n._)(e,["className"]);return(0,c.jsx)("div",(0,a._)({className:(0,d.cn)("grid gap-1.5 p-4 text-center sm:text-left",s)},t))};g.displayName="DrawerHeader";var f=e=>{var s=e.className,t=(0,n._)(e,["className"]);return(0,c.jsx)("div",(0,a._)({className:(0,d.cn)("mt-auto flex flex-col gap-2 p-4",s)},t))};f.displayName="DrawerFooter";var N=i.forwardRef((e,s)=>{var t=e.className,r=(0,n._)(e,["className"]);return(0,c.jsx)(l._s.Title,(0,a._)({ref:s,className:(0,d.cn)("text-lg font-semibold leading-none tracking-tight",t)},r))});N.displayName=l._s.Title.displayName;var v=i.forwardRef((e,s)=>{var t=e.className,r=(0,n._)(e,["className"]);return(0,c.jsx)(l._s.Description,(0,a._)({ref:s,className:(0,d.cn)("text-sm text-muted-foreground",t)},r))});v.displayName=l._s.Description.displayName},30822:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});var a=(0,t(11713).A)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},79441:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>z});var a=t(40854),r=t(37876),n=t(14232),c=t(89099),i=t(17660),l=t(20451),d=t(92101),o=t(66663),x=t(12293),u=t(16927),m=t(3576),h=t(62701),j=t(4902),g=t(8047),f=t(6960),N=t(30822),v=t(96108),p=t(62288),y=t(52372),_=t(83416),b=t(87577),w=t(19671);let k=e=>{var s=e.currentRound,t=e.handleChangedRound,c=(0,a._)((0,n.useState)(!1),2),i=c[0],l=c[1],d=e=>{t(e),l(!1)};return"undefined"!=typeof document&&document.addEventListener("touchstart",function(){},{passive:!1}),(0,r.jsxs)(w._s,{open:i,onOpenChange:l,children:[(0,r.jsx)(w.Uz,{asChild:!0,children:(0,r.jsx)(f.$,{variant:"link",className:"text-secondary no-underline pl-2 pr-1",children:"切换轮次"})}),(0,r.jsxs)(w.zj,{className:"z-[9999] min-h-[25vh]",children:[(0,r.jsxs)(w.BE,{children:[(0,r.jsx)(w.gk,{}),(0,r.jsx)(w.I6,{})]}),(0,r.jsx)("div",{className:"px-4 flex-grow",children:(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto",children:Array.from({length:Number(s)},(e,t)=>{var a=Number(s)-t;return(0,r.jsx)(f.$,{variant:"ghost",className:"w-full p-2 text-center rounded-none hover:bg-gray-100 touch-manipulation",onClick:e=>{e.preventDefault(),e.stopPropagation(),d(a)},onTouchEnd:e=>{e.preventDefault(),e.stopPropagation(),d(a)},style:{touchAction:"manipulation"},children:(0,r.jsxs)("span",{className:"text-lg",children:["第 ",a," 轮"]})},a)})})}),(0,r.jsx)(w.tb,{children:(0,r.jsx)(w.cp,{asChild:!0,children:(0,r.jsx)(f.$,{variant:"outline",children:"关闭"})})})]})]})};var C=t(1709),R=t(99574),A=t(42038),I=t(20442),S=t(43885);let E=e=>{var s=e.currentJoinRound,t=e.actionId,c=e.actionInfo,i=((0,n.useContext)(_.N)||{}).token,d=(0,g.F)(),o=d.address,w=d.chain,E=(0,a._)((0,n.useState)(0n),2),B=E[0],z=E[1],D=(0,a._)((0,n.useState)(new Set),2),P=D[0],$=D[1];(0,n.useEffect)(()=>{i&&s-BigInt(i.initialStakeRound)>=2n&&z(s-BigInt(i.initialStakeRound)-1n)},[s,i]);var F=(0,y.p$)(null==i?void 0:i.address,i&&B?B+BigInt(i.initialStakeRound)-1n:0n,t),T=F.verifiedAddresses,O=F.isPending,q=F.error,H=(0,y.Zp)(null==i?void 0:i.address,i&&B?B+BigInt(i.initialStakeRound)-1n:0n,t),L=H.verificationInfos,V=H.isPending,J=H.error,U=(0,a._)((0,n.useState)([]),2),X=U[0],K=U[1];(0,n.useEffect)(()=>{T&&K(T)},[T]);var W=(0,p.b$)(),Z=W.mintActionReward,G=W.isWriting,M=W.isConfirming,Q=W.isConfirmed,Y=W.writeError,ee=function(){var e=(0,u._)(function(e){return(0,j.__generator)(this,function(s){switch(s.label){case 0:if(!(0,A.C)(w))return[2];if(!(o&&e.unminted>0&&i))return[3,2];return[4,Z(null==i?void 0:i.address,B+BigInt(i.initialStakeRound)-1n,t)];case 1:s.sent(),s.label=2;case 2:return[2]}})});return function(s){return e.apply(this,arguments)}}();(0,n.useEffect)(()=>{Q&&K(e=>e.map(e=>e.account===o?(0,h._)((0,m._)({},e),{minted:e.unminted,unminted:0n}):e))},[Q,o]);var es=(0,l.g)().handleContractError;(0,n.useEffect)(()=>{q&&es(q,"dataViewer"),J&&es(J,"dataViewer"),Y&&es(Y,"mint")},[q,J,Y]),(0,n.useEffect)(()=>{X.length>0&&0===P.size&&$(new Set([[...X].sort((e,s)=>e.score>s.score?-1:+(e.score<s.score))[0].account]))},[X]);var et=[...X].sort((e,s)=>e.score>s.score?-1:+(e.score<s.score)),ea=e=>{var s=new Set(P);s.has(e)?s.delete(e):s.add(e),$(s)};return(0,r.jsxs)("div",{className:"relative px-4 py-4",children:[0n===B&&(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-center text-sm text-greyscale-500",children:"暂无验证结果"})}),(0,r.jsx)("div",{className:"flex items-center",children:B>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C.A,{title:"验证结果"}),(0,r.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"("}),(0,r.jsx)("span",{className:"text-sm text-greyscale-500",children:"行动轮第"}),(0,r.jsx)("span",{className:"text-sm text-secondary ml-1",children:B.toString()}),(0,r.jsx)("span",{className:"text-sm text-greyscale-500 ml-1",children:"轮"}),(0,r.jsx)(k,{currentRound:i&&s?(0,I.LP)(s-2n,i):0n,handleChangedRound:e=>{z(BigInt(e))}}),(0,r.jsx)("span",{className:"text-sm text-greyscale-500",children:")"})]})}),O||V?(0,r.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,r.jsx)(x.A,{})}):0===X.length?B>0n&&(0,r.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有地址参与行动"}):(0,r.jsxs)("table",{className:"table w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,r.jsx)("th",{}),(0,r.jsx)("th",{children:"被抽中地址"}),(0,r.jsx)("th",{className:"px-1 text-right",children:"获得验证票"}),(0,r.jsx)("th",{className:"px-1 text-right",children:"可铸造激励"}),(0,r.jsx)("th",{className:"text-right"})]})}),(0,r.jsx)("tbody",{children:et.map(e=>{var s=null==L?void 0:L.find(s=>s.account===e.account),t=P.has(e.account);return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===o?"text-secondary":""),children:[(0,r.jsx)("td",{className:"px-1 w-8",children:s&&(0,r.jsx)("button",{onClick:()=>ea(e.account),className:"text-greyscale-400 hover:text-greyscale-600",children:t?(0,r.jsx)(N.A,{size:16}):(0,r.jsx)(v.A,{size:16})})}),(0,r.jsx)("td",{className:"px-1 ",children:(0,r.jsx)(b.A,{address:e.account,showCopyButton:!0,word:e.account===o?"(我)":""})}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,I.$w)(e.score)}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,I.$w)(e.minted||e.unminted||0n)}),(0,r.jsx)("td",{className:"px-1 text-right",children:e.account===o&&(e.unminted>0?(0,r.jsx)(f.$,{variant:"outline",size:"sm",className:"text-secondary border-secondary",onClick:()=>ee(e),disabled:G||M,children:"铸造"}):e.score>0?(0,r.jsx)("span",{className:"text-greyscale-500",children:"已铸造"}):null)})]}),s&&c&&t&&(0,r.jsxs)("tr",{className:"border-b border-gray-100 bg-gray-50",children:[(0,r.jsx)("td",{}),(0,r.jsx)("td",{colSpan:4,className:"px-1 py-3",children:(0,r.jsxs)("div",{className:"text-sm text-greyscale-600",children:[(0,r.jsx)("div",{className:"text-xs text-greyscale-400 mb-2",children:"验证信息:"}),c.body.verificationKeys.map((e,t)=>(0,r.jsxs)("div",{className:"mb-1",children:[(0,r.jsxs)("span",{className:"text-greyscale-500",children:[e,":"]})," ",(0,r.jsx)(S.H,{text:s.infos[t]})]},t))]})})]})]},e.account)})})]}),(0,r.jsx)(R.A,{isLoading:G||M,text:G?"提交交易...":"确认交易..."})]})};var B=t(22605);let z=()=>{var e=(0,c.useRouter)().query.id,s=(0,i.vC)(),t=s.currentRound,u=s.isPending,m=s.error,h=(0,a._)((0,n.useState)(void 0),2),j=h[0],g=h[1],f=(0,l.g)().handleContractError;return(0,n.useEffect)(()=>{m&&f(m,"join")},[m]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.A,{title:"行动激励"}),(0,r.jsx)("main",{className:"flex-grow",children:u?(0,r.jsx)(x.A,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(B.A,{actionId:BigInt(e||0),onRoundChange:()=>{},actionInfo:j}),(0,r.jsx)(E,{currentJoinRound:t,actionId:BigInt(e||0),actionInfo:j}),(0,r.jsx)(d.A,{actionId:BigInt(e||0),round:t,showSubmitter:!1,showVerifyHistory:!1,onActionInfo:g})]})})]})}},96108:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});var a=(0,t(11713).A)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])}},e=>{var s=s=>e(e.s=s);e.O(0,[8230,4112,2569,2840,8656,2288,1217,636,6593,8792],()=>s(11704)),_N_E=e.O()}]);