try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="9425bbf6-d6c2-4d06-a846-c4888bb345cf",e._sentryDebugIdIdentifier="sentry-dbid-9425bbf6-d6c2-4d06-a846-c4888bb345cf")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[943],{51436:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/actionrewards",function(){return n(69534)}])},64777:function(e,t,n){"use strict";var r=n(85893);t.Z=function(e){var t=e.title;return(0,r.jsx)("div",{className:"flex justify-between items-center",children:(0,r.jsx)("h1",{className:"text-lg font-bold",children:t})})}},42083:function(e,t,n){"use strict";var r=n(85893),s=n(23432);t.Z=function(){return(0,r.jsx)(s.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},69534:function(e,t,n){"use strict";n.r(t);var r=n(11010),s=n(72253),a=n(14932),i=n(91309),c=n(97582),d=n(85893),o=n(67294),l=n(86501),u=n(42130),f=n(11163),h=n(93778),x=n(7208),m=n(93950),g=n(7399),b=n(73591),y=n(83494),v=n(64777),j=n(42083),w=n(44576),p=n(27245),N=n(21774),I=n(91529),_=n(6743),S=BigInt(30);t.default=function(){var e,t=(0,f.useRouter)(),n=((0,o.useContext)(h.M)||{}).token,B=(0,u.m)().address,E=(0,x.N6)(null==n?void 0:n.address,B,S),$=E.rewards,M=E.isPending,k=E.error,Z=(0,m.dB)(null==n?void 0:n.address,B),C=Z.joinedActions,P=Z.isPending,D=Z.error,T=(0,o.useMemo)(function(){if(!C||!$)return[];var e=new Map,t=!0,n=!1,r=void 0;try{for(var s,a=$[Symbol.iterator]();!(t=(s=a.next()).done);t=!0){var i=s.value;if(!(i.reward<=BigInt(0))){var c=i.actionId.toString();e.has(c)||e.set(c,[]),e.get(c).push(i)}}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}var d=[],o=!0,l=!1,u=void 0;try{for(var f,h=C[Symbol.iterator]();!(o=(f=h.next()).done);o=!0){var x=f.value,m=String(x.action.head.id),g=e.get(m)||[];g.length>0&&g.sort(function(e,t){return e.round>t.round?-1:1}),d.push({action:x,rewards:g})}}catch(e){l=!0,u=e}finally{try{o||null==h.return||h.return()}finally{if(l)throw u}}return d.sort(function(e,t){return BigInt(e.action.action.head.id)>BigInt(t.action.action.head.id)?-1:1}),d},[C,$]),z=(0,g.Rb)(),F=z.mintActionReward,O=z.isPending,R=z.isConfirming,A=z.isConfirmed,K=z.writeError,L=(0,i._)((0,o.useState)(null),2),V=L[0],X=L[1],H=(0,i._)((0,o.useState)(new Set),2),J=H[0],W=H[1],q=(0,i._)((0,o.useState)(""),2),G=q[0],Q=q[1];(0,o.useEffect)(function(){if(A){if(l.ZP.success("铸造成功"),V){var e="".concat(V.actionId.toString(),"-").concat(V.round.toString());W(function(t){var n=new Set(t);return n.add(e),n})}(null==n?void 0:n.address)&&B&&(0,_.j)(B,n.address,!1)}},[A,V,null==n?void 0:n.address,B]),(0,o.useEffect)(function(){W(new Set)},[null==n?void 0:n.address,B]),(0,o.useEffect)(function(){if((null==n?void 0:n.address)&&B&&!M&&$&&!$.some(function(e){return e.reward>BigInt(0)&&!e.isMinted})){var e=(0,_.FP)(B,n.address);if(null==e?void 0:e.needMinted){var t=(0,_.iO)(B,n.address);localStorage.removeItem(t),(0,_.j)(B,n.address,!1)}}},[null==n?void 0:n.address,B,M,$]);var U=(e=(0,r._)(function(e,t){return(0,c.Jh)(this,function(r){switch(r.label){case 0:if(!((null==n?void 0:n.address)&&B))return[3,2];return X({actionId:t,round:e}),[4,F(n.address,e,t)];case 1:r.sent(),r.label=2;case 2:return[2]}})}),function(t,n){return e.apply(this,arguments)}),Y=function(){if(!G.trim()){l.ZP.error("请输入行动ID");return}var e=G.trim();if(!/^\d+$/.test(e)){l.ZP.error("请输入有效的行动ID");return}t.push("/my/rewardsofaction?id=".concat(e))},ee=(0,o.useMemo)(function(){return T?T.map(function(e){return(0,a._)((0,s._)({},e),{rewards:e.rewards.map(function(t){var n="".concat(BigInt(e.action.action.head.id).toString(),"-").concat(t.round.toString());return J.has(n)||t.isMinted?(0,a._)((0,s._)({},t),{isMinted:!0}):t})})}):[]},[T,J]),et=(0,b.S)().handleContractError;return(0,o.useEffect)(function(){k&&et(k,"dataViewer"),D&&et(D,"dataViewer"),K&&et(K,"mint")},[k,D,K,et]),(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(y.Z,{title:"行动激励",showBackButton:!0}),(0,d.jsxs)("main",{className:"flex-grow",children:[n?(0,d.jsxs)("div",{className:"flex flex-col space-y-6 p-4",children:[(0,d.jsx)(v.Z,{title:"铸造行动激励"}),(0,d.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:(0,d.jsxs)("div",{className:"flex flex-col space-y-3",children:[(0,d.jsx)("label",{className:"text-sm font-medium text-greyscale-700",children:"查看某个行动的激励："}),(0,d.jsxs)("div",{className:"flex space-x-3",children:[(0,d.jsx)(N.I,{type:"text",placeholder:"请输入行动ID",value:G,onChange:function(e){return Q(e.target.value)},className:"flex-1",onKeyPress:function(e){"Enter"===e.key&&Y()}}),(0,d.jsx)(p.z,{onClick:Y,className:"text-white px-6",children:"确认"})]})]})}),M||P?(0,d.jsx)(j.Z,{}):ee.length>0?ee.map(function(e){return(0,d.jsxs)("div",{className:"border border-gray-100 rounded-lg p-4 shadow-sm",children:[(0,d.jsx)("div",{className:"flex items-center mb-3",children:(0,d.jsxs)("div",{className:"flex items-baseline  mr-2",children:[(0,d.jsx)("span",{className:"text-greyscale-500",children:"No."}),(0,d.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(e.action.action.head.id)}),(0,d.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(e.action.action.body.title)})]})}),e.rewards.length>0?(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)("table",{className:"table w-full table-auto",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,d.jsx)("th",{children:"轮次"}),(0,d.jsx)("th",{className:"text-center",children:"可铸造激励"}),(0,d.jsx)("th",{className:"text-center",children:"结果"})]})}),(0,d.jsx)("tbody",{children:e.rewards.map(function(t,r){return(0,d.jsxs)("tr",{className:r===e.rewards.length-1?"border-none":"border-b border-gray-100",children:[(0,d.jsx)("td",{children:(0,I.cK)(t.round,n).toString()}),(0,d.jsx)("td",{className:"text-center",children:(0,I.LH)(t.reward||BigInt(0))}),(0,d.jsx)("td",{className:"text-center",children:t.reward>BigInt(0)&&!t.isMinted?(0,d.jsx)(p.z,{variant:"outline",size:"sm",className:"text-secondary border-secondary",onClick:function(){return U(t.round,BigInt(e.action.action.head.id))},disabled:O||R,children:"铸造"}):t.isMinted?(0,d.jsx)("span",{className:"text-greyscale-500",children:"已铸造"}):(0,d.jsx)("span",{className:"text-greyscale-500",children:"-"})})]},"".concat(e.action.action.head.id,"-").concat(t.round.toString()))})})]})}):(0,d.jsxs)("div",{className:"text-center text-greyscale-500 py-4",children:["该行动最近 ",S.toString()," 轮没有获得激励"]}),(0,d.jsx)("div",{className:"text-center",children:(0,d.jsx)("button",{onClick:function(){return t.push("/my/rewardsofaction?id=".concat(e.action.action.head.id))},className:"text-secondary hover:text-secondary/80 underline text-sm bg-transparent border-none cursor-pointer",children:"查看更多激励 >>"})})]},e.action.action.head.id)}):(0,d.jsx)("div",{className:"text-center text-greyscale-500 py-8",children:"没有参与任何行动"})]}):(0,d.jsx)(j.Z,{}),(0,d.jsx)(w.Z,{isLoading:O||R,text:O?"提交交易...":"确认交易..."})]})]})}},21803:function(e,t,n){"use strict";function r(e,t){let[n,r="0"]=e.split("."),s=n.startsWith("-");if(s&&(n=n.slice(1)),r=r.replace(/(0+)$/,""),0===t)1===Math.round(Number(`.${r}`))&&(n=`${BigInt(n)+1n}`),r="";else if(r.length>t){let[e,s,a]=[r.slice(0,t-1),r.slice(t-1,t),r.slice(t)],i=Math.round(Number(`${s}.${a}`));(r=i>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${i}`).length>t&&(r=r.slice(1),n=`${BigInt(n)+1n}`),r=r.slice(0,t)}else r=r.padEnd(t,"0");return BigInt(`${s?"-":""}${n}${r}`)}n.d(t,{v:function(){return r}})}},function(e){e.O(0,[8239,367,3494,2252,3950,7399,2888,9774,179],function(){return e(e.s=51436)}),_N_E=e.O()}]);