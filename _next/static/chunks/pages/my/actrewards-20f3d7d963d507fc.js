(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4249],{1709:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});var r=t(37876);let a=e=>{var s=e.title;return(0,r.jsx)("div",{className:"flex justify-between items-center",children:(0,r.jsx)("h1",{className:"text-lg font-bold",children:s})})}},11704:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/actrewards",function(){return t(79441)}])},19671:(e,s,t)=>{"use strict";t.d(s,{BE:()=>f,I6:()=>N,Uz:()=>x,_s:()=>o,cp:()=>m,gk:()=>g,tb:()=>v,zj:()=>j});var r=t(3576),a=t(62701),n=t(65699),c=t(37876),l=t(14232),i=t(28653),d=t(30684),o=e=>{var s=e.shouldScaleBackground,t=(0,n._)(e,["shouldScaleBackground"]);return(0,c.jsx)(i._s.Root,(0,r._)({shouldScaleBackground:void 0===s||s},t))};o.displayName="Drawer";var x=i._s.Trigger,u=i._s.Portal,m=i._s.Close,h=l.forwardRef((e,s)=>{var t=e.className,a=(0,n._)(e,["className"]);return(0,c.jsx)(i._s.Overlay,(0,r._)({ref:s,className:(0,d.cn)("fixed inset-0 z-50 bg-black/80",t)},a))});h.displayName=i._s.Overlay.displayName;var j=l.forwardRef((e,s)=>{var t=e.className,l=e.children,o=(0,n._)(e,["className","children"]);return(0,c.jsxs)(u,{children:[(0,c.jsx)(h,{}),(0,c.jsxs)(i._s.Content,(0,a._)((0,r._)({ref:s,className:(0,d.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t)},o),{children:[(0,c.jsx)("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),l]}))]})});j.displayName="DrawerContent";var f=e=>{var s=e.className,t=(0,n._)(e,["className"]);return(0,c.jsx)("div",(0,r._)({className:(0,d.cn)("grid gap-1.5 p-4 text-center sm:text-left",s)},t))};f.displayName="DrawerHeader";var v=e=>{var s=e.className,t=(0,n._)(e,["className"]);return(0,c.jsx)("div",(0,r._)({className:(0,d.cn)("mt-auto flex flex-col gap-2 p-4",s)},t))};v.displayName="DrawerFooter";var g=l.forwardRef((e,s)=>{var t=e.className,a=(0,n._)(e,["className"]);return(0,c.jsx)(i._s.Title,(0,r._)({ref:s,className:(0,d.cn)("text-lg font-semibold leading-none tracking-tight",t)},a))});g.displayName=i._s.Title.displayName;var N=l.forwardRef((e,s)=>{var t=e.className,a=(0,n._)(e,["className"]);return(0,c.jsx)(i._s.Description,(0,r._)({ref:s,className:(0,d.cn)("text-sm text-muted-foreground",t)},a))});N.displayName=i._s.Description.displayName},42038:(e,s,t)=>{"use strict";t.d(s,{C:()=>a});var r=t(97685),a=e=>!!e||(r.oR.error("请先将钱包链接 ".concat("thinkium70001")),!1)},79441:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>B});var r=t(40854),a=t(37876),n=t(14232),c=t(89099),l=t(17660),i=t(20451),d=t(92101),o=t(60154),x=t(12293),u=t(16927),m=t(3576),h=t(62701),j=t(4902),f=t(8047),v=t(6960),g=t(30822),N=t(96108),p=t(62288),y=t(52372),w=t(83416),_=t(87577),b=t(19671);let C=e=>{var s=e.currentRound,t=e.handleChangedRound,c=(0,r._)((0,n.useState)(!1),2),l=c[0],i=c[1],d=e=>{t(e),i(!1)};return"undefined"!=typeof document&&document.addEventListener("touchstart",function(){},{passive:!1}),(0,a.jsxs)(b._s,{open:l,onOpenChange:i,children:[(0,a.jsx)(b.Uz,{asChild:!0,children:(0,a.jsx)(v.$,{variant:"link",className:"text-secondary no-underline pl-2 pr-1",children:"切换轮次"})}),(0,a.jsxs)(b.zj,{className:"z-[9999] min-h-[25vh]",children:[(0,a.jsxs)(b.BE,{children:[(0,a.jsx)(b.gk,{}),(0,a.jsx)(b.I6,{})]}),(0,a.jsx)("div",{className:"px-4 flex-grow",children:(0,a.jsx)("div",{className:"max-h-64 overflow-y-auto",children:Array.from({length:Number(s)},(e,t)=>{var r=Number(s)-t;return(0,a.jsx)(v.$,{variant:"ghost",className:"w-full p-2 text-center rounded-none hover:bg-gray-100 touch-manipulation",onClick:e=>{e.preventDefault(),e.stopPropagation(),d(r)},onTouchEnd:e=>{e.preventDefault(),e.stopPropagation(),d(r)},style:{touchAction:"manipulation"},children:(0,a.jsxs)("span",{className:"text-lg",children:["第 ",r," 轮"]})},r)})})}),(0,a.jsx)(b.tb,{children:(0,a.jsx)(b.cp,{asChild:!0,children:(0,a.jsx)(v.$,{variant:"outline",children:"关闭"})})})]})]})};var k=t(1709),A=t(99574),E=t(42038),R=t(20442),S=t(43885);let I=e=>{var s=e.currentJoinRound,t=e.actionId,c=e.actionInfo,l=((0,n.useContext)(w.N)||{}).token,d=(0,f.F)(),o=d.address,b=d.chain,I=(0,r._)((0,n.useState)(0n),2),z=I[0],B=I[1],D=(0,r._)((0,n.useState)(new Set),2),P=D[0],T=D[1];(0,n.useEffect)(()=>{l&&s-BigInt(l.initialStakeRound)>=2n&&B(s-1n)},[s,l]);var $=(0,y.p$)(null==l?void 0:l.address,l&&z?z:0n,t),F=$.verifiedAddresses,L=$.isPending,O=$.error,H=(0,y.Zp)(null==l?void 0:l.address,l&&z?z:0n,t),M=H.verificationInfos,V=H.isPending,J=H.error,U=(0,r._)((0,n.useState)([]),2),X=U[0],q=U[1];(0,n.useEffect)(()=>{F&&q(F)},[F]);var K=(0,p.b$)(),Y=K.mintActionReward,Z=K.isPending,G=K.isConfirming,Q=K.isConfirmed,W=K.writeError,ee=function(){var e=(0,u._)(function(e){return(0,j.YH)(this,function(s){switch(s.label){case 0:if(!(0,E.C)(b))return[2];if(!(o&&e.reward>0n&&!e.isMinted&&l))return[3,2];return[4,Y(null==l?void 0:l.address,z,t)];case 1:s.sent(),s.label=2;case 2:return[2]}})});return function(s){return e.apply(this,arguments)}}();(0,n.useEffect)(()=>{Q&&q(e=>e.map(e=>e.account===o?(0,h._)((0,m._)({},e),{isMinted:!0}):e))},[Q,o]);var es=(0,i.g)().handleContractError;(0,n.useEffect)(()=>{O&&es(O,"dataViewer"),J&&es(J,"dataViewer"),W&&es(W,"mint")},[O,J,W]),(0,n.useEffect)(()=>{X.length>0&&0===P.size&&T(new Set([[...X].sort((e,s)=>e.score>s.score?-1:+(e.score<s.score))[0].account]))},[X]);var et=[...X].sort((e,s)=>e.score>s.score?-1:+(e.score<s.score)),er=e=>{var s=new Set(P);s.has(e)?s.delete(e):s.add(e),T(s)};return(0,a.jsxs)("div",{className:"relative px-4 py-4",children:[0n===z&&(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-500",children:"暂无验证结果"})}),(0,a.jsx)("div",{className:"flex items-center",children:z>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.A,{title:"验证结果"}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"("}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500",children:"行动轮第"}),(0,a.jsx)("span",{className:"text-sm text-secondary ml-1",children:z.toString()}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500 ml-1",children:"轮"}),(0,a.jsx)(C,{currentRound:l&&s?(0,R.LP)(s-2n,l):0n,handleChangedRound:e=>{B(BigInt(e))}}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500",children:")"})]})}),L||V?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)(x.A,{})}):0===X.length?z>0n&&(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有可铸造激励的地址"}):(0,a.jsxs)("table",{className:"table w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,a.jsx)("th",{}),(0,a.jsx)("th",{children:"被抽中地址"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"获得验证票"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"可铸造激励"}),(0,a.jsx)("th",{className:"text-right"})]})}),(0,a.jsx)("tbody",{children:et.map(e=>{var s=null==M?void 0:M.find(s=>s.account===e.account),t=P.has(e.account);return(0,a.jsxs)(n.Fragment,{children:[(0,a.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===o?"text-secondary":""),children:[(0,a.jsx)("td",{className:"px-1 w-8",children:s&&(0,a.jsx)("button",{onClick:()=>er(e.account),className:"text-greyscale-400 hover:text-greyscale-600",children:t?(0,a.jsx)(g.A,{size:16}):(0,a.jsx)(N.A,{size:16})})}),(0,a.jsx)("td",{className:"px-1 ",children:(0,a.jsx)(_.A,{address:e.account,showCopyButton:!0,word:e.account===o?"(我)":""})}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,R.$w)(e.score)}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,R.$w)(e.reward||0n)}),(0,a.jsx)("td",{className:"px-1 text-right",children:e.account===o&&(e.reward>0n&&!e.isMinted?(0,a.jsx)(v.$,{variant:"outline",size:"sm",className:"text-secondary border-secondary",onClick:()=>ee(e),disabled:Z||G,children:"铸造"}):e.score>0?(0,a.jsx)("span",{className:"text-greyscale-500",children:"已铸造"}):null)})]}),s&&c&&t&&(0,a.jsxs)("tr",{className:"border-b border-gray-100 bg-gray-50",children:[(0,a.jsx)("td",{}),(0,a.jsx)("td",{colSpan:4,className:"px-1 py-3",children:(0,a.jsxs)("div",{className:"text-sm text-greyscale-600",children:[(0,a.jsx)("div",{className:"text-xs text-greyscale-400 mb-2",children:"验证信息:"}),c.body.verificationKeys.map((e,t)=>(0,a.jsxs)("div",{className:"mb-1",children:[(0,a.jsxs)("span",{className:"text-greyscale-500",children:[e,":"]})," ",(0,a.jsx)(S.H,{text:s.infos[t]})]},t))]})})]})]},e.account)})})]}),(0,a.jsx)(A.A,{isLoading:Z||G,text:Z?"提交交易...":"确认交易..."})]})};var z=t(22605);let B=()=>{var e=(0,c.useRouter)().query.id,s=(0,l.vC)(),t=s.currentRound,u=s.isPending,m=s.error,h=(0,r._)((0,n.useState)(void 0),2),j=h[0],f=h[1],v=(0,i.g)().handleContractError;return(0,n.useEffect)(()=>{m&&v(m,"join")},[m]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.A,{title:"行动激励"}),(0,a.jsx)("main",{className:"flex-grow",children:u?(0,a.jsx)(x.A,{}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(z.A,{actionId:BigInt(e||0),onRoundChange:()=>{},actionInfo:j}),(0,a.jsx)(I,{currentJoinRound:t,actionId:BigInt(e||0),actionInfo:j}),(0,a.jsx)(d.A,{actionId:BigInt(e||0),round:t,showSubmitter:!1,showVerifyHistory:!1,onActionInfo:f})]})})]})}},99574:(e,s,t)=>{"use strict";t.d(s,{A:()=>c});var r=t(37876),a=t(14232),n=t(7446);let c=e=>{var s=e.isLoading,t=e.text;return((0,a.useEffect)(()=>{if(s){var e=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}}},[s]),s)?(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50 touch-none overscroll-none",onTouchMove:e=>{e.preventDefault()},onTouchStart:e=>{e.preventDefault()},style:{touchAction:"none"},children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(n.A,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,r.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:void 0===t?"Loading":t})]})}):null}}},e=>{var s=s=>e(e.s=s);e.O(0,[3308,9374,8230,5701,154,3096,4115,2288,7432,1217,636,6593,8792],()=>s(11704)),_N_E=e.O()}]);