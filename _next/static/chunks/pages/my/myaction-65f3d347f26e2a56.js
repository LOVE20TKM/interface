try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="d9374c02-791e-4c77-9d22-b7ea46979219",e._sentryDebugIdIdentifier="sentry-dbid-d9374c02-791e-4c77-9d22-b7ea46979219")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1274],{84476:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/myaction",function(){return t(76364)}])},11418:function(e,n,t){"use strict";t.d(n,{Z:function(){return x}});var s=t(85893),i=t(67294),r=t(42130),a=t(11163),o=t(41664),d=t.n(o),c=t(93778),l=t(91529),u=t(27245);function m(e){var n=e.isJoined,t=e.actionId,r=(e.userJoinedAmount,e.isPending),a=((0,i.useContext)(c.M)||{}).token;if(!a)return null;var o="/acting/join?symbol=".concat(a.symbol,"&id=").concat(t),l="/my/myaction?symbol=".concat(a.symbol,"&id=").concat(t);return void 0!==r&&r?(0,s.jsx)("div",{className:"flex justify-center mb-6",children:(0,s.jsx)("div",{className:"loading loading-spinner loading-md"})}):(0,s.jsx)("div",{className:"mt-4 flex justify-center",children:n?(0,s.jsx)(d(),{className:"text-secondary hover:text-secondary/80 text-sm cursor-pointer",href:l,children:"我的参与 >>"}):(0,s.jsx)(u.z,{className:"w-1/2",asChild:!0,children:(0,s.jsx)(d(),{href:o,children:"加入行动 >>"})})})}function x(e){var n=e.actionInfo,t=e.participantCount,o=e.totalAmount,u=e.isJoined,x=e.userJoinedAmount,f=e.isPending,h=e.showActionButtons,v=void 0===h||h,y=e.linkToActionInfo,j=void 0!==y&&y,g=((0,i.useContext)(c.M)||{}).token,b=(0,r.m)().address,N=(0,a.useRouter)();if(!g)return(0,s.jsx)("div",{children:"Token信息加载中..."});var p=o?(0,l.LH)(o):"0";return(0,s.jsxs)("div",{className:"bg-gray-100 rounded-lg px-4 pt-2 pb-2 text-sm my-4 ".concat(j?"cursor-pointer hover:bg-gray-200 transition-colors":""),onClick:function(){j&&g&&N.push("/action/info?symbol=".concat(g.symbol,"&id=").concat(n.head.id))},children:[(0,s.jsx)("div",{className:"mb-2",children:(0,s.jsx)("h1",{className:"text-lg mb-1",children:(0,s.jsxs)("div",{className:"flex items-baseline",children:[(0,s.jsx)("span",{className:"text-gray-400 text-sm",children:"No."}),(0,s.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:n.head.id.toString()}),(0,s.jsx)("span",{className:"font-bold text-gray-800",children:n.body.title})]})})}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"text-gray-500 mr-2",children:"参与代币总数:"}),(0,s.jsxs)("span",{className:"font-mono text-secondary",children:[p," "]})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"text-gray-500 mr-2",children:"参与地址数:"}),(0,s.jsx)("span",{className:"font-mono text-secondary",children:(null==t?void 0:t.toString())||"0"})]})]}),v&&n&&b&&(0,s.jsx)(m,{isJoined:u,actionId:n.head.id,userJoinedAmount:x,isPending:f}),!v&&(0,s.jsx)("div",{className:"mt-4 flex justify-center",children:(0,s.jsx)(d(),{className:"text-secondary hover:text-secondary/80 text-sm cursor-pointer",href:"/action/info?symbol=".concat(null==g?void 0:g.symbol,"&id=").concat(n.head.id),children:"行动详情 >>"})})]})}},31729:function(e,n,t){"use strict";var s=t(11010),i=t(97582),r=t(85893),a=t(67294),o=t(42130),d=t(39360),c=t(86501),l=t(27245),u=t(41664),m=t.n(u),x=t(11163),f=t(20442),h=t(93950),v=t(93566),y=t(7080),j=t(73591),g=t(93778),b=t(91529),N=t(42083),p=t(44576),w=t(72107);n.Z=function(e){var n,t,u=e.actionId,A=e.actionInfo,I=e.onStakedAmountChange,C=e.showJoinButton,B=(0,o.m)().address;(0,d.x)();var k=((0,a.useContext)(g.M)||{}).token,_=(0,x.useRouter)(),P=(0,f.Bk)(),E=P.currentRound,J=P.error,Z=(0,v.$A)((null==k?void 0:k.address)||"",E,u),S=Z.isSubmitted,D=Z.error,F=Z.isPending,M=(0,y.Dn)((null==k?void 0:k.address)||"",E,u),R=M.isActionIdVoted,z=M.error,T=M.isPending,q=(0,f.X9)((null==k?void 0:k.address)||"",u,B||""),L=q.joinedAmountByActionIdByAccount,O=q.isPending,K=q.error,X=(0,f.PL)((null==k?void 0:k.address)||"",u),H=X.joinedAmountByActionId,Q=X.isPending,V=X.error,$=L&&L>0&&H&&H>0,G=$?Number(L)/Number(H)*100:0,U=(0,b.rl)(G),W=$?(0,b.rl)(Math.min(G*Number((null==A?void 0:null===(t=A.body)||void 0===t?void 0:t.maxRandomAccounts)||0),100)):"0%",Y=(0,h.Cv)((null==k?void 0:k.address)||"",u,B||""),ee=Y.verificationKeys,en=Y.verificationInfos,et=Y.isPending,es=Y.error,ei=(0,f.Qc)(),er=ei.withdraw,ea=ei.isPending,eo=ei.isConfirming,ed=ei.isConfirmed,ec=ei.writeError,el=(n=(0,s._)(function(){return(0,i.Jh)(this,function(e){switch(e.label){case 0:if(void 0!=L&&L<=BigInt(2))return c.Am.error("你还没有参与，无需取回"),[2];return[4,er((null==k?void 0:k.address)||"",u)];case 1:return e.sent(),[2]}})}),function(){return n.apply(this,arguments)});(0,a.useEffect)(function(){ed&&(c.Am.success("取回成功"),_.push("/my"))},[ed,_]),(0,a.useEffect)(function(){O||null==I||I(L||BigInt(0))},[L,O]);var eu=(0,j.S)().handleContractError;return((0,a.useEffect)(function(){K&&eu(K,"join"),V&&eu(V,"join"),es&&eu(es,"join"),J&&eu(J,"join"),ec&&eu(ec,"join"),D&&eu(D,"submit"),z&&eu(z,"vote")},[K,V,es,J,ec,D,z]),O||Q||F||T)?"":(0,r.jsxs)("div",{className:"flex flex-col items-center px-4 pt-1",children:[$&&(0,r.jsxs)("div",{className:"stats w-full grid grid-cols-1 sm:grid-cols-2 divide-x-0 gap-2 sm:gap-0",children:[(0,r.jsxs)("div",{className:"stat place-items-center min-h-[120px] flex flex-col justify-center",children:[(0,r.jsx)("div",{className:"stat-title",children:"我的参与"}),(0,r.jsx)("div",{className:"stat-value text-2xl text-secondary",children:O?(0,r.jsx)(N.Z,{}):(0,b.LH)(L||BigInt(0),0)}),(0,r.jsxs)("div",{className:"stat-desc text-sm mt-2 whitespace-normal break-words text-center",children:[null==k?void 0:k.symbol,"数量"]})]}),(0,r.jsxs)("div",{className:"stat place-items-center min-h-[120px] flex flex-col justify-center",children:[(0,r.jsx)("div",{className:"stat-title",children:"我的占比"}),(0,r.jsx)("div",{className:"stat-value text-2xl text-secondary",children:U}),(0,r.jsxs)("div",{className:"stat-desc text-sm mt-2 whitespace-normal break-words text-center",children:["被抽中验证概率 ",W]})]})]}),(void 0===C||C)&&(0,r.jsx)(r.Fragment,{children:$?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex justify-center space-x-2 mt-2 w-full",children:[void 0!=L&&L<=BigInt(2)?(0,r.jsx)(l.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",disabled:!0,children:"取回"}):(0,r.jsx)(l.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",onClick:el,disabled:ea||eo||ed,children:ea?"提交中":eo?"确认中":ed?"已取回":"取回代币"}),(0,r.jsx)(l.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",asChild:!0,children:(0,r.jsx)(m(),{href:"/my/rewardsofaction?id=".concat(u,"&symbol=").concat(null==k?void 0:k.symbol),children:"查看激励"})}),R?(0,r.jsx)(l.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",asChild:!0,children:(0,r.jsx)(m(),{href:"/acting/join?id=".concat(u,"&symbol=").concat(null==k?void 0:k.symbol),children:"增加参与代币"})}):(0,r.jsx)(l.z,{variant:"outline",className:"w-1/3",disabled:!0,children:"增加参与代币"})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-700 bg-gray-50 border border-gray-200 rounded px-2 py-3 mt-3 mb-3 w-full",children:[(0,r.jsx)("div",{className:"font-medium text-gray-600 mb-2",children:"\uD83D\uDCA1 小贴士："}),(0,r.jsx)("div",{className:"ml-4 text-gray-600",children:"当前验证的是上一轮的行动结果，所以取回代币，不会影响正在进行的验证，也不会影响上一轮行动的激励。"})]}),(0,r.jsx)("div",{className:"flex flex-col items-start my-4 w-full",children:(0,r.jsxs)("div",{className:"text-sm text-greyscale-600 w-full",children:[et&&"加载中...",void 0!=L&&L>BigInt(2)&&ee&&ee.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{className:"text-base font-medium text-gray-700 mb-3",children:"我提供的验证信息："}),(0,r.jsx)("div",{className:"w-full bg-gray-50 rounded-lg p-4 border border-gray-100",children:(0,r.jsx)("div",{className:"w-full text-left",children:ee.map(function(e,n){return(0,r.jsxs)("div",{className:"mb-2",children:[(0,r.jsx)("div",{className:"text-sm font-bold text-greyscale-600",children:e}),(0,r.jsx)("div",{className:"text-base",children:(0,r.jsx)(w.L,{text:en[n]})})]},n)})})})]})]})})]}):S&&(0,r.jsx)(l.z,{variant:"outline",className:"w-1/2 text-secondary border-secondary",asChild:!0,children:(0,r.jsx)(m(),{href:"/acting/join?id=".concat(u,"&symbol=").concat(null==k?void 0:k.symbol),children:"参与行动"})})}),(0,r.jsx)(p.Z,{isLoading:ea||eo,text:ea?"提交交易...":"确认交易..."})]})}},36893:function(e,n,t){"use strict";t.d(n,{r:function(){return l}});var s=t(91309),i=t(67294),r=t(67516),a=t(7724),o=t(98482),d=t(37742),c="0xACea4f086BE05BeA47f3A56788FA3919C7f40799",l=function(e){var n=e.tokenAddress,t=e.actionId,l=e.account,u=(0,i.useMemo)(function(){if(!n||void 0===t)return[];var e=[{address:"0xeBB295af1D4ee9ed92e55EFF4ca5Eb8D4AB81aCE",abi:a.d,functionName:"actionInfo",args:[n,t]},{address:c,abi:o.S,functionName:"amountByActionId",args:[n,t]},{address:c,abi:o.S,functionName:"numOfAccounts",args:[n,t]},{address:c,abi:o.S,functionName:"currentRound",args:[]}];return l&&e.push({address:c,abi:o.S,functionName:"amountByActionIdByAccount",args:[n,t,l]}),e},[n,t,l]),m=(0,r.N)({contracts:u,query:{enabled:!!n&&void 0!==t&&u.length>0}}),x=m.data,f=m.isPending,h=m.error;return(0,i.useMemo)(function(){if(!x||!n||void 0===t)return{actionInfo:void 0,participantCount:void 0,totalAmount:void 0,userJoinedAmount:void 0,isJoined:!1,currentRound:void 0,isPending:f,error:h};var e=(0,s._)(x,5),i=e[0],r=e[1],a=e[2],o=e[3],c=e[4],l=null==i?void 0:i.result,u=(null==r?void 0:r.result)?(0,d.Zu)(r.result):void 0,m=(null==a?void 0:a.result)?(0,d.Zu)(a.result):void 0,v=(null==o?void 0:o.result)?(0,d.Zu)(o.result):void 0,y=(null==c?void 0:c.result)?(0,d.Zu)(c.result):void 0,j=!!y&&y>BigInt(0);return{actionInfo:l,participantCount:m,totalAmount:u,userJoinedAmount:y,isJoined:j,currentRound:v,isPending:f,error:h}},[x,n,t,f,h])}},76364:function(e,n,t){"use strict";t.r(n);var s=t(85893),i=t(67294),r=t(11163),a=t(42130),o=t(36893),d=t(73591),c=t(83494),l=t(42083),u=t(11418),m=t(93778),x=t(31729);n.default=function(){var e=(0,r.useRouter)().query.id,n=e?BigInt(e):void 0,t=(0,a.m)().address,f=((0,i.useContext)(m.M)||{}).token,h=(0,o.r)({tokenAddress:null==f?void 0:f.address,actionId:n,account:t}),v=h.actionInfo,y=h.participantCount,j=h.totalAmount,g=h.userJoinedAmount,b=h.isJoined,N=h.isPending,p=h.error,w=(0,d.S)().handleContractError;return((0,i.useEffect)(function(){p&&w(p,"submit")},[p]),void 0===n)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.Z,{title:"行动激励",showBackButton:!0}),(0,s.jsx)("main",{className:"flex-grow",children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsx)("div",{className:"text-center text-red-500",children:"参数错误：缺少行动ID参数"})})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.Z,{title:"行动激励",showBackButton:!0}),(0,s.jsx)("main",{className:"flex-grow",children:(0,s.jsxs)("div",{className:"px-4 pt-0 pb-3",children:[v&&(0,s.jsx)(u.Z,{actionInfo:v,participantCount:y,totalAmount:j,isJoined:b,userJoinedAmount:g,isPending:N,showActionButtons:!1,linkToActionInfo:!0}),N?(0,s.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(l.Z,{}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"加载数据中..."})]})}):p?(0,s.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,s.jsxs)("div",{className:"text-center text-red-500",children:["加载失败：",p.message||"获取行动信息失败，请稍后重试"]})}):v?(0,s.jsx)(x.Z,{actionId:n,actionInfo:v}):(0,s.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,s.jsx)("div",{className:"text-center text-yellow-600",children:"行动不存在：找不到指定的行动信息"})})]})})]})}},67516:function(e,n,t){"use strict";t.d(n,{N:function(){return u}});var s=t(72253),i=t(14932),r=t(97995),a=t(36100),o=t(67294),d=t(95159),c=t(39360),l=t(78942);function u(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.contracts,u=void 0===t?[]:t,m=n.query,x=void 0===m?{}:m,f=(0,l.Z)(n),h=(0,c.x)({config:f}),v=function(e,n={}){return{async queryFn({queryKey:t}){let s=[],i=t[1].contracts.length;for(let e=0;e<i;e++){let i=t[1].contracts[e],r=(n.contracts?.[e]).abi;s.push({...i,abi:r})}let{scopeKey:a,...o}=t[1];return(0,r.J)(e,{...o,contracts:s})},queryKey:function(e={}){let n=[];for(let t of e.contracts??[]){let{abi:s,...i}=t;n.push({...i,chainId:i.chainId??e.chainId})}return["readContracts",(0,a.OP)({...e,contracts:n})]}(n)}}(f,(0,i._)((0,s._)({},n),{chainId:h})),y=(0,o.useMemo)(function(){var e,n=!1,t=!0,s=!1,i=void 0;try{for(var r,a=u[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value,d=o.abi,c=o.address,l=o.functionName;if(!d||!c||!l){n=!1;break}n=!0}}catch(e){s=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(s)throw i}}return!!(n&&(null===(e=x.enabled)||void 0===e||e))},[u,x.enabled]);return(0,d.aM)((0,i._)((0,s._)({},v,x),{enabled:y,structuralSharing:null!==(e=x.structuralSharing)&&void 0!==e?e:a.if}))}}},function(e){e.O(0,[8239,3615,3494,3591,3950,7724,1489,2888,9774,179],function(){return e(e.s=84476)}),_N_E=e.O()}]);