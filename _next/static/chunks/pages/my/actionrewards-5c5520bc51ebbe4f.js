try{!function(){var n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},e=(new n.Error).stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="a53410db-8a66-4710-b77c-58ffad674ba9",n._sentryDebugIdIdentifier="sentry-dbid-a53410db-8a66-4710-b77c-58ffad674ba9")}()}catch(n){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[943],{51436:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/actionrewards",function(){return t(22565)}])},22565:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return A}});var r=t(91309),i=t(85893),o=t(67294),a=t(11163),s=t(73591),d=t(93778),c=t(11010),u=t(72253),l=t(14932),f=t(97582),x=t(42130),h=t(86501),v=t(7208),g=t(90278),y=t(8345),m=t(7399),w=t(36268),b=t(6743),p=function(n){var e,t=n.tokenAddress,i=(n.currentRound,n.lastRounds),a=(0,x.m)().address,s=(0,v.N6)(t||"",a||"",i-BigInt(1)),d=s.rewards,p=s.isPending,S=s.error,j=(0,g.dB)(t||"",a||""),I=j.joinedActions,R=j.isPending,_=j.error,M=(0,y.s)({tokenAddress:t,account:a}),E=M.joinedExtensionActions,N=M.extensionContractInfos,k=M.isPending,B=M.error,C=(0,o.useMemo)(function(){return N.filter(function(n){return n.isExtension&&n.extension}).map(function(n){return n.extension})},[N]),P=(0,w.Us)({extensionAddresses:C,lastRounds:i,account:a}),A=P.rewardsMap,D=P.isPending,O=P.error,Z=(0,o.useMemo)(function(){var n=I||[],e=E||[];if(0===n.length&&0===e.length)return[];var t=new Map;if(d){var r=!0,i=!1,o=void 0;try{for(var a,s=d[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;if(!(c.reward<=BigInt(0))){var u=c.actionId.toString();t.has(u)||t.set(u,[]),t.get(u).push({round:c.round,mintReward:c.reward,burnReward:BigInt(0),claimed:c.isMinted})}}}catch(n){i=!0,o=n}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}var l=new Map,f=!0,x=!1,h=void 0;try{for(var v,g=N[Symbol.iterator]();!(f=(v=g.next()).done);f=!0){var y=v.value;l.set(y.actionId.toString(),y)}}catch(n){x=!0,h=n}finally{try{f||null==g.return||g.return()}finally{if(x)throw h}}var m=new Set(e.map(function(n){return n.action.head.id.toString()})),w=[],b=!0,p=!1,S=void 0;try{for(var j,R=n[Symbol.iterator]();!(b=(j=R.next()).done);b=!0){var _=j.value,M=String(_.action.head.id),k=t.get(M)||[];k.length>0&&k.sort(function(n,e){return n.round>e.round?-1:1});var B=m.has(M)?l.get(M):void 0,C=(null==B?void 0:B.extension)?A.get(B.extension):void 0;w.push({action:_,coreRewards:k,extensionInfo:B,extensionRewards:C})}}catch(n){p=!0,S=n}finally{try{b||null==R.return||R.return()}finally{if(p)throw S}}var P=new Set(n.map(function(n){return n.action.head.id.toString()})),D=!0,O=!1,Z=void 0;try{for(var T,V=e[Symbol.iterator]();!(D=(T=V.next()).done);D=!0){var G=T.value,L=String(G.action.head.id);if(!P.has(L)){var F=t.get(L)||[];F.length>0&&F.sort(function(n,e){return n.round>e.round?-1:1});var U=l.get(L),X=(null==U?void 0:U.extension)?A.get(U.extension):void 0;w.push({action:G,coreRewards:F,extensionInfo:U,extensionRewards:X})}}}catch(n){O=!0,Z=n}finally{try{D||null==V.return||V.return()}finally{if(O)throw Z}}return w.sort(function(n,e){return BigInt(n.action.action.head.id)>BigInt(e.action.action.head.id)?-1:1}),w},[I,E,d,N,A]),T=(0,m.Rb)(),V=T.mintActionReward,G=T.isPending,L=T.isConfirming,F=T.isConfirmed,U=T.writeError,X=(0,r._)((0,o.useState)(null),2),q=X[0],J=X[1],z=(0,r._)((0,o.useState)(new Set),2),H=z[0],K=z[1];(0,o.useEffect)(function(){if(F){if(h.ZP.success("铸造成功"),q){var n="".concat(q.actionId.toString(),"-").concat(q.round.toString());K(function(e){var t=new Set(e);return t.add(n),t})}t&&a&&(0,b.j)(a,t,!1)}},[F,q,t,a]),(0,o.useEffect)(function(){K(new Set)},[t,a]),(0,o.useEffect)(function(){if(t&&a&&!p&&d){var n=d.some(function(n){return n.reward>BigInt(0)&&!n.isMinted}),e=!1,r=!0,i=!1,o=void 0;try{for(var s,c=A.values()[Symbol.iterator]();!(r=(s=c.next()).done);r=!0)if(s.value.some(function(n){return(n.mintReward>BigInt(0)||n.burnReward>BigInt(0))&&!n.claimed})){e=!0;break}}catch(n){i=!0,o=n}finally{try{r||null==c.return||c.return()}finally{if(i)throw o}}if(!n&&!e){var u=(0,b.FP)(a,t);if(null==u?void 0:u.needMinted){var l=(0,b.iO)(a,t);localStorage.removeItem(l),(0,b.j)(a,t,!1)}}}},[t,a,p,d,A]);var Q=(e=(0,c._)(function(n,e){return(0,f.Jh)(this,function(r){switch(r.label){case 0:if(!(t&&a))return[3,2];return J({actionId:e,round:n}),[4,V(t,n,e)];case 1:r.sent(),r.label=2;case 2:return[2]}})}),function(n,t){return e.apply(this,arguments)});return{displayedGroups:(0,o.useMemo)(function(){return Z?Z.map(function(n){return(0,l._)((0,u._)({},n),{coreRewards:n.coreRewards.map(function(e){var t="".concat(BigInt(n.action.action.head.id).toString(),"-").concat(e.round.toString());return H.has(t)||e.claimed?(0,l._)((0,u._)({},e),{claimed:!0}):e})})}):[]},[Z,H]),isLoading:p||R||k||D,isPending:G,isConfirming:L,handleClaimCoreReward:Q,locallyMinted:H,handleExtensionMintSuccess:function(n,e){var r="".concat(n,"-").concat(e);K(function(n){var e=new Set(n);return e.add(r),e}),t&&a&&(0,b.j)(a,t,!1)},errors:{coreRewards:S,actions:_||B,extensionRewards:O,mint:U}}},S=t(20442),j=t(83494),I=t(42083),R=t(44576),_=t(64777),M=function(n){var e=n.tokenSymbol,t=(0,a.useRouter)();return(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)(_.Z,{title:"铸造行动激励"}),(0,i.jsx)("button",{onClick:function(){return t.push("/my/queryaction?symbol=".concat(e))},className:"text-secondary hover:text-secondary/80 text-sm bg-transparent border-none cursor-pointer",children:"查看已退出行动激励\xa0>>"})]})},E=t(96966),N=t(92261),k=t(89823),B=t(91167),C=t(70734),P=BigInt(7),A=function(){var n=(0,a.useRouter)(),e=((0,o.useContext)(d.M)||{}).token,t=(0,S.Bk)().currentRound,c=(0,r._)((0,o.useState)(!1),2),u=c[0],l=c[1],f=(0,r._)((0,o.useState)(""),2),x=f[0],h=f[1],v=p({tokenAddress:null==e?void 0:e.address,currentRound:t,lastRounds:P}),g=v.displayedGroups,y=v.isLoading,m=v.handleExtensionMintSuccess,w=v.errors,b=function(){l(!0),h("提交交易...")},_=function(){l(!1),h("")},A=(0,s.S)().handleContractError;return(0,o.useEffect)(function(){w.coreRewards&&A(w.coreRewards,"dataViewer"),w.actions&&A(w.actions,"dataViewer"),w.extensionInfo&&A(w.extensionInfo,"dataViewer"),w.extensionRewards&&A(w.extensionRewards,"dataViewer"),w.mint&&A(w.mint,"mint")},[w,A]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(j.Z,{title:"行动激励",showBackButton:!0}),(0,i.jsxs)("main",{className:"flex-grow",children:[e?(0,i.jsxs)("div",{className:"flex flex-col space-y-6 p-4",children:[(0,i.jsx)(M,{tokenSymbol:e.symbol}),y?(0,i.jsx)(I.Z,{}):g.length>0?g.map(function(t){var r,o,a,s=t.action,d=t.coreRewards,c=t.extensionInfo,u=t.extensionRewards,l=null==c?void 0:c.isExtension,f=d.length>0||u&&u.length>0;return(0,i.jsxs)("div",{className:"border border-gray-100 rounded-lg p-4 shadow-sm",children:[(0,i.jsx)("div",{className:"flex items-center mb-3",children:(0,i.jsxs)("div",{className:"flex items-baseline mr-2",children:[(0,i.jsx)("span",{className:"text-greyscale-500",children:"No."}),(0,i.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(s.action.head.id)}),(0,i.jsx)("span",{className:"font-bold text-greyscale-800",children:s.action.body.title})]})}),f?(0,i.jsxs)(i.Fragment,{children:[!l&&d.length>0&&(0,i.jsx)(E.P,{rewards:d,tokenAddress:null==e?void 0:e.address,actionId:s.action.head.id,tokenData:e,onMintStart:b,onMintEnd:_}),l&&(null==c?void 0:c.extension)&&u&&u.length>0&&((null==c?void 0:null===(r=c.factory)||void 0===r?void 0:r.type)===N.nw.GROUP_ACTION?(0,i.jsx)(k.p,{rewards:u,extensionAddress:c.extension,tokenData:e,actionId:s.action.head.id,onMintStart:b,onMintEnd:_,onMintSuccess:function(n){return m(c.extension,n.toString())}}):(null==c?void 0:null===(o=c.factory)||void 0===o?void 0:o.type)===N.nw.LP?(0,i.jsx)(B.M,{rewards:u,extensionAddress:c.extension,tokenData:e,actionId:s.action.head.id,onMintStart:b,onMintEnd:_,onMintSuccess:function(n){return m(c.extension,n.toString())}}):(null==c?void 0:null===(a=c.factory)||void 0===a?void 0:a.type)===N.nw.GROUP_SERVICE?(0,i.jsx)(C.c,{rewards:u,extensionAddress:c.extension,tokenData:e,actionId:s.action.head.id,tokenSymbol:(null==e?void 0:e.symbol)||"",onMintStart:b,onMintEnd:_,onMintSuccess:function(n){return m(c.extension,n.toString())}}):(0,i.jsx)("div",{className:"text-center text-greyscale-500 py-4",children:"暂不支持此扩展类型的激励展示"}))]}):(0,i.jsxs)("div",{className:"text-center text-greyscale-500 py-4",children:["该行动最近 ",P.toString()," 轮没有获得激励"]}),(0,i.jsx)("div",{className:"text-center mt-4",children:(0,i.jsx)("button",{onClick:function(){return n.push("/my/rewardsofaction?id=".concat(s.action.head.id))},className:"text-secondary hover:text-secondary/80 underline text-sm bg-transparent border-none cursor-pointer",children:"查看更多激励 >>"})})]},s.action.head.id)}):(0,i.jsx)("div",{className:"text-center text-greyscale-500 py-8",children:"没有参与任何行动"})]}):(0,i.jsx)(I.Z,{}),(0,i.jsx)(R.Z,{isLoading:u,text:x})]})]})}}},function(n){n.O(0,[8501,4463,3494,3591,5787,8300,2112,5611,6268,7902,7399,7469,2888,9774,179],function(){return n(n.s=51436)}),_N_E=n.O()}]);