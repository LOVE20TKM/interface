(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9178],{94515:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/actrewards",function(){return t(59083)}])},26986:function(e,s,t){"use strict";t.d(s,{OX:function(){return u},Qz:function(){return d},dy:function(){return a},iI:function(){return j},sc:function(){return m},u6:function(){return f},uh:function(){return x},ze:function(){return h}});var n=t(85893),i=t(67294),l=t(53798),r=t(40108);let a=e=>{let{shouldScaleBackground:s=!0,...t}=e;return(0,n.jsx)(l.dy.Root,{shouldScaleBackground:s,...t})};a.displayName="Drawer";let d=l.dy.Trigger,c=l.dy.Portal,x=l.dy.Close,o=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,n.jsx)(l.dy.Overlay,{ref:s,className:(0,r.cn)("fixed inset-0 z-50 bg-black/80",t),...i})});o.displayName=l.dy.Overlay.displayName;let m=i.forwardRef((e,s)=>{let{className:t,children:i,...a}=e;return(0,n.jsxs)(c,{children:[(0,n.jsx)(o,{}),(0,n.jsxs)(l.dy.Content,{ref:s,className:(0,r.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t),...a,children:[(0,n.jsx)("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),i]})]})});m.displayName="DrawerContent";let u=e=>{let{className:s,...t}=e;return(0,n.jsx)("div",{className:(0,r.cn)("grid gap-1.5 p-4 text-center sm:text-left",s),...t})};u.displayName="DrawerHeader";let h=e=>{let{className:s,...t}=e;return(0,n.jsx)("div",{className:(0,r.cn)("mt-auto flex flex-col gap-2 p-4",s),...t})};h.displayName="DrawerFooter";let j=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,n.jsx)(l.dy.Title,{ref:s,className:(0,r.cn)("text-lg font-semibold leading-none tracking-tight",t),...i})});j.displayName=l.dy.Title.displayName;let f=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,n.jsx)(l.dy.Description,{ref:s,className:(0,r.cn)("text-sm text-muted-foreground",t),...i})});f.displayName=l.dy.Description.displayName},20725:function(e,s,t){"use strict";var n=t(85893),i=t(67294),l=t(94782),r=t(67068),a=t(93778),d=t(91529),c=t(27460),x=t(42083),o=t(64777);s.Z=e=>{var s;let{actionId:t,round:m,showSubmitter:u,onActionInfo:h}=e,{token:j}=(0,i.useContext)(a.M)||{},{actionInfo:f,isPending:N,error:y}=(0,l.dI)(null==j?void 0:j.address,t);(0,i.useEffect)(()=>{h&&f&&h(f)},[f]);let{actionSubmits:g,isPending:p,error:v}=(0,l.WZ)(null==j?void 0:j.address,u?m:0n),b=(null==g?void 0:null===(s=g.find(e=>e.actionId==Number(t)))||void 0===s?void 0:s.submitter)||"N/A",{handleContractError:w}=(0,r.S)();return((0,i.useEffect)(()=>{y&&w(y,"submit"),v&&w(v,"submit")},[y,v]),N)?(0,n.jsx)(x.Z,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mx-auto p-4 pb-2 border-t border-greyscale-100",children:(0,n.jsx)(o.Z,{title:"行动详情"})}),(0,n.jsxs)("div",{className:"mx-auto p-4 pb-2 ",children:[(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsxs)("span",{className:"text-sm text-greyscale-500",children:["No.",null==f?void 0:f.head.id.toString()]}),(0,n.jsx)("span",{className:"text-xl font-bold text-black",children:null==f?void 0:f.body.action})]}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("span",{className:"text-greyscale-600",children:null==f?void 0:f.body.consensus})}),(0,n.jsxs)("div",{className:"mt-0 text-xs text-greyscale-500 flex justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center",children:["创建人 ",(0,n.jsx)(c.Z,{address:null==f?void 0:f.head.author})]}),u&&(0,n.jsxs)("div",{className:"flex items-center",children:["推举人"," ",p?(0,n.jsx)(x.Z,{}):(0,n.jsx)(c.Z,{address:b})]})]})]}),(0,n.jsx)("div",{className:"mx-auto p-4 pb-2",children:(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"最小参与代币数"}),(0,n.jsx)("p",{className:"text-greyscale-500",children:(0,d.LH)((null==f?void 0:f.body.minStake)||BigInt(0))})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"随机奖励地址数"}),(0,n.jsx)("p",{className:"text-greyscale-500",children:(null==f?void 0:f.body.maxRandomAccounts.toString())||"-"})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"验证规则"}),(0,n.jsx)("p",{className:"text-greyscale-500 whitespace-pre-wrap",children:null==f?void 0:f.body.verificationRule})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"验证信息"}),(null==f?void 0:f.body.verificationKeys)&&(null==f?void 0:f.body.verificationKeys.length)>0?(0,n.jsx)("ul",{className:"list-disc pl-5",children:f.body.verificationKeys.map((e,s)=>(0,n.jsxs)("li",{className:"text-greyscale-500",children:[e," : ",f.body.verificationInfoGuides[s]]},s))}):(0,n.jsx)("span",{className:"text-greyscale-500",children:"无"})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-bold",children:"白名单"}),(0,n.jsx)("p",{className:"text-greyscale-500 flex flex-wrap items-center",children:(null==f?void 0:f.body.whiteList.length)?f.body.whiteList.map((e,s)=>(0,n.jsx)("span",{className:"flex items-center mr-2",children:(0,n.jsx)(c.Z,{address:e})},s)):"无限制"})]})]})})]})}},64777:function(e,s,t){"use strict";var n=t(85893);s.Z=e=>{let{title:s}=e;return(0,n.jsx)("div",{className:"flex justify-between items-center",children:(0,n.jsx)("h1",{className:"text-lg font-bold",children:s})})}},44576:function(e,s,t){"use strict";var n=t(85893);t(67294);var i=t(23432);s.Z=e=>{let{isLoading:s,text:t="Loading"}=e;return s?(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(i.Z,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,n.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:t})]})}):null}},48105:function(e,s,t){"use strict";t.d(s,{S:function(){return i}});var n=t(86501);let i=e=>!!e||(n.Am.error("请先将钱包链接 ".concat("thinkium801")),!1)},59083:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return C}});var n=t(85893),i=t(67294),l=t(11163),r=t(5028),a=t(67068),d=t(20725),c=t(37436),x=t(42083),o=t(92321),m=t(86501),u=t(27245),h=t(48105),j=t(91529),f=t(93778),N=t(64777),y=t(44576),g=e=>{let{actionId:s}=e,{address:t,chain:l}=(0,o.m)(),{token:d}=(0,i.useContext)(f.M)||{},{joinedAmountByActionIdByAccount:c,isPending:h,error:g}=(0,r.X9)((null==d?void 0:d.address)||"",s,t||""),{withdraw:p,isPending:v,isConfirming:b,isConfirmed:w,error:Z}=(0,r.Qc)();(0,i.useEffect)(()=>{w&&m.Am.success("取回成功")},[w]);let{handleContractError:k}=(0,a.S)();return((0,i.useEffect)(()=>{g&&k(g,"join"),Z&&k(Z,"join")},[g,Z]),h)?(0,n.jsxs)("div",{className:"px-4 pt-4 pb-2",children:[(0,n.jsx)(N.Z,{title:"我的参与"}),(0,n.jsx)(x.Z,{})]}):(0,n.jsxs)("div",{className:"px-4 pt-4 pb-2",children:[(0,n.jsx)(N.Z,{title:"我的参与"}),(0,n.jsx)("div",{className:"stats mt-2 w-full flex justify-center",children:(0,n.jsxs)("div",{className:"stat place-items-center",children:[(0,n.jsx)("div",{className:"stat-title",children:"我参与的代币数"}),(0,n.jsx)("div",{className:"stat-value text-2xl text-secondary",children:(0,j.LH)(c||BigInt(0))})]})}),(0,n.jsx)("div",{className:"flex justify-center space-x-4 mt-2",children:(0,n.jsx)(u.z,{type:"button",className:"w",disabled:!0,children:"第1次内测体验, 暂时关闭 取回和追加代币 功能"})}),(0,n.jsx)(y.Z,{isLoading:v||b,text:v?"提交交易...":"确认交易..."})]})},p=t(7399),v=t(45551),b=t(27460),w=t(26986),Z=e=>{let{currentRound:s,handleChangedRound:t}=e,[l,r]=(0,i.useState)(!1),a=e=>{t(e),r(!1)};return(0,n.jsxs)(w.dy,{open:l,onOpenChange:r,children:[(0,n.jsx)(w.Qz,{asChild:!0,children:(0,n.jsx)(u.z,{variant:"link",className:"text-secondary no-underline",children:"切换轮次"})}),(0,n.jsxs)(w.sc,{children:[(0,n.jsxs)(w.OX,{children:[(0,n.jsx)(w.iI,{}),(0,n.jsx)(w.u6,{})]}),(0,n.jsx)("div",{className:"px-4",children:(0,n.jsx)("div",{className:"max-h-64 overflow-y-auto",children:Array.from({length:Number(s)},(e,t)=>{let i=Number(s)-t;return(0,n.jsx)(u.z,{variant:"ghost",className:"w-full p-2 text-center rounded-none hover:bg-gray-100",onClick:e=>{e.preventDefault(),e.stopPropagation(),a(i)},children:(0,n.jsxs)("span",{className:"text-lg",children:["第 ",i," 轮"]})},i)})})}),(0,n.jsx)(w.ze,{children:(0,n.jsx)(w.uh,{asChild:!0,children:(0,n.jsx)(u.z,{variant:"outline",children:"关闭"})})})]})]})},k=e=>{let{currentJoinRound:s,actionId:t}=e,{token:l}=(0,i.useContext)(f.M)||{},{address:r,chain:d}=(0,o.m)(),[c,x]=(0,i.useState)(0n);(0,i.useEffect)(()=>{l&&s-BigInt(l.initialStakeRound)>=2n&&x(s-BigInt(l.initialStakeRound)-1n)},[s,l]);let{verifiedAddresses:m,isPending:g,error:w}=(0,v.pK)(null==l?void 0:l.address,l&&c?c+BigInt(l.initialStakeRound)-1n:0n,t),[k,C]=(0,i.useState)([]);(0,i.useEffect)(()=>{m&&C(m)},[m]);let{mintActionReward:S,isWriting:I,isConfirming:R,isConfirmed:E,writeError:z}=(0,p.Rb)(),B=async e=>{(0,h.S)(d)&&r&&e.unminted>0&&l&&await S(null==l?void 0:l.address,c+BigInt(l.initialStakeRound)-1n,t)};(0,i.useEffect)(()=>{E&&C(e=>e.map(e=>e.account===r?{...e,unminted:0n}:e))},[E]);let{handleContractError:_}=(0,a.S)();return(0,i.useEffect)(()=>{w&&_(w,"dataViewer"),z&&_(z,"mint")},[w,z]),(0,n.jsxs)("div",{className:"relative px-4 py-4",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(N.Z,{title:"验证结果"}),(0,n.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"行动轮第"}),(0,n.jsx)("span",{className:"text-sm text-secondary ml-1",children:c.toString()}),(0,n.jsx)("span",{className:"text-sm text-greyscale-500 ml-1",children:"轮"}),c>0&&(0,n.jsx)(Z,{currentRound:l&&s?(0,j.cK)(s-2n,l):0n,handleChangedRound:e=>{x(BigInt(e))}})]}),g?"":0===k.length?(0,n.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有地址参与行动"}):(0,n.jsxs)("table",{className:"table w-full",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,n.jsx)("th",{children:"地址"}),(0,n.jsx)("th",{children:"得分"}),(0,n.jsx)("th",{children:"待领取奖励"}),(0,n.jsx)("th",{className:"text-center",children:"结果"})]})}),(0,n.jsx)("tbody",{children:k.map(e=>(0,n.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,n.jsx)("td",{children:(0,n.jsx)(b.Z,{address:e.account,showCopyButton:!1})}),(0,n.jsx)("td",{children:(0,j.LH)(e.score)}),(0,n.jsx)("td",{children:(0,j.LH)(e.minted||e.unminted||0n)}),(0,n.jsx)("td",{className:"text-center",children:e.account===r?e.unminted>0?(0,n.jsx)(u.z,{variant:"outline",size:"sm",className:"text-secondary border-secondary",onClick:()=>B(e),disabled:I||R,children:"领取"}):e.score>0?(0,n.jsx)("span",{className:"text-greyscale-500",children:"已领"}):"":""})]},e.account))})]}),(0,n.jsx)(y.Z,{isLoading:I||R,text:I?"提交交易...":"确认交易..."})]})},C=()=>{let{id:e}=(0,l.useRouter)().query,{currentRound:s,isPending:t,error:o}=(0,r.Bk)(),{handleContractError:m}=(0,a.S)();return(0,i.useEffect)(()=>{o&&m(o,"join")},[o]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.Z,{title:"行动激励"}),(0,n.jsx)("main",{className:"flex-grow",children:t?(0,n.jsx)(x.Z,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(g,{actionId:BigInt(e||0)}),(0,n.jsx)(k,{currentJoinRound:s,actionId:BigInt(e||0)}),(0,n.jsx)(d.Z,{actionId:BigInt(e||0),round:s,showSubmitter:!1})]})})]})}}},function(e){e.O(0,[1335,7863,4782,6697,2042,2888,9774,179],function(){return e(e.s=94515)}),_N_E=e.O()}]);