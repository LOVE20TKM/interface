try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="767731f7-7636-4dd4-b7c6-483df8e58bca",e._sentryDebugIdIdentifier="sentry-dbid-767731f7-7636-4dd4-b7c6-483df8e58bca")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[943],{51436:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/actionrewards",function(){return n(69534)}])},74598:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var r=(0,n(31134).Z)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},64777:function(e,t,n){"use strict";var r=n(85893);t.Z=function(e){var t=e.title;return(0,r.jsx)("div",{className:"flex justify-between items-center",children:(0,r.jsx)("h1",{className:"text-lg font-bold",children:t})})}},42083:function(e,t,n){"use strict";var r=n(85893),s=n(23432);t.Z=function(){return(0,r.jsx)(s.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},69534:function(e,t,n){"use strict";n.r(t);var r=n(11010),s=n(72253),a=n(14932),i=n(91309),d=n(97582),c=n(85893),o=n(67294),l=n(86501),u=n(42130),x=n(11163),f=n(93778),h=n(7208),m=n(93950),b=n(7399),g=n(73591),y=n(83494),j=n(64777),v=n(42083),p=n(44576),w=n(27245),N=n(74598),_=n(26858),S=n(6743),I=BigInt(15);t.default=function(){var e,t=(0,x.useRouter)(),n=((0,o.useContext)(f.M)||{}).token,k=(0,u.m)().address,B=(0,h.N6)(null==n?void 0:n.address,k,I),E=B.rewards,M=B.isPending,Z=B.error,C=(0,m.dB)(null==n?void 0:n.address,k),P=C.joinedActions,D=C.isPending,T=C.error,F=(0,o.useMemo)(function(){if(!P||!E)return[];var e=new Map,t=!0,n=!1,r=void 0;try{for(var s,a=E[Symbol.iterator]();!(t=(s=a.next()).done);t=!0){var i=s.value;if(!(i.reward<=BigInt(0))){var d=i.actionId.toString();e.has(d)||e.set(d,[]),e.get(d).push(i)}}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}var c=[],o=!0,l=!1,u=void 0;try{for(var x,f=P[Symbol.iterator]();!(o=(x=f.next()).done);o=!0){var h=x.value,m=String(h.action.head.id),b=e.get(m)||[];b.length>0&&b.sort(function(e,t){return e.round>t.round?-1:1}),c.push({action:h,rewards:b})}}catch(e){l=!0,u=e}finally{try{o||null==f.return||f.return()}finally{if(l)throw u}}return c.sort(function(e,t){return BigInt(e.action.action.head.id)>BigInt(t.action.action.head.id)?-1:1}),c},[P,E]),O=(0,b.Rb)(),R=O.mintActionReward,z=O.isPending,A=O.isConfirming,L=O.isConfirmed,V=O.writeError,X=(0,i._)((0,o.useState)(null),2),q=X[0],H=X[1],J=(0,i._)((0,o.useState)(new Set),2),K=J[0],G=J[1];(0,o.useEffect)(function(){if(L){if(l.ZP.success("铸造成功"),q){var e="".concat(q.actionId.toString(),"-").concat(q.round.toString());G(function(t){var n=new Set(t);return n.add(e),n})}(null==n?void 0:n.address)&&k&&(0,S.j)(k,n.address,!1)}},[L,q,null==n?void 0:n.address,k]),(0,o.useEffect)(function(){G(new Set)},[null==n?void 0:n.address,k]),(0,o.useEffect)(function(){if((null==n?void 0:n.address)&&k&&!M&&E&&!E.some(function(e){return e.reward>BigInt(0)&&!e.isMinted})){var e=(0,S.FP)(k,n.address);if(null==e?void 0:e.needMinted){var t=(0,S.iO)(k,n.address);localStorage.removeItem(t),(0,S.j)(k,n.address,!1)}}},[null==n?void 0:n.address,k,M,E]);var Q=(e=(0,r._)(function(e,t){return(0,d.Jh)(this,function(r){switch(r.label){case 0:if(!((null==n?void 0:n.address)&&k))return[3,2];return H({actionId:t,round:e}),[4,R(n.address,e,t)];case 1:r.sent(),r.label=2;case 2:return[2]}})}),function(t,n){return e.apply(this,arguments)}),U=(0,o.useMemo)(function(){return F?F.map(function(e){return(0,a._)((0,s._)({},e),{rewards:e.rewards.map(function(t){var n="".concat(BigInt(e.action.action.head.id).toString(),"-").concat(t.round.toString());return K.has(n)||t.isMinted?(0,a._)((0,s._)({},t),{isMinted:!0}):t})})}):[]},[F,K]),W=(0,g.S)().handleContractError;return(0,o.useEffect)(function(){Z&&W(Z,"dataViewer"),T&&W(T,"dataViewer"),V&&W(V,"mint")},[Z,T,V,W]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(y.Z,{title:"行动激励",showBackButton:!0}),(0,c.jsxs)("main",{className:"flex-grow",children:[n?(0,c.jsxs)("div",{className:"flex flex-col space-y-6 p-4",children:[(0,c.jsxs)("div",{className:"flex justify-between items-center",children:[(0,c.jsx)(j.Z,{title:"铸造行动激励"}),(0,c.jsx)("button",{onClick:function(){return t.push("/my/queryaction?symbol=".concat(null==n?void 0:n.symbol))},className:"text-secondary hover:text-secondary/80 text-sm bg-transparent border-none cursor-pointer",children:"查看已退出行动激励\xa0>>"})]}),(0,c.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-red-500 text-sm",children:(0,c.jsxs)("div",{className:"flex items-start gap-2",children:[(0,c.jsx)(N.Z,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"font-medium",children:"小贴士："}),(0,c.jsx)("br",{}),"如果对激励打分有疑问，可以",(0,c.jsx)("br",{}),"1. 仔细阅读行动打分规则，检查是否按要求打卡；",(0,c.jsx)("br",{}),"2. 请教周围的治理者或志愿者；"]})]})}),M||D?(0,c.jsx)(v.Z,{}):U.length>0?U.map(function(e){return(0,c.jsxs)("div",{className:"border border-gray-100 rounded-lg p-4 shadow-sm",children:[(0,c.jsx)("div",{className:"flex items-center mb-3",children:(0,c.jsxs)("div",{className:"flex items-baseline  mr-2",children:[(0,c.jsx)("span",{className:"text-greyscale-500",children:"No."}),(0,c.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(e.action.action.head.id)}),(0,c.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(e.action.action.body.title)})]})}),e.rewards.length>0?(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)("table",{className:"table w-full table-auto",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,c.jsx)("th",{className:"text-left px-0",children:"轮次"}),(0,c.jsx)("th",{className:"text-center",children:"可铸造激励"}),(0,c.jsx)("th",{className:"text-center",children:"结果"}),(0,c.jsx)("th",{className:"text-center",children:"验证详情"})]})}),(0,c.jsx)("tbody",{children:e.rewards.map(function(r,s){return(0,c.jsxs)("tr",{className:s===e.rewards.length-1?"border-none":"border-b border-gray-100",children:[(0,c.jsx)("td",{className:"px-1",children:(0,_.cK)(r.round,n).toString()}),(0,c.jsx)("td",{className:"text-center px-1",children:(0,_.LH)(r.reward||BigInt(0))}),(0,c.jsx)("td",{className:"text-center px-1",children:r.reward>BigInt(0)&&!r.isMinted?(0,c.jsx)(w.z,{variant:"outline",size:"sm",className:"text-secondary border-secondary",onClick:function(){return Q(r.round,BigInt(e.action.action.head.id))},disabled:z||A,children:"铸造"}):r.isMinted?(0,c.jsx)("span",{className:"text-greyscale-500",children:"已铸造"}):(0,c.jsx)("span",{className:"text-greyscale-500",children:"-"})}),(0,c.jsx)("td",{className:"text-center px-1",children:(0,c.jsx)("button",{onClick:function(){return t.push("/verify/detail?symbol=".concat(null==n?void 0:n.symbol,"&id=").concat(e.action.action.head.id.toString(),"&round=").concat(r.round.toString()))},className:"text-secondary hover:text-secondary/80 underline text-sm bg-transparent border-none cursor-pointer",children:"验证明细 >>"})})]},"".concat(e.action.action.head.id,"-").concat(r.round.toString()))})})]})}):(0,c.jsxs)("div",{className:"text-center text-greyscale-500 py-4",children:["该行动最近 ",I.toString()," 轮没有获得激励"]}),(0,c.jsx)("div",{className:"text-center",children:(0,c.jsx)("button",{onClick:function(){return t.push("/my/rewardsofaction?id=".concat(e.action.action.head.id))},className:"text-secondary hover:text-secondary/80 underline text-sm bg-transparent border-none cursor-pointer",children:"查看更多激励 >>"})})]},e.action.action.head.id)}):(0,c.jsx)("div",{className:"text-center text-greyscale-500 py-8",children:"没有参与任何行动"})]}):(0,c.jsx)(v.Z,{}),(0,c.jsx)(p.Z,{isLoading:z||A,text:z?"提交交易...":"确认交易..."})]})]})}}},function(e){e.O(0,[8501,4463,3494,3591,3950,7399,2888,9774,179],function(){return e(e.s=51436)}),_N_E=e.O()}]);