try{!function(){var n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},e=(new n.Error).stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="6c85ba78-8377-46a1-9e0e-5403286cd4c9",n._sentryDebugIdIdentifier="sentry-dbid-6c85ba78-8377-46a1-9e0e-5403286cd4c9")}()}catch(n){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2479],{34541:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/rewardsofaction",function(){return t(99915)}])},42083:function(n,e,t){"use strict";var r=t(85893),i=t(23432);e.Z=function(){return(0,r.jsx)(i.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},93566:function(n,e,t){"use strict";t.d(e,{$A:function(){return m},Bk:function(){return x},Xo:function(){return b},dI:function(){return l},qd:function(){return v},r7:function(){return g},sK:function(){return h}});var r=t(11010),i=t(97582),s=t(67294),o=t(71104),d=t(7724),a=t(37742),u=t(84689),c=t(37474),f="0xeBB295af1D4ee9ed92e55EFF4ca5Eb8D4AB81aCE",l=function(n,e){var t=(0,o.u)({address:f,abi:d.d,functionName:"actionInfo",args:[n,e||BigInt(0)],query:{enabled:!!n&&void 0!==e}});return{actionInfo:t.data,isPending:t.isPending,error:t.error}},g=function(n){var e=(0,o.u)({address:f,abi:d.d,functionName:"actionsCount",args:[n]}),t=e.data,r=e.isPending,i=e.error;return{actionNum:t?(0,a.Z)(t):void 0,isPending:r,error:i}},x=function(){var n=(0,o.u)({address:f,abi:d.d,functionName:"currentRound",args:[]}),e=n.data,t=n.isPending,r=n.error;return{currentRound:(0,a.Z)(e),isPending:t,error:r}},m=function(n,e,t){var r=(0,o.u)({address:f,abi:d.d,functionName:"isSubmitted",args:[n,e,t]});return{isSubmitted:r.data,isPending:r.isPending,error:r.error}},h=function(n,e,t){var r=(0,o.u)({address:f,abi:d.d,functionName:"submitInfo",args:[n,e,t],query:{enabled:!!n&&!!e}});return{submitInfo:r.data,isPending:r.isPending,error:r.error}};function v(){var n,e=(0,c.e9)(d.d,f,"submit"),t=e.execute,o=e.isPending,a=e.isConfirming,l=e.isConfirmed,g=e.error,x=e.hash,m=e.isTukeMode,h=(n=(0,r._)(function(n,e){return(0,i.Jh)(this,function(r){switch(r.label){case 0:return console.log("提交submit交易:",{tokenAddress:n,actionId:e,isTukeMode:m}),[4,t([n,e])];case 1:return[2,r.sent()]}})}),function(e,t){return n.apply(this,arguments)});return(0,s.useEffect)(function(){x&&console.log("submit tx hash:",x),g&&(console.log("提交submit交易错误:"),(0,u.Vh)(g),(0,u.H)(g)),l&&console.log("submit tx confirmed")},[x,g,l]),{submit:h,isPending:o,isConfirming:a,writeError:g,isConfirmed:l,hash:x,isTukeMode:m}}function b(){var n,e=(0,c.e9)(d.d,f,"submitNewAction"),t=e.execute,o=e.isPending,a=e.isConfirming,l=e.isConfirmed,g=e.error,x=e.hash,m=e.isTukeMode,h=(n=(0,r._)(function(n,e){return(0,i.Jh)(this,function(r){switch(r.label){case 0:return console.log("提交submitNewAction交易:",{tokenAddress:n,actionBody:e,isTukeMode:m}),[4,t([n,e])];case 1:return[2,r.sent()]}})}),function(e,t){return n.apply(this,arguments)});return(0,s.useEffect)(function(){x&&console.log("submitNewAction tx hash:",x),g&&(console.log("提交submitNewAction交易错误:"),(0,u.Vh)(g),(0,u.H)(g)),l&&console.log("submitNewAction tx confirmed")},[x,g,l]),{submitNewAction:h,isPending:o,isConfirming:a,writeError:g,isConfirmed:l,hash:x,isTukeMode:m}}},5563:function(n,e,t){"use strict";t.d(e,{t:function(){return u}});var r=t(91309),i=t(67294),s=t(42130),o=t(67516),d=t(4502),a=t(37742),u=function(n){var e=n.extensionAddress,t=n.startRound,u=n.endRound,c=n.enabled,f=(0,s.m)().address,l=(0,i.useMemo)(function(){if(!e||!f||!c||u<t)return[];for(var n=[],r=t;r<=u;r++)n.push({address:e,abi:d.q,functionName:"rewardByAccount",args:[r,f]});return n},[e,f,c,t,u]),g=(0,o.N)({contracts:l,query:{enabled:l.length>0}}),x=g.data,m=g.isPending,h=g.error,v=g.refetch;return{rewards:(0,i.useMemo)(function(){if(!x||0===x.length)return[];for(var n=[],e=0;e<x.length;e++){var i=x[e];if(null==i?void 0:i.result){var s=(0,r._)(i.result,3),o=s[0],d=s[1],u=s[2],c=t+BigInt(e);n.push({round:c,mintReward:(0,a.Z)(o),burnReward:(0,a.Z)(d),claimed:u})}}return n.sort(function(n,e){return n.round>e.round?-1:1})},[x,t]),isPending:l.length>0&&m,error:h,refetch:v||function(){}}}},99915:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return P}});var r=t(72253),i=t(14932),s=t(91309),o=t(4586),d=t(85893),a=t(67294),u=t(11163),c=t(93778),f=t(93566),l=t(20442),g=t(73591),x=t(42130),m=t(7208),h=t(92112),v=t(5563),b=function(n){var e=n.tokenAddress,t=n.actionInfo,r=n.startRound,i=n.endRound,s=n.enabled,o=(0,x.m)().address,d=null==t?void 0:t.head.id,u=(0,h.kz)({tokenAddress:e,actionInfo:t}),c=u.contractInfo,f=u.isPending,l=u.error,g=(null==c?void 0:c.isExtension)||!1,b=(0,m.B$)(!g&&s&&e?e:"0x0",!g&&s&&o?o:"0x0",!g&&s&&void 0!==d?d:BigInt(0),!g&&s?r:BigInt(0),!g&&s?i:BigInt(0)),w=b.rewards,I=b.isPending,y=b.error,N=b.refetch,p=(0,v.t)({extensionAddress:null==c?void 0:c.extension,startRound:r,endRound:i,enabled:g&&s}),j=p.rewards,E=p.isPending,k=p.error,B=p.refetch,_=(0,a.useMemo)(function(){return g?j||[]:(w||[]).map(function(n){return{round:n.round,mintReward:n.reward,burnReward:BigInt(0),claimed:n.isMinted}})},[g,j,w]),P=g?E:I,R=g?k:y,M=(0,a.useMemo)(function(){return function(){g?null==B||B():null==N||N()}},[g,B,N]);return{extensionInfo:c,isLoadingExtensionInfo:f,errorExtensionInfo:l,rewards:_,isLoadingRewards:P,errorRewards:R,isExtensionAction:g,isLoading:f||P,refetch:M}},w=t(83494),I=t(64777),y=t(42083),N=t(44576),p=t(96966),j=t(92261),E=t(89823),k=t(91167),B=t(70734),_=BigInt(20),P=function(){var n,e,t,x=(0,u.useRouter)(),m=x.query.id,h=x.isReady&&"string"==typeof m&&""!==m.trim()?BigInt(m):void 0,v=((0,a.useContext)(c.M)||{}).token,P=(0,l.Bk)(),R=P.currentRound,M=P.isPending,S=P.error,A=(0,s._)((0,a.useState)(BigInt(0)),2),C=A[0],Z=A[1],D=(0,s._)((0,a.useState)(BigInt(0)),2),L=D[0],T=D[1],q=(0,s._)((0,a.useState)(!0),2),O=q[0],F=q[1],V=(0,s._)((0,a.useState)(!1),2),X=V[0],G=V[1],H=(0,a.useRef)(null),J=(0,s._)((0,a.useState)(!1),2),U=J[0],$=J[1],z=(0,s._)((0,a.useState)(""),2),K=z[0],Q=z[1],W=(0,f.dI)(null==v?void 0:v.address,h),Y=W.actionInfo,nn=W.isPending,ne=W.error,nt=b({tokenAddress:null==v?void 0:v.address,actionInfo:Y,startRound:C,endRound:L,enabled:X}),nr=nt.extensionInfo,ni=nt.rewards,ns=nt.isLoadingRewards,no=nt.errorRewards,nd=nt.isExtensionAction,na=nt.isLoadingExtensionInfo,nu=nt.errorExtensionInfo,nc=nt.refetch,nf=(0,s._)((0,a.useState)([]),2),nl=nf[0],ng=nf[1];(0,a.useEffect)(function(){void 0!==h&&(G(!1),Z(BigInt(0)),T(BigInt(0)),F(!0),ng([]))},[h]),(0,a.useEffect)(function(){if(Y&&v&&void 0!==R&&!X){var n=R>2?R-BigInt(2):BigInt(0);Z(n>BigInt(20)?n-BigInt(20):BigInt(0)),T(n),G(!0)}},[Y,v,R,X]),(0,a.useEffect)(function(){v&&X&&F(C>BigInt(0))},[C,v,X]),(0,a.useEffect)(function(){if(X&&ni&&ni.length>0){var n=(0,o._)(ni).sort(function(n,e){return n.round<e.round?1:n.round>e.round?-1:0});ng(function(e){var t=new Set(e.map(function(n){return n.round.toString()})),r=n.filter(function(n){return!t.has(n.round.toString())});return(0,o._)(e).concat((0,o._)(r)).sort(function(n,e){return n.round<e.round?1:n.round>e.round?-1:0})})}},[ni,X]);var nx=(0,a.useCallback)(function(){$(!0),Q("提交交易...")},[]),nm=(0,a.useCallback)(function(){$(!1),Q("")},[]),nh=(0,a.useCallback)(function(n){ng(function(e){return e.map(function(e){return e.round===n?(0,i._)((0,r._)({},e),{claimed:!0}):e})}),nc&&nc()},[nc]),nv=(0,a.useCallback)(function(){if(v){var n=BigInt(0);Z(function(e){return e>n?e-_>=n?e-_:n:e})}},[v]);(0,a.useEffect)(function(){if(H.current&&X){var n=H.current,e=new IntersectionObserver(function(n){n.forEach(function(n){n.isIntersecting&&!ns&&O&&nv()})},{root:null,rootMargin:"200px",threshold:0});return e.observe(n),function(){e.unobserve(n),e.disconnect()}}},[nv,ns,O,X]);var nb=(0,g.S)().handleContractError;return((0,a.useEffect)(function(){ne&&nb(ne,"actionInfo"),S&&nb(S,"currentRound"),nu&&nb(nu,"extensionCenter"),no&&nb(no,"dataViewer")},[ne,S,nu,no,nb]),x.isReady)?void 0===h?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(w.Z,{title:"行动激励",showBackButton:!0}),(0,d.jsx)("main",{className:"flex-grow",children:(0,d.jsx)("div",{className:"flex flex-col space-y-6 p-4",children:(0,d.jsx)("div",{className:"text-center text-red-500 py-4",children:"缺少行动ID参数"})})})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(w.Z,{title:"行动激励",showBackButton:!0}),(0,d.jsxs)("main",{className:"flex-grow",children:[!v||nn||M||na?(0,d.jsx)(y.Z,{}):(0,d.jsxs)("div",{className:"flex flex-col space-y-6 p-4",children:[(0,d.jsx)(I.Z,{title:"铸造行动激励："}),Y&&(0,d.jsx)("div",{className:"",children:(0,d.jsx)("div",{className:"flex items-center mb-3",children:(0,d.jsxs)("div",{className:"flex items-baseline mr-2",children:[(0,d.jsx)("span",{className:"text-greyscale-500",children:"No."}),(0,d.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(Y.head.id)}),(0,d.jsx)("span",{className:"font-bold text-greyscale-800",children:Y.body.title})]})})}),nd?(null==nr?void 0:nr.extension)?(null==nr?void 0:null===(n=nr.factory)||void 0===n?void 0:n.type)===j.nw.GROUP_ACTION?(0,d.jsx)(E.p,{rewards:nl,extensionAddress:nr.extension,tokenData:v,actionId:h,onMintStart:nx,onMintEnd:nm,onMintSuccess:nh,isLoading:ns}):(null==nr?void 0:null===(e=nr.factory)||void 0===e?void 0:e.type)===j.nw.LP?(0,d.jsx)(k.M,{rewards:nl,extensionAddress:nr.extension,tokenData:v,actionId:h,onMintStart:nx,onMintEnd:nm,onMintSuccess:nh,isLoading:ns}):(null==nr?void 0:null===(t=nr.factory)||void 0===t?void 0:t.type)===j.nw.GROUP_SERVICE?(0,d.jsx)(B.c,{rewards:nl,extensionAddress:nr.extension,tokenData:v,actionId:h,tokenSymbol:(null==v?void 0:v.symbol)||"",onMintStart:nx,onMintEnd:nm,onMintSuccess:nh,isLoading:ns}):(0,d.jsx)("div",{className:"text-center text-sm text-gray-500 py-4",children:"暂不支持此扩展类型的激励展示"}):(0,d.jsx)("div",{className:"text-center text-sm text-gray-500 py-4",children:"无法加载扩展行动信息"}):(0,d.jsx)(p.P,{rewards:nl,tokenAddress:null==v?void 0:v.address,actionId:h,tokenData:v,onMintStart:nx,onMintEnd:nm,onMintSuccess:nh,isLoading:ns}),(0,d.jsx)("div",{ref:H,className:"h-12 flex justify-center items-center",children:ns?(0,d.jsx)(y.Z,{}):O?(0,d.jsx)("span",{className:"text-sm text-gray-500",children:"上滑加载更多..."}):(0,d.jsx)("span",{className:"text-sm text-gray-500",children:"没有更多激励"})})]}),(0,d.jsx)(N.Z,{isLoading:U,text:K})]})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(w.Z,{title:"行动激励",showBackButton:!0}),(0,d.jsx)("main",{className:"flex-grow",children:(0,d.jsx)(y.Z,{})})]})}}},function(n){n.O(0,[8501,4463,3494,3591,2112,5801,8945,7399,7469,2888,9774,179],function(){return n(n.s=34541)}),_N_E=n.O()}]);