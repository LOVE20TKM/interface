(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2884],{2293:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>A});var n=s(37876),t=s(14232),r=s(8047),l=s(6960),c=s(48230),i=s.n(c),o=s(12293),d=s(83416),u=s(20451),m=s(9215),x=s(62288),h=s(20442),v=s(4066);let N=e=>{var a=e.currentRound,s=((0,t.useContext)(d.N)||{}).token,r=(0,x.CZ)((null==s?void 0:s.address)||""),l=r.rewardAvailable,c=r.isPending,i=r.error,N=(0,m.lW)((null==s?void 0:s.address)||"","0xDe5256A1cf6022ef6af832181CCE617Aee585Dc9"),f=N.balance,j=N.isPending,g=N.error,p=(0,u.g)().handleContractError;(0,t.useEffect)(()=>{g&&p(g,"join"),i&&p(i,"mint")},[g,i]);var y=s?a-BigInt(s.initialStakeRound)+1n:0n,b=(0,v.u3)(l,y);return(0,n.jsx)("div",{className:"px-4",children:(0,n.jsxs)("div",{className:"w-full border rounded-lg p-0",children:[(0,n.jsxs)("div",{className:"stats w-full grid grid-cols-2 divide-x-0",children:[(0,n.jsxs)("div",{className:"stat place-items-center pb-2",children:[(0,n.jsx)("div",{className:"stat-title text-sm pb-1",children:"参与行动代币总数"}),(0,n.jsx)("div",{className:"stat-value text-xl text-secondary",children:j?(0,n.jsx)(o.A,{}):(0,h.NJ)(f||BigInt(0),0)})]}),(0,n.jsxs)("div",{className:"stat place-items-center pb-2",children:[(0,n.jsx)("div",{className:"stat-title text-sm pb-1",children:"预计新增铸币"}),(0,n.jsx)("div",{className:"stat-value text-xl text-secondary",children:c||void 0===l?(0,n.jsx)(o.A,{}):(0,h.NJ)(b,2)})]})]}),(0,n.jsxs)("div",{className:"text-center text-xs mb-2 text-greyscale-500",children:["预估年化收益率（APY）：",(0,v.BN)(b,f)]})]})})};var f=s(66663),j=s(70641),g=s(96108),p=s(28638),y=s(52372),b=s(18651),w=s(1709),C=s(87577);let _=e=>{var a=e.currentRound,s=((0,t.useContext)(d.N)||{}).token,l=(0,r.F)().address,c=(0,y.pX)((null==s?void 0:s.address)||"",a||0n,l),m=c.joinableActionDetails,N=c.joinedActions,f=c.isPending,_=c.error,B=(0,x.CZ)((null==s?void 0:s.address)||""),I=B.rewardAvailable,A=B.isPending,k=B.error;null==m||m.sort((e,a)=>Number(e.action.head.id)-Number(a.action.head.id));var E=(null==m?void 0:m.reduce((e,a)=>e+a.votesNum,0n))||0n,R=s?a-BigInt(s.initialStakeRound)+1n:0n,M=(0,v.u3)(I,R),T=(0,u.g)().handleContractError;return(0,t.useEffect)(()=>{_&&T(_,"dataViewer"),k&&T(k,"mint")},[_,k]),(0,n.jsxs)("div",{className:"px-4 py-6",children:[(0,n.jsx)(w.A,{title:"本轮可参与的行动："}),(0,n.jsx)(b.A,{currentRound:a,roundType:"act"}),!l&&(0,n.jsx)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:"请先连接钱包"}),l&&f&&(0,n.jsx)("div",{className:"p-4 flex justify-center items-center",children:(0,n.jsx)(o.A,{})}),l&&!f&&!(null==m?void 0:m.length)&&(0,n.jsx)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:"本轮暂无行动"}),!f&&m&&m.length>0&&(0,n.jsx)("div",{className:"mt-2 space-y-4",children:m.map((e,a)=>{var t=null==N?void 0:N.some(a=>a.action.head.id===e.action.head.id),r=Number(E)>0?Number(m[a].votesNum||0n)/Number(E):0,l=t?"/action/".concat(e.action.head.id,"?type=join&symbol=").concat(null==s?void 0:s.symbol):"/acting/join?id=".concat(e.action.head.id,"&symbol=").concat(null==s?void 0:s.symbol);return(0,n.jsx)(p.Zp,{className:"shadow-none",children:(0,n.jsxs)(i(),{href:l,className:"relative block",children:[(0,n.jsxs)(p.aR,{className:"px-3 pt-2 pb-1 flex-row items-baseline",children:[(0,n.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No.".concat(e.action.head.id)}),(0,n.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(e.action.body.action)})]}),(0,n.jsxs)(p.Wu,{className:"px-3 pt-1 pb-2",children:[(0,n.jsx)("div",{className:"text-greyscale-500",children:e.action.body.consensus}),(0,n.jsxs)("div",{className:"flex justify-between mt-1 text-sm",children:[(0,n.jsxs)("span",{className:"flex items-center",children:[(0,n.jsx)(j.A,{className:"text-greyscale-400 mr-1 h-3 w-3 -translate-y-0.5"}),(0,n.jsx)("span",{className:"text-greyscale-400",children:(0,n.jsx)(C.A,{address:m[a].action.head.author,showCopyButton:!1,colorClassName2:"text-secondary"})})]}),(0,n.jsxs)("span",{children:[(0,n.jsx)("span",{className:"text-greyscale-400 mr-1",children:"投票"}),(0,n.jsx)("span",{className:"text-secondary",children:(0,h.Ee)(100*r)})]}),(0,n.jsxs)("span",{children:[(0,n.jsx)("span",{className:"text-greyscale-400 mr-1",children:"预估年化(APY)"}),(0,n.jsx)("span",{className:"text-secondary",children:A?(0,n.jsx)(o.A,{}):(0,v.BN)(BigInt(Math.floor(Number(M||0n)*r)),m[a].joinedAmount)})]})]})]}),(0,n.jsx)(g.A,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-greyscale-400 pointer-events-none"})]})},e.action.head.id)})})]})};var B=s(19593),I=s(17660);let A=()=>{var e=(0,r.F)().isConnected,a=((0,t.useContext)(d.N)||{}).token,s=e&&(null==a?void 0:a.hasEnded)===!0,c=(0,I.vC)(s),m=c.currentRound,x=c.error,h=c.isPending,v=(0,u.g)().handleContractError;return((0,t.useEffect)(()=>{x&&v(x,"join")},[x]),s&&h)?(0,n.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,n.jsx)(o.A,{})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.A,{title:"社区首页"}),(0,n.jsx)("main",{className:"flex-grow",children:e?a?a&&!a.hasEnded?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(B.A,{}),(0,n.jsxs)("div",{className:"flex flex-col items-center p-4 mt-4",children:[(0,n.jsx)("div",{className:"text-center mb-4 text-greyscale-500",children:"公平发射未结束，还不能参与社区行动"}),(0,n.jsx)(l.$,{className:"w-1/2",asChild:!0,children:(0,n.jsx)(i(),{href:"/launch?symbol=".concat(a.symbol),children:"查看公平发射"})})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(B.A,{}),(0,n.jsx)(N,{currentRound:m}),(0,n.jsx)(_,{currentRound:m})]}):(0,n.jsx)(o.A,{}):(0,n.jsx)("div",{className:"flex flex-col items-center p-4 mt-4",children:(0,n.jsx)("div",{className:"text-center mb-4 text-greyscale-500",children:"没有链接钱包，请先连接钱包"})})})]})}},4066:(e,a,s)=>{"use strict";s.d(a,{BN:()=>r,bD:()=>t,u$:()=>l,u3:()=>c});var n=s(20442),t=(e,a,s)=>{if(!e||!a)return"0%";var t=31536e5/Number("255"),r=BigInt("33784");if(0===t||0n===r)return console.error("配置错误: NEXT_PUBLIC_BLOCK_TIME 或 NEXT_PUBLIC_PHASE_BLOCKS 未设置"),"0%";var l=e?99n*e*99n/2000000n:BigInt(0),c=(2n*a||BigInt(0))+(s||BigInt(0));if(c===BigInt(0))return"0%";var i=Number(l)/Number(c)/(Number(r)/t)*100;return(0,n.Ee)(i)},r=(e,a)=>{if(!e||!a||0n===a)return"0%";var s=31536e5/Number("255"),t=BigInt("33784");if(0===s||0n===t)return console.error("配置错误: BLOCK_TIME 或 PHASE_BLOCKS 未设置或为0"),"0%";var r=Number(e)/Number(a)/(Number(t)/s)*100;return(0,n.Ee)(r)},l=function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=Number("33784")||0,n=Number("255")||0,t=e*s,r=Math.ceil(Math.ceil(t*n/100)/86400),l="".concat(t.toLocaleString(),"区块，约").concat(r,"天");return a||(l="".concat(e,"个阶段（").concat(l,")")),l},c=(e,a)=>{if(!e)return BigInt(0);var s=100n-(BigInt("5")+BigInt("5"))/10n,n=BigInt(0);return a<=1n?e*BigInt("5")/1000n:e*s*BigInt("5")/100000n}},18651:(e,a,s)=>{"use strict";s.d(a,{A:()=>d});var n=s(40854),t=s(37876),r=s(14232),l=s(63934),c=s(83416);let i=e=>{var a=e.initialTimeLeft,s=e.onTick,l=(0,n._)((0,r.useState)(Date.now()+1e3*a),2),c=l[0],i=l[1],o=(0,n._)((0,r.useState)(a),2),d=o[0],u=o[1];(0,r.useEffect)(()=>{i(Date.now()+1e3*a)},[a]),(0,r.useEffect)(()=>{var e=setInterval(()=>{var a=Math.max(0,Math.floor((c-Date.now())/1e3));u(a),s&&s(a),a<=0&&(clearInterval(e),window.location.reload())},1e3);return()=>clearInterval(e)},[c,s]);var m=Math.floor(d/86400),x=Math.floor(d%86400/3600),h=Math.floor(d%3600/60);return(0,t.jsxs)("div",{className:"inline-flex gap-1 text-greyscale-400",children:[m>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"countdown font-mono",children:(0,t.jsx)("span",{style:{"--value":m}})}),"天"]}),(x>0||m>0)&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"countdown font-mono",children:(0,t.jsx)("span",{style:{"--value":x}})}),"时"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"countdown font-mono",children:(0,t.jsx)("span",{style:{"--value":h}})}),"分"]}),m<=0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"countdown font-mono",children:(0,t.jsx)("span",{style:{"--value":d%60}})}),"秒"]})]})};var o=s(12293);let d=e=>{var a=e.currentRound,s=e.roundType,d=e.showCountdown,u=(0,l.y)().data,m=(0,r.useContext)(c.N),x=m?m.token:void 0,h=!u||!x||void 0===x.voteOriginBlocks,v=(0,n._)((0,r.useState)(0n),2),N=v[0],f=v[1],j=Number("33784")||0,g=Number("255")||0,p=x?Number(x.voteOriginBlocks):0,y=j-(Number(u)-p)%j,b=y>0?Math.ceil(y*g/100):0,w=(0,n._)((0,r.useState)(b),2),C=w[0],_=w[1];(0,r.useEffect)(()=>{if(u){var e=j-(Number(u)-p)%j;_(e>0?Math.ceil(e*g/100):0)}},[u,j,g,p]),(0,r.useEffect)(()=>{x&&a>0n&&f(a-BigInt(x.initialStakeRound)+1n)},[a,x]);var B=null!=N?N.toString():"0";return(null==x?void 0:x.initialStakeRound)&&!(N<=0n)?h||null==N||N<0n?((null==N||N<0n)&&(console.log("currentTokenRound",N),console.log("currentRound",a),console.log("token.initialStakeRound",null==x?void 0:x.initialStakeRound),console.log("token",x)),(0,t.jsx)(o.A,{})):(0,t.jsx)("div",{className:"flex items-center mb-3",children:(0,t.jsxs)("span",{className:"text-sm text-greyscale-400",children:["( 第",(0,t.jsx)("span",{className:"text-greyscale-400",children:B}),"轮","vote"===s?"投票":"verify"===s?"验证":"行动","阶段，",(0,t.jsx)("span",{className:"text-greyscale-400",children:"剩余"}),(0,t.jsx)("span",{className:"text-greyscale-400",children:Math.ceil(100*C/g)}),(0,t.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),void 0===d||d?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(i,{initialTimeLeft:b,onTick:_})}):(0,t.jsx)("span",{className:"text-greyscale-400",children:C<60?"".concat(C,"秒"):C<=300?"".concat(Math.floor(C/60),"分钟").concat(C%60,"秒"):C<3600?"".concat(Math.floor(C/60),"分钟"):"".concat(Math.floor(C/3600),"小时").concat(Math.floor(C%3600/60),"分钟")}),(0,t.jsx)("span",{className:"text-greyscale-400",children:" )"})]})}):(0,t.jsx)(t.Fragment,{})}},28638:(e,a,s)=>{"use strict";s.d(a,{BT:()=>u,Wu:()=>m,ZB:()=>d,Zp:()=>i,aR:()=>o,wL:()=>x});var n=s(3576),t=s(65699),r=s(37876),l=s(14232),c=s(30684),i=l.forwardRef((e,a)=>{var s=e.className,l=(0,t._)(e,["className"]);return(0,r.jsx)("div",(0,n._)({ref:a,className:(0,c.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s)},l))});i.displayName="Card";var o=l.forwardRef((e,a)=>{var s=e.className,l=(0,t._)(e,["className"]);return(0,r.jsx)("div",(0,n._)({ref:a,className:(0,c.cn)("flex flex-col space-y-1.5 p-6",s)},l))});o.displayName="CardHeader";var d=l.forwardRef((e,a)=>{var s=e.className,l=(0,t._)(e,["className"]);return(0,r.jsx)("div",(0,n._)({ref:a,className:(0,c.cn)("text-2xl font-semibold leading-none tracking-tight",s)},l))});d.displayName="CardTitle";var u=l.forwardRef((e,a)=>{var s=e.className,l=(0,t._)(e,["className"]);return(0,r.jsx)("div",(0,n._)({ref:a,className:(0,c.cn)("text-sm text-muted-foreground",s)},l))});u.displayName="CardDescription";var m=l.forwardRef((e,a)=>{var s=e.className,l=(0,t._)(e,["className"]);return(0,r.jsx)("div",(0,n._)({ref:a,className:(0,c.cn)("p-6 pt-0",s)},l))});m.displayName="CardContent";var x=l.forwardRef((e,a)=>{var s=e.className,l=(0,t._)(e,["className"]);return(0,r.jsx)("div",(0,n._)({ref:a,className:(0,c.cn)("flex items-center p-6 pt-0",s)},l))});x.displayName="CardFooter"},45839:(e,a,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/acting",function(){return s(2293)}])},63934:(e,a,s)=>{"use strict";s.d(a,{y:()=>u});var n=s(63127),t=s(77434),r=s(629),l=s(24751),c=s(57742),i=s(1081),o=s(43387),d=s(79056);function u(e={}){let{query:a={},watch:s}=e,m=(0,o.U)(e),x=(0,n.jE)(),h=(0,i.i)({config:m}),v=e.chainId??h,N=function(e,a={}){return{gcTime:0,async queryFn({queryKey:a}){let{scopeKey:s,...n}=a[1];return await function(e,a={}){let{chainId:s,...n}=a,l=e.getClient({chainId:s});return(0,r.T)(l,t.G,"getBlockNumber")(n)}(e,n)??null},queryKey:function(e={}){return["blockNumber",(0,l.xO)(e)]}(a)}}(m,{...e,chainId:v});return(0,d.r)({...{config:e.config,chainId:e.chainId,..."object"==typeof s?s:{}},enabled:!!((a.enabled??!0)&&("object"==typeof s?s.enabled:s)),onBlockNumber(e){x.setQueryData(N.queryKey,e)}}),(0,c.IT)({...a,...N})}},70641:(e,a,s)=>{"use strict";s.d(a,{A:()=>n});var n=(0,s(11713).A)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},79056:(e,a,s)=>{"use strict";s.d(a,{r:()=>i});var n=s(84194),t=s(629),r=s(14232),l=s(1081),c=s(43387);function i(e={}){let{enabled:a=!0,onBlockNumber:s,config:o,...d}=e,u=(0,c.U)(e),m=(0,l.i)({config:u}),x=e.chainId??m;(0,r.useEffect)(()=>{if(a&&s)return function(e,a){let s,r,{syncConnectedChain:l=e._internal.syncConnectedChain,...c}=a,i=a=>{s&&s();let r=e.getClient({chainId:a});return s=(0,t.T)(r,n.q,"watchBlockNumber")(c)},o=i(a.chainId);return l&&!a.chainId&&(r=e.subscribe(({chainId:e})=>e,async e=>i(e))),()=>{o?.(),r?.()}}(u,{...d,chainId:x,onBlockNumber:s})},[x,u,a,s,d.onError,d.emitMissed,d.emitOnBegin,d.poll,d.pollingInterval,d.syncConnectedChain])}},96108:(e,a,s)=>{"use strict";s.d(a,{A:()=>n});var n=(0,s(11713).A)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])}},e=>{var a=a=>e(e.s=a);e.O(0,[4571,4112,5752,2569,5139,7432,9593,5389,636,6593,8792],()=>a(45839)),_N_E=e.O()}]);