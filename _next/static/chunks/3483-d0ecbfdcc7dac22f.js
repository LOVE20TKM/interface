try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="9c77e9cd-8cb7-4561-804f-d1b9ec176a73",e._sentryDebugIdIdentifier="sentry-dbid-9c77e9cd-8cb7-4561-804f-d1b9ec176a73")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3483],{31729:function(e,n,t){var r=t(11010),i=t(97582),s=t(85893),a=t(67294),o=t(42130),c=t(39360),l=t(86501),d=t(27245),u=t(41664),f=t.n(u),m=t(11163),h=t(20442),g=t(93950),v=t(93566),x=t(7080),p=t(73591),b=t(93778),j=t(91529),y=t(42083),w=t(44576),N=t(72107);n.Z=function(e){var n,t,u=e.actionId,I=e.actionInfo,k=e.onStakedAmountChange,C=e.showJoinButton,B=(0,o.m)().address;(0,c.x)();var P=((0,a.useContext)(b.M)||{}).token,E=(0,m.useRouter)(),A=(0,h.Bk)(),L=A.currentRound,$=A.error,_=(0,v.$A)((null==P?void 0:P.address)||"",L,u),z=_.isSubmitted,M=_.error,R=_.isPending,T=(0,x.Dn)((null==P?void 0:P.address)||"",L,u),D=T.isActionIdVoted,S=T.error,F=T.isPending,H=(0,h.X9)((null==P?void 0:P.address)||"",u,B||""),K=H.joinedAmountByActionIdByAccount,V=H.isPending,Z=H.error,q=(0,h.PL)((null==P?void 0:P.address)||"",u),J=q.joinedAmountByActionId,W=q.isPending,X=q.error,Q=K&&K>0&&J&&J>0,U=Q?Number(K)/Number(J)*100:0,G=(0,j.rl)(U),O=Q?(0,j.rl)(Math.min(U*Number((null==I?void 0:null===(t=I.body)||void 0===t?void 0:t.maxRandomAccounts)||0),100)):"0%",Y=(0,g.Cv)((null==P?void 0:P.address)||"",u,B||""),ee=Y.verificationKeys,en=Y.verificationInfos,et=Y.isPending,er=Y.error,ei=(0,h.Qc)(),es=ei.withdraw,ea=ei.isPending,eo=ei.isConfirming,ec=ei.isConfirmed,el=ei.writeError,ed=(n=(0,r._)(function(){return(0,i.Jh)(this,function(e){switch(e.label){case 0:if(void 0!=K&&K<=BigInt(2))return l.Am.error("你还没有参与，无需取回"),[2];return[4,es((null==P?void 0:P.address)||"",u)];case 1:return e.sent(),[2]}})}),function(){return n.apply(this,arguments)});(0,a.useEffect)(function(){ec&&(l.Am.success("取回成功"),E.push("/my"))},[ec,E]),(0,a.useEffect)(function(){V||null==k||k(K||BigInt(0))},[K,V]);var eu=(0,p.S)().handleContractError;return((0,a.useEffect)(function(){Z&&eu(Z,"join"),X&&eu(X,"join"),er&&eu(er,"join"),$&&eu($,"join"),el&&eu(el,"join"),M&&eu(M,"submit"),S&&eu(S,"vote")},[Z,X,er,$,el,M,S]),V||W||R||F)?"":(0,s.jsxs)("div",{className:"flex flex-col items-center px-4 pt-1",children:[Q&&(0,s.jsxs)("div",{className:"stats w-full grid grid-cols-1 sm:grid-cols-2 divide-x-0 gap-2 sm:gap-0",children:[(0,s.jsxs)("div",{className:"stat place-items-center min-h-[120px] flex flex-col justify-center",children:[(0,s.jsx)("div",{className:"stat-title",children:"我的参与"}),(0,s.jsx)("div",{className:"stat-value text-2xl text-secondary",children:V?(0,s.jsx)(y.Z,{}):(0,j.LH)(K||BigInt(0),0)}),(0,s.jsxs)("div",{className:"stat-desc text-sm mt-2 whitespace-normal break-words text-center",children:[null==P?void 0:P.symbol,"数量"]})]}),(0,s.jsxs)("div",{className:"stat place-items-center min-h-[120px] flex flex-col justify-center",children:[(0,s.jsx)("div",{className:"stat-title",children:"我的占比"}),(0,s.jsx)("div",{className:"stat-value text-2xl text-secondary",children:G}),(0,s.jsxs)("div",{className:"stat-desc text-sm mt-2 whitespace-normal break-words text-center",children:["被抽中验证概率 ",O]})]})]}),(void 0===C||C)&&(0,s.jsx)(s.Fragment,{children:Q?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex justify-center space-x-2 mt-2 w-full",children:[void 0!=K&&K<=BigInt(2)?(0,s.jsx)(d.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",disabled:!0,children:"取回"}):(0,s.jsx)(d.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",onClick:ed,disabled:ea||eo||ec,children:ea?"提交中":eo?"确认中":ec?"已取回":"取回代币"}),(0,s.jsx)(d.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",asChild:!0,children:(0,s.jsx)(f(),{href:"/my/rewardsofaction?id=".concat(u,"&symbol=").concat(null==P?void 0:P.symbol),children:"查看激励"})}),D?(0,s.jsx)(d.z,{variant:"outline",className:"w-1/3 text-secondary border-secondary",asChild:!0,children:(0,s.jsx)(f(),{href:"/acting/join?id=".concat(u,"&symbol=").concat(null==P?void 0:P.symbol),children:"增加参与代币"})}):(0,s.jsx)(d.z,{variant:"outline",className:"w-1/3",disabled:!0,children:"增加参与代币"})]}),(0,s.jsx)("div",{className:"flex flex-col items-start my-4 w-full",children:(0,s.jsxs)("div",{className:"text-sm text-greyscale-600 w-full",children:[et&&"加载中...",void 0!=K&&K>BigInt(2)&&ee&&ee.length>0&&(0,s.jsx)("div",{className:"w-full text-left",children:ee.map(function(e,n){return(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("div",{className:"text-sm font-bold text-greyscale-600",children:e}),(0,s.jsx)("div",{className:"text-base",children:(0,s.jsx)(N.L,{text:en[n]})})]},n)})})]})})]}):z&&(0,s.jsx)(d.z,{variant:"outline",className:"w-1/2 text-secondary border-secondary",asChild:!0,children:(0,s.jsx)(f(),{href:"/acting/join?id=".concat(u,"&symbol=").concat(null==P?void 0:P.symbol),children:"参与行动"})})}),(0,s.jsx)(w.Z,{isLoading:ea||eo,text:ea?"提交交易...":"确认交易..."})]})}},42083:function(e,n,t){var r=t(85893),i=t(23432);n.Z=function(){return(0,r.jsx)(i.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},93566:function(e,n,t){t.d(n,{$A:function(){return h},Bk:function(){return m},Xo:function(){return x},dI:function(){return f},qd:function(){return v},sK:function(){return g}});var r=t(11010),i=t(97582),s=t(67294),a=t(71104),o=t(7724),c=t(37742),l=t(84689),d=t(37474),u="0xeBB295af1D4ee9ed92e55EFF4ca5Eb8D4AB81aCE",f=function(e,n){var t=(0,a.u)({address:u,abi:o.d,functionName:"actionInfo",args:[e,n||BigInt(0)],query:{enabled:!!e&&void 0!==n}});return{actionInfo:t.data,isPending:t.isPending,error:t.error}},m=function(){var e=(0,a.u)({address:u,abi:o.d,functionName:"currentRound",args:[]}),n=e.data,t=e.isPending,r=e.error;return{currentRound:(0,c.Zu)(n),isPending:t,error:r}},h=function(e,n,t){var r=(0,a.u)({address:u,abi:o.d,functionName:"isSubmitted",args:[e,n,t]});return{isSubmitted:r.data,isPending:r.isPending,error:r.error}},g=function(e,n,t){var r=(0,a.u)({address:u,abi:o.d,functionName:"submitInfo",args:[e,n,t],query:{enabled:!!e&&!!n}});return{submitInfo:r.data,isPending:r.isPending,error:r.error}};function v(){var e,n=(0,d.e9)(o.d,u,"submit"),t=n.execute,a=n.isPending,c=n.isConfirming,f=n.isConfirmed,m=n.error,h=n.hash,g=n.isTukeMode,v=(e=(0,r._)(function(e,n){return(0,i.Jh)(this,function(r){switch(r.label){case 0:return[4,t([e,n])];case 1:return[2,r.sent()]}})}),function(n,t){return e.apply(this,arguments)});return(0,s.useEffect)(function(){m&&((0,l.Vh)(m),(0,l.H)(m))},[h,m,f]),{submit:v,isPending:a,isConfirming:c,writeError:m,isConfirmed:f,hash:h,isTukeMode:g}}function x(){var e,n=(0,d.e9)(o.d,u,"submitNewAction"),t=n.execute,a=n.isPending,c=n.isConfirming,f=n.isConfirmed,m=n.error,h=n.hash,g=n.isTukeMode,v=(e=(0,r._)(function(e,n){return(0,i.Jh)(this,function(r){switch(r.label){case 0:return[4,t([e,n])];case 1:return[2,r.sent()]}})}),function(n,t){return e.apply(this,arguments)});return(0,s.useEffect)(function(){m&&((0,l.Vh)(m),(0,l.H)(m))},[h,m,f]),{submitNewAction:v,isPending:a,isConfirming:c,writeError:m,isConfirmed:f,hash:h,isTukeMode:g}}},45655:function(e,n,t){t.d(n,{Hg:function(){return c},KL:function(){return a},lt:function(){return o},rJ:function(){return l}});var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};function i(e){return e?e.replace(/[&<>"'/]/g,function(e){return r[e]||e}):""}function s(e){if(!e)return"";var n=e.replace(/<[^>]*>/g,"");return i(n=(n=(n=n.replace(/javascript:/gi,"")).replace(/on\w+\s*=/gi,"")).replace(/data:[^;]*;base64,/gi,""))}function a(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"";var t=/(https?:\/\/[^\s]+)/g;if(0===(e.match(t)||[]).length){var r=i(e);return n?r.replace(/\n/g,"<br>"):r}var s=e;return s=(s=(s=(s=s.replace(/<script[^>]*>.*?<\/script>/gi,"")).replace(/<[^>]*on\w+\s*=\s*[^>]*>/gi,"")).replace(/javascript:/gi,"")).split(t).map(function(e,n){return n%2==0?function(e){if(!e)return"";var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"};return e.replace(/[&<>"']/g,function(e){return n[e]||e})}(e):o(e)?e:i(e)}).join(""),n&&(s=s.replace(/\n/g,"<br>")),s}function o(e){if(!e)return!1;try{var n=new URL(e);if(!["https:","http:"].includes(n.protocol))return!1;var t=n.hostname.toLowerCase(),r=e.toLowerCase();if(r.includes("javascript:")||r.includes("data:")||r.includes("vbscript:")||r.includes("file:")||["phishing-site.com","fake-bank.com","malware-host.net"].some(function(e){return t===e||t.endsWith("."+e)})||["phishing","malware","trojan","keylogger","ransomware","exploit-kit"].some(function(e){return t.includes(e)})||/[\u0000-\u001f\u007f-\u009f]/.test(t)||!/^[a-zA-Z0-9.-]+$/.test(t))return!1;return/^\d+\.\d+\.\d+\.\d+$/.test(t),!0}catch(e){return!1}}function c(e){var n=[],t=e;if(!e||""===e.trim())return{isValid:!1,errors:["验证规则不能为空"],sanitizedRule:""};e.length>1e4&&n.push("验证规则不能超过10000字"),/<(?:script|iframe|object|embed|form|input|meta|link|style)[^>]*>/gi.test(e)&&(n.push("验证规则不能包含危险的HTML标签"),t=s(e)),RegExp("(?<!https?:\\/\\/[^\\s]*)(javascript:|onclick\\s*=|onerror\\s*=|onload\\s*=|<script)","gi").test(e)&&(n.push("验证规则不能包含可执行脚本代码"),t=s(e));var r=e.match(/(https?:\/\/[^\s]+)/g)||[];if(r.length>0){var i=r.filter(function(e){return!o(e)});i.length>0&&n.push("包含危险的链接，已被安全过滤器拦截: ".concat(i.join(", ")))}return{isValid:0===n.length,errors:n,sanitizedRule:t}}function l(e){var n=[];if(!e||""===e.trim())return{isValid:!1,errors:["验证名称不能为空"],sanitizedKey:""};var t=s(e);return t!==e&&n.push("验证名称包含不安全的内容"),{isValid:0===n.length,errors:n,sanitizedKey:t}}},72107:function(e,n,t){t.d(n,{L:function(){return o}});var r=t(85893);t(67294);var i=t(1938),s=t(45655),a=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return e;var t=/(https?:\/\/[^\s]+)/g;if(!t.test(e)){var a=(0,s.KL)(e,n);return(0,r.jsx)("span",{dangerouslySetInnerHTML:{__html:a}})}var o=e.split(t),c=e.match(t)||[];return(0,r.jsx)(r.Fragment,{children:o.map(function(e,t){if(t%2==0){var a=(0,s.KL)(e,n);return(0,r.jsx)("span",{dangerouslySetInnerHTML:{__html:a}},t)}var o=c[(t-1)/2];return(0,s.lt)(o)?(0,r.jsx)("a",{href:o,onClick:function(e){return(e.preventDefault(),e.stopPropagation(),(0,s.lt)(o))?i.N.handleExternalLink(o):alert("链接安全检查失败: ".concat(o.substring(0,50),"...")),!1},className:"text-blue-500 underline hover:text-blue-700 break-words break-all whitespace-normal",title:"外部链接: ".concat(o),rel:"noopener noreferrer",target:"_self",children:o.length>32?"".concat(o.substring(0,29),"..."):o},t):(0,r.jsx)("span",{className:"text-red-500 font-semibold",children:"[危险链接已被拦截]"},t)})})},o=function(e){var n=e.text,t=e.preserveLineBreaks;return(0,r.jsx)(r.Fragment,{children:a(n,void 0!==t&&t)})}},21803:function(e,n,t){t.d(n,{v:function(){return r}});function r(e,n){let[t,r="0"]=e.split("."),i=t.startsWith("-");if(i&&(t=t.slice(1)),r=r.replace(/(0+)$/,""),0===n)1===Math.round(Number(`.${r}`))&&(t=`${BigInt(t)+1n}`),r="";else if(r.length>n){let[e,i,s]=[r.slice(0,n-1),r.slice(n-1,n),r.slice(n)],a=Math.round(Number(`${i}.${s}`));(r=a>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${a}`).length>n&&(r=r.slice(1),t=`${BigInt(t)+1n}`),r=r.slice(0,n)}else r=r.padEnd(n,"0");return BigInt(`${i?"-":""}${t}${r}`)}}}]);