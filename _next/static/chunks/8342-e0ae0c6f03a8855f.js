try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="c65f75d4-6eb9-4cda-a663-f3a40e077a1c",e._sentryDebugIdIdentifier="sentry-dbid-c65f75d4-6eb9-4cda-a663-f3a40e077a1c")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8342],{21338:function(e,n,t){var r=t(91309),s=t(85893),o=t(67294),a=t(88504),i=t(93778),u=t(74089),c=t(42083);n.Z=function(e){var n=e.currentRound,t=e.roundType,d=e.showCountdown,l=(0,a.O)().data,f=(0,o.useContext)(i.M),g=f?f.token:void 0,h=!l||!g||void 0===g.voteOriginBlocks,m=(0,r._)((0,o.useState)(BigInt(0)),2),I=m[0],p=m[1],v=Number("30126")||0,x=Number("2868")||0,b=g?Number(g.voteOriginBlocks):0,y=v-(Number(l)-b)%v,M=y>0?Math.ceil(y*x/1e3):0,B=(0,r._)((0,o.useState)(M),2),N=B[0],A=B[1];(0,o.useEffect)(function(){if(l){var e=v-(Number(l)-b)%v;A(e>0?Math.ceil(e*x/1e3):0)}},[l,v,x,b]),(0,o.useEffect)(function(){n>BigInt(0)&&p(n)},[n]);var E=null!=I?I.toString():"0";return I<=BigInt(0)?(0,s.jsx)(s.Fragment,{}):h||null==I||I<BigInt(0)?((null==I||I<BigInt(0))&&(console.log("currentTokenRound",I),console.log("currentRound",n)),(0,s.jsx)(c.Z,{})):(0,s.jsx)("div",{className:"flex items-center mb-3",children:(0,s.jsxs)("span",{className:"text-sm text-greyscale-400",children:["(第",(0,s.jsx)("span",{className:"text-greyscale-400",children:E}),"轮","vote"===t?"投票":"verify"===t?"验证":"行动","阶段，",(0,s.jsx)("span",{className:"text-greyscale-400",children:"剩余"}),(0,s.jsx)("span",{className:"text-greyscale-400",children:Math.ceil(1e3*N/x)}),(0,s.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),void 0===d||d?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(u.Z,{initialTimeLeft:M,onTick:A})}):(0,s.jsx)("span",{className:"text-greyscale-400",children:N<60?"".concat(N,"秒"):N<=300?"".concat(Math.floor(N/60),"分钟").concat(N%60,"秒"):N<3600?"".concat(Math.floor(N/60),"分钟"):"".concat(Math.floor(N/3600),"小时").concat(Math.floor(N%3600/60),"分钟")}),(0,s.jsx)("span",{className:"text-greyscale-400",children:")"})]})})}},34188:function(e,n,t){t.d(n,{i:function(){return h}});var r=t(4586),s=t(67294),o=t(67516),a=t(93778),i=t(50095),u=t(8945),c=t(35611),d=t(8926),l=t(8300),f=t(37742),g="0xd94e4Fc2108B78Aa57438BFe5E85192687f74322";function h(e){var n=e.account,t=e.round,h=((0,s.useContext)(a.M)||{}).token,m=null==h?void 0:h.address,I=(0,l.hS)(n,!!n),p=I.balance,v=I.isPending,x=I.error,b=p||BigInt(0),y=(0,s.useMemo)(function(){if(!n||b===BigInt(0))return[];for(var e=[],t=0;t<Number(b);t++)e.push({address:"0xA0a5BB442214988D0c6e707d825640C026fB1d04",abi:i.s,functionName:"tokenOfOwnerByIndex",args:[n,BigInt(t)]});return e},[n,b]),M=(0,o.N)({contracts:y,query:{enabled:!!n&&b>BigInt(0)}}),B=M.data,N=M.isPending,A=M.error,E=(0,s.useMemo)(function(){if(!B)return[];var e=[];return B.forEach(function(n){(null==n?void 0:n.status)==="success"&&n.result&&e.push((0,f.Z)(n.result))}),e},[B]),w=(0,s.useMemo)(function(){return m&&0!==E.length?E.map(function(e){return{address:g,abi:c.w,functionName:"gActionIdsByTokenAddressByGroupId",args:[m,e]}}):[]},[m,E]),k=(0,o.N)({contracts:w,query:{enabled:!!m&&E.length>0}}),j=k.data,_=k.isPending,T=k.error,C=(0,s.useMemo)(function(){var e=new Map,n=new Set;return j?(E.forEach(function(t,r){var s=j[r];if((null==s?void 0:s.status)==="success"&&s.result){var o=s.result.map(function(e){return(0,f.Z)(e)});e.set(t,o),o.forEach(function(e){return n.add(e)})}}),{groupIdToActionIdsMap:e,allUniqueActionIds:Array.from(n)}):{groupIdToActionIdsMap:e,allUniqueActionIds:[]}},[E,j]),D=C.groupIdToActionIdsMap,q=C.allUniqueActionIds,P=(0,d.W)({token:h,actionIds:q,enabled:!!h&&q.length>0}),O=P.extensions,S=P.isPending,Z=P.error,F=(0,s.useMemo)(function(){var e=new Map;return O.forEach(function(n){n.isExtension&&n.extensionAddress&&e.set(n.actionId,n.extensionAddress)}),e},[O]),R=(0,s.useMemo)(function(){var e=[];return D.forEach(function(n,t){n.forEach(function(n){var r=F.get(n);r&&e.push({actionId:n,extensionAddress:r,groupId:t})})}),e},[D,F]),U=(0,s.useMemo)(function(){if(void 0===t||0===R.length)return[];var e=R.map(function(e){var n=e.extensionAddress,r=e.groupId;return{address:"0x6c720b8a9c4803E7D78849E10fe535d862ACbfD1",abi:u.l,functionName:"isVerified",args:[n,t,r]}}),n=R.map(function(e){var n=e.extensionAddress,r=e.groupId;return{address:g,abi:c.w,functionName:"accountsByGroupIdCount",args:[n,t,r]}});return(0,r._)(e).concat((0,r._)(n))},[t,R]),V=(0,o.N)({contracts:U,query:{enabled:void 0!==t&&R.length>0}}),G=V.data,L=V.isPending,W=V.error,z=(0,s.useMemo)(function(){if(G&&0!==R.length)return G.slice(0,R.length)},[G,R.length]),H=(0,s.useMemo)(function(){if(G&&0!==R.length)return G.slice(R.length,2*R.length)},[G,R.length]);return{groups:(0,s.useMemo)(function(){if(!z||!H||0===R.length)return[];var e=[];return z.forEach(function(n,t){if((null==n?void 0:n.status)==="success"){var r=R[t],s=r.actionId,o=r.extensionAddress,a=r.groupId,i=n.result,u=H[t],c=(null==u?void 0:u.status)==="success"?u.result:BigInt(0),d=!i&&c>BigInt(0);e.push({groupId:a,extensionAddress:o,actionId:s,isVerified:i,needToVerify:d})}}),e},[R,z,H]),isPending:(0,s.useMemo)(function(){return!m||!n||void 0===t||!!v||b!==BigInt(0)&&(!!N||0!==E.length&&(!!_||0!==q.length&&(!!S||0!==R.length&&L)))},[m,n,t,v,b,N,E.length,_,q.length,S,R.length,L]),error:x||A||T||Z||W||null}}}}]);